/******/ (function(modules) { // webpackBootstrap
/******/ 	// The module cache
/******/ 	var installedModules = {};
/******/
/******/ 	// The require function
/******/ 	function __webpack_require__(moduleId) {
/******/
/******/ 		// Check if module is in cache
/******/ 		if(installedModules[moduleId]) {
/******/ 			return installedModules[moduleId].exports;
/******/ 		}
/******/ 		// Create a new module (and put it into the cache)
/******/ 		var module = installedModules[moduleId] = {
/******/ 			i: moduleId,
/******/ 			l: false,
/******/ 			exports: {}
/******/ 		};
/******/
/******/ 		// Execute the module function
/******/ 		modules[moduleId].call(module.exports, module, module.exports, __webpack_require__);
/******/
/******/ 		// Flag the module as loaded
/******/ 		module.l = true;
/******/
/******/ 		// Return the exports of the module
/******/ 		return module.exports;
/******/ 	}
/******/
/******/
/******/ 	// expose the modules object (__webpack_modules__)
/******/ 	__webpack_require__.m = modules;
/******/
/******/ 	// expose the module cache
/******/ 	__webpack_require__.c = installedModules;
/******/
/******/ 	// define getter function for harmony exports
/******/ 	__webpack_require__.d = function(exports, name, getter) {
/******/ 		if(!__webpack_require__.o(exports, name)) {
/******/ 			Object.defineProperty(exports, name, { enumerable: true, get: getter });
/******/ 		}
/******/ 	};
/******/
/******/ 	// define __esModule on exports
/******/ 	__webpack_require__.r = function(exports) {
/******/ 		if(typeof Symbol !== 'undefined' && Symbol.toStringTag) {
/******/ 			Object.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });
/******/ 		}
/******/ 		Object.defineProperty(exports, '__esModule', { value: true });
/******/ 	};
/******/
/******/ 	// create a fake namespace object
/******/ 	// mode & 1: value is a module id, require it
/******/ 	// mode & 2: merge all properties of value into the ns
/******/ 	// mode & 4: return value when already ns object
/******/ 	// mode & 8|1: behave like require
/******/ 	__webpack_require__.t = function(value, mode) {
/******/ 		if(mode & 1) value = __webpack_require__(value);
/******/ 		if(mode & 8) return value;
/******/ 		if((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;
/******/ 		var ns = Object.create(null);
/******/ 		__webpack_require__.r(ns);
/******/ 		Object.defineProperty(ns, 'default', { enumerable: true, value: value });
/******/ 		if(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));
/******/ 		return ns;
/******/ 	};
/******/
/******/ 	// getDefaultExport function for compatibility with non-harmony modules
/******/ 	__webpack_require__.n = function(module) {
/******/ 		var getter = module && module.__esModule ?
/******/ 			function getDefault() { return module['default']; } :
/******/ 			function getModuleExports() { return module; };
/******/ 		__webpack_require__.d(getter, 'a', getter);
/******/ 		return getter;
/******/ 	};
/******/
/******/ 	// Object.prototype.hasOwnProperty.call
/******/ 	__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };
/******/
/******/ 	// __webpack_public_path__
/******/ 	__webpack_require__.p = "";
/******/
/******/
/******/ 	// Load entry module and return exports
/******/ 	return __webpack_require__(__webpack_require__.s = 21);
/******/ })
/************************************************************************/
/******/ ({

/***/ 0:
/***/ (function(module, exports) {

/*
	MIT License http://www.opensource.org/licenses/mit-license.php
	Author Tobias Koppers @sokra
*/
module.exports = function(src) {
	function log(error) {
		(typeof console !== "undefined")
		&& (console.error || console.log)("[Script Loader]", error);
	}

	// Check for IE =< 8
	function isIE() {
		return typeof attachEvent !== "undefined" && typeof addEventListener === "undefined";
	}

	try {
		if (typeof execScript !== "undefined" && isIE()) {
			execScript(src);
		} else if (typeof eval !== "undefined") {
			eval.call(null, src);
		} else {
			log("EvalError: No eval function available");
		}
	} catch (error) {
		log(error);
	}
}


/***/ }),

/***/ 21:
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var script_loader_src_common_recenzije_recenzije_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(22);
/* harmony import */ var script_loader_src_common_recenzije_recenzije_js__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(script_loader_src_common_recenzije_recenzije_js__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var _src_common_recenzije_recenzije_css__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(24);
/* harmony import */ var _src_common_recenzije_recenzije_css__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(_src_common_recenzije_recenzije_css__WEBPACK_IMPORTED_MODULE_1__);

/*
 *
 * Files included only in packaged DOS bundles
 *
 */



// ------------------------------- //
// ---------- recenzije ---------- //
// ------------------------------- //





/***/ }),

/***/ 22:
/***/ (function(module, exports, __webpack_require__) {

__webpack_require__(0)(__webpack_require__(23))

/***/ }),

/***/ 23:
/***/ (function(module, exports) {

module.exports = "const devURL = \"https://dos-carnet.int.sedamit.hr/\"; // dev url\nconst testURL = \"https://dos-alat-test.sedamcloud.com/\"; // test url\nconst prodURL = \"https://dos-alat.sedamcloud.com/\" // production\nconst apiURL = \"explain/services/v2/unpackedhpub/\";\nconst servedHpubURL = \"explain/static/book/served/\";\nconst authTokenRef = \"authToken\";\n\nconst downloadLink = document.createElement('a');\ndownloadLink.target = '_blank';\ndownloadLink.style.display = 'none';\ndocument.body.appendChild(downloadLink);\n\nlet baseURL = null;\n\nif (document.location.href.includes(devURL)) {\n  baseURL = devURL;\n} else if (document.location.href.includes(testURL)) {\n  baseURL = testURL;\n} else if (document.location.href.includes(prodURL)) {\n  baseURL = prodURL;\n} else {\n  console.warn('Unrecognized URL, review disabled');\n}\n\n\n$(document).ready(function() {\n  if (baseURL) {\n    // disables reviewing locally\n    const footer = $(\"footer\");\n    $('<div id=\"modal_toggler\" class=\"dos-btn-def-basic\">Komentiranje</div>').appendTo(footer);\n    initRecenzije();\n  }\n});\n\nfunction initRecenzije() {\n  const cookieToken = getCookie();\n  const documentBody = $(document).find(\"body\");\n  const modal = cookieToken ? createModal(cookieToken) : createModal();\n\n  modal.appendTo(documentBody);\n\n  $(\"#modal_toggler\").click(function() {\n    toggleModal(modal);\n  });\n}\n\nfunction toggleModal(modal) {\n  const cookieToken = getCookie();\n  if (cookieToken) {\n    // if there is a cookie, autofill token input field\n    $(\"#token\").val(cookieToken);\n    $('#potvrdi').click();\n  }\n\n  if (modal.css(\"display\") == \"none\") {\n    modal.css({\n      display: \"flex\"\n    });\n  } else {\n    modal.css(\"display\", \"none\");\n  }\n}\n\nfunction createModal(cookie) {\n  // Authentication (1st part of modal)\n  // create elements\n  const modal = $('<div class=\"recenzija_modal\">');\n  const modalAuthForm = $('<div class=\"modal_auth\">');\n\n  const tokenInputDiv = $(\"<div>\");\n  const tokenLabel = $(\"<span> Molimo Vas da unesete token: </span>\");\n  const tokenInput = $('<input id=\"token\">');\n\n  const buttonsDiv = $(\"<div>\");\n  const submitButton = $('<button id=\"potvrdi\"> Potvrdi </button>');\n  const cancelButton = $(\"<button> Odustani </button>\");\n\n  const tooltipDiv = $('<div class=\"modal_tooltips\">');\n\n  // append (render) elements\n  tokenInputDiv.appendTo(modalAuthForm);\n  tokenLabel.appendTo(tokenInputDiv);\n  tokenInput.appendTo(tokenInputDiv);\n\n  buttonsDiv.appendTo(tokenInputDiv);\n  submitButton.appendTo(buttonsDiv);\n  cancelButton.appendTo(buttonsDiv);\n\n  tooltipDiv.appendTo(tokenInputDiv);\n\n  modalAuthForm.appendTo(modal);\n\n  // events\n  submitButton.click(function() {\n    if (tooltipDiv.children().length > 0) {\n      // remove tooltip message if any\n      tooltipDiv.children()[0].remove();\n    }\n\n    if (tokenInput.val()) {\n      if (cookie != tokenInput.val() || getCookie() != tokenInput.val()) {\n        // if entered a new auth token, create a new cookie\n        createAuthCookie(tokenInput.val());\n      }\n      fetchComments(\n        undefined,\n        function(response) {\n          // success callback\n          createCommentForm(modal, response.data.items);\n        },\n        function(message) {\n          // error callback\n          const messageEl = $(\"<span>\", {\n            html: message\n          });\n\n          messageEl.appendTo(tooltipDiv);\n        }\n      );\n    } else {\n      // display no token message\n      const noTokenMessage = \"Molimo Vas unesite token.\";\n      const messageEl = $(\"<span>\");\n\n      messageEl.html(noTokenMessage);\n      messageEl.appendTo(tooltipDiv);\n    }\n  });\n  cancelButton.click(function() {\n    if (tooltipDiv.children().length > 0) {\n      // remove tooltip message if any\n      tooltipDiv.children()[0].remove();\n    }\n    toggleModal(modal);\n  });\n\n  return modal;\n}\n\nfunction createCommentForm(modal, data) {\n  // Comments container (2nd part of modal)\n  const authForm = modal.find(\".modal_auth\");\n  authForm.detach();\n  // create elements\n  const commentForm = $('<div class=\"modal_comments_container\">');\n\n  const commentsFormHeader = $('<div class=\"modal_comments_label\">');\n  const commentsFormHeaderLabel = $(\"<span>\", {\n    html: \"Prijavljeni ste s tokenom: \" + getCookie()\n  });\n  const headerButtonsDiv = $('<div>');\n  const headerButtonsDiv2 = $('<div>');\n  const invalidateButton = $(\"<button> Završi komentiranje </button>\");\n  const logoutButton = $(\"<button> Odjava </button>\");\n\n  const commentsFlexDiv = $('<div class=\"flex_div\">');\n\n  const commentsContainer = $('<div class=\"current_modal_comments\">');\n  const commentsHeader = $(\n    '<div class=\"comments_header\"> Komentari: </div>'\n  );\n  const commentsDiv = $('<div class=\"modal_comments\">');\n  const comments =\n    data.length > 0\n      ? (function() {\n          const comments = data[0].comments;\n          let commentArray = [];\n          for (let i = 0; i < comments.length; i++) {\n            const commentEl = createCommentElement(\n              modal,\n              comments[i],\n              authForm,\n              true,\n              commentsDiv\n            );\n            commentArray.push(commentEl);\n          }\n          return commentArray;\n        })()\n      : null;\n\n  const oldCommentsContainer = $('<div class=\"old_modal_comments\">');\n  const oldCommentsHeader = $('<div class=\"comments_header\">');\n  const breakLine = $('<div class=\"vertical_line\">');\n  const oldCommentsDiv = $('<div class=\"modal_comments\">');\n\n  const buttonsDiv = $('<div class=\"modal_buttons\">');\n  const createCommentButton = $(\"<button> Dodaj novi komentar </button>\");\n  const toggleOldCommentsButton = $(\n    \"<button> Dohvati stare komentare </button>\"\n  );\n  const cancelButton = $(\"<button> Zatvori </button>\");\n\n  // append (render) elements\n  //commentsFormHeaderLabel.appendTo(commentsFormHeader);\n  createCommentButton.appendTo(headerButtonsDiv);\n  invalidateButton.appendTo(headerButtonsDiv);\n  logoutButton.appendTo(headerButtonsDiv2);\n  cancelButton.appendTo(headerButtonsDiv2);\n  headerButtonsDiv.appendTo(commentsFormHeader);\n  headerButtonsDiv2.appendTo(commentsFormHeader);\n\n  if (comments && comments.length > 0) {\n    for (let i = 0; i < comments.length; i++) {\n      $(comments[i]).appendTo(commentsDiv);\n    }\n  } else {\n    const noCommentsPrompt = $(\n      '<div class=\"recenzija_comment\" commentid=\"-1\"><div class=\"comment_text\"> Nema komentara </div></div>'\n    );\n    noCommentsPrompt.appendTo(commentsDiv);\n  }\n\n  commentsHeader.appendTo(commentsContainer);\n  commentsDiv.appendTo(commentsContainer);\n\n  oldCommentsHeader.appendTo(oldCommentsContainer);\n  oldCommentsDiv.appendTo(oldCommentsContainer);\n\n  //createCommentButton.appendTo(buttonsDiv);\n  //toggleOldCommentsButton.appendTo(buttonsDiv);\n  //cancelButton.appendTo(buttonsDiv);\n\n  commentsFormHeader.appendTo(commentForm); // containers\n\n  commentsContainer.appendTo(commentsFlexDiv);\n  commentsFlexDiv.appendTo(commentForm);\n  //buttonsDiv.appendTo(commentForm);\n\n  commentForm.appendTo(modal);\n  commentForm.resizable({\n\t  handles: \"n, e, ne\"\n  });\n\n  // events\n  logoutButton.click(function() {\n    deleteCookie(authTokenRef);\n    commentForm.remove();\n    authForm.find(\"#token\").val(\"\");\n    authForm.appendTo(modal);\n  });\n\n  invalidateButton.click(function() {\n    const message = 'Ovime ćete poništiti Vaš token. Jeste li sigurni?';\n    confirmPrompt(message, modal, function() {\n      invalidateToken(function() {\n        commentForm.detach();\n        authForm.appendTo(modal);\n        toggleModal(modal);\n      });\n    })\n  });\n\n  toggleOldCommentsButton.click(function() {\n    toggleDatePickerForm(modal, function(dateQuery) {\n      // create and add old comments section to comment form\n      const oldComments = oldCommentsContainer\n        .find(\".modal_comments\")\n        .children();\n      if (oldComments && oldComments.length > 0) {\n        for (let i = 0; i < oldComments.length; i++) {\n          oldComments[i].remove();\n        }\n      }\n\n      fetchComments(\n        dateQuery,\n        function(response) {\n          // success callback\n          oldCommentsHeader.html(\"Komentari inačice: \" + dateQuery);\n          const relevantData = response.data.items.filter(function(loc) {\n            return loc.locationLink == document.location.href;\n          });\n          const comments =\n            relevantData[0] && relevantData[0].comments\n              ? relevantData[0].comments\n              : [];\n\n          if (comments && comments.length > 0) {\n            for (let i = 0; i < comments.length; i++) {\n              const newComment = createCommentElement(\n                modal,\n                comments[i],\n                authForm,\n                false,\n                commentsDiv\n              );\n              newComment.appendTo(oldCommentsDiv);\n            }\n          } else {\n            const noCommentsPrompt = $(\n              '<div class=\"recenzija_comment\" commentid=\"-1\"><div class=\"comment_text\"> Nema komentara </div></div>'\n            );\n            noCommentsPrompt.appendTo(oldCommentsDiv);\n          }\n        },\n        function() {\n          // error callback\n          const tooltip = $(\"<span> Nema unesenih komentara </span>\");\n          tooltip.appendTo(oldCommentsDiv);\n        }\n      );\n\n      if (commentsFlexDiv.find(oldCommentsContainer).length == 0) {\n        // only render the first time\n        buttonsDiv.detach();\n        breakLine.appendTo(commentsFlexDiv);\n        oldCommentsContainer.appendTo(commentsFlexDiv);\n        buttonsDiv.appendTo(commentForm);\n      }\n    });\n  });\n  createCommentButton.click(function() {\n    toggleCommentForm(modal, commentsDiv, authForm);\n  });\n  cancelButton.click(function() {\n    const chechForCommentForm = modal.find(\".modal_comment_form\");\n    const checkForPrompt = modal.find(\".modal_prompt\");\n    if (chechForCommentForm.length > 0) {\n      chechForCommentForm.remove();\n    }\n    if (checkForPrompt.length > 0) {\n      checkForPrompt.remove();\n    }\n    toggleModal(modal);\n    commentForm.remove();\n    authForm.appendTo(modal);\n  });\n}\n\nfunction createCommentElement(\n  modal,\n  commentData,\n  authForm,\n  withButtons,\n  parent\n) {\n  // create elements\n  const commentDiv = $(\"<div>\", {\n    class: \"recenzija_comment\",\n    commentId: commentData.unpackedHpubCommentId\n  });\n  const commentText = $(\"<div>\", {\n    class: \"comment_text\",\n    html: commentData.text\n  });\n\n  commentText.appendTo(commentDiv);\n\n  const buttonsDiv = $('<div class=\"control_buttons\">');\n  const editButton = $(\"<button> Uredi </button>\");\n  const deleteButton = $(\"<button> Obriši </button>\");\n\n  // append (render) elements (conditional)\n  if (withButtons) {\n    buttonsDiv.appendTo(commentDiv);\n    editButton.appendTo(buttonsDiv);\n    deleteButton.appendTo(buttonsDiv);\n\n    // events\n    editButton.click(function() {\n      editComment(commentDiv, modal, function(message) {\n        const commentForm = modal.find(\".modal_comments_container\");\n        commentForm.remove();\n        authForm.appendTo(modal);\n\n        const tooltips = authForm.find(\".modal_tooltips\");\n        if (tooltips.children().length > 0) {\n          // remove tooltip message if any\n          tooltips.children()[0].remove();\n        }\n        const tooltipMessage = $(\"<span>\", {\n          html: message\n        });\n\n        tooltipMessage.appendTo(tooltips);\n      });\n    });\n\n    deleteButton.click(function() {\n      deleteComment(commentDiv, modal, parent, function(message) {\n        // error callback\n        const commentForm = modal.find(\".modal_comments_container\");\n        commentForm.remove();\n        authForm.appendTo(modal);\n\n        const tooltips = authForm.find(\".modal_tooltips\");\n        if (tooltips.children().length > 0) {\n          // remove tooltip message if any\n          tooltips.children()[0].remove();\n        }\n        const tooltipMessage = $(\"<span>\", {\n          html: message\n        });\n\n        tooltipMessage.appendTo(tooltips);\n      });\n    });\n  }\n\n  return commentDiv;\n}\n\nfunction toggleCommentForm(modal, commentsDiv, authForm) {\n  // create elements\n  const createCommentDiv = $('<div class=\"modal_comment_form\">');\n\n  const textLabel = $(\"<div> Unesite komentar: </div>\");\n  const textInput = $(\"<textarea>\");\n\n  const buttonsDiv = $('<div class=\"modal_buttons\">');\n  const createButton = $(\"<button> Spremi </button>\");\n  const cancelButton = $(\"<button> Odustani </button>\");\n\n  // append (render) elements\n  textLabel.appendTo(createCommentDiv);\n  textInput.appendTo(createCommentDiv);\n\n  buttonsDiv.appendTo(createCommentDiv);\n  createButton.appendTo(buttonsDiv);\n  cancelButton.appendTo(buttonsDiv);\n\n  createCommentDiv.appendTo(modal);\n\n  // events\n  createButton.click(function() {\n    createComment(\n      textInput.val(),\n      function(response) {\n        // success callback\n        createCommentDiv.remove();\n        const newComment = createCommentElement(\n          modal,\n          response.data,\n          authForm,\n          true,\n          commentsDiv\n        );\n        if (commentsDiv.find('div[commentid=\"-1\"]')) {\n          commentsDiv.find('div[commentid=\"-1\"]').remove();\n        }\n        newComment.appendTo(commentsDiv);\n      },\n      function(message) {\n        // error callback\n        createCommentDiv.remove();\n        modal.find(\".modal_comments_container\").remove();\n        authForm.appendTo(modal);\n\n        const tooltips = authForm.find(\".modal_tooltips\");\n        if (tooltips.children().length > 0) {\n          // remove tooltip message if any\n          tooltips.children()[0].remove();\n        }\n        const tooltipMessage = $(\"<span>\", {\n          html: message\n        });\n\n        tooltipMessage.appendTo(tooltips);\n      }\n    );\n  });\n\n  cancelButton.click(function() {\n    createCommentDiv.remove();\n  });\n}\n\nfunction toggleDatePickerForm(modal, callback) {\n  // create elements\n  const promptDiv = $('<div class=\"modal_prompt\">');\n\n  const dayDiv = $('<div class=\"flex_div\">');\n  const monthDiv = $('<div class=\"flex_div\">');\n  const yearDiv = $('<div class=\"flex_div\">');\n\n  const dayDivLabel = $(\"<span> Unesite dan </span>\");\n  const monthDivLabel = $(\"<span> Unesite mjesec </span>\");\n  const yearDivLabel = $(\"<span> Unesite godinu </span>\");\n\n  const dayInput = $(\"<select>\");\n  const monthInput = $(\"<select>\");\n  const yearInput = $(\"<input>\");\n\n  const dayOptions = (function() {\n    let days = [];\n    for (let i = 0; i < 30; i++) {\n      days.push(\n        $(\"<option>\", {\n          value: i + 1,\n          html: i + 1\n        })\n      );\n    }\n    return days;\n  })();\n  const monthOptions = (function() {\n    let months = [];\n    for (let i = 0; i < 12; i++) {\n      months.push(\n        $(\"<option>\", {\n          value: i + 1,\n          html: i + 1\n        })\n      );\n    }\n    return months;\n  })();\n\n  const buttonsDiv = $('<div class=\"modal_buttons\">');\n  const submitButton = $(\"<button> Unesi </button>\");\n  const cancelButton = $(\"<button> Odustani </button>\");\n\n  const tooltip = $('<div class=\"modal_tooltips\">');\n\n  // render\n  tooltip.appendTo(promptDiv);\n\n  dayDivLabel.appendTo(dayDiv);\n  for (let i = 0; i < dayOptions.length; i++) {\n    dayOptions[i].appendTo(dayInput);\n  }\n  dayInput.appendTo(dayDiv);\n\n  monthDivLabel.appendTo(monthDiv);\n  for (let i = 0; i < monthOptions.length; i++) {\n    monthOptions[i].appendTo(monthInput);\n  }\n  monthInput.appendTo(monthDiv);\n\n  yearDivLabel.appendTo(yearDiv);\n  yearInput.appendTo(yearDiv);\n\n  submitButton.appendTo(buttonsDiv);\n  cancelButton.appendTo(buttonsDiv);\n\n  dayDiv.appendTo(promptDiv); // containers\n  monthDiv.appendTo(promptDiv);\n  yearDiv.appendTo(promptDiv);\n  buttonsDiv.appendTo(promptDiv);\n\n  promptDiv.appendTo(modal);\n\n  // events\n  submitButton.click(function() {\n    const yearRegex = new RegExp(\"^[0-9]{4}\");\n    const dateQuery =\n      dayInput.val() + \"-\" + monthInput.val() + \"-\" + yearInput.val();\n    if (yearRegex.test(yearInput.val())) {\n      callback(dateQuery);\n      promptDiv.remove();\n    } else {\n      tooltip.html(\"Neispravan unos godine\");\n    }\n  });\n  cancelButton.click(function() {\n    promptDiv.remove();\n  });\n}\n\nfunction confirmPrompt(message, modal, callback) {\n  // create elements\n  const promptContainer = $('<div class=\"recenzije-confirmPrompt\">');\n  const messageContainer = $('<span>', {\n    html: message,\n  });\n  const buttonsContainer = $('<div class=\"recenzije-confirmPrompt__buttons\">');\n  const yesButton = $('<button>', {\n    html: 'Potvrdi',\n    click: function() {\n      callback();\n      promptContainer.remove();\n    }\n  });\n  const noButton = $('<button>', {\n    html: 'Odustani'\n  });\n\n  // render\n  messageContainer.appendTo(promptContainer);\n  yesButton.appendTo(buttonsContainer);\n  noButton.appendTo(buttonsContainer);\n  buttonsContainer.appendTo(promptContainer);\n  promptContainer.appendTo(modal);\n\n  // events\n  noButton.click(function() {\n    promptContainer.remove();\n  })\n}\n\n// API CALLS\n\nfunction invalidateToken(callback) {\n  downloadComments(function() {\n    $.post({\n      url: baseURL + apiURL + 'token/invalidate',\n      data: JSON.stringify({\n        generatedToken: getCookie()\n      }),\n      dataType: \"json\",\n      contentType: \"application/json;charset=UTF-8\",\n      success: function() {\n        callback();\n      },\n      error: function() {\n        console.error('Došlo je do greške s poslužiteljem');\n      }\n    })\n  })\n}\n\nfunction downloadComments(callback) {\n  $.post({\n    url: baseURL + apiURL + 'comment/list/csv',\n    data: JSON.stringify({\n      token: getCookie(),\n      derId: getHpubInfo().downloadId,\n    }),\n    dataType: \"json\",\n    contentType: \"application/json;charset=UTF-8\",\n    success: function(data) {\n      callback();\n    },\n    error: function(data) { // for unknown reasons this api call triggers error function even tough status is 200 (success)\n      const csvString = unescape(encodeURIComponent(data.responseText));\n\n      downloadLink.href = 'data:attachment/csv;base64,77u/' + window.btoa(csvString);\n      downloadLink.download = getCookie() + '.csv';\n      setTimeout(function() {downloadLink.click()}, 2000);\n      callback();\n    }\n  })\n}\n\nfunction fetchComments(date, callback, errorCallback) {\n  const hpubInfo = getHpubInfo();\n  $.post({\n    url: baseURL + apiURL + \"comment/list/mine\",\n    data: JSON.stringify({\n      derId: hpubInfo.reviewDerId.toString(),\n      dateFrom: \"\",\n      token: getCookie()\n    }),\n    dataType: \"json\",\n    contentType: \"application/json;charset=UTF-8\",\n    success: function(response) {\n      if (response.err == 0) {\n        callback(response);\n      } else if (response.err == 803 || response.err == 804) {\n        errorCallback(\"Nevažeći token\");\n      } else {\n        errorCallback(\"Došlo je do pogreške s poslužiteljem.\");\n      }\n    },\n    error: function() {\n      errorCallback(\"Došlo je do pogreške s poslužiteljem.\");\n    }\n  });\n}\n\nfunction createComment(text, callback, errorCallback) {\n  $.post({\n    url: baseURL + apiURL + \"comment/create\",\n    data: JSON.stringify({\n      authenticationToken: getCookie(),\n      text: text,\n      locationLink: document.location.href\n    }),\n    dataType: \"json\",\n    contentType: \"application/json;charset=UTF-8\",\n    success: function(response) {\n      if (response.err == 0) {\n        callback(response);\n      } else {\n        errorCallback(\"Token je nevažeći ili je istekao\");\n      }\n    },\n    error: function() {\n      errorCallback(\"Došlo je do greške s poslužiteljem\");\n    }\n  });\n}\n\nfunction editComment(comment, modal, errorCallback) {\n  const commentText = comment.find(\".comment_text\");\n  // create elements\n  const commentFormDiv = $('<div class=\"modal_comment_form\">');\n  const textLabel = $(\"<div> Uredite komentar: </div>\");\n\n  const textInput = $(\"<textarea>\");\n  textInput.val(commentText.html());\n\n  const buttonsDiv = $('<div class=\"modal_buttons\">');\n  const submitButton = $(\"<button> Spremi </button>\");\n  const cancelButton = $(\"<button> Odustani </button>\");\n\n  // append (render) elements\n  textLabel.appendTo(commentFormDiv);\n  textInput.appendTo(commentFormDiv);\n\n  buttonsDiv.appendTo(commentFormDiv);\n  submitButton.appendTo(buttonsDiv);\n  cancelButton.appendTo(buttonsDiv);\n\n  commentFormDiv.appendTo(modal);\n\n  // events\n  submitButton.click(function() {\n    //baseURL + apiURL + 'update', { authenticationToken: getCookie(), unpackedHpubCommentId: comment.attr('commentId'), text: textInput.val() }\n    $.post({\n      url: baseURL + apiURL + \"comment/update\",\n      data: JSON.stringify({\n        authenticationToken: getCookie(),\n        unpackedHpubCommentId: comment.attr(\"commentId\"),\n        text: textInput.val()\n      }),\n      dataType: \"json\",\n      contentType: \"application/json;charset=UTF-8\",\n      success: function(response) {\n        if (response.err == 0) {\n          commentText.html(textInput.val());\n        } else {\n          errorCallback(\"Token je nevažeći ili je istekao.\");\n        }\n        commentFormDiv.remove();\n      },\n      error: function(response) {\n        errorCallback(\"Došlo je do pogreške s poslužiteljem.\");\n        commentFormDiv.remove();\n      }\n    });\n  });\n\n  cancelButton.click(function() {\n    commentFormDiv.remove();\n  });\n}\n\nfunction deleteComment(comment, modal, parent, errorCallback) {\n  // toggle prompt\n  // create elements\n  const promptDiv = $('<div class=\"modal_prompt\">');\n  const div = $(\"<div>\");\n  const promptText = $(\n    \"<span>Jeste li sigurni da želite obrisati ovaj komentar?</span>\"\n  );\n\n  const buttonsDiv = $(\"<div>\");\n  const submitButton = $(\"<button> Potvrdi </button>\");\n  const cancelButton = $(\"<button> Odustani </button>\");\n\n  // append (render) elements\n  promptText.appendTo(div);\n\n  buttonsDiv.appendTo(div);\n  submitButton.appendTo(buttonsDiv);\n  cancelButton.appendTo(buttonsDiv);\n\n  div.appendTo(promptDiv);\n  promptDiv.appendTo(modal);\n\n  // events\n  submitButton.click(function() {\n    $.post({\n      url: baseURL + apiURL + \"comment/delete\",\n      data: JSON.stringify({\n        authenticationToken: getCookie(),\n        unpackedHpubCommentId: comment.attr(\"commentId\")\n      }),\n      dataType: \"json\",\n      contentType: \"application/json;charset=UTF-8\",\n      success: function(response) {\n        if (response.err == 0) {\n          comment.remove();\n          if (parent.children().length == 0) {\n            const noCommentsTooltip = $(\n              '<div class=\"recenzija_comment\" commentid=\"-1\"><div class=\"comment_text\"> Nema komentara </div></div>'\n            );\n            noCommentsTooltip.appendTo(parent);\n          }\n          promptDiv.remove();\n        } else {\n          errorCallback(\"Token je nevažeći ili je istekao.\");\n          promptDiv.remove();\n        }\n      },\n      error: function() {\n        errorCallback(\"Došlo je do greške s poslužiteljem\");\n        promptDiv.remove();\n      }\n    });\n  });\n\n  cancelButton.click(function() {\n    promptDiv.remove();\n  });\n}\n\n// UTILS\nfunction createAuthCookie(cookieValue) {\n  const cookieName = authTokenRef + \"=\";\n  const cookieDuration = new Date();\n  cookieDuration.setTime(cookieDuration.getTime() + 1000 * 60 * 60 * 24); // add 1 day duration in miliseconds to current time\n  const cookieExpirationValue = \"expires=\" + cookieDuration;\n  document.cookie =\n    cookieName + cookieValue + \"; \" + cookieExpirationValue + \"; path=/;\";\n}\n\nfunction getCookie() {\n  if (document.cookie.includes(authTokenRef)) {\n    const cookies = document.cookie.split(\"; \");\n    const authCookie = cookies.filter(function(cookie) {\n      return cookie.includes(authTokenRef);\n    });\n    return authCookie[0].substring(\n      authCookie[0].indexOf(\"=\") + 1,\n      authCookie[0].length\n    );\n  }\n}\n\nfunction deleteCookie(cookieName) {\n  const cookieDuration = new Date();\n  cookieDuration.setTime(0); // set time to past (1970) so cookie is expired (deleted)\n  const cookieExpirationValue = \"expires=\" + cookieDuration;\n  document.cookie = cookieName + \"=; \" + cookieExpirationValue + \"; path=/;\";\n}\n\nfunction getHpubInfo() {\n  // global config var REVIEW_INFO should be set\n  const info = {\n    reviewDerId: REVIEW_INFO && REVIEW_INFO.reviewDerId,\n    reviewDate: REVIEW_INFO && REVIEW_INFO.reviewDate,\n    downloadId: REVIEW_INFO && REVIEW_INFO.downloadId\n  };\n\n  return info;\n}\n"

/***/ }),

/***/ 24:
/***/ (function(module, exports, __webpack_require__) {

// extracted by mini-css-extract-plugin

/***/ })

/******/ });
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vd2VicGFjay9ib290c3RyYXAiLCJ3ZWJwYWNrOi8vLy4uL25vZGVfbW9kdWxlcy9zY3JpcHQtbG9hZGVyL2FkZFNjcmlwdC5qcyIsIndlYnBhY2s6Ly8vLi9wcm9qZWN0L2Nhcm5ldC9wYWNrYWdlLmpzIiwid2VicGFjazovLy8uL2NvbW1vbi9yZWNlbnppamUvcmVjZW56aWplLmpzIiwid2VicGFjazovLy8uL2NvbW1vbi9yZWNlbnppamUvcmVjZW56aWplLmpzP2ZlNzUiLCJ3ZWJwYWNrOi8vLy4vY29tbW9uL3JlY2VuemlqZS9yZWNlbnppamUuY3NzP2IyNTAiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtRQUFBO1FBQ0E7O1FBRUE7UUFDQTs7UUFFQTtRQUNBO1FBQ0E7UUFDQTtRQUNBO1FBQ0E7UUFDQTtRQUNBO1FBQ0E7UUFDQTs7UUFFQTtRQUNBOztRQUVBO1FBQ0E7O1FBRUE7UUFDQTtRQUNBOzs7UUFHQTtRQUNBOztRQUVBO1FBQ0E7O1FBRUE7UUFDQTtRQUNBO1FBQ0EsMENBQTBDLGdDQUFnQztRQUMxRTtRQUNBOztRQUVBO1FBQ0E7UUFDQTtRQUNBLHdEQUF3RCxrQkFBa0I7UUFDMUU7UUFDQSxpREFBaUQsY0FBYztRQUMvRDs7UUFFQTtRQUNBO1FBQ0E7UUFDQTtRQUNBO1FBQ0E7UUFDQTtRQUNBO1FBQ0E7UUFDQTtRQUNBO1FBQ0EseUNBQXlDLGlDQUFpQztRQUMxRSxnSEFBZ0gsbUJBQW1CLEVBQUU7UUFDckk7UUFDQTs7UUFFQTtRQUNBO1FBQ0E7UUFDQSwyQkFBMkIsMEJBQTBCLEVBQUU7UUFDdkQsaUNBQWlDLGVBQWU7UUFDaEQ7UUFDQTtRQUNBOztRQUVBO1FBQ0Esc0RBQXNELCtEQUErRDs7UUFFckg7UUFDQTs7O1FBR0E7UUFDQTs7Ozs7Ozs7QUNsRkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7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ZHVsZSBjYWNoZVxuIFx0dmFyIGluc3RhbGxlZE1vZHVsZXMgPSB7fTtcblxuIFx0Ly8gVGhlIHJlcXVpcmUgZnVuY3Rpb25cbiBcdGZ1bmN0aW9uIF9fd2VicGFja19yZXF1aXJlX18obW9kdWxlSWQpIHtcblxuIFx0XHQvLyBDaGVjayBpZiBtb2R1bGUgaXMgaW4gY2FjaGVcbiBcdFx0aWYoaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0pIHtcbiBcdFx0XHRyZXR1cm4gaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0uZXhwb3J0cztcbiBcdFx0fVxuIFx0XHQvLyBDcmVhdGUgYSBuZXcgbW9kdWxlIChhbmQgcHV0IGl0IGludG8gdGhlIGNhY2hlKVxuIFx0XHR2YXIgbW9kdWxlID0gaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0gPSB7XG4gXHRcdFx0aTogbW9kdWxlSWQsXG4gXHRcdFx0bDogZmFsc2UsXG4gXHRcdFx0ZXhwb3J0czoge31cbiBcdFx0fTtcblxuIFx0XHQvLyBFeGVjdXRlIHRoZSBtb2R1bGUgZnVuY3Rpb25cbiBcdFx0bW9kdWxlc1ttb2R1bGVJZF0uY2FsbChtb2R1bGUuZXhwb3J0cywgbW9kdWxlLCBtb2R1bGUuZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXyk7XG5cbiBcdFx0Ly8gRmxhZyB0aGUgbW9kdWxlIGFzIGxvYWRlZFxuIFx0XHRtb2R1bGUubCA9IHRydWU7XG5cbiBcdFx0Ly8gUmV0dXJuIHRoZSBleHBvcnRzIG9mIHRoZSBtb2R1bGVcbiBcdFx0cmV0dXJuIG1vZHVsZS5leHBvcnRzO1xuIFx0fVxuXG5cbiBcdC8vIGV4cG9zZSB0aGUgbW9kdWxlcyBvYmplY3QgKF9fd2VicGFja19tb2R1bGVzX18pXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm0gPSBtb2R1bGVzO1xuXG4gXHQvLyBleHBvc2UgdGhlIG1vZHVsZSBjYWNoZVxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5jID0gaW5zdGFsbGVkTW9kdWxlcztcblxuIFx0Ly8gZGVmaW5lIGdldHRlciBmdW5jdGlvbiBmb3IgaGFybW9ueSBleHBvcnRzXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLmQgPSBmdW5jdGlvbihleHBvcnRzLCBuYW1lLCBnZXR0ZXIpIHtcbiBcdFx0aWYoIV9fd2VicGFja19yZXF1aXJlX18ubyhleHBvcnRzLCBuYW1lKSkge1xuIFx0XHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBuYW1lLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZ2V0dGVyIH0pO1xuIFx0XHR9XG4gXHR9O1xuXG4gXHQvLyBkZWZpbmUgX19lc01vZHVsZSBvbiBleHBvcnRzXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLnIgPSBmdW5jdGlvbihleHBvcnRzKSB7XG4gXHRcdGlmKHR5cGVvZiBTeW1ib2wgIT09ICd1bmRlZmluZWQnICYmIFN5bWJvbC50b1N0cmluZ1RhZykge1xuIFx0XHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBTeW1ib2wudG9TdHJpbmdUYWcsIHsgdmFsdWU6ICdNb2R1bGUnIH0pO1xuIFx0XHR9XG4gXHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAnX19lc01vZHVsZScsIHsgdmFsdWU6IHRydWUgfSk7XG4gXHR9O1xuXG4gXHQvLyBjcmVhdGUgYSBmYWtlIG5hbWVzcGFjZSBvYmplY3RcbiBcdC8vIG1vZGUgJiAxOiB2YWx1ZSBpcyBhIG1vZHVsZSBpZCwgcmVxdWlyZSBpdFxuIFx0Ly8gbW9kZSAmIDI6IG1lcmdlIGFsbCBwcm9wZXJ0aWVzIG9mIHZhbHVlIGludG8gdGhlIG5zXG4gXHQvLyBtb2RlICYgNDogcmV0dXJuIHZhbHVlIHdoZW4gYWxyZWFkeSBucyBvYmplY3RcbiBcdC8vIG1vZGUgJiA4fDE6IGJlaGF2ZSBsaWtlIHJlcXVpcmVcbiBcdF9fd2VicGFja19yZXF1aXJlX18udCA9IGZ1bmN0aW9uKHZhbHVlLCBtb2RlKSB7XG4gXHRcdGlmKG1vZGUgJiAxKSB2YWx1ZSA9IF9fd2VicGFja19yZXF1aXJlX18odmFsdWUpO1xuIFx0XHRpZihtb2RlICYgOCkgcmV0dXJuIHZhbHVlO1xuIFx0XHRpZigobW9kZSAmIDQpICYmIHR5cGVvZiB2YWx1ZSA9PT0gJ29iamVjdCcgJiYgdmFsdWUgJiYgdmFsdWUuX19lc01vZHVsZSkgcmV0dXJuIHZhbHVlO1xuIFx0XHR2YXIgbnMgPSBPYmplY3QuY3JlYXRlKG51bGwpO1xuIFx0XHRfX3dlYnBhY2tfcmVxdWlyZV9fLnIobnMpO1xuIFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkobnMsICdkZWZhdWx0JywgeyBlbnVtZXJhYmxlOiB0cnVlLCB2YWx1ZTogdmFsdWUgfSk7XG4gXHRcdGlmKG1vZGUgJiAyICYmIHR5cGVvZiB2YWx1ZSAhPSAnc3RyaW5nJykgZm9yKHZhciBrZXkgaW4gdmFsdWUpIF9fd2VicGFja19yZXF1aXJlX18uZChucywga2V5LCBmdW5jdGlvbihrZXkpIHsgcmV0dXJuIHZhbHVlW2tleV07IH0uYmluZChudWxsLCBrZXkpKTtcbiBcdFx0cmV0dXJuIG5zO1xuIFx0fTtcblxuIFx0Ly8gZ2V0RGVmYXVsdEV4cG9ydCBmdW5jdGlvbiBmb3IgY29tcGF0aWJpbGl0eSB3aXRoIG5vbi1oYXJtb255IG1vZHVsZXNcbiBcdF9fd2VicGFja19yZXF1aXJlX18ubiA9IGZ1bmN0aW9uKG1vZHVsZSkge1xuIFx0XHR2YXIgZ2V0dGVyID0gbW9kdWxlICYmIG1vZHVsZS5fX2VzTW9kdWxlID9cbiBcdFx0XHRmdW5jdGlvbiBnZXREZWZhdWx0KCkgeyByZXR1cm4gbW9kdWxlWydkZWZhdWx0J107IH0gOlxuIFx0XHRcdGZ1bmN0aW9uIGdldE1vZHVsZUV4cG9ydHMoKSB7IHJldHVybiBtb2R1bGU7IH07XG4gXHRcdF9fd2VicGFja19yZXF1aXJlX18uZChnZXR0ZXIsICdhJywgZ2V0dGVyKTtcbiBcdFx0cmV0dXJuIGdldHRlcjtcbiBcdH07XG5cbiBcdC8vIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbFxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5vID0gZnVuY3Rpb24ob2JqZWN0LCBwcm9wZXJ0eSkgeyByZXR1cm4gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG9iamVjdCwgcHJvcGVydHkpOyB9O1xuXG4gXHQvLyBfX3dlYnBhY2tfcHVibGljX3BhdGhfX1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5wID0gXCJcIjtcblxuXG4gXHQvLyBMb2FkIGVudHJ5IG1vZHVsZSBhbmQgcmV0dXJuIGV4cG9ydHNcbiBcdHJldHVybiBfX3dlYnBhY2tfcmVxdWlyZV9fKF9fd2VicGFja19yZXF1aXJlX18ucyA9IDIxKTtcbiIsIi8qXG5cdE1JVCBMaWNlbnNlIGh0dHA6Ly93d3cub3BlbnNvdXJjZS5vcmcvbGljZW5zZXMvbWl0LWxpY2Vuc2UucGhwXG5cdEF1dGhvciBUb2JpYXMgS29wcGVycyBAc29rcmFcbiovXG5tb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uKHNyYykge1xuXHRmdW5jdGlvbiBsb2coZXJyb3IpIHtcblx0XHQodHlwZW9mIGNvbnNvbGUgIT09IFwidW5kZWZpbmVkXCIpXG5cdFx0JiYgKGNvbnNvbGUuZXJyb3IgfHwgY29uc29sZS5sb2cpKFwiW1NjcmlwdCBMb2FkZXJdXCIsIGVycm9yKTtcblx0fVxuXG5cdC8vIENoZWNrIGZvciBJRSA9PCA4XG5cdGZ1bmN0aW9uIGlzSUUoKSB7XG5cdFx0cmV0dXJuIHR5cGVvZiBhdHRhY2hFdmVudCAhPT0gXCJ1bmRlZmluZWRcIiAmJiB0eXBlb2YgYWRkRXZlbnRMaXN0ZW5lciA9PT0gXCJ1bmRlZmluZWRcIjtcblx0fVxuXG5cdHRyeSB7XG5cdFx0aWYgKHR5cGVvZiBleGVjU2NyaXB0ICE9PSBcInVuZGVmaW5lZFwiICYmIGlzSUUoKSkge1xuXHRcdFx0ZXhlY1NjcmlwdChzcmMpO1xuXHRcdH0gZWxzZSBpZiAodHlwZW9mIGV2YWwgIT09IFwidW5kZWZpbmVkXCIpIHtcblx0XHRcdGV2YWwuY2FsbChudWxsLCBzcmMpO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRsb2coXCJFdmFsRXJyb3I6IE5vIGV2YWwgZnVuY3Rpb24gYXZhaWxhYmxlXCIpO1xuXHRcdH1cblx0fSBjYXRjaCAoZXJyb3IpIHtcblx0XHRsb2coZXJyb3IpO1xuXHR9XG59XG4iLCJcbi8qXG4gKlxuICogRmlsZXMgaW5jbHVkZWQgb25seSBpbiBwYWNrYWdlZCBET1MgYnVuZGxlc1xuICpcbiAqL1xuXG5cblxuLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAvL1xuLy8gLS0tLS0tLS0tLSByZWNlbnppamUgLS0tLS0tLS0tLSAvL1xuLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAvL1xuXG5pbXBvcnQgJ3NjcmlwdC1sb2FkZXIhQHNyYy9jb21tb24vcmVjZW56aWplL3JlY2VuemlqZS5qcyc7XG5pbXBvcnQgJ0BzcmMvY29tbW9uL3JlY2VuemlqZS9yZWNlbnppamUuY3NzJztcbiIsInJlcXVpcmUoXCIhIS92YXIvbGliL2plbmtpbnMvd29ya3NwYWNlL2FsZ2VicmEtZnJvbnRlbmQtaW50ZXJhY3Rpb25zLXRlc3Qvbm9kZV9tb2R1bGVzL3NjcmlwdC1sb2FkZXIvYWRkU2NyaXB0LmpzXCIpKHJlcXVpcmUoXCIhIS92YXIvbGliL2plbmtpbnMvd29ya3NwYWNlL2FsZ2VicmEtZnJvbnRlbmQtaW50ZXJhY3Rpb25zLXRlc3Qvbm9kZV9tb2R1bGVzL3NjcmlwdC1sb2FkZXIvbm9kZV9tb2R1bGVzL3Jhdy1sb2FkZXIvaW5kZXguanMhL3Zhci9saWIvamVua2lucy93b3Jrc3BhY2UvYWxnZWJyYS1mcm9udGVuZC1pbnRlcmFjdGlvbnMtdGVzdC9zcmMvY29tbW9uL3JlY2VuemlqZS9yZWNlbnppamUuanNcIikpIiwibW9kdWxlLmV4cG9ydHMgPSBcImNvbnN0IGRldlVSTCA9IFxcXCJodHRwczovL2Rvcy1jYXJuZXQuaW50LnNlZGFtaXQuaHIvXFxcIjsgLy8gZGV2IHVybFxcbmNvbnN0IHRlc3RVUkwgPSBcXFwiaHR0cHM6Ly9kb3MtYWxhdC10ZXN0LnNlZGFtY2xvdWQuY29tL1xcXCI7IC8vIHRlc3QgdXJsXFxuY29uc3QgcHJvZFVSTCA9IFxcXCJodHRwczovL2Rvcy1hbGF0LnNlZGFtY2xvdWQuY29tL1xcXCIgLy8gcHJvZHVjdGlvblxcbmNvbnN0IGFwaVVSTCA9IFxcXCJleHBsYWluL3NlcnZpY2VzL3YyL3VucGFja2VkaHB1Yi9cXFwiO1xcbmNvbnN0IHNlcnZlZEhwdWJVUkwgPSBcXFwiZXhwbGFpbi9zdGF0aWMvYm9vay9zZXJ2ZWQvXFxcIjtcXG5jb25zdCBhdXRoVG9rZW5SZWYgPSBcXFwiYXV0aFRva2VuXFxcIjtcXG5cXG5jb25zdCBkb3dubG9hZExpbmsgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdhJyk7XFxuZG93bmxvYWRMaW5rLnRhcmdldCA9ICdfYmxhbmsnO1xcbmRvd25sb2FkTGluay5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnO1xcbmRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQoZG93bmxvYWRMaW5rKTtcXG5cXG5sZXQgYmFzZVVSTCA9IG51bGw7XFxuXFxuaWYgKGRvY3VtZW50LmxvY2F0aW9uLmhyZWYuaW5jbHVkZXMoZGV2VVJMKSkge1xcbiAgYmFzZVVSTCA9IGRldlVSTDtcXG59IGVsc2UgaWYgKGRvY3VtZW50LmxvY2F0aW9uLmhyZWYuaW5jbHVkZXModGVzdFVSTCkpIHtcXG4gIGJhc2VVUkwgPSB0ZXN0VVJMO1xcbn0gZWxzZSBpZiAoZG9jdW1lbnQubG9jYXRpb24uaHJlZi5pbmNsdWRlcyhwcm9kVVJMKSkge1xcbiAgYmFzZVVSTCA9IHByb2RVUkw7XFxufSBlbHNlIHtcXG4gIGNvbnNvbGUud2FybignVW5yZWNvZ25pemVkIFVSTCwgcmV2aWV3IGRpc2FibGVkJyk7XFxufVxcblxcblxcbiQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCkge1xcbiAgaWYgKGJhc2VVUkwpIHtcXG4gICAgLy8gZGlzYWJsZXMgcmV2aWV3aW5nIGxvY2FsbHlcXG4gICAgY29uc3QgZm9vdGVyID0gJChcXFwiZm9vdGVyXFxcIik7XFxuICAgICQoJzxkaXYgaWQ9XFxcIm1vZGFsX3RvZ2dsZXJcXFwiIGNsYXNzPVxcXCJkb3MtYnRuLWRlZi1iYXNpY1xcXCI+S29tZW50aXJhbmplPC9kaXY+JykuYXBwZW5kVG8oZm9vdGVyKTtcXG4gICAgaW5pdFJlY2VuemlqZSgpO1xcbiAgfVxcbn0pO1xcblxcbmZ1bmN0aW9uIGluaXRSZWNlbnppamUoKSB7XFxuICBjb25zdCBjb29raWVUb2tlbiA9IGdldENvb2tpZSgpO1xcbiAgY29uc3QgZG9jdW1lbnRCb2R5ID0gJChkb2N1bWVudCkuZmluZChcXFwiYm9keVxcXCIpO1xcbiAgY29uc3QgbW9kYWwgPSBjb29raWVUb2tlbiA/IGNyZWF0ZU1vZGFsKGNvb2tpZVRva2VuKSA6IGNyZWF0ZU1vZGFsKCk7XFxuXFxuICBtb2RhbC5hcHBlbmRUbyhkb2N1bWVudEJvZHkpO1xcblxcbiAgJChcXFwiI21vZGFsX3RvZ2dsZXJcXFwiKS5jbGljayhmdW5jdGlvbigpIHtcXG4gICAgdG9nZ2xlTW9kYWwobW9kYWwpO1xcbiAgfSk7XFxufVxcblxcbmZ1bmN0aW9uIHRvZ2dsZU1vZGFsKG1vZGFsKSB7XFxuICBjb25zdCBjb29raWVUb2tlbiA9IGdldENvb2tpZSgpO1xcbiAgaWYgKGNvb2tpZVRva2VuKSB7XFxuICAgIC8vIGlmIHRoZXJlIGlzIGEgY29va2llLCBhdXRvZmlsbCB0b2tlbiBpbnB1dCBmaWVsZFxcbiAgICAkKFxcXCIjdG9rZW5cXFwiKS52YWwoY29va2llVG9rZW4pO1xcbiAgICAkKCcjcG90dnJkaScpLmNsaWNrKCk7XFxuICB9XFxuXFxuICBpZiAobW9kYWwuY3NzKFxcXCJkaXNwbGF5XFxcIikgPT0gXFxcIm5vbmVcXFwiKSB7XFxuICAgIG1vZGFsLmNzcyh7XFxuICAgICAgZGlzcGxheTogXFxcImZsZXhcXFwiXFxuICAgIH0pO1xcbiAgfSBlbHNlIHtcXG4gICAgbW9kYWwuY3NzKFxcXCJkaXNwbGF5XFxcIiwgXFxcIm5vbmVcXFwiKTtcXG4gIH1cXG59XFxuXFxuZnVuY3Rpb24gY3JlYXRlTW9kYWwoY29va2llKSB7XFxuICAvLyBBdXRoZW50aWNhdGlvbiAoMXN0IHBhcnQgb2YgbW9kYWwpXFxuICAvLyBjcmVhdGUgZWxlbWVudHNcXG4gIGNvbnN0IG1vZGFsID0gJCgnPGRpdiBjbGFzcz1cXFwicmVjZW56aWphX21vZGFsXFxcIj4nKTtcXG4gIGNvbnN0IG1vZGFsQXV0aEZvcm0gPSAkKCc8ZGl2IGNsYXNzPVxcXCJtb2RhbF9hdXRoXFxcIj4nKTtcXG5cXG4gIGNvbnN0IHRva2VuSW5wdXREaXYgPSAkKFxcXCI8ZGl2PlxcXCIpO1xcbiAgY29uc3QgdG9rZW5MYWJlbCA9ICQoXFxcIjxzcGFuPiBNb2xpbW8gVmFzIGRhIHVuZXNldGUgdG9rZW46IDwvc3Bhbj5cXFwiKTtcXG4gIGNvbnN0IHRva2VuSW5wdXQgPSAkKCc8aW5wdXQgaWQ9XFxcInRva2VuXFxcIj4nKTtcXG5cXG4gIGNvbnN0IGJ1dHRvbnNEaXYgPSAkKFxcXCI8ZGl2PlxcXCIpO1xcbiAgY29uc3Qgc3VibWl0QnV0dG9uID0gJCgnPGJ1dHRvbiBpZD1cXFwicG90dnJkaVxcXCI+IFBvdHZyZGkgPC9idXR0b24+Jyk7XFxuICBjb25zdCBjYW5jZWxCdXR0b24gPSAkKFxcXCI8YnV0dG9uPiBPZHVzdGFuaSA8L2J1dHRvbj5cXFwiKTtcXG5cXG4gIGNvbnN0IHRvb2x0aXBEaXYgPSAkKCc8ZGl2IGNsYXNzPVxcXCJtb2RhbF90b29sdGlwc1xcXCI+Jyk7XFxuXFxuICAvLyBhcHBlbmQgKHJlbmRlcikgZWxlbWVudHNcXG4gIHRva2VuSW5wdXREaXYuYXBwZW5kVG8obW9kYWxBdXRoRm9ybSk7XFxuICB0b2tlbkxhYmVsLmFwcGVuZFRvKHRva2VuSW5wdXREaXYpO1xcbiAgdG9rZW5JbnB1dC5hcHBlbmRUbyh0b2tlbklucHV0RGl2KTtcXG5cXG4gIGJ1dHRvbnNEaXYuYXBwZW5kVG8odG9rZW5JbnB1dERpdik7XFxuICBzdWJtaXRCdXR0b24uYXBwZW5kVG8oYnV0dG9uc0Rpdik7XFxuICBjYW5jZWxCdXR0b24uYXBwZW5kVG8oYnV0dG9uc0Rpdik7XFxuXFxuICB0b29sdGlwRGl2LmFwcGVuZFRvKHRva2VuSW5wdXREaXYpO1xcblxcbiAgbW9kYWxBdXRoRm9ybS5hcHBlbmRUbyhtb2RhbCk7XFxuXFxuICAvLyBldmVudHNcXG4gIHN1Ym1pdEJ1dHRvbi5jbGljayhmdW5jdGlvbigpIHtcXG4gICAgaWYgKHRvb2x0aXBEaXYuY2hpbGRyZW4oKS5sZW5ndGggPiAwKSB7XFxuICAgICAgLy8gcmVtb3ZlIHRvb2x0aXAgbWVzc2FnZSBpZiBhbnlcXG4gICAgICB0b29sdGlwRGl2LmNoaWxkcmVuKClbMF0ucmVtb3ZlKCk7XFxuICAgIH1cXG5cXG4gICAgaWYgKHRva2VuSW5wdXQudmFsKCkpIHtcXG4gICAgICBpZiAoY29va2llICE9IHRva2VuSW5wdXQudmFsKCkgfHwgZ2V0Q29va2llKCkgIT0gdG9rZW5JbnB1dC52YWwoKSkge1xcbiAgICAgICAgLy8gaWYgZW50ZXJlZCBhIG5ldyBhdXRoIHRva2VuLCBjcmVhdGUgYSBuZXcgY29va2llXFxuICAgICAgICBjcmVhdGVBdXRoQ29va2llKHRva2VuSW5wdXQudmFsKCkpO1xcbiAgICAgIH1cXG4gICAgICBmZXRjaENvbW1lbnRzKFxcbiAgICAgICAgdW5kZWZpbmVkLFxcbiAgICAgICAgZnVuY3Rpb24ocmVzcG9uc2UpIHtcXG4gICAgICAgICAgLy8gc3VjY2VzcyBjYWxsYmFja1xcbiAgICAgICAgICBjcmVhdGVDb21tZW50Rm9ybShtb2RhbCwgcmVzcG9uc2UuZGF0YS5pdGVtcyk7XFxuICAgICAgICB9LFxcbiAgICAgICAgZnVuY3Rpb24obWVzc2FnZSkge1xcbiAgICAgICAgICAvLyBlcnJvciBjYWxsYmFja1xcbiAgICAgICAgICBjb25zdCBtZXNzYWdlRWwgPSAkKFxcXCI8c3Bhbj5cXFwiLCB7XFxuICAgICAgICAgICAgaHRtbDogbWVzc2FnZVxcbiAgICAgICAgICB9KTtcXG5cXG4gICAgICAgICAgbWVzc2FnZUVsLmFwcGVuZFRvKHRvb2x0aXBEaXYpO1xcbiAgICAgICAgfVxcbiAgICAgICk7XFxuICAgIH0gZWxzZSB7XFxuICAgICAgLy8gZGlzcGxheSBubyB0b2tlbiBtZXNzYWdlXFxuICAgICAgY29uc3Qgbm9Ub2tlbk1lc3NhZ2UgPSBcXFwiTW9saW1vIFZhcyB1bmVzaXRlIHRva2VuLlxcXCI7XFxuICAgICAgY29uc3QgbWVzc2FnZUVsID0gJChcXFwiPHNwYW4+XFxcIik7XFxuXFxuICAgICAgbWVzc2FnZUVsLmh0bWwobm9Ub2tlbk1lc3NhZ2UpO1xcbiAgICAgIG1lc3NhZ2VFbC5hcHBlbmRUbyh0b29sdGlwRGl2KTtcXG4gICAgfVxcbiAgfSk7XFxuICBjYW5jZWxCdXR0b24uY2xpY2soZnVuY3Rpb24oKSB7XFxuICAgIGlmICh0b29sdGlwRGl2LmNoaWxkcmVuKCkubGVuZ3RoID4gMCkge1xcbiAgICAgIC8vIHJlbW92ZSB0b29sdGlwIG1lc3NhZ2UgaWYgYW55XFxuICAgICAgdG9vbHRpcERpdi5jaGlsZHJlbigpWzBdLnJlbW92ZSgpO1xcbiAgICB9XFxuICAgIHRvZ2dsZU1vZGFsKG1vZGFsKTtcXG4gIH0pO1xcblxcbiAgcmV0dXJuIG1vZGFsO1xcbn1cXG5cXG5mdW5jdGlvbiBjcmVhdGVDb21tZW50Rm9ybShtb2RhbCwgZGF0YSkge1xcbiAgLy8gQ29tbWVudHMgY29udGFpbmVyICgybmQgcGFydCBvZiBtb2RhbClcXG4gIGNvbnN0IGF1dGhGb3JtID0gbW9kYWwuZmluZChcXFwiLm1vZGFsX2F1dGhcXFwiKTtcXG4gIGF1dGhGb3JtLmRldGFjaCgpO1xcbiAgLy8gY3JlYXRlIGVsZW1lbnRzXFxuICBjb25zdCBjb21tZW50Rm9ybSA9ICQoJzxkaXYgY2xhc3M9XFxcIm1vZGFsX2NvbW1lbnRzX2NvbnRhaW5lclxcXCI+Jyk7XFxuXFxuICBjb25zdCBjb21tZW50c0Zvcm1IZWFkZXIgPSAkKCc8ZGl2IGNsYXNzPVxcXCJtb2RhbF9jb21tZW50c19sYWJlbFxcXCI+Jyk7XFxuICBjb25zdCBjb21tZW50c0Zvcm1IZWFkZXJMYWJlbCA9ICQoXFxcIjxzcGFuPlxcXCIsIHtcXG4gICAgaHRtbDogXFxcIlByaWphdmxqZW5pIHN0ZSBzIHRva2Vub206IFxcXCIgKyBnZXRDb29raWUoKVxcbiAgfSk7XFxuICBjb25zdCBoZWFkZXJCdXR0b25zRGl2ID0gJCgnPGRpdj4nKTtcXG4gIGNvbnN0IGhlYWRlckJ1dHRvbnNEaXYyID0gJCgnPGRpdj4nKTtcXG4gIGNvbnN0IGludmFsaWRhdGVCdXR0b24gPSAkKFxcXCI8YnV0dG9uPiBaYXZyxaFpIGtvbWVudGlyYW5qZSA8L2J1dHRvbj5cXFwiKTtcXG4gIGNvbnN0IGxvZ291dEJ1dHRvbiA9ICQoXFxcIjxidXR0b24+IE9kamF2YSA8L2J1dHRvbj5cXFwiKTtcXG5cXG4gIGNvbnN0IGNvbW1lbnRzRmxleERpdiA9ICQoJzxkaXYgY2xhc3M9XFxcImZsZXhfZGl2XFxcIj4nKTtcXG5cXG4gIGNvbnN0IGNvbW1lbnRzQ29udGFpbmVyID0gJCgnPGRpdiBjbGFzcz1cXFwiY3VycmVudF9tb2RhbF9jb21tZW50c1xcXCI+Jyk7XFxuICBjb25zdCBjb21tZW50c0hlYWRlciA9ICQoXFxuICAgICc8ZGl2IGNsYXNzPVxcXCJjb21tZW50c19oZWFkZXJcXFwiPiBLb21lbnRhcmk6IDwvZGl2PidcXG4gICk7XFxuICBjb25zdCBjb21tZW50c0RpdiA9ICQoJzxkaXYgY2xhc3M9XFxcIm1vZGFsX2NvbW1lbnRzXFxcIj4nKTtcXG4gIGNvbnN0IGNvbW1lbnRzID1cXG4gICAgZGF0YS5sZW5ndGggPiAwXFxuICAgICAgPyAoZnVuY3Rpb24oKSB7XFxuICAgICAgICAgIGNvbnN0IGNvbW1lbnRzID0gZGF0YVswXS5jb21tZW50cztcXG4gICAgICAgICAgbGV0IGNvbW1lbnRBcnJheSA9IFtdO1xcbiAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGNvbW1lbnRzLmxlbmd0aDsgaSsrKSB7XFxuICAgICAgICAgICAgY29uc3QgY29tbWVudEVsID0gY3JlYXRlQ29tbWVudEVsZW1lbnQoXFxuICAgICAgICAgICAgICBtb2RhbCxcXG4gICAgICAgICAgICAgIGNvbW1lbnRzW2ldLFxcbiAgICAgICAgICAgICAgYXV0aEZvcm0sXFxuICAgICAgICAgICAgICB0cnVlLFxcbiAgICAgICAgICAgICAgY29tbWVudHNEaXZcXG4gICAgICAgICAgICApO1xcbiAgICAgICAgICAgIGNvbW1lbnRBcnJheS5wdXNoKGNvbW1lbnRFbCk7XFxuICAgICAgICAgIH1cXG4gICAgICAgICAgcmV0dXJuIGNvbW1lbnRBcnJheTtcXG4gICAgICAgIH0pKClcXG4gICAgICA6IG51bGw7XFxuXFxuICBjb25zdCBvbGRDb21tZW50c0NvbnRhaW5lciA9ICQoJzxkaXYgY2xhc3M9XFxcIm9sZF9tb2RhbF9jb21tZW50c1xcXCI+Jyk7XFxuICBjb25zdCBvbGRDb21tZW50c0hlYWRlciA9ICQoJzxkaXYgY2xhc3M9XFxcImNvbW1lbnRzX2hlYWRlclxcXCI+Jyk7XFxuICBjb25zdCBicmVha0xpbmUgPSAkKCc8ZGl2IGNsYXNzPVxcXCJ2ZXJ0aWNhbF9saW5lXFxcIj4nKTtcXG4gIGNvbnN0IG9sZENvbW1lbnRzRGl2ID0gJCgnPGRpdiBjbGFzcz1cXFwibW9kYWxfY29tbWVudHNcXFwiPicpO1xcblxcbiAgY29uc3QgYnV0dG9uc0RpdiA9ICQoJzxkaXYgY2xhc3M9XFxcIm1vZGFsX2J1dHRvbnNcXFwiPicpO1xcbiAgY29uc3QgY3JlYXRlQ29tbWVudEJ1dHRvbiA9ICQoXFxcIjxidXR0b24+IERvZGFqIG5vdmkga29tZW50YXIgPC9idXR0b24+XFxcIik7XFxuICBjb25zdCB0b2dnbGVPbGRDb21tZW50c0J1dHRvbiA9ICQoXFxuICAgIFxcXCI8YnV0dG9uPiBEb2h2YXRpIHN0YXJlIGtvbWVudGFyZSA8L2J1dHRvbj5cXFwiXFxuICApO1xcbiAgY29uc3QgY2FuY2VsQnV0dG9uID0gJChcXFwiPGJ1dHRvbj4gWmF0dm9yaSA8L2J1dHRvbj5cXFwiKTtcXG5cXG4gIC8vIGFwcGVuZCAocmVuZGVyKSBlbGVtZW50c1xcbiAgLy9jb21tZW50c0Zvcm1IZWFkZXJMYWJlbC5hcHBlbmRUbyhjb21tZW50c0Zvcm1IZWFkZXIpO1xcbiAgY3JlYXRlQ29tbWVudEJ1dHRvbi5hcHBlbmRUbyhoZWFkZXJCdXR0b25zRGl2KTtcXG4gIGludmFsaWRhdGVCdXR0b24uYXBwZW5kVG8oaGVhZGVyQnV0dG9uc0Rpdik7XFxuICBsb2dvdXRCdXR0b24uYXBwZW5kVG8oaGVhZGVyQnV0dG9uc0RpdjIpO1xcbiAgY2FuY2VsQnV0dG9uLmFwcGVuZFRvKGhlYWRlckJ1dHRvbnNEaXYyKTtcXG4gIGhlYWRlckJ1dHRvbnNEaXYuYXBwZW5kVG8oY29tbWVudHNGb3JtSGVhZGVyKTtcXG4gIGhlYWRlckJ1dHRvbnNEaXYyLmFwcGVuZFRvKGNvbW1lbnRzRm9ybUhlYWRlcik7XFxuXFxuICBpZiAoY29tbWVudHMgJiYgY29tbWVudHMubGVuZ3RoID4gMCkge1xcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGNvbW1lbnRzLmxlbmd0aDsgaSsrKSB7XFxuICAgICAgJChjb21tZW50c1tpXSkuYXBwZW5kVG8oY29tbWVudHNEaXYpO1xcbiAgICB9XFxuICB9IGVsc2Uge1xcbiAgICBjb25zdCBub0NvbW1lbnRzUHJvbXB0ID0gJChcXG4gICAgICAnPGRpdiBjbGFzcz1cXFwicmVjZW56aWphX2NvbW1lbnRcXFwiIGNvbW1lbnRpZD1cXFwiLTFcXFwiPjxkaXYgY2xhc3M9XFxcImNvbW1lbnRfdGV4dFxcXCI+IE5lbWEga29tZW50YXJhIDwvZGl2PjwvZGl2PidcXG4gICAgKTtcXG4gICAgbm9Db21tZW50c1Byb21wdC5hcHBlbmRUbyhjb21tZW50c0Rpdik7XFxuICB9XFxuXFxuICBjb21tZW50c0hlYWRlci5hcHBlbmRUbyhjb21tZW50c0NvbnRhaW5lcik7XFxuICBjb21tZW50c0Rpdi5hcHBlbmRUbyhjb21tZW50c0NvbnRhaW5lcik7XFxuXFxuICBvbGRDb21tZW50c0hlYWRlci5hcHBlbmRUbyhvbGRDb21tZW50c0NvbnRhaW5lcik7XFxuICBvbGRDb21tZW50c0Rpdi5hcHBlbmRUbyhvbGRDb21tZW50c0NvbnRhaW5lcik7XFxuXFxuICAvL2NyZWF0ZUNvbW1lbnRCdXR0b24uYXBwZW5kVG8oYnV0dG9uc0Rpdik7XFxuICAvL3RvZ2dsZU9sZENvbW1lbnRzQnV0dG9uLmFwcGVuZFRvKGJ1dHRvbnNEaXYpO1xcbiAgLy9jYW5jZWxCdXR0b24uYXBwZW5kVG8oYnV0dG9uc0Rpdik7XFxuXFxuICBjb21tZW50c0Zvcm1IZWFkZXIuYXBwZW5kVG8oY29tbWVudEZvcm0pOyAvLyBjb250YWluZXJzXFxuXFxuICBjb21tZW50c0NvbnRhaW5lci5hcHBlbmRUbyhjb21tZW50c0ZsZXhEaXYpO1xcbiAgY29tbWVudHNGbGV4RGl2LmFwcGVuZFRvKGNvbW1lbnRGb3JtKTtcXG4gIC8vYnV0dG9uc0Rpdi5hcHBlbmRUbyhjb21tZW50Rm9ybSk7XFxuXFxuICBjb21tZW50Rm9ybS5hcHBlbmRUbyhtb2RhbCk7XFxuICBjb21tZW50Rm9ybS5yZXNpemFibGUoe1xcblxcdCAgaGFuZGxlczogXFxcIm4sIGUsIG5lXFxcIlxcbiAgfSk7XFxuXFxuICAvLyBldmVudHNcXG4gIGxvZ291dEJ1dHRvbi5jbGljayhmdW5jdGlvbigpIHtcXG4gICAgZGVsZXRlQ29va2llKGF1dGhUb2tlblJlZik7XFxuICAgIGNvbW1lbnRGb3JtLnJlbW92ZSgpO1xcbiAgICBhdXRoRm9ybS5maW5kKFxcXCIjdG9rZW5cXFwiKS52YWwoXFxcIlxcXCIpO1xcbiAgICBhdXRoRm9ybS5hcHBlbmRUbyhtb2RhbCk7XFxuICB9KTtcXG5cXG4gIGludmFsaWRhdGVCdXR0b24uY2xpY2soZnVuY3Rpb24oKSB7XFxuICAgIGNvbnN0IG1lc3NhZ2UgPSAnT3ZpbWUgxIdldGUgcG9uacWhdGl0aSBWYcWhIHRva2VuLiBKZXN0ZSBsaSBzaWd1cm5pPyc7XFxuICAgIGNvbmZpcm1Qcm9tcHQobWVzc2FnZSwgbW9kYWwsIGZ1bmN0aW9uKCkge1xcbiAgICAgIGludmFsaWRhdGVUb2tlbihmdW5jdGlvbigpIHtcXG4gICAgICAgIGNvbW1lbnRGb3JtLmRldGFjaCgpO1xcbiAgICAgICAgYXV0aEZvcm0uYXBwZW5kVG8obW9kYWwpO1xcbiAgICAgICAgdG9nZ2xlTW9kYWwobW9kYWwpO1xcbiAgICAgIH0pO1xcbiAgICB9KVxcbiAgfSk7XFxuXFxuICB0b2dnbGVPbGRDb21tZW50c0J1dHRvbi5jbGljayhmdW5jdGlvbigpIHtcXG4gICAgdG9nZ2xlRGF0ZVBpY2tlckZvcm0obW9kYWwsIGZ1bmN0aW9uKGRhdGVRdWVyeSkge1xcbiAgICAgIC8vIGNyZWF0ZSBhbmQgYWRkIG9sZCBjb21tZW50cyBzZWN0aW9uIHRvIGNvbW1lbnQgZm9ybVxcbiAgICAgIGNvbnN0IG9sZENvbW1lbnRzID0gb2xkQ29tbWVudHNDb250YWluZXJcXG4gICAgICAgIC5maW5kKFxcXCIubW9kYWxfY29tbWVudHNcXFwiKVxcbiAgICAgICAgLmNoaWxkcmVuKCk7XFxuICAgICAgaWYgKG9sZENvbW1lbnRzICYmIG9sZENvbW1lbnRzLmxlbmd0aCA+IDApIHtcXG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgb2xkQ29tbWVudHMubGVuZ3RoOyBpKyspIHtcXG4gICAgICAgICAgb2xkQ29tbWVudHNbaV0ucmVtb3ZlKCk7XFxuICAgICAgICB9XFxuICAgICAgfVxcblxcbiAgICAgIGZldGNoQ29tbWVudHMoXFxuICAgICAgICBkYXRlUXVlcnksXFxuICAgICAgICBmdW5jdGlvbihyZXNwb25zZSkge1xcbiAgICAgICAgICAvLyBzdWNjZXNzIGNhbGxiYWNrXFxuICAgICAgICAgIG9sZENvbW1lbnRzSGVhZGVyLmh0bWwoXFxcIktvbWVudGFyaSBpbmHEjWljZTogXFxcIiArIGRhdGVRdWVyeSk7XFxuICAgICAgICAgIGNvbnN0IHJlbGV2YW50RGF0YSA9IHJlc3BvbnNlLmRhdGEuaXRlbXMuZmlsdGVyKGZ1bmN0aW9uKGxvYykge1xcbiAgICAgICAgICAgIHJldHVybiBsb2MubG9jYXRpb25MaW5rID09IGRvY3VtZW50LmxvY2F0aW9uLmhyZWY7XFxuICAgICAgICAgIH0pO1xcbiAgICAgICAgICBjb25zdCBjb21tZW50cyA9XFxuICAgICAgICAgICAgcmVsZXZhbnREYXRhWzBdICYmIHJlbGV2YW50RGF0YVswXS5jb21tZW50c1xcbiAgICAgICAgICAgICAgPyByZWxldmFudERhdGFbMF0uY29tbWVudHNcXG4gICAgICAgICAgICAgIDogW107XFxuXFxuICAgICAgICAgIGlmIChjb21tZW50cyAmJiBjb21tZW50cy5sZW5ndGggPiAwKSB7XFxuICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBjb21tZW50cy5sZW5ndGg7IGkrKykge1xcbiAgICAgICAgICAgICAgY29uc3QgbmV3Q29tbWVudCA9IGNyZWF0ZUNvbW1lbnRFbGVtZW50KFxcbiAgICAgICAgICAgICAgICBtb2RhbCxcXG4gICAgICAgICAgICAgICAgY29tbWVudHNbaV0sXFxuICAgICAgICAgICAgICAgIGF1dGhGb3JtLFxcbiAgICAgICAgICAgICAgICBmYWxzZSxcXG4gICAgICAgICAgICAgICAgY29tbWVudHNEaXZcXG4gICAgICAgICAgICAgICk7XFxuICAgICAgICAgICAgICBuZXdDb21tZW50LmFwcGVuZFRvKG9sZENvbW1lbnRzRGl2KTtcXG4gICAgICAgICAgICB9XFxuICAgICAgICAgIH0gZWxzZSB7XFxuICAgICAgICAgICAgY29uc3Qgbm9Db21tZW50c1Byb21wdCA9ICQoXFxuICAgICAgICAgICAgICAnPGRpdiBjbGFzcz1cXFwicmVjZW56aWphX2NvbW1lbnRcXFwiIGNvbW1lbnRpZD1cXFwiLTFcXFwiPjxkaXYgY2xhc3M9XFxcImNvbW1lbnRfdGV4dFxcXCI+IE5lbWEga29tZW50YXJhIDwvZGl2PjwvZGl2PidcXG4gICAgICAgICAgICApO1xcbiAgICAgICAgICAgIG5vQ29tbWVudHNQcm9tcHQuYXBwZW5kVG8ob2xkQ29tbWVudHNEaXYpO1xcbiAgICAgICAgICB9XFxuICAgICAgICB9LFxcbiAgICAgICAgZnVuY3Rpb24oKSB7XFxuICAgICAgICAgIC8vIGVycm9yIGNhbGxiYWNrXFxuICAgICAgICAgIGNvbnN0IHRvb2x0aXAgPSAkKFxcXCI8c3Bhbj4gTmVtYSB1bmVzZW5paCBrb21lbnRhcmEgPC9zcGFuPlxcXCIpO1xcbiAgICAgICAgICB0b29sdGlwLmFwcGVuZFRvKG9sZENvbW1lbnRzRGl2KTtcXG4gICAgICAgIH1cXG4gICAgICApO1xcblxcbiAgICAgIGlmIChjb21tZW50c0ZsZXhEaXYuZmluZChvbGRDb21tZW50c0NvbnRhaW5lcikubGVuZ3RoID09IDApIHtcXG4gICAgICAgIC8vIG9ubHkgcmVuZGVyIHRoZSBmaXJzdCB0aW1lXFxuICAgICAgICBidXR0b25zRGl2LmRldGFjaCgpO1xcbiAgICAgICAgYnJlYWtMaW5lLmFwcGVuZFRvKGNvbW1lbnRzRmxleERpdik7XFxuICAgICAgICBvbGRDb21tZW50c0NvbnRhaW5lci5hcHBlbmRUbyhjb21tZW50c0ZsZXhEaXYpO1xcbiAgICAgICAgYnV0dG9uc0Rpdi5hcHBlbmRUbyhjb21tZW50Rm9ybSk7XFxuICAgICAgfVxcbiAgICB9KTtcXG4gIH0pO1xcbiAgY3JlYXRlQ29tbWVudEJ1dHRvbi5jbGljayhmdW5jdGlvbigpIHtcXG4gICAgdG9nZ2xlQ29tbWVudEZvcm0obW9kYWwsIGNvbW1lbnRzRGl2LCBhdXRoRm9ybSk7XFxuICB9KTtcXG4gIGNhbmNlbEJ1dHRvbi5jbGljayhmdW5jdGlvbigpIHtcXG4gICAgY29uc3QgY2hlY2hGb3JDb21tZW50Rm9ybSA9IG1vZGFsLmZpbmQoXFxcIi5tb2RhbF9jb21tZW50X2Zvcm1cXFwiKTtcXG4gICAgY29uc3QgY2hlY2tGb3JQcm9tcHQgPSBtb2RhbC5maW5kKFxcXCIubW9kYWxfcHJvbXB0XFxcIik7XFxuICAgIGlmIChjaGVjaEZvckNvbW1lbnRGb3JtLmxlbmd0aCA+IDApIHtcXG4gICAgICBjaGVjaEZvckNvbW1lbnRGb3JtLnJlbW92ZSgpO1xcbiAgICB9XFxuICAgIGlmIChjaGVja0ZvclByb21wdC5sZW5ndGggPiAwKSB7XFxuICAgICAgY2hlY2tGb3JQcm9tcHQucmVtb3ZlKCk7XFxuICAgIH1cXG4gICAgdG9nZ2xlTW9kYWwobW9kYWwpO1xcbiAgICBjb21tZW50Rm9ybS5yZW1vdmUoKTtcXG4gICAgYXV0aEZvcm0uYXBwZW5kVG8obW9kYWwpO1xcbiAgfSk7XFxufVxcblxcbmZ1bmN0aW9uIGNyZWF0ZUNvbW1lbnRFbGVtZW50KFxcbiAgbW9kYWwsXFxuICBjb21tZW50RGF0YSxcXG4gIGF1dGhGb3JtLFxcbiAgd2l0aEJ1dHRvbnMsXFxuICBwYXJlbnRcXG4pIHtcXG4gIC8vIGNyZWF0ZSBlbGVtZW50c1xcbiAgY29uc3QgY29tbWVudERpdiA9ICQoXFxcIjxkaXY+XFxcIiwge1xcbiAgICBjbGFzczogXFxcInJlY2VuemlqYV9jb21tZW50XFxcIixcXG4gICAgY29tbWVudElkOiBjb21tZW50RGF0YS51bnBhY2tlZEhwdWJDb21tZW50SWRcXG4gIH0pO1xcbiAgY29uc3QgY29tbWVudFRleHQgPSAkKFxcXCI8ZGl2PlxcXCIsIHtcXG4gICAgY2xhc3M6IFxcXCJjb21tZW50X3RleHRcXFwiLFxcbiAgICBodG1sOiBjb21tZW50RGF0YS50ZXh0XFxuICB9KTtcXG5cXG4gIGNvbW1lbnRUZXh0LmFwcGVuZFRvKGNvbW1lbnREaXYpO1xcblxcbiAgY29uc3QgYnV0dG9uc0RpdiA9ICQoJzxkaXYgY2xhc3M9XFxcImNvbnRyb2xfYnV0dG9uc1xcXCI+Jyk7XFxuICBjb25zdCBlZGl0QnV0dG9uID0gJChcXFwiPGJ1dHRvbj4gVXJlZGkgPC9idXR0b24+XFxcIik7XFxuICBjb25zdCBkZWxldGVCdXR0b24gPSAkKFxcXCI8YnV0dG9uPiBPYnJpxaFpIDwvYnV0dG9uPlxcXCIpO1xcblxcbiAgLy8gYXBwZW5kIChyZW5kZXIpIGVsZW1lbnRzIChjb25kaXRpb25hbClcXG4gIGlmICh3aXRoQnV0dG9ucykge1xcbiAgICBidXR0b25zRGl2LmFwcGVuZFRvKGNvbW1lbnREaXYpO1xcbiAgICBlZGl0QnV0dG9uLmFwcGVuZFRvKGJ1dHRvbnNEaXYpO1xcbiAgICBkZWxldGVCdXR0b24uYXBwZW5kVG8oYnV0dG9uc0Rpdik7XFxuXFxuICAgIC8vIGV2ZW50c1xcbiAgICBlZGl0QnV0dG9uLmNsaWNrKGZ1bmN0aW9uKCkge1xcbiAgICAgIGVkaXRDb21tZW50KGNvbW1lbnREaXYsIG1vZGFsLCBmdW5jdGlvbihtZXNzYWdlKSB7XFxuICAgICAgICBjb25zdCBjb21tZW50Rm9ybSA9IG1vZGFsLmZpbmQoXFxcIi5tb2RhbF9jb21tZW50c19jb250YWluZXJcXFwiKTtcXG4gICAgICAgIGNvbW1lbnRGb3JtLnJlbW92ZSgpO1xcbiAgICAgICAgYXV0aEZvcm0uYXBwZW5kVG8obW9kYWwpO1xcblxcbiAgICAgICAgY29uc3QgdG9vbHRpcHMgPSBhdXRoRm9ybS5maW5kKFxcXCIubW9kYWxfdG9vbHRpcHNcXFwiKTtcXG4gICAgICAgIGlmICh0b29sdGlwcy5jaGlsZHJlbigpLmxlbmd0aCA+IDApIHtcXG4gICAgICAgICAgLy8gcmVtb3ZlIHRvb2x0aXAgbWVzc2FnZSBpZiBhbnlcXG4gICAgICAgICAgdG9vbHRpcHMuY2hpbGRyZW4oKVswXS5yZW1vdmUoKTtcXG4gICAgICAgIH1cXG4gICAgICAgIGNvbnN0IHRvb2x0aXBNZXNzYWdlID0gJChcXFwiPHNwYW4+XFxcIiwge1xcbiAgICAgICAgICBodG1sOiBtZXNzYWdlXFxuICAgICAgICB9KTtcXG5cXG4gICAgICAgIHRvb2x0aXBNZXNzYWdlLmFwcGVuZFRvKHRvb2x0aXBzKTtcXG4gICAgICB9KTtcXG4gICAgfSk7XFxuXFxuICAgIGRlbGV0ZUJ1dHRvbi5jbGljayhmdW5jdGlvbigpIHtcXG4gICAgICBkZWxldGVDb21tZW50KGNvbW1lbnREaXYsIG1vZGFsLCBwYXJlbnQsIGZ1bmN0aW9uKG1lc3NhZ2UpIHtcXG4gICAgICAgIC8vIGVycm9yIGNhbGxiYWNrXFxuICAgICAgICBjb25zdCBjb21tZW50Rm9ybSA9IG1vZGFsLmZpbmQoXFxcIi5tb2RhbF9jb21tZW50c19jb250YWluZXJcXFwiKTtcXG4gICAgICAgIGNvbW1lbnRGb3JtLnJlbW92ZSgpO1xcbiAgICAgICAgYXV0aEZvcm0uYXBwZW5kVG8obW9kYWwpO1xcblxcbiAgICAgICAgY29uc3QgdG9vbHRpcHMgPSBhdXRoRm9ybS5maW5kKFxcXCIubW9kYWxfdG9vbHRpcHNcXFwiKTtcXG4gICAgICAgIGlmICh0b29sdGlwcy5jaGlsZHJlbigpLmxlbmd0aCA+IDApIHtcXG4gICAgICAgICAgLy8gcmVtb3ZlIHRvb2x0aXAgbWVzc2FnZSBpZiBhbnlcXG4gICAgICAgICAgdG9vbHRpcHMuY2hpbGRyZW4oKVswXS5yZW1vdmUoKTtcXG4gICAgICAgIH1cXG4gICAgICAgIGNvbnN0IHRvb2x0aXBNZXNzYWdlID0gJChcXFwiPHNwYW4+XFxcIiwge1xcbiAgICAgICAgICBodG1sOiBtZXNzYWdlXFxuICAgICAgICB9KTtcXG5cXG4gICAgICAgIHRvb2x0aXBNZXNzYWdlLmFwcGVuZFRvKHRvb2x0aXBzKTtcXG4gICAgICB9KTtcXG4gICAgfSk7XFxuICB9XFxuXFxuICByZXR1cm4gY29tbWVudERpdjtcXG59XFxuXFxuZnVuY3Rpb24gdG9nZ2xlQ29tbWVudEZvcm0obW9kYWwsIGNvbW1lbnRzRGl2LCBhdXRoRm9ybSkge1xcbiAgLy8gY3JlYXRlIGVsZW1lbnRzXFxuICBjb25zdCBjcmVhdGVDb21tZW50RGl2ID0gJCgnPGRpdiBjbGFzcz1cXFwibW9kYWxfY29tbWVudF9mb3JtXFxcIj4nKTtcXG5cXG4gIGNvbnN0IHRleHRMYWJlbCA9ICQoXFxcIjxkaXY+IFVuZXNpdGUga29tZW50YXI6IDwvZGl2PlxcXCIpO1xcbiAgY29uc3QgdGV4dElucHV0ID0gJChcXFwiPHRleHRhcmVhPlxcXCIpO1xcblxcbiAgY29uc3QgYnV0dG9uc0RpdiA9ICQoJzxkaXYgY2xhc3M9XFxcIm1vZGFsX2J1dHRvbnNcXFwiPicpO1xcbiAgY29uc3QgY3JlYXRlQnV0dG9uID0gJChcXFwiPGJ1dHRvbj4gU3ByZW1pIDwvYnV0dG9uPlxcXCIpO1xcbiAgY29uc3QgY2FuY2VsQnV0dG9uID0gJChcXFwiPGJ1dHRvbj4gT2R1c3RhbmkgPC9idXR0b24+XFxcIik7XFxuXFxuICAvLyBhcHBlbmQgKHJlbmRlcikgZWxlbWVudHNcXG4gIHRleHRMYWJlbC5hcHBlbmRUbyhjcmVhdGVDb21tZW50RGl2KTtcXG4gIHRleHRJbnB1dC5hcHBlbmRUbyhjcmVhdGVDb21tZW50RGl2KTtcXG5cXG4gIGJ1dHRvbnNEaXYuYXBwZW5kVG8oY3JlYXRlQ29tbWVudERpdik7XFxuICBjcmVhdGVCdXR0b24uYXBwZW5kVG8oYnV0dG9uc0Rpdik7XFxuICBjYW5jZWxCdXR0b24uYXBwZW5kVG8oYnV0dG9uc0Rpdik7XFxuXFxuICBjcmVhdGVDb21tZW50RGl2LmFwcGVuZFRvKG1vZGFsKTtcXG5cXG4gIC8vIGV2ZW50c1xcbiAgY3JlYXRlQnV0dG9uLmNsaWNrKGZ1bmN0aW9uKCkge1xcbiAgICBjcmVhdGVDb21tZW50KFxcbiAgICAgIHRleHRJbnB1dC52YWwoKSxcXG4gICAgICBmdW5jdGlvbihyZXNwb25zZSkge1xcbiAgICAgICAgLy8gc3VjY2VzcyBjYWxsYmFja1xcbiAgICAgICAgY3JlYXRlQ29tbWVudERpdi5yZW1vdmUoKTtcXG4gICAgICAgIGNvbnN0IG5ld0NvbW1lbnQgPSBjcmVhdGVDb21tZW50RWxlbWVudChcXG4gICAgICAgICAgbW9kYWwsXFxuICAgICAgICAgIHJlc3BvbnNlLmRhdGEsXFxuICAgICAgICAgIGF1dGhGb3JtLFxcbiAgICAgICAgICB0cnVlLFxcbiAgICAgICAgICBjb21tZW50c0RpdlxcbiAgICAgICAgKTtcXG4gICAgICAgIGlmIChjb21tZW50c0Rpdi5maW5kKCdkaXZbY29tbWVudGlkPVxcXCItMVxcXCJdJykpIHtcXG4gICAgICAgICAgY29tbWVudHNEaXYuZmluZCgnZGl2W2NvbW1lbnRpZD1cXFwiLTFcXFwiXScpLnJlbW92ZSgpO1xcbiAgICAgICAgfVxcbiAgICAgICAgbmV3Q29tbWVudC5hcHBlbmRUbyhjb21tZW50c0Rpdik7XFxuICAgICAgfSxcXG4gICAgICBmdW5jdGlvbihtZXNzYWdlKSB7XFxuICAgICAgICAvLyBlcnJvciBjYWxsYmFja1xcbiAgICAgICAgY3JlYXRlQ29tbWVudERpdi5yZW1vdmUoKTtcXG4gICAgICAgIG1vZGFsLmZpbmQoXFxcIi5tb2RhbF9jb21tZW50c19jb250YWluZXJcXFwiKS5yZW1vdmUoKTtcXG4gICAgICAgIGF1dGhGb3JtLmFwcGVuZFRvKG1vZGFsKTtcXG5cXG4gICAgICAgIGNvbnN0IHRvb2x0aXBzID0gYXV0aEZvcm0uZmluZChcXFwiLm1vZGFsX3Rvb2x0aXBzXFxcIik7XFxuICAgICAgICBpZiAodG9vbHRpcHMuY2hpbGRyZW4oKS5sZW5ndGggPiAwKSB7XFxuICAgICAgICAgIC8vIHJlbW92ZSB0b29sdGlwIG1lc3NhZ2UgaWYgYW55XFxuICAgICAgICAgIHRvb2x0aXBzLmNoaWxkcmVuKClbMF0ucmVtb3ZlKCk7XFxuICAgICAgICB9XFxuICAgICAgICBjb25zdCB0b29sdGlwTWVzc2FnZSA9ICQoXFxcIjxzcGFuPlxcXCIsIHtcXG4gICAgICAgICAgaHRtbDogbWVzc2FnZVxcbiAgICAgICAgfSk7XFxuXFxuICAgICAgICB0b29sdGlwTWVzc2FnZS5hcHBlbmRUbyh0b29sdGlwcyk7XFxuICAgICAgfVxcbiAgICApO1xcbiAgfSk7XFxuXFxuICBjYW5jZWxCdXR0b24uY2xpY2soZnVuY3Rpb24oKSB7XFxuICAgIGNyZWF0ZUNvbW1lbnREaXYucmVtb3ZlKCk7XFxuICB9KTtcXG59XFxuXFxuZnVuY3Rpb24gdG9nZ2xlRGF0ZVBpY2tlckZvcm0obW9kYWwsIGNhbGxiYWNrKSB7XFxuICAvLyBjcmVhdGUgZWxlbWVudHNcXG4gIGNvbnN0IHByb21wdERpdiA9ICQoJzxkaXYgY2xhc3M9XFxcIm1vZGFsX3Byb21wdFxcXCI+Jyk7XFxuXFxuICBjb25zdCBkYXlEaXYgPSAkKCc8ZGl2IGNsYXNzPVxcXCJmbGV4X2RpdlxcXCI+Jyk7XFxuICBjb25zdCBtb250aERpdiA9ICQoJzxkaXYgY2xhc3M9XFxcImZsZXhfZGl2XFxcIj4nKTtcXG4gIGNvbnN0IHllYXJEaXYgPSAkKCc8ZGl2IGNsYXNzPVxcXCJmbGV4X2RpdlxcXCI+Jyk7XFxuXFxuICBjb25zdCBkYXlEaXZMYWJlbCA9ICQoXFxcIjxzcGFuPiBVbmVzaXRlIGRhbiA8L3NwYW4+XFxcIik7XFxuICBjb25zdCBtb250aERpdkxhYmVsID0gJChcXFwiPHNwYW4+IFVuZXNpdGUgbWplc2VjIDwvc3Bhbj5cXFwiKTtcXG4gIGNvbnN0IHllYXJEaXZMYWJlbCA9ICQoXFxcIjxzcGFuPiBVbmVzaXRlIGdvZGludSA8L3NwYW4+XFxcIik7XFxuXFxuICBjb25zdCBkYXlJbnB1dCA9ICQoXFxcIjxzZWxlY3Q+XFxcIik7XFxuICBjb25zdCBtb250aElucHV0ID0gJChcXFwiPHNlbGVjdD5cXFwiKTtcXG4gIGNvbnN0IHllYXJJbnB1dCA9ICQoXFxcIjxpbnB1dD5cXFwiKTtcXG5cXG4gIGNvbnN0IGRheU9wdGlvbnMgPSAoZnVuY3Rpb24oKSB7XFxuICAgIGxldCBkYXlzID0gW107XFxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgMzA7IGkrKykge1xcbiAgICAgIGRheXMucHVzaChcXG4gICAgICAgICQoXFxcIjxvcHRpb24+XFxcIiwge1xcbiAgICAgICAgICB2YWx1ZTogaSArIDEsXFxuICAgICAgICAgIGh0bWw6IGkgKyAxXFxuICAgICAgICB9KVxcbiAgICAgICk7XFxuICAgIH1cXG4gICAgcmV0dXJuIGRheXM7XFxuICB9KSgpO1xcbiAgY29uc3QgbW9udGhPcHRpb25zID0gKGZ1bmN0aW9uKCkge1xcbiAgICBsZXQgbW9udGhzID0gW107XFxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgMTI7IGkrKykge1xcbiAgICAgIG1vbnRocy5wdXNoKFxcbiAgICAgICAgJChcXFwiPG9wdGlvbj5cXFwiLCB7XFxuICAgICAgICAgIHZhbHVlOiBpICsgMSxcXG4gICAgICAgICAgaHRtbDogaSArIDFcXG4gICAgICAgIH0pXFxuICAgICAgKTtcXG4gICAgfVxcbiAgICByZXR1cm4gbW9udGhzO1xcbiAgfSkoKTtcXG5cXG4gIGNvbnN0IGJ1dHRvbnNEaXYgPSAkKCc8ZGl2IGNsYXNzPVxcXCJtb2RhbF9idXR0b25zXFxcIj4nKTtcXG4gIGNvbnN0IHN1Ym1pdEJ1dHRvbiA9ICQoXFxcIjxidXR0b24+IFVuZXNpIDwvYnV0dG9uPlxcXCIpO1xcbiAgY29uc3QgY2FuY2VsQnV0dG9uID0gJChcXFwiPGJ1dHRvbj4gT2R1c3RhbmkgPC9idXR0b24+XFxcIik7XFxuXFxuICBjb25zdCB0b29sdGlwID0gJCgnPGRpdiBjbGFzcz1cXFwibW9kYWxfdG9vbHRpcHNcXFwiPicpO1xcblxcbiAgLy8gcmVuZGVyXFxuICB0b29sdGlwLmFwcGVuZFRvKHByb21wdERpdik7XFxuXFxuICBkYXlEaXZMYWJlbC5hcHBlbmRUbyhkYXlEaXYpO1xcbiAgZm9yIChsZXQgaSA9IDA7IGkgPCBkYXlPcHRpb25zLmxlbmd0aDsgaSsrKSB7XFxuICAgIGRheU9wdGlvbnNbaV0uYXBwZW5kVG8oZGF5SW5wdXQpO1xcbiAgfVxcbiAgZGF5SW5wdXQuYXBwZW5kVG8oZGF5RGl2KTtcXG5cXG4gIG1vbnRoRGl2TGFiZWwuYXBwZW5kVG8obW9udGhEaXYpO1xcbiAgZm9yIChsZXQgaSA9IDA7IGkgPCBtb250aE9wdGlvbnMubGVuZ3RoOyBpKyspIHtcXG4gICAgbW9udGhPcHRpb25zW2ldLmFwcGVuZFRvKG1vbnRoSW5wdXQpO1xcbiAgfVxcbiAgbW9udGhJbnB1dC5hcHBlbmRUbyhtb250aERpdik7XFxuXFxuICB5ZWFyRGl2TGFiZWwuYXBwZW5kVG8oeWVhckRpdik7XFxuICB5ZWFySW5wdXQuYXBwZW5kVG8oeWVhckRpdik7XFxuXFxuICBzdWJtaXRCdXR0b24uYXBwZW5kVG8oYnV0dG9uc0Rpdik7XFxuICBjYW5jZWxCdXR0b24uYXBwZW5kVG8oYnV0dG9uc0Rpdik7XFxuXFxuICBkYXlEaXYuYXBwZW5kVG8ocHJvbXB0RGl2KTsgLy8gY29udGFpbmVyc1xcbiAgbW9udGhEaXYuYXBwZW5kVG8ocHJvbXB0RGl2KTtcXG4gIHllYXJEaXYuYXBwZW5kVG8ocHJvbXB0RGl2KTtcXG4gIGJ1dHRvbnNEaXYuYXBwZW5kVG8ocHJvbXB0RGl2KTtcXG5cXG4gIHByb21wdERpdi5hcHBlbmRUbyhtb2RhbCk7XFxuXFxuICAvLyBldmVudHNcXG4gIHN1Ym1pdEJ1dHRvbi5jbGljayhmdW5jdGlvbigpIHtcXG4gICAgY29uc3QgeWVhclJlZ2V4ID0gbmV3IFJlZ0V4cChcXFwiXlswLTldezR9XFxcIik7XFxuICAgIGNvbnN0IGRhdGVRdWVyeSA9XFxuICAgICAgZGF5SW5wdXQudmFsKCkgKyBcXFwiLVxcXCIgKyBtb250aElucHV0LnZhbCgpICsgXFxcIi1cXFwiICsgeWVhcklucHV0LnZhbCgpO1xcbiAgICBpZiAoeWVhclJlZ2V4LnRlc3QoeWVhcklucHV0LnZhbCgpKSkge1xcbiAgICAgIGNhbGxiYWNrKGRhdGVRdWVyeSk7XFxuICAgICAgcHJvbXB0RGl2LnJlbW92ZSgpO1xcbiAgICB9IGVsc2Uge1xcbiAgICAgIHRvb2x0aXAuaHRtbChcXFwiTmVpc3ByYXZhbiB1bm9zIGdvZGluZVxcXCIpO1xcbiAgICB9XFxuICB9KTtcXG4gIGNhbmNlbEJ1dHRvbi5jbGljayhmdW5jdGlvbigpIHtcXG4gICAgcHJvbXB0RGl2LnJlbW92ZSgpO1xcbiAgfSk7XFxufVxcblxcbmZ1bmN0aW9uIGNvbmZpcm1Qcm9tcHQobWVzc2FnZSwgbW9kYWwsIGNhbGxiYWNrKSB7XFxuICAvLyBjcmVhdGUgZWxlbWVudHNcXG4gIGNvbnN0IHByb21wdENvbnRhaW5lciA9ICQoJzxkaXYgY2xhc3M9XFxcInJlY2VuemlqZS1jb25maXJtUHJvbXB0XFxcIj4nKTtcXG4gIGNvbnN0IG1lc3NhZ2VDb250YWluZXIgPSAkKCc8c3Bhbj4nLCB7XFxuICAgIGh0bWw6IG1lc3NhZ2UsXFxuICB9KTtcXG4gIGNvbnN0IGJ1dHRvbnNDb250YWluZXIgPSAkKCc8ZGl2IGNsYXNzPVxcXCJyZWNlbnppamUtY29uZmlybVByb21wdF9fYnV0dG9uc1xcXCI+Jyk7XFxuICBjb25zdCB5ZXNCdXR0b24gPSAkKCc8YnV0dG9uPicsIHtcXG4gICAgaHRtbDogJ1BvdHZyZGknLFxcbiAgICBjbGljazogZnVuY3Rpb24oKSB7XFxuICAgICAgY2FsbGJhY2soKTtcXG4gICAgICBwcm9tcHRDb250YWluZXIucmVtb3ZlKCk7XFxuICAgIH1cXG4gIH0pO1xcbiAgY29uc3Qgbm9CdXR0b24gPSAkKCc8YnV0dG9uPicsIHtcXG4gICAgaHRtbDogJ09kdXN0YW5pJ1xcbiAgfSk7XFxuXFxuICAvLyByZW5kZXJcXG4gIG1lc3NhZ2VDb250YWluZXIuYXBwZW5kVG8ocHJvbXB0Q29udGFpbmVyKTtcXG4gIHllc0J1dHRvbi5hcHBlbmRUbyhidXR0b25zQ29udGFpbmVyKTtcXG4gIG5vQnV0dG9uLmFwcGVuZFRvKGJ1dHRvbnNDb250YWluZXIpO1xcbiAgYnV0dG9uc0NvbnRhaW5lci5hcHBlbmRUbyhwcm9tcHRDb250YWluZXIpO1xcbiAgcHJvbXB0Q29udGFpbmVyLmFwcGVuZFRvKG1vZGFsKTtcXG5cXG4gIC8vIGV2ZW50c1xcbiAgbm9CdXR0b24uY2xpY2soZnVuY3Rpb24oKSB7XFxuICAgIHByb21wdENvbnRhaW5lci5yZW1vdmUoKTtcXG4gIH0pXFxufVxcblxcbi8vIEFQSSBDQUxMU1xcblxcbmZ1bmN0aW9uIGludmFsaWRhdGVUb2tlbihjYWxsYmFjaykge1xcbiAgZG93bmxvYWRDb21tZW50cyhmdW5jdGlvbigpIHtcXG4gICAgJC5wb3N0KHtcXG4gICAgICB1cmw6IGJhc2VVUkwgKyBhcGlVUkwgKyAndG9rZW4vaW52YWxpZGF0ZScsXFxuICAgICAgZGF0YTogSlNPTi5zdHJpbmdpZnkoe1xcbiAgICAgICAgZ2VuZXJhdGVkVG9rZW46IGdldENvb2tpZSgpXFxuICAgICAgfSksXFxuICAgICAgZGF0YVR5cGU6IFxcXCJqc29uXFxcIixcXG4gICAgICBjb250ZW50VHlwZTogXFxcImFwcGxpY2F0aW9uL2pzb247Y2hhcnNldD1VVEYtOFxcXCIsXFxuICAgICAgc3VjY2VzczogZnVuY3Rpb24oKSB7XFxuICAgICAgICBjYWxsYmFjaygpO1xcbiAgICAgIH0sXFxuICAgICAgZXJyb3I6IGZ1bmN0aW9uKCkge1xcbiAgICAgICAgY29uc29sZS5lcnJvcignRG/FoWxvIGplIGRvIGdyZcWha2UgcyBwb3NsdcW+aXRlbGplbScpO1xcbiAgICAgIH1cXG4gICAgfSlcXG4gIH0pXFxufVxcblxcbmZ1bmN0aW9uIGRvd25sb2FkQ29tbWVudHMoY2FsbGJhY2spIHtcXG4gICQucG9zdCh7XFxuICAgIHVybDogYmFzZVVSTCArIGFwaVVSTCArICdjb21tZW50L2xpc3QvY3N2JyxcXG4gICAgZGF0YTogSlNPTi5zdHJpbmdpZnkoe1xcbiAgICAgIHRva2VuOiBnZXRDb29raWUoKSxcXG4gICAgICBkZXJJZDogZ2V0SHB1YkluZm8oKS5kb3dubG9hZElkLFxcbiAgICB9KSxcXG4gICAgZGF0YVR5cGU6IFxcXCJqc29uXFxcIixcXG4gICAgY29udGVudFR5cGU6IFxcXCJhcHBsaWNhdGlvbi9qc29uO2NoYXJzZXQ9VVRGLThcXFwiLFxcbiAgICBzdWNjZXNzOiBmdW5jdGlvbihkYXRhKSB7XFxuICAgICAgY2FsbGJhY2soKTtcXG4gICAgfSxcXG4gICAgZXJyb3I6IGZ1bmN0aW9uKGRhdGEpIHsgLy8gZm9yIHVua25vd24gcmVhc29ucyB0aGlzIGFwaSBjYWxsIHRyaWdnZXJzIGVycm9yIGZ1bmN0aW9uIGV2ZW4gdG91Z2ggc3RhdHVzIGlzIDIwMCAoc3VjY2VzcylcXG4gICAgICBjb25zdCBjc3ZTdHJpbmcgPSB1bmVzY2FwZShlbmNvZGVVUklDb21wb25lbnQoZGF0YS5yZXNwb25zZVRleHQpKTtcXG5cXG4gICAgICBkb3dubG9hZExpbmsuaHJlZiA9ICdkYXRhOmF0dGFjaG1lbnQvY3N2O2Jhc2U2NCw3N3UvJyArIHdpbmRvdy5idG9hKGNzdlN0cmluZyk7XFxuICAgICAgZG93bmxvYWRMaW5rLmRvd25sb2FkID0gZ2V0Q29va2llKCkgKyAnLmNzdic7XFxuICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpIHtkb3dubG9hZExpbmsuY2xpY2soKX0sIDIwMDApO1xcbiAgICAgIGNhbGxiYWNrKCk7XFxuICAgIH1cXG4gIH0pXFxufVxcblxcbmZ1bmN0aW9uIGZldGNoQ29tbWVudHMoZGF0ZSwgY2FsbGJhY2ssIGVycm9yQ2FsbGJhY2spIHtcXG4gIGNvbnN0IGhwdWJJbmZvID0gZ2V0SHB1YkluZm8oKTtcXG4gICQucG9zdCh7XFxuICAgIHVybDogYmFzZVVSTCArIGFwaVVSTCArIFxcXCJjb21tZW50L2xpc3QvbWluZVxcXCIsXFxuICAgIGRhdGE6IEpTT04uc3RyaW5naWZ5KHtcXG4gICAgICBkZXJJZDogaHB1YkluZm8ucmV2aWV3RGVySWQudG9TdHJpbmcoKSxcXG4gICAgICBkYXRlRnJvbTogXFxcIlxcXCIsXFxuICAgICAgdG9rZW46IGdldENvb2tpZSgpXFxuICAgIH0pLFxcbiAgICBkYXRhVHlwZTogXFxcImpzb25cXFwiLFxcbiAgICBjb250ZW50VHlwZTogXFxcImFwcGxpY2F0aW9uL2pzb247Y2hhcnNldD1VVEYtOFxcXCIsXFxuICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uKHJlc3BvbnNlKSB7XFxuICAgICAgaWYgKHJlc3BvbnNlLmVyciA9PSAwKSB7XFxuICAgICAgICBjYWxsYmFjayhyZXNwb25zZSk7XFxuICAgICAgfSBlbHNlIGlmIChyZXNwb25zZS5lcnIgPT0gODAzIHx8IHJlc3BvbnNlLmVyciA9PSA4MDQpIHtcXG4gICAgICAgIGVycm9yQ2FsbGJhY2soXFxcIk5ldmHFvmXEh2kgdG9rZW5cXFwiKTtcXG4gICAgICB9IGVsc2Uge1xcbiAgICAgICAgZXJyb3JDYWxsYmFjayhcXFwiRG/FoWxvIGplIGRvIHBvZ3JlxaFrZSBzIHBvc2x1xb5pdGVsamVtLlxcXCIpO1xcbiAgICAgIH1cXG4gICAgfSxcXG4gICAgZXJyb3I6IGZ1bmN0aW9uKCkge1xcbiAgICAgIGVycm9yQ2FsbGJhY2soXFxcIkRvxaFsbyBqZSBkbyBwb2dyZcWha2UgcyBwb3NsdcW+aXRlbGplbS5cXFwiKTtcXG4gICAgfVxcbiAgfSk7XFxufVxcblxcbmZ1bmN0aW9uIGNyZWF0ZUNvbW1lbnQodGV4dCwgY2FsbGJhY2ssIGVycm9yQ2FsbGJhY2spIHtcXG4gICQucG9zdCh7XFxuICAgIHVybDogYmFzZVVSTCArIGFwaVVSTCArIFxcXCJjb21tZW50L2NyZWF0ZVxcXCIsXFxuICAgIGRhdGE6IEpTT04uc3RyaW5naWZ5KHtcXG4gICAgICBhdXRoZW50aWNhdGlvblRva2VuOiBnZXRDb29raWUoKSxcXG4gICAgICB0ZXh0OiB0ZXh0LFxcbiAgICAgIGxvY2F0aW9uTGluazogZG9jdW1lbnQubG9jYXRpb24uaHJlZlxcbiAgICB9KSxcXG4gICAgZGF0YVR5cGU6IFxcXCJqc29uXFxcIixcXG4gICAgY29udGVudFR5cGU6IFxcXCJhcHBsaWNhdGlvbi9qc29uO2NoYXJzZXQ9VVRGLThcXFwiLFxcbiAgICBzdWNjZXNzOiBmdW5jdGlvbihyZXNwb25zZSkge1xcbiAgICAgIGlmIChyZXNwb25zZS5lcnIgPT0gMCkge1xcbiAgICAgICAgY2FsbGJhY2socmVzcG9uc2UpO1xcbiAgICAgIH0gZWxzZSB7XFxuICAgICAgICBlcnJvckNhbGxiYWNrKFxcXCJUb2tlbiBqZSBuZXZhxb5lxIdpIGlsaSBqZSBpc3Rla2FvXFxcIik7XFxuICAgICAgfVxcbiAgICB9LFxcbiAgICBlcnJvcjogZnVuY3Rpb24oKSB7XFxuICAgICAgZXJyb3JDYWxsYmFjayhcXFwiRG/FoWxvIGplIGRvIGdyZcWha2UgcyBwb3NsdcW+aXRlbGplbVxcXCIpO1xcbiAgICB9XFxuICB9KTtcXG59XFxuXFxuZnVuY3Rpb24gZWRpdENvbW1lbnQoY29tbWVudCwgbW9kYWwsIGVycm9yQ2FsbGJhY2spIHtcXG4gIGNvbnN0IGNvbW1lbnRUZXh0ID0gY29tbWVudC5maW5kKFxcXCIuY29tbWVudF90ZXh0XFxcIik7XFxuICAvLyBjcmVhdGUgZWxlbWVudHNcXG4gIGNvbnN0IGNvbW1lbnRGb3JtRGl2ID0gJCgnPGRpdiBjbGFzcz1cXFwibW9kYWxfY29tbWVudF9mb3JtXFxcIj4nKTtcXG4gIGNvbnN0IHRleHRMYWJlbCA9ICQoXFxcIjxkaXY+IFVyZWRpdGUga29tZW50YXI6IDwvZGl2PlxcXCIpO1xcblxcbiAgY29uc3QgdGV4dElucHV0ID0gJChcXFwiPHRleHRhcmVhPlxcXCIpO1xcbiAgdGV4dElucHV0LnZhbChjb21tZW50VGV4dC5odG1sKCkpO1xcblxcbiAgY29uc3QgYnV0dG9uc0RpdiA9ICQoJzxkaXYgY2xhc3M9XFxcIm1vZGFsX2J1dHRvbnNcXFwiPicpO1xcbiAgY29uc3Qgc3VibWl0QnV0dG9uID0gJChcXFwiPGJ1dHRvbj4gU3ByZW1pIDwvYnV0dG9uPlxcXCIpO1xcbiAgY29uc3QgY2FuY2VsQnV0dG9uID0gJChcXFwiPGJ1dHRvbj4gT2R1c3RhbmkgPC9idXR0b24+XFxcIik7XFxuXFxuICAvLyBhcHBlbmQgKHJlbmRlcikgZWxlbWVudHNcXG4gIHRleHRMYWJlbC5hcHBlbmRUbyhjb21tZW50Rm9ybURpdik7XFxuICB0ZXh0SW5wdXQuYXBwZW5kVG8oY29tbWVudEZvcm1EaXYpO1xcblxcbiAgYnV0dG9uc0Rpdi5hcHBlbmRUbyhjb21tZW50Rm9ybURpdik7XFxuICBzdWJtaXRCdXR0b24uYXBwZW5kVG8oYnV0dG9uc0Rpdik7XFxuICBjYW5jZWxCdXR0b24uYXBwZW5kVG8oYnV0dG9uc0Rpdik7XFxuXFxuICBjb21tZW50Rm9ybURpdi5hcHBlbmRUbyhtb2RhbCk7XFxuXFxuICAvLyBldmVudHNcXG4gIHN1Ym1pdEJ1dHRvbi5jbGljayhmdW5jdGlvbigpIHtcXG4gICAgLy9iYXNlVVJMICsgYXBpVVJMICsgJ3VwZGF0ZScsIHsgYXV0aGVudGljYXRpb25Ub2tlbjogZ2V0Q29va2llKCksIHVucGFja2VkSHB1YkNvbW1lbnRJZDogY29tbWVudC5hdHRyKCdjb21tZW50SWQnKSwgdGV4dDogdGV4dElucHV0LnZhbCgpIH1cXG4gICAgJC5wb3N0KHtcXG4gICAgICB1cmw6IGJhc2VVUkwgKyBhcGlVUkwgKyBcXFwiY29tbWVudC91cGRhdGVcXFwiLFxcbiAgICAgIGRhdGE6IEpTT04uc3RyaW5naWZ5KHtcXG4gICAgICAgIGF1dGhlbnRpY2F0aW9uVG9rZW46IGdldENvb2tpZSgpLFxcbiAgICAgICAgdW5wYWNrZWRIcHViQ29tbWVudElkOiBjb21tZW50LmF0dHIoXFxcImNvbW1lbnRJZFxcXCIpLFxcbiAgICAgICAgdGV4dDogdGV4dElucHV0LnZhbCgpXFxuICAgICAgfSksXFxuICAgICAgZGF0YVR5cGU6IFxcXCJqc29uXFxcIixcXG4gICAgICBjb250ZW50VHlwZTogXFxcImFwcGxpY2F0aW9uL2pzb247Y2hhcnNldD1VVEYtOFxcXCIsXFxuICAgICAgc3VjY2VzczogZnVuY3Rpb24ocmVzcG9uc2UpIHtcXG4gICAgICAgIGlmIChyZXNwb25zZS5lcnIgPT0gMCkge1xcbiAgICAgICAgICBjb21tZW50VGV4dC5odG1sKHRleHRJbnB1dC52YWwoKSk7XFxuICAgICAgICB9IGVsc2Uge1xcbiAgICAgICAgICBlcnJvckNhbGxiYWNrKFxcXCJUb2tlbiBqZSBuZXZhxb5lxIdpIGlsaSBqZSBpc3Rla2FvLlxcXCIpO1xcbiAgICAgICAgfVxcbiAgICAgICAgY29tbWVudEZvcm1EaXYucmVtb3ZlKCk7XFxuICAgICAgfSxcXG4gICAgICBlcnJvcjogZnVuY3Rpb24ocmVzcG9uc2UpIHtcXG4gICAgICAgIGVycm9yQ2FsbGJhY2soXFxcIkRvxaFsbyBqZSBkbyBwb2dyZcWha2UgcyBwb3NsdcW+aXRlbGplbS5cXFwiKTtcXG4gICAgICAgIGNvbW1lbnRGb3JtRGl2LnJlbW92ZSgpO1xcbiAgICAgIH1cXG4gICAgfSk7XFxuICB9KTtcXG5cXG4gIGNhbmNlbEJ1dHRvbi5jbGljayhmdW5jdGlvbigpIHtcXG4gICAgY29tbWVudEZvcm1EaXYucmVtb3ZlKCk7XFxuICB9KTtcXG59XFxuXFxuZnVuY3Rpb24gZGVsZXRlQ29tbWVudChjb21tZW50LCBtb2RhbCwgcGFyZW50LCBlcnJvckNhbGxiYWNrKSB7XFxuICAvLyB0b2dnbGUgcHJvbXB0XFxuICAvLyBjcmVhdGUgZWxlbWVudHNcXG4gIGNvbnN0IHByb21wdERpdiA9ICQoJzxkaXYgY2xhc3M9XFxcIm1vZGFsX3Byb21wdFxcXCI+Jyk7XFxuICBjb25zdCBkaXYgPSAkKFxcXCI8ZGl2PlxcXCIpO1xcbiAgY29uc3QgcHJvbXB0VGV4dCA9ICQoXFxuICAgIFxcXCI8c3Bhbj5KZXN0ZSBsaSBzaWd1cm5pIGRhIMW+ZWxpdGUgb2JyaXNhdGkgb3ZhaiBrb21lbnRhcj88L3NwYW4+XFxcIlxcbiAgKTtcXG5cXG4gIGNvbnN0IGJ1dHRvbnNEaXYgPSAkKFxcXCI8ZGl2PlxcXCIpO1xcbiAgY29uc3Qgc3VibWl0QnV0dG9uID0gJChcXFwiPGJ1dHRvbj4gUG90dnJkaSA8L2J1dHRvbj5cXFwiKTtcXG4gIGNvbnN0IGNhbmNlbEJ1dHRvbiA9ICQoXFxcIjxidXR0b24+IE9kdXN0YW5pIDwvYnV0dG9uPlxcXCIpO1xcblxcbiAgLy8gYXBwZW5kIChyZW5kZXIpIGVsZW1lbnRzXFxuICBwcm9tcHRUZXh0LmFwcGVuZFRvKGRpdik7XFxuXFxuICBidXR0b25zRGl2LmFwcGVuZFRvKGRpdik7XFxuICBzdWJtaXRCdXR0b24uYXBwZW5kVG8oYnV0dG9uc0Rpdik7XFxuICBjYW5jZWxCdXR0b24uYXBwZW5kVG8oYnV0dG9uc0Rpdik7XFxuXFxuICBkaXYuYXBwZW5kVG8ocHJvbXB0RGl2KTtcXG4gIHByb21wdERpdi5hcHBlbmRUbyhtb2RhbCk7XFxuXFxuICAvLyBldmVudHNcXG4gIHN1Ym1pdEJ1dHRvbi5jbGljayhmdW5jdGlvbigpIHtcXG4gICAgJC5wb3N0KHtcXG4gICAgICB1cmw6IGJhc2VVUkwgKyBhcGlVUkwgKyBcXFwiY29tbWVudC9kZWxldGVcXFwiLFxcbiAgICAgIGRhdGE6IEpTT04uc3RyaW5naWZ5KHtcXG4gICAgICAgIGF1dGhlbnRpY2F0aW9uVG9rZW46IGdldENvb2tpZSgpLFxcbiAgICAgICAgdW5wYWNrZWRIcHViQ29tbWVudElkOiBjb21tZW50LmF0dHIoXFxcImNvbW1lbnRJZFxcXCIpXFxuICAgICAgfSksXFxuICAgICAgZGF0YVR5cGU6IFxcXCJqc29uXFxcIixcXG4gICAgICBjb250ZW50VHlwZTogXFxcImFwcGxpY2F0aW9uL2pzb247Y2hhcnNldD1VVEYtOFxcXCIsXFxuICAgICAgc3VjY2VzczogZnVuY3Rpb24ocmVzcG9uc2UpIHtcXG4gICAgICAgIGlmIChyZXNwb25zZS5lcnIgPT0gMCkge1xcbiAgICAgICAgICBjb21tZW50LnJlbW92ZSgpO1xcbiAgICAgICAgICBpZiAocGFyZW50LmNoaWxkcmVuKCkubGVuZ3RoID09IDApIHtcXG4gICAgICAgICAgICBjb25zdCBub0NvbW1lbnRzVG9vbHRpcCA9ICQoXFxuICAgICAgICAgICAgICAnPGRpdiBjbGFzcz1cXFwicmVjZW56aWphX2NvbW1lbnRcXFwiIGNvbW1lbnRpZD1cXFwiLTFcXFwiPjxkaXYgY2xhc3M9XFxcImNvbW1lbnRfdGV4dFxcXCI+IE5lbWEga29tZW50YXJhIDwvZGl2PjwvZGl2PidcXG4gICAgICAgICAgICApO1xcbiAgICAgICAgICAgIG5vQ29tbWVudHNUb29sdGlwLmFwcGVuZFRvKHBhcmVudCk7XFxuICAgICAgICAgIH1cXG4gICAgICAgICAgcHJvbXB0RGl2LnJlbW92ZSgpO1xcbiAgICAgICAgfSBlbHNlIHtcXG4gICAgICAgICAgZXJyb3JDYWxsYmFjayhcXFwiVG9rZW4gamUgbmV2YcW+ZcSHaSBpbGkgamUgaXN0ZWthby5cXFwiKTtcXG4gICAgICAgICAgcHJvbXB0RGl2LnJlbW92ZSgpO1xcbiAgICAgICAgfVxcbiAgICAgIH0sXFxuICAgICAgZXJyb3I6IGZ1bmN0aW9uKCkge1xcbiAgICAgICAgZXJyb3JDYWxsYmFjayhcXFwiRG/FoWxvIGplIGRvIGdyZcWha2UgcyBwb3NsdcW+aXRlbGplbVxcXCIpO1xcbiAgICAgICAgcHJvbXB0RGl2LnJlbW92ZSgpO1xcbiAgICAgIH1cXG4gICAgfSk7XFxuICB9KTtcXG5cXG4gIGNhbmNlbEJ1dHRvbi5jbGljayhmdW5jdGlvbigpIHtcXG4gICAgcHJvbXB0RGl2LnJlbW92ZSgpO1xcbiAgfSk7XFxufVxcblxcbi8vIFVUSUxTXFxuZnVuY3Rpb24gY3JlYXRlQXV0aENvb2tpZShjb29raWVWYWx1ZSkge1xcbiAgY29uc3QgY29va2llTmFtZSA9IGF1dGhUb2tlblJlZiArIFxcXCI9XFxcIjtcXG4gIGNvbnN0IGNvb2tpZUR1cmF0aW9uID0gbmV3IERhdGUoKTtcXG4gIGNvb2tpZUR1cmF0aW9uLnNldFRpbWUoY29va2llRHVyYXRpb24uZ2V0VGltZSgpICsgMTAwMCAqIDYwICogNjAgKiAyNCk7IC8vIGFkZCAxIGRheSBkdXJhdGlvbiBpbiBtaWxpc2Vjb25kcyB0byBjdXJyZW50IHRpbWVcXG4gIGNvbnN0IGNvb2tpZUV4cGlyYXRpb25WYWx1ZSA9IFxcXCJleHBpcmVzPVxcXCIgKyBjb29raWVEdXJhdGlvbjtcXG4gIGRvY3VtZW50LmNvb2tpZSA9XFxuICAgIGNvb2tpZU5hbWUgKyBjb29raWVWYWx1ZSArIFxcXCI7IFxcXCIgKyBjb29raWVFeHBpcmF0aW9uVmFsdWUgKyBcXFwiOyBwYXRoPS87XFxcIjtcXG59XFxuXFxuZnVuY3Rpb24gZ2V0Q29va2llKCkge1xcbiAgaWYgKGRvY3VtZW50LmNvb2tpZS5pbmNsdWRlcyhhdXRoVG9rZW5SZWYpKSB7XFxuICAgIGNvbnN0IGNvb2tpZXMgPSBkb2N1bWVudC5jb29raWUuc3BsaXQoXFxcIjsgXFxcIik7XFxuICAgIGNvbnN0IGF1dGhDb29raWUgPSBjb29raWVzLmZpbHRlcihmdW5jdGlvbihjb29raWUpIHtcXG4gICAgICByZXR1cm4gY29va2llLmluY2x1ZGVzKGF1dGhUb2tlblJlZik7XFxuICAgIH0pO1xcbiAgICByZXR1cm4gYXV0aENvb2tpZVswXS5zdWJzdHJpbmcoXFxuICAgICAgYXV0aENvb2tpZVswXS5pbmRleE9mKFxcXCI9XFxcIikgKyAxLFxcbiAgICAgIGF1dGhDb29raWVbMF0ubGVuZ3RoXFxuICAgICk7XFxuICB9XFxufVxcblxcbmZ1bmN0aW9uIGRlbGV0ZUNvb2tpZShjb29raWVOYW1lKSB7XFxuICBjb25zdCBjb29raWVEdXJhdGlvbiA9IG5ldyBEYXRlKCk7XFxuICBjb29raWVEdXJhdGlvbi5zZXRUaW1lKDApOyAvLyBzZXQgdGltZSB0byBwYXN0ICgxOTcwKSBzbyBjb29raWUgaXMgZXhwaXJlZCAoZGVsZXRlZClcXG4gIGNvbnN0IGNvb2tpZUV4cGlyYXRpb25WYWx1ZSA9IFxcXCJleHBpcmVzPVxcXCIgKyBjb29raWVEdXJhdGlvbjtcXG4gIGRvY3VtZW50LmNvb2tpZSA9IGNvb2tpZU5hbWUgKyBcXFwiPTsgXFxcIiArIGNvb2tpZUV4cGlyYXRpb25WYWx1ZSArIFxcXCI7IHBhdGg9LztcXFwiO1xcbn1cXG5cXG5mdW5jdGlvbiBnZXRIcHViSW5mbygpIHtcXG4gIC8vIGdsb2JhbCBjb25maWcgdmFyIFJFVklFV19JTkZPIHNob3VsZCBiZSBzZXRcXG4gIGNvbnN0IGluZm8gPSB7XFxuICAgIHJldmlld0RlcklkOiBSRVZJRVdfSU5GTyAmJiBSRVZJRVdfSU5GTy5yZXZpZXdEZXJJZCxcXG4gICAgcmV2aWV3RGF0ZTogUkVWSUVXX0lORk8gJiYgUkVWSUVXX0lORk8ucmV2aWV3RGF0ZSxcXG4gICAgZG93bmxvYWRJZDogUkVWSUVXX0lORk8gJiYgUkVWSUVXX0lORk8uZG93bmxvYWRJZFxcbiAgfTtcXG5cXG4gIHJldHVybiBpbmZvO1xcbn1cXG5cIiIsIi8vIGV4dHJhY3RlZCBieSBtaW5pLWNzcy1leHRyYWN0LXBsdWdpbiJdLCJzb3VyY2VSb290IjoiIn0=