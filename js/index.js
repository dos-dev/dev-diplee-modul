/******/ (function(modules) { // webpackBootstrap
/******/ 	// The module cache
/******/ 	var installedModules = {};
/******/
/******/ 	// The require function
/******/ 	function __webpack_require__(moduleId) {
/******/
/******/ 		// Check if module is in cache
/******/ 		if(installedModules[moduleId]) {
/******/ 			return installedModules[moduleId].exports;
/******/ 		}
/******/ 		// Create a new module (and put it into the cache)
/******/ 		var module = installedModules[moduleId] = {
/******/ 			i: moduleId,
/******/ 			l: false,
/******/ 			exports: {}
/******/ 		};
/******/
/******/ 		// Execute the module function
/******/ 		modules[moduleId].call(module.exports, module, module.exports, __webpack_require__);
/******/
/******/ 		// Flag the module as loaded
/******/ 		module.l = true;
/******/
/******/ 		// Return the exports of the module
/******/ 		return module.exports;
/******/ 	}
/******/
/******/
/******/ 	// expose the modules object (__webpack_modules__)
/******/ 	__webpack_require__.m = modules;
/******/
/******/ 	// expose the module cache
/******/ 	__webpack_require__.c = installedModules;
/******/
/******/ 	// define getter function for harmony exports
/******/ 	__webpack_require__.d = function(exports, name, getter) {
/******/ 		if(!__webpack_require__.o(exports, name)) {
/******/ 			Object.defineProperty(exports, name, { enumerable: true, get: getter });
/******/ 		}
/******/ 	};
/******/
/******/ 	// define __esModule on exports
/******/ 	__webpack_require__.r = function(exports) {
/******/ 		if(typeof Symbol !== 'undefined' && Symbol.toStringTag) {
/******/ 			Object.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });
/******/ 		}
/******/ 		Object.defineProperty(exports, '__esModule', { value: true });
/******/ 	};
/******/
/******/ 	// create a fake namespace object
/******/ 	// mode & 1: value is a module id, require it
/******/ 	// mode & 2: merge all properties of value into the ns
/******/ 	// mode & 4: return value when already ns object
/******/ 	// mode & 8|1: behave like require
/******/ 	__webpack_require__.t = function(value, mode) {
/******/ 		if(mode & 1) value = __webpack_require__(value);
/******/ 		if(mode & 8) return value;
/******/ 		if((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;
/******/ 		var ns = Object.create(null);
/******/ 		__webpack_require__.r(ns);
/******/ 		Object.defineProperty(ns, 'default', { enumerable: true, value: value });
/******/ 		if(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));
/******/ 		return ns;
/******/ 	};
/******/
/******/ 	// getDefaultExport function for compatibility with non-harmony modules
/******/ 	__webpack_require__.n = function(module) {
/******/ 		var getter = module && module.__esModule ?
/******/ 			function getDefault() { return module['default']; } :
/******/ 			function getModuleExports() { return module; };
/******/ 		__webpack_require__.d(getter, 'a', getter);
/******/ 		return getter;
/******/ 	};
/******/
/******/ 	// Object.prototype.hasOwnProperty.call
/******/ 	__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };
/******/
/******/ 	// __webpack_public_path__
/******/ 	__webpack_require__.p = "";
/******/
/******/
/******/ 	// Load entry module and return exports
/******/ 	return __webpack_require__(__webpack_require__.s = 4);
/******/ })
/************************************************************************/
/******/ ([
/* 0 */
/***/ (function(module, exports) {

/*
	MIT License http://www.opensource.org/licenses/mit-license.php
	Author Tobias Koppers @sokra
*/
module.exports = function(src) {
	function log(error) {
		(typeof console !== "undefined")
		&& (console.error || console.log)("[Script Loader]", error);
	}

	// Check for IE =< 8
	function isIE() {
		return typeof attachEvent !== "undefined" && typeof addEventListener === "undefined";
	}

	try {
		if (typeof execScript !== "undefined" && isIE()) {
			execScript(src);
		} else if (typeof eval !== "undefined") {
			eval.call(null, src);
		} else {
			log("EvalError: No eval function available");
		}
	} catch (error) {
		log(error);
	}
}


/***/ }),
/* 1 */,
/* 2 */,
/* 3 */,
/* 4 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var script_loader_sourceMap_true_src_common_main_util_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(5);
/* harmony import */ var script_loader_sourceMap_true_src_common_main_util_js__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(script_loader_sourceMap_true_src_common_main_util_js__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var _src_common_main_add_css__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(7);
/* harmony import */ var _src_common_main_add_css__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(_src_common_main_add_css__WEBPACK_IMPORTED_MODULE_1__);
/* harmony import */ var script_loader_sourceMap_true_src_common_quiz_quiz_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(8);
/* harmony import */ var script_loader_sourceMap_true_src_common_quiz_quiz_js__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(script_loader_sourceMap_true_src_common_quiz_quiz_js__WEBPACK_IMPORTED_MODULE_2__);
/* harmony import */ var _src_common_quiz_quiz_css__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(10);
/* harmony import */ var _src_common_quiz_quiz_css__WEBPACK_IMPORTED_MODULE_3___default = /*#__PURE__*/__webpack_require__.n(_src_common_quiz_quiz_css__WEBPACK_IMPORTED_MODULE_3__);
/* harmony import */ var script_loader_sourceMap_true_src_common_tipkovnice_keyboard_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(11);
/* harmony import */ var script_loader_sourceMap_true_src_common_tipkovnice_keyboard_js__WEBPACK_IMPORTED_MODULE_4___default = /*#__PURE__*/__webpack_require__.n(script_loader_sourceMap_true_src_common_tipkovnice_keyboard_js__WEBPACK_IMPORTED_MODULE_4__);
/* harmony import */ var _src_common_tipkovnice_keyboard_css__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(13);
/* harmony import */ var _src_common_tipkovnice_keyboard_css__WEBPACK_IMPORTED_MODULE_5___default = /*#__PURE__*/__webpack_require__.n(_src_common_tipkovnice_keyboard_css__WEBPACK_IMPORTED_MODULE_5__);
/* harmony import */ var script_loader_sourceMap_true_src_common_memory_memory_js__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(14);
/* harmony import */ var script_loader_sourceMap_true_src_common_memory_memory_js__WEBPACK_IMPORTED_MODULE_6___default = /*#__PURE__*/__webpack_require__.n(script_loader_sourceMap_true_src_common_memory_memory_js__WEBPACK_IMPORTED_MODULE_6__);
/* harmony import */ var _src_common_memory_memory_css__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(16);
/* harmony import */ var _src_common_memory_memory_css__WEBPACK_IMPORTED_MODULE_7___default = /*#__PURE__*/__webpack_require__.n(_src_common_memory_memory_css__WEBPACK_IMPORTED_MODULE_7__);
/* harmony import */ var script_loader_sourceMap_true_src_common_main_comm_commClient_js__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(17);
/* harmony import */ var script_loader_sourceMap_true_src_common_main_comm_commClient_js__WEBPACK_IMPORTED_MODULE_8___default = /*#__PURE__*/__webpack_require__.n(script_loader_sourceMap_true_src_common_main_comm_commClient_js__WEBPACK_IMPORTED_MODULE_8__);
/* harmony import */ var script_loader_sourceMap_true_src_common_main_comm_ivrComm_js__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(19);
/* harmony import */ var script_loader_sourceMap_true_src_common_main_comm_ivrComm_js__WEBPACK_IMPORTED_MODULE_9___default = /*#__PURE__*/__webpack_require__.n(script_loader_sourceMap_true_src_common_main_comm_ivrComm_js__WEBPACK_IMPORTED_MODULE_9__);

/*
 *
 * Main files always (required) included in any DOS bundle
 *
 */


// -------------------------- //
// ---------- util ---------- //
// -------------------------- //





// TODO: manually import images used outside this project
//import '@src/common/main/img/1.jpg';


// -------------------------- //
// ---------- quiz ---------- //
// -------------------------- //





// -------------------------------- //
// ---------- tipkovnice ---------- //
// -------------------------------- //





// ---------------------------- //
// ---------- memory ---------- //
// ---------------------------- //




// --------------------------------------------------- //
// ---------- content object communication ----------- //
// --------------------------------------------------- //





// -------------------- examples

/* -- import everything in folder
function requireAll(r) { r.keys().forEach(r); }
requireAll(require.context('@src/main/img/', true, /\.jpg$/));
*/

/***/ }),
/* 5 */
/***/ (function(module, exports, __webpack_require__) {

__webpack_require__(0)(__webpack_require__(6))

/***/ }),
/* 6 */
/***/ (function(module, exports) {

module.exports = "$(document).ready(function () {\n\n    if (window.location.href.indexOf(\"https://dos-alat-test.sedamcloud.com/api/creator?derId=684&derName=obavijesti\") > -1) {\n        $(\".dos-header-title\").css(\"visibility\", \"hidden\");\n        $(\".dos-main-information__nav\").css(\"visibility\", \"hidden\");\n    }\n\n    /*$('.dos-btn-solution').on('click', function (event) {\n        $(this).closest('.dos-part-question').find('.question-help').slideToggle(400);\n    });*/\n\n\n    var focusedVid;\n    var allvids = $('video');\n\n    var focusedAudio;\n    var allAudio = $('audio');\n\n    pauseMultimedia = (multimediaList, currentPlayingIndex) => {\n        // pause multimedia, except current if exists\n        for (var i = 0; i < multimediaList.length; i++) {\n            if (currentPlayingIndex == null || i !== currentPlayingIndex) {\n                multimediaList[i].pause();\n            }\n        }\n    };\n\n    /** play only one video at a time **/\n    $(\"video\").on(\"play\", function (event) {\n        focusedVid = event.target;\n        var currentVideoIndex = allvids.index(this);\n\n        pauseMultimedia(allvids, currentVideoIndex);\n        pauseMultimedia(allAudio);\n    });\n\n    /** play only one audio at a time **/\n    $(\"audio\").on(\"play\", function (event) {\n        focusedAudio = event.target;\n        var currentAudioIndex = allAudio.index(this);\n\n        pauseMultimedia(allAudio, currentAudioIndex);\n        pauseMultimedia(allvids);\n    });\n\n    $(\"video\").on(\"click\", function (e) {\n        this.play();\n    });\n\n    $(\"audio\").on(\"click\", function (e) {\n        this.play();\n    });\n\n    //pause multimedia on slide change\n    $('.dos-collection-tasks-slider').on('beforeChange', function (slick, currentSlide, nextSlide) {\n        const multimediaElements = $(slick.currentTarget).find(\"audio, video\");\n        pauseMultimedia(multimediaElements);\n    });\n\n\n    $(document.body).bind(\"keydown\", function (e) {\n        if (e.keyCode === 27) {\n            /* close fancybox on esc */\n            var $target = $(\".iframe-btn.zoomed\");\n\n            if ($target) {\n                $target.next().toggleClass(\"iframe-zoom\");\n                $target.toggleClass(\"zoomed\");\n                $target.before('<div class=\"iframe-overlay\"></div>');\n                if ($target.hasClass(\"zoomed\")) {\n                    $target.before('<div class=\"iframe-overlay\"></div>');\n                } else {\n                    $(\".iframe-overlay\").remove();\n                }\n            }\n        }\n\n        if (e.keyCode === 32) {\n            if (navigator.userAgent.indexOf(\"Chrome\") !== -1) {\n                /**\n                  * console.error(\"we in chrome!\");\n                * e.preventDefault();\n                  */\n                if (focusedVid && focusedVid.paused === true) {\n                    focusedVid.pause();\n                    e.preventDefault();\n                } else {\n                    if (focusedVid) {\n                        focusedVid.play();\n                        e.preventDefault();\n                    }\n                }\n            }\n        }\n    });\n\n    $(\"input\").focus(function () {\n        focusedVid = \"\";\n        focusedAudio = \"\";\n    });\n\n\n    /* Quiz handlers start */\n    $(\".take-test .btn\").click(function () {\n\n        $(\"#knowledge-assessment\").toggle(\"fast\", function () {\n            /* console.log(\"completed toggle\"); */\n            $(\"#knowledge-assessment\").find('div[data-question-type=\"Povla??enje rije??i\"]').each(function () {\n                adjustDropzoneDimensions($(this).attr('id'));\n            });\n        });\n        $(\"section.take-test\").toggleClass(\"opened\");\n    });\n\n    $(\"button#finish-test\").click(function () {\n        $(\"#unit-test-finished\").show(\"fast\");\n    });\n\n    if (typeof WebVttHelper === \"function\") {\n        (new WebVttHelper).generateVTTCues();\n    }\n\n    $(\".pill\").watch({\n        /* specify CSS styles or attribute names to monitor */\n        properties: \"attr_data-dragged-group-value\",\n\n        /* callback function when a change is detected */\n        callback: function (data, i) {\n            // $(this).siblings('.pill[data-dragged-group-value=\"-1\"]').hide();\n            // $(this).siblings('.pill[data-dragged-group-value=\"-1\"]:first').css('display', 'inline-block');\n            $(this).siblings('.pill[data-dragged-group-value=\"-1\"]:first').css('position', 'absolute');\n        }\n    });\n\n    /* Quiz handlers stop */\n\n\n    /**\n     * Adds appropriate classes to text and numeric inputs, so that they can be sized appropriately\n     * for example, if the longest possible answer is \"red\", the input field is smaller if the longest possible is \"otorinolaringologija\"\n     */\n    function addClassesToTextInputs() {\n\n        var inputs = $(\"input[type='text'][data-correct-data]\");\n\n        function addClass(classname, element) {\n            element.className += classname;\n        }\n\n        /* console.log(inputs.length); */\n        for (var i = 0; i < inputs.length; i++) {\n\n\n            /**\n             * Data-correct-data can have multiple options, we need to parse them\n             * we assume that ; is never a correct answer\n             */\n\n            var correctanswers = inputs[i].getAttribute(\"data-correct-data\").split(\";\");\n            var longestCorrectAnswer = 0;\n            for (var j = 0; j < correctanswers.length; j++) {\n                /* console.log(j + \". correct answer is \" + correctanswers[j] + \"and its length is \" + correctanswers[j].length); */\n                if (correctanswers[j].length > longestCorrectAnswer) {\n                    longestCorrectAnswer = correctanswers[j].length;\n                }\n            }\n            /* console.log(\"longest correct is \" + longestCorrectAnswer); */\n            if (longestCorrectAnswer <= 3) {\n                addClass(\"length-tiny\", inputs[i]);\n            }\n            else if (longestCorrectAnswer <= 6) {\n                addClass(\"length-small\", inputs[i]);\n                /* console.log (\"you should be small\"); */\n            }\n            else if (longestCorrectAnswer <= 10) {\n                addClass(\"length-medium\", inputs[i]);\n                /* console.log(\"you should be medium\"); */\n            }\n            else if (longestCorrectAnswer <= 15) {\n                addClass(\"length-long\", inputs[i]);\n                /* console.log(\"you should be long\"); */\n            }\n            else {\n                addClass(\"length-verylong\", inputs[i]);\n                /* console.log (\"you are very long\"); */\n            }\n\n\n        }\n    }\n\n    function addClassesToNumberInputs() {\n\n        /* all have data-minvalue */\n        var inputs = $(\"input[type='number'][data-minvalue]\");\n\n        function addClass(classname, element) {\n            element.className += classname;\n        }\n\n        /* console.log(inputs.length); */\n        for (var i = 0; i < inputs.length; i++) {\n\n\n            /**\n             * Data-correct-data can have multiple options, we need to parse them\n             * we assume that ; is never a correct answer\n             */\n\n            var correctMinValue = inputs[i].getAttribute(\"data-minvalue\");\n            var correctMaxValue = inputs[i].getAttribute(\"data-maxvalue\");\n            var longestCorrectAnswer = 0;\n\n            correctMinValue = correctMinValue.toString();\n            correctMaxValue = correctMaxValue.toString();\n            if (correctMinValue.length > correctMaxValue.length) {\n                longestCorrectAnswer = correctMinValue.length;\n            }\n            else if (correctMaxValue.length > correctMinValue.length) {\n                longestCorrectAnswer = correctMaxValue.length;\n            }\n            else {\n                longestCorrectAnswer = correctMaxValue.length;\n            }\n\n            /* console.log(\"longest correct is \" + longestCorrectAnswer); */\n            if (longestCorrectAnswer <= 3) {\n                addClass(\"length-tiny\", inputs[i]);\n            }\n            else if (longestCorrectAnswer <= 6) {\n                addClass(\"length-small\", inputs[i]);\n                /* console.log (\"you should be small\"); */\n            }\n            else if (longestCorrectAnswer <= 10) {\n                addClass(\"length-medium\", inputs[i]);\n                /* console.log(\"you should be medium\"); */\n            }\n            else if (longestCorrectAnswer <= 15) {\n                addClass(\"length-long\", inputs[i]);\n                /* console.log(\"you should be long\"); */\n            }\n            else {\n                addClass(\"length-verylong\", inputs[i]);\n                /* console.log (\"you are very long\"); */\n            }\n\n\n        }\n    }\n    /**\n     * Numeric inputs are inputs of type text whose input is restricted to numbers and other math characters\n     * input type number returns empty string when '.' or ',' is used, depending on browser settings, so\n     * we a custom, 'numeric' input is used\n     */\n\n    function addClassesToNumericInputs() {\n\n        /* all have data-minvalue */\n        var inputs = $(\"input[type='text'][data-minvalue]\");\n\n        function addClass(classname, element) {\n            element.className += classname;\n        }\n\n        /* console.log(inputs.length); */\n        for (var i = 0; i < inputs.length; i++) {\n\n\n            /**\n             * Data-correct-data can have multiple options, we need to parse them\n             * we assume that ; is never a correct answer\n             */\n\n            var correctMinValue = inputs[i].getAttribute(\"data-minvalue\");\n            var correctMaxValue = inputs[i].getAttribute(\"data-maxvalue\");\n            var longestCorrectAnswer = 0;\n\n            correctMinValue = correctMinValue.toString();\n            correctMaxValue = correctMaxValue.toString();\n            if (correctMinValue.length > correctMaxValue.length) {\n                longestCorrectAnswer = correctMinValue.length;\n            }\n            else if (correctMaxValue.length > correctMinValue.length) {\n                longestCorrectAnswer = correctMaxValue.length;\n            }\n            else {\n                longestCorrectAnswer = correctMaxValue.length;\n            }\n\n            /* console.log(\"longest correct is \" + longestCorrectAnswer); */\n            if (longestCorrectAnswer <= 3) {\n                addClass(\"length-tiny\", inputs[i]);\n            }\n            else if (longestCorrectAnswer <= 6) {\n                addClass(\"length-small\", inputs[i]);\n                /* console.log (\"you should be small\"); */\n            }\n            else if (longestCorrectAnswer <= 10) {\n                addClass(\"length-medium\", inputs[i]);\n                /* console.log(\"you should be medium\"); */\n            }\n            else if (longestCorrectAnswer <= 15) {\n                addClass(\"length-long\", inputs[i]);\n                /* console.log(\"you should be long\"); */\n            }\n            else {\n                addClass(\"length-verylong\", inputs[i]);\n                /* console.log (\"you are very long\"); */\n            }\n\n\n        }\n    }\n\n    /*addClassesToTextInputs();\n    addClassesToNumberInputs();\n    addClassesToNumericInputs();\n    */\n\n    /* select the target node */\n    var target = document.getElementsByTagName(\"title\");\n    var originalTitle = document.title;\n\n    function changeTitle() {\n        document.title = originalTitle;\n    }\n\n    /* create an observer instance */\n    var observer = new MutationObserver(function (mutations) {\n        mutations.forEach(function (mutation) {\n            if (document.title !== originalTitle) {\n                changeTitle();\n            }\n            /* Treat the mutation here. Use mutation.type to see what happened. */\n        });\n    });\n\n    /* configuration of the observer: */\n    var config = { attributes: true, childList: true, characterData: true };\n\n    /* pass in the target node, as well as the observer options */\n    observer.observe(target[0], config);\n\n\n\n    var renderMath = function () {\n        MathJax.Hub.Queue([\"Typeset\", MathJax.Hub]);\n    };\n\n    var isMathRendered = false;\n\n    $('math').click(function () {\n        if (!isMathRendered) {\n            renderMath();\n            isMathRendered = true;\n        }\n    });\n\n    $('body .btn-audio-alternative').on('click', function () {\n        $(this).closest('.audio-alternative-container').find('.btn-audio-alternative-toggle').slideToggle();\n    });\n\n    setTimeout(function () { window.dispatchEvent(new Event('resize')); }, 3000);\n\n    // attach scroll client to each IVR interaction\n    $('.interaction-resize-container iframe').each((idx, interactionEl) => {\n        new ScrollVisibleIvrContentCommClient(interactionEl.id);\n    })\n})\n"

/***/ }),
/* 7 */
/***/ (function(module, exports, __webpack_require__) {

// extracted by mini-css-extract-plugin

/***/ }),
/* 8 */
/***/ (function(module, exports, __webpack_require__) {

__webpack_require__(0)(__webpack_require__(9))

/***/ }),
/* 9 */
/***/ (function(module, exports) {

module.exports = "/**\n *enableBloat is a variable that enables or disables unnecessary features.\n *If you wish to disable them, simply change enableBloat to false.\n *\n *The features as of now affected:\n *\n * - Forbidding drops outside dropzones in drag and drop quizzes\n */\nconst questionTypes = {\n\ttruefalse: \"Da/Ne\",\n\tpair: \"Jedan točan odgovor\",\n\tmulti: \"Višestruki odabir\",\n\tmatching: \"Uparivanje odgovora\",\n\twordInsert: \"Upisivanje riječi\",\n\tinsertWordToElement: \"Upisivanje u elemente\",\n\twordSelect: \"Odabiranje riječi\",\n\tdragElements: \"Povlačenje riječi\",\n\tdragPairs: \"Povlačenje parova\",\n\tdragSortElements: \"Razvrstavanje elemenata\",\n\tdragOrderElements: \"Uređivanje poretka elemenata\",\n\tnumericValue: \"Numerički\",\n\tdragOnPicture: \"Povlačenje na sliku\",\n\trepl: \"REPL zadatak\"\n};\n\nvar enableBloat = true;\n\nconst UPITNIKHINTPATH = \"../img/informatika/upitnik-hint.svg\";\n//for internet explorer\nif (!String.prototype.includes) {\n\tString.prototype.includes = function (search, start) {\n\t\tif (typeof start !== 'number') {\n\t\t\tstart = 0;\n\t\t}\n\n\t\tif (start + search.length > this.length) {\n\t\t\treturn false;\n\t\t} else {\n\t\t\treturn this.indexOf(search, start) !== -1;\n\t\t}\n\t};\n}\n\nvar winAudio; //= new Audio('../audio/Tocno.mp3');\nvar loseAudio; //= new Audio('../audio/Krivo.mp3');\n\n// ---------- initialize \"drag elements\" question elements\n\nfunction initDragElementsElements(questionId) {\n\tvar questionContextElement = questionId && document.getElementById(questionId) || document;\n\n\tvar taskId;\n\n\t$('.dropzone, .dropzone-holder', questionContextElement)\n\t\t.droppable({\n\n\t\t\taccept: '.draggable.dos-answer-draggable',\n\t\t\trevert: 'invalid',\n\t\t\t// TODO: custom overlapping\n\t\t\ttolerance: 'intersect',\n\n\t\t\t// listen for drop related events:\n\n\t\t\tactivate: function (event) {\n\t\t\t\t// add active dropzone feedback\n\t\t\t\tevent.target.classList.add('drop-active');\n\t\t\t},\n\t\t\tover: function (event, ui) {\n\t\t\t\tvar draggableElement = ui.draggable.get(0),\n\t\t\t\t\tdropzoneElement = event.target;\n\n\t\t\t\t// feedback the possibility of a drop\n\t\t\t\tdropzoneElement.classList.add('drop-target');\n\t\t\t\tdropzoneElement.classList.add('border-transparent');\n\n\t\t\t\tdraggableElement.classList.add('can-drop-style');\n\t\t\t\tdraggableElement.classList.add('can-drop');\n\t\t\t\tdropzoneElement.classList.add('hidetext');\n\t\t\t\tif (!(Number(dropzoneElement.getAttribute(\"visits\")) > 0)) {\n\t\t\t\t\t//if attribute visits is not set or 0, check in the element\n\t\t\t\t\tdropzoneElement.setAttribute(\"visits\", Number(1));\n\t\t\t\t\tdropzoneElement.setAttribute(\"visitedByDataGroup\" + draggableElement.getAttribute(\"data-group\"), \"visited\");\n\n\t\t\t\t} else {\n\t\t\t\t\t//element has already been visited, so check if the visit is new\n\t\t\t\t\tif (dropzoneElement.getAttribute(\"visitedByDataGroup\" + draggableElement.getAttribute(\"data-group\")) == \"visited\") {\n\t\t\t\t\t\t//The visit is not new\n\t\t\t\t\t} else {\n\t\t\t\t\t\t//The visit is new, check in and increment num of visits\n\t\t\t\t\t\tdropzoneElement.setAttribute(\"visitedByDataGroup\" + draggableElement.getAttribute(\"data-group\"), \"visited\");\n\t\t\t\t\t\tdropzoneElement.setAttribute(\"visits\", Number(Number(dropzoneElement.getAttribute(\"visits\")) + 1));\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tdropzoneElement.setAttribute(\"data-dragged-group-value\", event.target.getAttribute(\"id\").split('a')[1]);\n\t\t\t},\n\t\t\tout: function (event, ui) {\n\t\t\t\tvar draggableElement = ui.draggable.get(0),\n\t\t\t\t\tdropzoneElement = event.target;\n\n\t\t\t\t// remove the drop feedback style\n\t\t\t\tdropzoneElement.classList.remove('drop-target');\n\t\t\t\tdropzoneElement.classList.remove('border-transparent2');\n\n\t\t\t\tdraggableElement.classList.remove('can-drop-style');\n\t\t\t\tdraggableElement.classList.remove('draggable-active');\n\t\t\t\tdraggableElement.classList.remove('can-drop');\n\t\t\t\tdraggableElement.classList.remove('element-correct');\n\t\t\t\tdraggableElement.classList.remove('element-notcorrect');\n\t\t\t\tdropzoneElement.classList.remove('over');\n\n\t\t\t\tdropzoneElement = draggableElement;\n\t\t\t\tdraggableElement = dropzoneElement;\n\t\t\t\t//Check if the element was already checked in. If yes, decrement the visits and check out\n\n\t\t\t\tprevDropzone = event.target.getAttribute(\"id\");\n\n\t\t\t\tif (dropzoneElement.getAttribute(\"visitedByDataGroup\" + draggableElement.getAttribute(\"data-group\")) == \"visited\") {\n\t\t\t\t\t//The element is checked in, check it out\n\t\t\t\t\tdropzoneElement.setAttribute(\"visitedByDataGroup\" + draggableElement.getAttribute(\"data-group\"), \"checked-out\");\n\t\t\t\t\t//decrement number of visitors\n\t\t\t\t\tdropzoneElement.setAttribute(\"visits\", Number(Number(dropzoneElement.getAttribute(\"visits\")) - 1));\n\t\t\t\t}\n\n\t\t\t\t//If no elements are checked in, remove hidetext\n\t\t\t\t// if (Number(dropzoneElement.getAttribute(\"visits\")) < 1) {\n\t\t\t\t// \tdraggableElement.classList.remove(\"hidetext\");\n\t\t\t\t// }\n\n\t\t\t\t// dropzoneElement.setAttribute(\"data-dragged-group-value\", \"-1\");\n\t\t\t},\n\t\t\tdrop: (event, ui) => {\n\t\t\t\tvar draggableElement = ui.draggable.get(0);\n\t\t\t\tdragDropAction(event.target, taskId, draggableElement);\n\t\t\t},\n\t\t\tdeactivate: function (event, ui) {\n\t\t\t\tvar draggableElement = ui.draggable.get(0),\n\t\t\t\t\tdropzoneElement = event.target;\n\n\t\t\t\t// remove active dropzone feedback\n\t\t\t\tdropzoneElement.classList.remove('drop-active');\n\t\t\t\tdropzoneElement.classList.remove('drop-target');\n\t\t\t\tdropzoneElement.classList.remove('over');\n\t\t\t\tdraggableElement.classList.remove('can-drop');\n\t\t\t\tdropzoneElement.classList.add('border-none');\n\t\t\t}\n\t\t});\n\n\t// target elements with the \"draggable\" class\n\t$('.draggable.dos-answer-draggable', questionContextElement)\n\t\t.draggable({\n\t\t\trevert: 'invalid',\n\t\t\t// TODO: custom overlapping\n\t\t\ttolerance: 'intersect',\n\t\t\tdistance: 7,\n\n\t\t\t// call this function on every dragend event\n\t\t\tstart: function (event) {\n\t\t\t\tvar draggableElement = event.target;\n\n\t\t\t\tif (!$(draggableElement).parent().hasClass('dos-answer-wrapper')) {\n\t\t\t\t\t$(draggableElement).parent().addClass('dos-dropzone-while-element-dragging-style');\n\t\t\t\t}\n\n\t\t\t\t// $('.dos-answer-wrapper').css({ overflow: '' });\n\n\t\t\t\tdraggableElement.style.zIndex = '10';\n\n\t\t\t\ttaskId = `${$(draggableElement).closest('div[id*=\"_questionId_\"]').attr('id')}`;\n\n\t\t\t\tDragCounter.onDragStart(draggableElement);\n\n\t\t\t\tdraggableElement.classList.remove('success');\n\t\t\t\tdraggableElement.classList.remove('danger');\n\n\t\t\t\t// mark element as being active\n\t\t\t\tdraggableElement.classList.add('draggable-active');\n\n\t\t\t\t//to paint them orange!\n\t\t\t\tif (draggableElement.classList.contains('dd-solution')) {\n\t\t\t\t\tdraggableElement.classList.add('can-drop');\n\t\t\t\t}\n\t\t\t},\n\n\t\t\tstop: function (event) {\n\t\t\t\tvar draggableElement = event.target;\n\n\t\t\t\t$('.dos-dropzone-while-element-dragging-style').removeClass('dos-dropzone-while-element-dragging-style');\n\n\t\t\t\t$('.dos-answer-wrapper').css({ overflow: 'visible' });\n\n\t\t\t\t//to remove the orange paint\n\t\t\t\tif (draggableElement.classList.contains('can-drop')) {\n\t\t\t\t\tdraggableElement.classList.remove('can-drop');\n\t\t\t\t}\n\n\t\t\t\t// unmark active element\n\t\t\t\tdraggableElement.classList.remove('draggable-active');\n\t\t\t\tdraggableElement.classList.remove('can-drop-style');\n\n\t\t\t\tDragCounter.onDragEnd(draggableElement);\n\t\t\t}\n\t\t})\n\t\t// containment - we are targeting element's ancestor, not unique element\n\t\t.each(function () {\n\t\t\t$(this).draggable({\n\t\t\t\tcontainment: $(this).closest('.question')\n\t\t\t});\n\t\t});\n}\n\n// ---------- initialize \"drag on picture\" question elements\n\nfunction initDragOnPictureElements(questionId) {\n\tvar questionContextElement = questionId && document.getElementById(questionId) || document;\n\n\t$('.draggable-restricted', questionContextElement)\n\t\t.each(function () {\n\t\t\tinitDragOnPictureAnswerElement(this);\n\t\t\tinitDragOnPictureAnswerElementByClick(this);\n\t\t});\n\n\t$(\".picture-dropzone-creator\", questionContextElement)\n\t\t.droppable({\n\t\t\t// only accept elements matching this CSS selector\n\t\t\taccept: '.draggable-restricted',\n\t\t\t// TODO: custom overlapping\n\t\t\ttolerance: 'intersect',\n\n\t\t\tactivate: function (event) {\n\t\t\t\t// add active dropzone feedback\n\t\t\t\tevent.target.classList.add('drop-active');\n\t\t\t},\n\t\t\tover: function (event, ui) {\n\t\t\t\tvar draggableElement = ui.draggable.get(0),\n\t\t\t\t\tdropzoneElement = event.target;\n\n\t\t\t\t// feedback the possibility of a drop\n\t\t\t\tdropzoneElement.classList.add('drop-target');\n\t\t\t\tdraggableElement.classList.add('can-drop');\n\n\t\t\t},\n\t\t\tout: function (event, ui) {\n\t\t\t\tvar draggableElement = ui.draggable.get(0),\n\t\t\t\t\tdropzoneElement = event.target;\n\n\t\t\t\t// remove the drop feedback style\n\t\t\t\tdropzoneElement.classList.remove('drop-target');\n\t\t\t\tdraggableElement.classList.remove('can-drop');\n\t\t\t\tdraggableElement.classList.remove('element-correct');\n\t\t\t\tdraggableElement.classList.remove('element-notcorrect');\n\n\t\t\t\tdraggableElement.setAttribute('data-percentage-x', \"-1\");\n\t\t\t\tdraggableElement.setAttribute('data-percentage-y', \"-1\");\n\t\t\t},\n\t\t\tdrop: function (event, ui) {\n\t\t\t\tfunction findPositionPercentage(start, end, position) {\n\t\t\t\t\treturn (1. * position - start) / (end * 1. - start);\n\t\t\t\t}\n\n\t\t\t\tfunction checkPercentage(percentage) {\n\t\t\t\t\tif (percentage < 0) {\n\t\t\t\t\t\treturn 0;\n\t\t\t\t\t} else if (percentage > 1) {\n\t\t\t\t\t\treturn 1;\n\t\t\t\t\t}\n\t\t\t\t\treturn percentage;\n\t\t\t\t}\n\n\t\t\t\tvar draggableElement = ui.draggable.get(0);\n\t\t\t\tvar dropzoneElement = event.target;\n\t\t\t\t//with rect.top or rect.left you can get coordinates\n\t\t\t\tvar dragRect = draggableElement.getBoundingClientRect();\n\t\t\t\tvar dropRect = dropzoneElement.getBoundingClientRect();\n\t\t\t\tvar centerDragX = (dragRect.right + dragRect.left) / 2.0;\n\t\t\t\tvar centerDragY = (dragRect.top + dragRect.bottom) / 2.0;\n\t\t\t\tvar percentageX = checkPercentage(findPositionPercentage(dropRect.left, dropRect.right, centerDragX));\n\t\t\t\tvar percentageY = checkPercentage(findPositionPercentage(dropRect.top, dropRect.bottom, centerDragY));\n\n\t\t\t\tdraggableElement.setAttribute('data-percentage-x', percentageX);\n\t\t\t\tdraggableElement.setAttribute('data-percentage-y', percentageY);\n\t\t\t\tvar answerNum = draggableElement.getAttribute('data-answer-number');\n\t\t\t\tvar questionNum = draggableElement.id.split(\"q\")[1].split(\"a\")[0];\n\t\t\t\tif (!questionNum) {\n\t\t\t\t\tquestionNum = 0;\n\t\t\t\t}\n\t\t\t\tvar answerNum = draggableElement.id.split(\"a\")[1];\n\t\t\t\tangular.element(document.getElementById('QuizModal')).scope().setPercentages(percentageX, percentageY, questionNum, answerNum);\n\t\t\t},\n\t\t\tdeactivate: function (event, ui) {\n\t\t\t\tvar draggableElement = ui.draggable.get(0),\n\t\t\t\t\tdropzoneElement = event.target;\n\n\t\t\t\t// remove active dropzone feedback\n\t\t\t\tdropzoneElement.classList.remove('drop-active');\n\t\t\t\tdropzoneElement.classList.remove('drop-target');\n\t\t\t\tdraggableElement.classList.remove('can-drop');\n\t\t\t}\n\t\t});\n\n\n\t$('.picture-dropzone-quiz', questionContextElement)\n\t\t.droppable({\n\t\t\t// only accept elements matching this CSS selector\n\t\t\taccept: '.draggable-restricted',\n\t\t\t// TODO: custom overlapping\n\t\t\ttolerance: 'intersect',\n\n\t\t\t// listen for drop related events:\n\n\t\t\tondropactivate: function (event) {\n\t\t\t\tvar dropzoneElement = event.target;\n\t\t\t\tvar containerElement = $(dropzoneElement).parents(\".draggable-area\").get(0);\n\n\t\t\t\t// add active dropzone feedback\n\t\t\t\tdropzoneElement.classList.add('drop-active');\n\n\n\t\t\t\tif (!dropzoneElement.classList.contains(\"draggable-initialized\")) {\n\t\t\t\t\tdropzoneElement.classList.add(\"draggable-initialized\");\n\n\t\t\t\t\tfunction recalculatePositions() {\n\t\t\t\t\t\tvar dropRect = dropzoneElement.getBoundingClientRect();\n\n\t\t\t\t\t\t$(\".draggable-restricted\", containerElement)\n\t\t\t\t\t\t\t.each(function (idx, draggableElement) {\n\t\t\t\t\t\t\t\t// skip repositioning if element is currently active\n\t\t\t\t\t\t\t\tif (draggableElement.classList.contains(\"draggable-active\")) {\n\t\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t// get positioned draggables' positions\n\t\t\t\t\t\t\t\tvar quizPercentageXValue = parseFloat(draggableElement.getAttribute(\"data-quiz-percentage-x\") || -1);\n\t\t\t\t\t\t\t\tvar quizPercentageYValue = parseFloat(draggableElement.getAttribute(\"data-quiz-percentage-y\") || -1);\n\t\t\t\t\t\t\t\tvar quizWidth = parseFloat(draggableElement.getAttribute(\"data-quiz-width\") || -1);\n\t\t\t\t\t\t\t\tvar quizHeight = parseFloat(draggableElement.getAttribute(\"data-quiz-height\") || -1);\n\n\t\t\t\t\t\t\t\t// set position only if el has already been positioned\n\t\t\t\t\t\t\t\tif (quizPercentageXValue >= 0 && quizPercentageXValue >= 0) {\n\t\t\t\t\t\t\t\t\t/*\n\t\t\t\t\t\t\t\t\t * Draggables are positioned relatively to starting position. In order to reposition them properly after\n\t\t\t\t\t\t\t\t\t * resize, we have to reset their positioning to get new starting points and then calculate new postions\n\t\t\t\t\t\t\t\t\t * relatively to them.\n\t\t\t\t\t\t\t\t\t */\n\t\t\t\t\t\t\t\t\tdraggableElement.style.transform = \"\";\n\n\t\t\t\t\t\t\t\t\t// draggable rectangle\n\t\t\t\t\t\t\t\t\tvar dragRect = draggableElement.getBoundingClientRect();\n\n\n\t\t\t\t\t\t\t\t\t// ----- calculate X\n\t\t\t\t\t\t\t\t\tvar quizPercentageX = parseFloat(quizPercentageXValue);\n\t\t\t\t\t\t\t\t\t// percentages are calculated according to draggable's center point, so we have to reverse that calculation to get new absolute position\n\t\t\t\t\t\t\t\t\tvar newAbsoluteLeft = dropRect.left + dropRect.width * quizPercentageX - (quizWidth) / 2;\n\t\t\t\t\t\t\t\t\t// new relative position\n\t\t\t\t\t\t\t\t\tvar newLeft = newAbsoluteLeft - dragRect.left;\n\t\t\t\t\t\t\t\t\t// set new horizontal position\n\t\t\t\t\t\t\t\t\t//draggableElement.style.left = newLeft + \"px\";\n\n\n\t\t\t\t\t\t\t\t\t// ----- calculate Y\n\t\t\t\t\t\t\t\t\tvar quizPercentageY = parseFloat(quizPercentageYValue);\n\t\t\t\t\t\t\t\t\t// percentages are calculated according to draggable's center point, so we have to reverse that calculation to get new absolute position\n\t\t\t\t\t\t\t\t\tvar newAbsoluteTop = dropRect.top + dropRect.height * quizPercentageY - (quizHeight) / 2;\n\t\t\t\t\t\t\t\t\t// new relative position\n\t\t\t\t\t\t\t\t\tvar newTop = newAbsoluteTop - dragRect.top;\n\n\n\t\t\t\t\t\t\t\t\tdraggableElement.style.left = newLeft;\n\t\t\t\t\t\t\t\t\tdraggableElement.style.top = newTop;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\t// monitor draggable's container resize (use timeout to throtle events)\n\t\t\t\t\tvar RESIZE_EVENT_THROTLE_TIMEOUT = 100;\n\t\t\t\t\tvar timeoutHandle;\n\t\t\t\t\tnew ResizeSensor(containerElement, function () {\n\t\t\t\t\t\tif (timeoutHandle) clearTimeout(timeoutHandle);\n\t\t\t\t\t\ttimeoutHandle = setTimeout(function () {\n\t\t\t\t\t\t\ttimeoutHandle = null;\n\t\t\t\t\t\t\trecalculatePositions();\n\t\t\t\t\t\t}, RESIZE_EVENT_THROTLE_TIMEOUT);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t},\n\n\t\t\tactivate: function (event) {\n\t\t\t\t// add active dropzone feedback\n\t\t\t\tevent.target.classList.add('drop-active');\n\t\t\t},\n\t\t\tover: function (event, ui) {\n\t\t\t\tvar draggableElement = ui.draggable.get(0),\n\t\t\t\t\tdropzoneElement = event.target;\n\n\t\t\t\t// feedback the possibility of a drop\n\t\t\t\tdropzoneElement.classList.add('drop-target');\n\t\t\t\tdraggableElement.classList.add('can-drop');\n\t\t\t\tdraggableElement.classList.add('can-drop-style');\n\n\t\t\t},\n\t\t\tout: function (event, ui) {\n\t\t\t\tvar draggableElement = ui.draggable.get(0),\n\t\t\t\t\tdropzoneElement = event.target;\n\n\t\t\t\t// remove the drop feedback style\n\t\t\t\tdropzoneElement.classList.remove('drop-target');\n\t\t\t\tdraggableElement.classList.remove('can-drop');\n\t\t\t\tdraggableElement.classList.remove('element-correct');\n\t\t\t\tdraggableElement.classList.remove('element-notcorrect');\n\t\t\t\tdraggableElement.classList.remove('can-drop-style');\n\t\t\t\tdraggableElement.classList.remove('draggable-active');\n\n\t\t\t\tdraggableElement.setAttribute('data-quiz-width', \"-1\");\n\t\t\t\tdraggableElement.setAttribute('data-quiz-height', \"-1\");\n\n\t\t\t\tdraggableElement.setAttribute('data-quiz-percentage-x', \"-1\");\n\t\t\t\tdraggableElement.setAttribute('data-quiz-percentage-y', \"-1\");\n\t\t\t},\n\t\t\tdrop: function (event, ui) {\n\t\t\t\tfunction findPositionPercentage(start, end, position) {\n\t\t\t\t\treturn (position - start) / (end - start);\n\t\t\t\t}\n\n\t\t\t\tfunction checkPercentage(percentage) {\n\t\t\t\t\tif (percentage < 0) {\n\t\t\t\t\t\treturn 0;\n\t\t\t\t\t} else if (percentage > 1) {\n\t\t\t\t\t\treturn 1;\n\t\t\t\t\t}\n\t\t\t\t\treturn percentage;\n\t\t\t\t}\n\n\t\t\t\tvar draggableElement = ui.draggable.get(0),\n\t\t\t\t\tdropzoneElement = event.target;\n\n\t\t\t\t//with rect.top or rect.left you can get coordinates\n\t\t\t\tvar dragRect = draggableElement.getBoundingClientRect();\n\t\t\t\tvar dropRect = dropzoneElement.getBoundingClientRect();\n\n\t\t\t\tvar centerDragX = (dragRect.right + dragRect.left) / 2;\n\t\t\t\tvar centerDragY = (dragRect.top + dragRect.bottom) / 2;\n\n\t\t\t\tvar percentageX = checkPercentage(findPositionPercentage(dropRect.left, dropRect.right, centerDragX));\n\t\t\t\tvar percentageY = checkPercentage(findPositionPercentage(dropRect.top, dropRect.bottom, centerDragY));\n\n\t\t\t\tdraggableElement.setAttribute('data-quiz-width', dragRect.width);\n\t\t\t\tdraggableElement.setAttribute('data-quiz-height', dragRect.height);\n\n\t\t\t\tdraggableElement.setAttribute('data-quiz-percentage-x', percentageX);\n\t\t\t\tdraggableElement.setAttribute('data-quiz-percentage-y', percentageY);\n\n\t\t\t\tvar questionNum = draggableElement.id.split(\"q\")[1].split(\"a\")[0];\n\t\t\t\tvar answerNum = draggableElement.id.split(\"a\")[1];\n\n\t\t\t\t// snap draggable to dropzone\n\t\t\t\tif (draggableElement.classList.contains(\"dd-solution\") && !dropzoneElement.classList.contains(\"picture-dropzone-quiz\")) {\n\t\t\t\t\tui.draggable.position({\n\t\t\t\t\t\tof: $(this),\n\t\t\t\t\t\tmy: 'center',\n\t\t\t\t\t\tat: 'middle'\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t},\n\t\t\tdeactivate: function (event, ui) {\n\t\t\t\tvar draggableElement = ui.draggable.get(0),\n\t\t\t\t\tdropzoneElement = event.target;\n\n\t\t\t\t// remove active dropzone feedback\n\t\t\t\tdropzoneElement.classList.remove('drop-active');\n\t\t\t\tdropzoneElement.classList.remove('drop-target');\n\t\t\t\tdraggableElement.classList.remove('can-drop');\n\t\t\t}\n\t\t});\n}\n\n// Drag on picture elements can be added dynamically in quiz editor thus this has been extracted to a separate function\nfunction initDragOnPictureAnswerElement(element) {\n\t$(element)\n\t\t.draggable({\n\t\t\trevert: 'invalid',\n\t\t\tdistance: 7,\n\n\t\t\tstart: function (event) {\n\t\t\t\tvar draggableElement = event.target;\n\n\t\t\t\tdraggableElement.classList.remove('success');\n\t\t\t\tdraggableElement.classList.remove('danger');\n\t\t\t\tdraggableElement.classList.add('can-drop');\n\n\t\t\t\t// mark element as being active\n\t\t\t\tdraggableElement.classList.add('draggable-active');\n\n\t\t\t\tDragCounter.onDragStart(draggableElement);\n\t\t\t},\n\t\t\tstop: function (event) {\n\t\t\t\tvar draggableElement = event.target;\n\n\t\t\t\tdraggableElement.classList.remove('can-drop');\n\n\t\t\t\t// unmark active element\n\t\t\t\tdraggableElement.classList.remove('draggable-active');\n\n\t\t\t\tDragCounter.onDragEnd(draggableElement);\n\t\t\t}\n\t\t})\n\t\t// containment - we are targeting element's ancestor, not unique element\n\t\t.each(function () {\n\t\t\t$(this).draggable({\n\t\t\t\tcontainment: $(this).closest('.draggable-area')\n\t\t\t});\n\t\t});\n}\n\n// ---------- initialize \"click to grab, click to release\" for drag on picture elements\n\nfunction initDragOnPictureAnswerElementByClick(element) {\n\tlet draggableElement;\n\tlet taskId;\n\n\t$(element).off('draggable click').on('click', function (event) {\n\t\tif (event.which === 1) {\n\t\t\ttaskId = getParentQuestionTopElement(event.target).getAttribute('id');\n\n\t\t\tif ($('.draggable-restricted.can-drop').length) {\n\t\t\t\t$('.draggable-restricted.can-drop').removeClass('can-drop draggable-active over');\n\t\t\t}\n\n\t\t\tdraggableElement = element;\n\t\t\tdraggableElement.classList.add('can-drop');\n\n\t\t\tdropAnswerElementOnPicture(draggableElement, taskId);\n\t\t}\n\t});\n}\n\nfunction dropAnswerElementOnPicture(draggableElement, taskId) {\n\t$(`#${taskId} .picture-droparea`).off('click').on('click', function (event) {\n\t\tfunction findPositionPercentage(start, end, position) {\n\t\t\treturn (position - start) / (end - start);\n\t\t}\n\n\t\tfunction checkPercentage(percentage) {\n\t\t\tif (percentage < 0) {\n\t\t\t\treturn 0;\n\t\t\t} else if (percentage > 1) {\n\t\t\t\treturn 1;\n\t\t\t}\n\t\t\treturn percentage;\n\t\t}\n\n\t\tvar dropzoneElement = event.target;\n\n\t\t//with rect.top or rect.left you can get coordinates\n\t\tvar dragRect = draggableElement.getBoundingClientRect();\n\t\tvar dropRect = dropzoneElement.getBoundingClientRect();\n\n\t\tvar percentageX = checkPercentage(findPositionPercentage(dropRect.left, dropRect.right, event.clientX));\n\t\tvar percentageY = checkPercentage(findPositionPercentage(dropRect.top, dropRect.bottom, event.clientY));\n\n\t\tdraggableElement.setAttribute('data-quiz-width', dragRect.width);\n\t\tdraggableElement.setAttribute('data-quiz-height', dragRect.height);\n\n\t\tdraggableElement.setAttribute('data-quiz-percentage-x', percentageX);\n\t\tdraggableElement.setAttribute('data-quiz-percentage-y', percentageY);\n\n\t\t// get positioned draggables' positions\n\t\tvar quizPercentageXValue = parseFloat(draggableElement.getAttribute('data-quiz-percentage-x') || -1);\n\t\tvar quizPercentageYValue = parseFloat(draggableElement.getAttribute('data-quiz-percentage-y') || -1);\n\t\tvar quizWidth = parseFloat(draggableElement.getAttribute('data-quiz-width') || -1);\n\t\tvar quizHeight = parseFloat(draggableElement.getAttribute('data-quiz-height') || -1);\n\n\t\t// get positioned draggables' positions\n\t\tif (quizPercentageXValue >= 0 && quizPercentageXValue >= 0) {\n\t\t\t/*\n\t\t\t\t\t\t * Draggables are positioned relatively to starting position. In order to reposition them properly after\n\t\t\t\t\t\t * resize, we have to reset their positioning to get new starting points and then calculate new postions\n\t\t\t\t\t\t * relatively to them.\n\t\t\t\t\t\t */\n\t\t\tdraggableElement.style.transform = '';\n\t\t\t// ----- calculate X\n\t\t\tvar quizPercentageX = parseFloat(quizPercentageXValue);\n\t\t\t// percentages are calculated according to draggable's center point, so we have to reverse that calculation to get new absolute position\n\t\t\tvar newAbsoluteLeft = dropRect.left + dropRect.width * quizPercentageX - quizWidth / 2;\n\t\t\t// new relative position\n\t\t\tvar newLeft = newAbsoluteLeft - dragRect.left;\n\t\t\t// set new horizontal position\n\n\t\t\t// ----- calculate Y\n\t\t\tvar quizPercentageY = parseFloat(quizPercentageYValue);\n\t\t\t// percentages are calculated according to draggable's center point, so we have to reverse that calculation to get new absolute position\n\t\t\tvar newAbsoluteTop = dropRect.top + dropRect.height * quizPercentageY - quizHeight / 2;\n\t\t\t// new relative position\n\t\t\tvar newTop = newAbsoluteTop - dragRect.top;\n\n\t\t\tif (!draggableElement.style.left && !draggableElement.style.top) {\n\t\t\t\t$(draggableElement).css({\n\t\t\t\t\ttop: newTop,\n\t\t\t\t\tleft: newLeft,\n\t\t\t\t\tbackground: '#fff',\n\t\t\t\t\tcolor: '#000',\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tnewLeft = newLeft + parseFloat(draggableElement.style.left);\n\t\t\t\tnewTop = newTop + parseFloat(draggableElement.style.top);\n\t\t\t\t$(draggableElement).css({\n\t\t\t\t\ttop: newTop,\n\t\t\t\t\tleft: newLeft,\n\t\t\t\t\tbackground: '#fff',\n\t\t\t\t\tcolor: '#000',\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t});\n}\n\n// ---------- initialize \"click to grab, click to release\" for drag elements\n\nfunction initDragOnElementClick() {\n\tlet taskId;\n\tlet taskType;\n\tlet draggableElement;\n\tlet dropzoneElement;\n\n\t$('.draggable.dos-answer-draggable, .pair-draggable').off('draggable click').on('click', function (event) {\n\t\t// if left mouse click\n\t\tif (event.which === 1) {\n\t\t\tif ($('.draggable.dos-answer-draggable, .pair-draggable').draggable()) {\n\t\t\t\t$('.draggable.dos-answer-draggable, .pair-draggable').draggable('disable');\n\t\t\t}\n\n\t\t\ttaskId = `${$(event.target).closest('div[id*=\"_questionId_\"]').attr('id')}`;\n\n\t\t\t// find question type\n\t\t\tif (taskId) {\n\t\t\t\ttaskType = $($(`div[id*='${taskId}']`)[0]).attr('data-question-type');\n\t\t\t}\n\n\t\t\tif ($('.draggable.can-drop-style').length && taskType === questionTypes.dragElements) {\n\t\t\t\t$('.draggable.can-drop-style').removeClass('can-drop-style draggable-active over');\n\t\t\t}\n\n\t\t\tif (taskType === questionTypes.dragPairs || taskType === questionTypes.dragOrderElements) {\n\t\t\t\tif (!draggableElement) {\n\t\t\t\t\tif ($(event.target).parents('.draggable.dos-answer-draggable, .pair-draggable')[0]) {\n\t\t\t\t\t\tdraggableElement = $(event.target).parents('.draggable.dos-answer-draggable, .pair-draggable')[0];\n\t\t\t\t\t\tdraggableElement.focus();\n\t\t\t\t\t} else {\n\t\t\t\t\t\tdraggableElement = event.target;\n\t\t\t\t\t\tdraggableElement.focus();\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tif ($(draggableElement).closest('div[id*=\"_questionId_\"]').attr('id') === $(event.target).closest('div[id*=\"_questionId_\"]').attr('id')) {\n\t\t\t\t\t\tif ($(event.target).parents('.draggable.dos-answer-draggable, .pair-draggable')[0]) {\n\t\t\t\t\t\t\tdropzoneElement = $(event.target).parents('.draggable.dos-answer-draggable, .pair-draggable')[0];\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tdropzoneElement = event.target;\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tif ($(event.target).parents('.draggable.dos-answer-draggable, .pair-draggable')[0]) {\n\t\t\t\t\t\t\tdraggableElement = $(event.target).parents('.draggable.dos-answer-draggable, .pair-draggable')[0];\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tdraggableElement = event.target;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (draggableElement && dropzoneElement && taskId === $(draggableElement).closest('div[id*=\"_questionId_\"]').attr('id')) {\n\t\t\t\t\tdraggableElement.blur();\n\t\t\t\t\treplacePairs(dropzoneElement, draggableElement);\n\n\t\t\t\t\tdraggableElement = null;\n\t\t\t\t\tdropzoneElement = null;\n\t\t\t\t\ttaskType = null;\n\t\t\t\t\ttaskId = null;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif ($(event.target).parents('.draggable.dos-answer-draggable, .pair-draggable')[0]) {\n\t\t\t\t\tdraggableElement = $(event.target).parents('.draggable.dos-answer-draggable, .pair-draggable')[0];\n\t\t\t\t} else {\n\t\t\t\t\tdraggableElement = event.target;\n\t\t\t\t}\n\n\t\t\t\tif (taskType === questionTypes.dragElements) {\n\t\t\t\t\t$(draggableElement).addClass('can-drop-style');\n\t\t\t\t}\n\t\t\t}\n\t\t\t$('.draggable.dos-answer-draggable, .pair-draggable').draggable('enable');\n\t\t}\n\t});\n\n\t$('.dropzone, .dropzone-holder, .ui-droppable').on('click', function (event) {\n\t\tif (event.which === 1) {\n\t\t\ttaskId = `${$(event.target).closest('div[id*=\"_questionId_\"]').attr('id')}`;\n\n\t\t\tif (event.target.classList.contains('dropzone') && taskId === $(draggableElement).closest('div[id*=\"_questionId_\"]').attr('id')) {\n\t\t\t\tdragDropAction(event.target, taskId, draggableElement);\n\t\t\t\tdraggableElement = null;\n\t\t\t\tdropzoneElement = null;\n\t\t\t\ttaskType = null;\n\t\t\t\ttaskId = null;\n\t\t\t}\n\t\t}\n\t});\n}\n\n// ---------- initialize \"drag pairs\" question elements\n\nfunction initDragPairsElements(questionId) {\n\tresetQuizQuestion(questionId, true);\n\n\tvar questionContextElement = questionId && document.getElementById(questionId) || document;\n\n\tlet draggableElement;\n\tlet dropzoneElement;\n\n\t// ----- initialize switchable pairs\n\t$(\".pair-draggable\", questionContextElement)\n\t\t.draggable({\n\t\t\trevert: 'invalid',\n\t\t\t// TODO: custom overlapping\n\t\t\ttolerance: 'intersect',\n\t\t\tdistance: 7,\n\n\t\t\tstart: function (event) {\n\t\t\t\tdraggableElement = event.target;\n\t\t\t\t$(\".pair-draggable\").off('click');\n\n\t\t\t\t// mark element as being active\n\t\t\t\tdraggableElement.classList.add('draggable-active');\n\t\t\t},\n\n\t\t\t// call this function on every dragend event\n\t\t\tstop: function (event) {\n\t\t\t\tevent.target.style.left = \"\";\n\t\t\t\tevent.target.style.top = \"\";\n\n\t\t\t\t// unmark active element\n\t\t\t\tevent.target.classList.remove('draggable-active');\n\t\t\t\tevent.target.classList.remove('can-drop-style');\n\t\t\t\tif ($(event.target).closest(\"div[id*='uestionId']\").find('.over')[0]) {\n\t\t\t\t\t$(event.target).closest(\"div[id*='uestionId']\").find('.over')[0].classList.remove('over');\n\t\t\t\t}\n\t\t\t\tinitDragOnElementClick();\n\t\t\t}\n\t\t})\n\t\t// containment - we are targeting element's ancestor, not unique element\n\t\t.each(function () {\n\t\t\t$(this).draggable({\n\t\t\t\tcontainment: $(this).closest('.question')\n\t\t\t});\n\t\t});\n\n\n\t// enable draggables to be dropped into this\n\t$(\".pair-draggable\", questionContextElement)\n\t\t.droppable({\n\t\t\t// TODO: custom overlapping\n\t\t\ttolerance: 'intersect',\n\n\t\t\tover: function (event) {\n\t\t\t\tdropzoneElement = event.target;\n\t\t\t\tdropzoneElement.classList.add('over');\n\t\t\t},\n\t\t\tout: function (event) {\n\t\t\t\t// remove the drop feedback style\n\t\t\t\tevent.target.classList.remove('over');\n\t\t\t},\n\t\t\tdrop: function (event, ui) {\n\t\t\t\t// the same el can be draggable AND dropzone, we have to remove activity class to prevent it from being copied to dropzone el\n\t\t\t\tif (draggableElement) {\n\t\t\t\t\tdraggableElement.classList.remove('draggable-active');\n\t\t\t\t\tdraggableElement.classList.remove('can-drop-style');\n\t\t\t\t}\n\t\t\t\tevent.target.classList.remove('over');\n\n\t\t\t\tif (dropzoneElement && draggableElement) {\n\t\t\t\t\treplacePairs(dropzoneElement, draggableElement);\n\t\t\t\t\tdraggableElement = null;\n\t\t\t\t\tdropzoneElement = null;\n\t\t\t\t}\n\t\t\t}\n\t\t})\n\t\t// TODO: use CSS selection prevention\n\t\t.disableSelection();\n}\n\nfunction initKeyboardDragDrop() {\n\tlet draggableTaskIds = [];\n\n\t$('.draggable.dos-answer-draggable, .pair-draggable').each((index, el) => {\n\t\tif (draggableTaskIds.indexOf($(el).closest('div[id*=\"_questionId_\"]').attr('id')) < 0) {\n\t\t\tdraggableTaskIds.push($(el).closest('div[id*=\"_questionId_\"]').attr('id'));\n\t\t}\n\t});\n\n\tdraggableTaskIds.forEach((taskId, index) => {\n\t\tif ($(`#${taskId}`).attr('data-question-type') !== questionTypes.dragElements) {\n\t\t\t$(`#${taskId} .draggable, .pair-draggable`).each((index, el) => {\n\t\t\t\tel.setAttribute('tabindex', 0);\n\t\t\t\tel.setAttribute('aria-label', `${el.innerText} - draggable`);\n\t\t\t\tel.setAttribute('aria-grabbed', 'false');\n\t\t\t\tel.setAttribute('aria-haspopup', 'true');\n\t\t\t\tel.setAttribute('role', 'listitem');\n\n\t\t\t\tdrag.initialise(el);\n\t\t\t});\n\t\t\t$(`#${taskId} .dropzone`).each((index, el) => {\n\t\t\t\tel.setAttribute('tabindex', 0);\n\t\t\t\tel.setAttribute('aria-selected', 'true');\n\t\t\t\tel.setAttribute('role', 'button');\n\t\t\t});\n\t\t} else {\n\t\t\t$(`#${taskId} .dropzone`).each((index, el) => {\n\t\t\t\tel.setAttribute('tabindex', 0);\n\t\t\t\tel.setAttribute('aria-selected', 'true');\n\t\t\t\tel.setAttribute('aria-haspopup', 'true');\n\t\t\t\tel.setAttribute('role', 'listitem');\n\n\t\t\t\tdrag.initialise(el);\n\t\t\t});\n\t\t}\n\t});\n\n\tdraggableTaskIds.forEach(taskId => {\n\t\tlet assigmentControlElement = $($(`#${taskId}`)[0]).find('.dos-part-question__controls')[0];\n\t\t$(assigmentControlElement).children().each((index, childElement) => {\n\t\t\tchildElement.setAttribute('tabindex', 0);\n\t\t});\n\t\tassigmentControlsClickHandler($(assigmentControlElement).children()[1], taskId);\n\t});\n}\n\nfunction assigmentControlsClickHandler(focusedElement, taskId) {\n\tif (focusedElement) {\n\t\tfocusedElement.onkeydown = function (focusedElement) {\n\t\t\tif (focusedElement.keyCode === 13) {\n\t\t\t\tresetQuizQuestion(taskId);\n\t\t\t}\n\t\t};\n\t}\n}\n\nfunction replacePairs(dropzoneElement, draggableElement) {\n\tvar dropzoneElementContent;\n\tvar dropzoneElementCorrectPair;\n\tvar dropzoneElementClasslist;\n\tif (dropzoneElement && draggableElement) {\n\t\tdropzoneElementContent = dropzoneElement.innerHTML;\n\t\tdropzoneElementCorrectPair = dropzoneElement.dataset.correctPair;\n\t\tdropzoneElementClasslist = dropzoneElement.classList.value;\n\n\t\t// update dropzones content\n\t\tdropzoneElement.innerHTML = draggableElement.innerHTML;\n\t\tdropzoneElement.dataset.correctPair = draggableElement.dataset.correctPair;\n\t\tdropzoneElement.classList.value = draggableElement.classList.value;\n\n\t\t// update draggable's content\n\t\tdraggableElement.innerHTML = dropzoneElementContent;\n\t\tdraggableElement.dataset.correctPair = dropzoneElementCorrectPair;\n\t\tdraggableElement.classList.value = dropzoneElementClasslist;\n\t}\n\n\treturn;\n}\n\nfunction dragDropAction(event, taskId, draggableElement) {\n\tif (taskId) {\n\t\ttaskType = $($(`div[id*='${taskId}']`)[0]).attr('data-question-type');\n\t}\n\n\tif (taskType && taskType === 'Razvrstavanje elemenata') {\n\t\tevent.style.height = 'auto';\n\t\tevent.style.display = 'inline-block';\n\t}\n\n\tif (draggableElement !== event && taskId === $(event).closest('div[id*=\"_questionId_\"]').attr('id')) {\n\t\t$(draggableElement).detach().css({ top: 0, left: 0 }).appendTo(event);\n\t}\n\n\t$('.can-drop-style').removeClass('can-drop-style draggable-active over');\n\n\tif (taskType === 'Povlačenje parova') {\n\t\tif ($(event).attr(\"data-correct-pair\")) {\n\t\t\tevent.style.backgroundColor = '#FFFFFF';\n\t\t\tdraggableElement.style.backgroundColor = '#FFFFFF';\n\t\t}\n\t}\n\n\tif (taskType && taskId === $(event).closest('div[id*=\"_questionId_\"]').attr('id')) {\n\t\tif (!event.classList.contains(\"pill-container\")) {\n\t\t\tif (event.getAttribute(\"id\") && draggableElement) {\n\t\t\t\tdraggableElement.setAttribute('data-dragged-group-value', event.getAttribute(\"id\").split('a')[1]);\n\t\t\t} else {\n\t\t\t\tif (draggableElement) {\n\t\t\t\t\tdraggableElement.setAttribute('data-dragged-group-value', '-1');\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t$($(`#${taskId}`).find('.pill-container').children()[0]).css({ 'display': 'inline-block' });\n\t\t\t$($(draggableElement).closest('.hidetext')[0]).removeClass('hidetext');\n\t\t\t$($(draggableElement).closest('.sortgroup')[0]).css({ 'font-weight': '300', 'font-size': 18 });\n\t\t\t// snap draggable to dropzone\n\t\t\tif (taskType === 'Razvrstavanje elemenata') {\n\t\t\t\t$(draggableElement).position({\n\t\t\t\t\tof: $(event),\n\t\t\t\t\tmy: \"left top\",\n\t\t\t\t\tat: \"left top\",\n\t\t\t\t}).css({\n\t\t\t\t\t'position': 'relative',\n\t\t\t\t\t'left': '0px',\n\t\t\t\t\t'top': '0px',\n\t\t\t\t\t'float': 'left',\n\t\t\t\t\t'border-radius': '2px',\n\t\t\t\t\t'text-align': 'center',\n\t\t\t\t\t'cursor': 'pointer',\n\t\t\t\t\t'z-index': 1,\n\t\t\t\t\t'line-height': '130%',\n\t\t\t\t\t'margin': '5px',\n\t\t\t\t}).removeClass('can-drop-style draggable-active focus');\n\t\t\t} else if (taskType === 'Povlačenje riječi') {\n\t\t\t\tif ($(event).children().length > 1) {\n\t\t\t\t\t$($(event).children()[0]).detach().css({\n\t\t\t\t\t\ttop: 0,\n\t\t\t\t\t\tleft: 0,\n\t\t\t\t\t}).appendTo($(`#${taskId}`).find('.dos-answer-wrapper')[0]).attr('data-dragged-group-value', '-1');\n\t\t\t\t}\n\n\t\t\t\tif (event.classList.contains('dropzone-holder')) {\n\t\t\t\t\t$(draggableElement).detach().css({\n\t\t\t\t\t\ttop: 0,\n\t\t\t\t\t\tleft: 0,\n\t\t\t\t\t}).appendTo($(`#${taskId}`).find('.dos-answer-wrapper')[0]);\n\t\t\t\t} else {\n\t\t\t\t\t$(event).css({\n\t\t\t\t\t\t// 'z-index': 0,\n\t\t\t\t\t\t'transform': 'translateY(10px)',\n\t\t\t\t\t\t// 'height': '72px',\n\t\t\t\t\t\t'position': 'relative',\n\t\t\t\t\t\t//'width': $(draggableElement).width() + parseInt($(draggableElement).css('padding-left')) + parseInt($(draggableElement).css('padding-right')) + (parseInt($(draggableElement).css('border-width')) * 2) + 'px',\n\t\t\t\t\t});\n\n\t\t\t\t\t$(draggableElement).position({\n\t\t\t\t\t\tof: $(event),\n\t\t\t\t\t\tmy: \"left middle\",\n\t\t\t\t\t\tat: \"left middle\",\n\t\t\t\t\t}).css({\n\t\t\t\t\t\t'position': 'relative',\n\t\t\t\t\t\t'float': 'left',\n\t\t\t\t\t\t'text-align': 'center',\n\t\t\t\t\t\t'cursor': 'pointer',\n\t\t\t\t\t\t// 'word-wrap': 'break-word',\n\t\t\t\t\t}).removeClass('can-drop-style draggable-active focus');\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tevent.classList.remove('drop-polje-hover');\n\t\tevent.classList.remove('over');\n\t}\n}\n\nlet drag = {\n\tcurrentObject: null,\n\ttaskId: null,\n\ttaskType: null,\n\tinitialise: function (element) {\n\t\t// Add event handlers\n\t\telement.onclick = function () {\n\t\t\tthis.focus();\n\t\t};\n\t\telement.onkeydown = drag.keyboardDragDrop;\n\t\tdocument.body.onclick = drag.removePopup;\n\t},\n\n\tkeyboardDragDrop: function (event) {\n\t\tfocusedItem = event.target;\n\t\tevent.preventDefault();\n\t\tdrag.currentObject = this;\n\t\tdrag.taskId = `${$(focusedItem).closest('div[id*=\"_questionId_\"]').attr('id')}`;\n\t\tif (drag.taskId) {\n\t\t\tif ($(`div[id*='${drag.taskId}']`)[0]) {\n\t\t\t\tdrag.taskType = $(`div[id*='${drag.taskId}']`)[0].getAttribute('data-question-type');\n\t\t\t}\n\t\t}\n\t\tlet answerId = drag.taskId.split('uestionId_')[0] + drag.taskId.split('uestionId_')[1] + 'a';\n\t\tlet objMenu, objItem;\n\t\tlet objEvent = event || window.event;\n\n\t\tif (objEvent.keyCode === 32) {\n\t\t\tif (!$(focusedItem).children('#popup').length) {\n\t\t\t\tobjMenu = document.createElement('ul');\n\t\t\t\tobjMenu.setAttribute('id', 'popup');\n\t\t\t\tobjMenu.setAttribute('role', 'menu');\n\t\t\t\tobjMenu.setAttribute('style', 'margin: 25px 5px 20px;');\n\n\t\t\t\tif (drag.taskType === 'Razvrstavanje elemenata') {\n\t\t\t\t\tfor (i = 0; i < $(`[id*=\"${answerId}\"]`).length; i++) {\n\t\t\t\t\t\tif (!$(focusedItem).attr('keyboard-drag-menu')) {\n\t\t\t\t\t\t\tobjItem = document.createElement('li');\n\t\t\t\t\t\t\tobjItem.innerHTML = `${$($(`[id*=\"${answerId}\"]`)[i]).parent().find('.dos-drag-area__label').text()}`;\n\t\t\t\t\t\t\tobjItem.tabIndex = 0;\n\t\t\t\t\t\t\tobjItem.setAttribute('role', 'menuitem');\n\t\t\t\t\t\t\tobjItem.setAttribute('keyboard-drag-menu', true);\n\t\t\t\t\t\t\tif (!$(focusedItem).parent()[0].classList.contains('dropzone')) {\n\t\t\t\t\t\t\t\tfocusedItem.style.position = 'absolute';\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tobjItem.onkeydown = drag.handleItemChoice;\n\t\t\t\t\t\tobjMenu.appendChild(objItem);\n\t\t\t\t\t\tfocusedItem.appendChild(objMenu);\n\t\t\t\t\t\tfocusedItem.setAttribute('style', 'z-index: 2;');\n\t\t\t\t\t}\n\n\t\t\t\t\t$(objMenu).children().each((index, el) => {\n\t\t\t\t\t\tel.id = answerId + index;\n\t\t\t\t\t});\n\t\t\t\t} else if (drag.taskType === 'Povlačenje parova') {\n\t\t\t\t\tfor (i = 0; i < $(`#${drag.taskId}`).find('.pair-static').length; i++) {\n\t\t\t\t\t\tif (!$(focusedItem).attr('keyboard-drag-menu')) {\n\t\t\t\t\t\t\tobjItem = document.createElement('li');\n\t\t\t\t\t\t\tobjItem.innerHTML = `${$($(`#${drag.taskId}`).find('.pair-static')[i]).text()}`;\n\t\t\t\t\t\t\tobjItem.tabIndex = 0;\n\t\t\t\t\t\t\tobjItem.setAttribute('data-correct-pair', `${$($(`#${drag.taskId}`).find('.pair-static')[i]).attr('data-correct-pair')}`);\n\t\t\t\t\t\t\tobjItem.setAttribute('role', 'menuitem');\n\t\t\t\t\t\t\tobjItem.setAttribute('keyboard-drag-menu', true);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tobjItem.onkeydown = drag.handleItemChoice;\n\t\t\t\t\t\tobjMenu.appendChild(objItem);\n\t\t\t\t\t\tfocusedItem.appendChild(objMenu);\n\t\t\t\t\t\tfocusedItem.setAttribute('style', 'z-index: 2;');\n\t\t\t\t\t}\n\t\t\t\t} else if (drag.taskType === 'Povlačenje riječi') {\n\t\t\t\t\tfor (i = 0; i < $(`#${drag.taskId}`).find('.draggable.dos-answer-draggable').length; i++) {\n\t\t\t\t\t\tif (!$(focusedItem).attr('keyboard-drag-menu')) {\n\t\t\t\t\t\t\tobjItem = document.createElement('li');\n\t\t\t\t\t\t\tobjItem.innerHTML = `${$($(`#${drag.taskId}`).find('.draggable.dos-answer-draggable')[i]).text()}`;\n\t\t\t\t\t\t\tobjItem.tabIndex = 0;\n\t\t\t\t\t\t\tobjItem.setAttribute('data-correct-pair', `${$($(`#${drag.taskId}`).find('.draggable.dos-answer-draggable')[i]).attr('data-group')}`);\n\t\t\t\t\t\t\tobjItem.setAttribute('draggable-index', i);\n\t\t\t\t\t\t\tobjItem.setAttribute('role', 'menuitem');\n\t\t\t\t\t\t\tobjItem.setAttribute('keyboard-drag-menu', true);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (objItem) {\n\t\t\t\t\t\t\tobjItem.onkeydown = drag.handleItemChoice;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tobjMenu.appendChild(objItem);\n\t\t\t\t\t\tfocusedItem.appendChild(objMenu);\n\t\t\t\t\t\tfocusedItem.setAttribute('style', 'z-index: 2;');\n\t\t\t\t\t}\n\t\t\t\t} else if (drag.taskType === 'Uređivanje poretka elemenata') {\n\t\t\t\t\tfor (i = 0; i < $(`#${drag.taskId}`).find('.pair-static').length; i++) {\n\t\t\t\t\t\tif (!$(focusedItem).attr('keyboard-drag-menu')) {\n\t\t\t\t\t\t\tobjItem = document.createElement('li');\n\t\t\t\t\t\t\tobjItem.innerHTML = `${$($(`#${drag.taskId}`).find('.pair-static')[i]).text()}`;\n\t\t\t\t\t\t\tobjItem.tabIndex = 0;\n\t\t\t\t\t\t\tobjItem.setAttribute('data-correct-pair', `${$($(`#${drag.taskId}`).find('.pair-static')[i]).attr('data-correct-pair')}`);\n\t\t\t\t\t\t\tobjItem.setAttribute('role', 'menuitem');\n\t\t\t\t\t\t\tobjItem.setAttribute('keyboard-drag-menu', true);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tobjItem.onkeydown = drag.handleItemChoice;\n\t\t\t\t\t\tobjMenu.appendChild(objItem);\n\t\t\t\t\t\tfocusedItem.appendChild(objMenu);\n\t\t\t\t\t\tfocusedItem.setAttribute('style', 'z-index: 2;');\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tobjMenu.firstChild.focus();\n\t\t\t\tobjMenu.firstChild.className = 'focus';\n\t\t\t}\n\t\t}\n\n\t\tif (objEvent.keyCode === 9 && !objEvent.shiftKey) {\n\t\t\tif ((drag.taskType === 'Povlačenje parova' || drag.taskType === 'Uređivanje poretka elemenata') && objEvent.target.parentNode.nextElementSibling) {\n\t\t\t\t$(objEvent.target.parentNode.nextElementSibling).children('.pair-draggable')[0].focus();\n\t\t\t} else if (drag.taskType === 'Povlačenje riječi') {\n\t\t\t\tlet nextId = `${objEvent.target.getAttribute('id').substring(0, objEvent.target.getAttribute('id').length - 1)}${parseInt(objEvent.target.getAttribute('id')[objEvent.target.getAttribute('id').length - 1]) + 1}`;\n\t\t\t\tif (document.getElementById(nextId)) {\n\t\t\t\t\tdocument.getElementById(nextId).focus();\n\t\t\t\t} else {\n\t\t\t\t\tif ($(`#${drag.taskId}`).find('.dos-part-question__controls').children()[0]) {\n\t\t\t\t\t\t$(`#${drag.taskId}`).find('.dos-part-question__controls').children()[0].focus();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif ($(`#${drag.taskId}`).find('.dos-part-question__controls').children()[0]) {\n\t\t\t\t\t$(`#${drag.taskId}`).find('.dos-part-question__controls').children()[0].focus();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (objEvent.keyCode === 9 && objEvent.shiftKey) {\n\t\t\t$(\":tabbable\")[$(\":tabbable\").index($(this)[0]) - 1].focus();\n\t\t}\n\t},\n\n\thandleItemChoice: function (item) {\n\t\tif (item.keyCode === 38) { // Up arrow\n\t\t\titem.target.classList.remove('focus');\n\t\t\tif (!item.target.previousSibling) {\n\t\t\t\tfocusListItemWS(item.target.nextSibling);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tfocusListItemWS(item.target.previousSibling);\n\t\t} else if (item.keyCode === 40) { // Down arrow\n\t\t\titem.target.classList.remove('focus');\n\t\t\tif (!item.target.nextSibling) {\n\t\t\t\tfocusListItemWS(item.target.previousSibling);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tfocusListItemWS(item.target.nextSibling);\n\t\t} else if (item.keyCode === 39) { // Left arrow\n\t\t\titem.target.classList.remove('focus');\n\t\t\tif (!item.target.previousSibling) {\n\t\t\t\tfocusListItemWS(item.target.nextSibling);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tfocusListItemWS(item.target.previousSibling);\n\t\t} else if (item.keyCode === 37) { // Right arrow\n\t\t\titem.target.classList.remove('focus');\n\t\t\tif (!item.target.nextSibling) {\n\t\t\t\tfocusListItemWS(item.target.previousSibling);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tfocusListItemWS(item.target.nextSibling);\n\t\t} else if (item.keyCode === 13) { // Enter key\n\t\t\tdrag.moveFocusedItemToDropzone(item.target);\n\t\t\tfocusListItemWS($(`#${drag.taskId}`).find('.draggable.dos-answer-draggable, .pair-draggable')[0]);\n\t\t} else if (item.keyCode === 9 || item.keyCode === 27) { // 9 is Tab - 27 is Esc\n\t\t\tdrag.handleBlur(item);\n\t\t}\n\t},\n\n\thandleBlur: function (item) {\n\t\tif (drag.taskType === 'Povlačenje parova' || drag.taskType === 'Uređivanje poretka elemenata') {\n\t\t\tdrag.removePopup();\n\t\t\treturn;\n\t\t}\n\n\t\tdrag.currentObject.removeAttribute('aria-owns');\n\t\tif (item.target.parentNode) {\n\t\t\titem.target.parentNode.remove();\n\t\t}\n\t\tdrag.currentObject.focus();\n\t\tdrag.removePopup();\n\t},\n\n\tremovePopup: function () {\n\t\tdocument.onkeydown = null;\n\n\t\tlet objPopup = document.getElementById('popup');\n\t\tif (objPopup) {\n\t\t\tlet objPopupParent = objPopup.parentNode;\n\t\t\t$(objPopup).remove();\n\t\t\tobjPopupParent.blur();\n\t\t}\n\t},\n\n\tmoveFocusedItemToDropzone: function (item) {\n\t\tif (drag.taskType === 'Razvrstavanje elemenata') {\n\t\t\tlet dropzone = $(`#${$(item).attr('id')}.dropzone`)[0];\n\t\t\tlet draggable = $(item).parents('.draggable.dos-answer-draggable, .pair-draggable')[0];\n\t\t\tdrag.removePopup();\n\n\t\t\tdragDropAction(dropzone, drag.taskId, draggable);\n\t\t} else if (drag.taskType === 'Povlačenje parova') {\n\t\t\tlet dropzone = $(`[data-correct-pair*='${item.getAttribute('data-correct-pair')}'].pair-static`).parent().children()[0];\n\t\t\tlet draggable = $(item).parents('.draggable.dos-answer-draggable, .pair-draggable')[0];\n\t\t\tdrag.removePopup();\n\t\t\treplacePairs(dropzone, draggable);\n\t\t} else if (drag.taskType === 'Povlačenje riječi') {\n\t\t\tlet dropzone = $(item).parents('.dropzone')[0];\n\t\t\tlet draggable = $(`#${drag.taskId} .draggable`)[$(item).attr('draggable-index')];\n\t\t\tdrag.removePopup();\n\t\t\tdraggable.classList.add('can-drop-style');\n\n\t\t\tdragDropAction(dropzone, drag.taskId, draggable);\n\t\t} else if (drag.taskType === 'Uređivanje poretka elemenata') {\n\t\t\tlet dropzone = $(`[data-correct-pair*='${item.getAttribute('data-correct-pair')}'].pair-static`).parent().children('.pair-draggable')[0];\n\t\t\tlet draggable = $(item).parents('.draggable.dos-answer-draggable, .pair-draggable')[0];\n\t\t\tdrag.removePopup();\n\t\t\treplacePairs(dropzone, draggable);\n\t\t}\n\t}\n};\n\n// handles focusing list item that pops up when weak sighted/blind people use the app\nfunction focusListItemWS(listItem) {\n\tif (listItem) {\n\t\tlistItem.focus();\n\t\tlistItem.className += ' focus';\n\t}\n}\n\n\n\nfunction initAdditionalKeyboardNav() {\n\t$('input:text').focus(function (event) {\n\t\tvar taskId = '#' + $(event.target).closest(\"div[id*='uestionId'][data-question-type]\").attr('id');\n\t\tvar keyboardContainer = $(taskId).find('.keyboard_container.dos-part');\n\t\tvar keyboardExists = keyboardContainer.length > 0;\n\t\tvar isKeyboardShown = keyboardContainer.attr('display') !== 'none';\n\t\tvar buttons = $(keyboardContainer[0]).find('button');\n\n\t\tevent.target.onkeydown = function (evt) {\n\t\t\tif (keyboardExists && isKeyboardShown) {\n\t\t\t\tif (evt.keyCode === 37) {\n\t\t\t\t\tevt.preventDefault();\n\t\t\t\t\t$($(buttons)[0]).focus();\n\t\t\t\t}\n\t\t\t\tif (evt.keyCode === 38) {\n\t\t\t\t\tevt.preventDefault();\n\t\t\t\t\t$($(buttons)[0]).focus();\n\t\t\t\t}\n\t\t\t\tif (evt.keyCode === 39) {\n\t\t\t\t\tevt.preventDefault();\n\t\t\t\t\t$($(buttons)[0]).focus();\n\t\t\t\t}\n\t\t\t\tif (evt.keyCode === 40) {\n\t\t\t\t\tevt.preventDefault();\n\t\t\t\t\t$($(buttons)[0]).focus();\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\tbuttons.on('keydown', function (evt) {\n\t\t\tif (evt.keyCode === 27) { // esc\n\t\t\t\tevent.target.focus();\n\t\t\t}\n\n\t\t\tif (evt.keyCode === 9 && evt.shiftKey && evt.target === buttons[0]) {\n\t\t\t\tevt.preventDefault();\n\t\t\t\tevent.target.focus();\n\t\t\t}\n\t\t});\n\t});\n}\n\n\n\n// ---------- initialize static elements\ninitDragElementsElements();\ninitDragOnElementClick();\ninitDragOnPictureElements();\ninitKeyboardDragDrop();\n//initDragPairsElements(); // this init is called in \"setSortableElements()\" due to legacy reasons\n//initSortElements(); // this init is called in \"setSortableWitchConnection()\" due to legacy reasons\n\n\nfunction checkQuestionAnswer(questionId) {\n\tcheckQuizAnswers(questionId);\n}\n\nfunction toggleSolution(id) {\n\tvar solutionId = '#' + id;\n\t$(solutionId).toggleClass(\"question-element-hide\");\n}\n\nfunction isCloseEnough(realPosition, position, deviaton) {\n\treturn Math.abs(realPosition - position) <= deviaton;\n}\n\n/**\n * Calculates if the dropped element is closer than allowed deviation to the drop point in drag to image quizzes\n * The deviation is the same in X and Y because smaller dimension deviation is scaled. This avoids the situation\n * in which allowed deviation would be tiny in Y direction and normal in X direction in cases where for example the image\n * is short in height but long in width\n */\nfunction isGoodLocation(realPositionX, realPositionY, positionX, positionY, width, height) {\n\n\t//Set deviation to be equal for x and y\n\tvar deviation = 0.06;\n\tif (width >= height) {\n\t\tvar deviationX = deviation;\n\t\tvar deviationY = deviation * width / height;\n\t\tif (deviationY > 1) {\n\t\t\tdeviationY = 1;\n\t\t}\n\t} else {\n\t\tvar deviationY = deviation;\n\t\tvar deviationX = deviation * height / width;\n\t\tif (deviationX > 1) {\n\t\t\tdeviationX = 1;\n\t\t}\n\n\t}\n\n\tif (isCloseEnough(realPositionX, positionX, deviationX) && isCloseEnough(realPositionY, positionY, deviationY)) {\n\t\treturn true;\n\t}\n\treturn false;\n}\nvar outcomesInfo = {};\nvar questionData = {};\nvar outcomesEvaluationType = '';\nvar outcomesPercentageCutoff = 0;\n\nvar singleAnswerQuestionTypes = [questionTypes.truefalse, questionTypes.pair];\n\nfunction checkQuizAnswers(srcId) {\n\n\tif (srcId == undefined) {\n\t\tsrcId = \"quizSrc\";\n\t} else if (srcId.indexOf('quiz') !== -1) {\n\t\tvar quizElement = document.getElementById(srcId);\n\n\t\toutcomesEvaluationType = quizElement.getAttribute('data-outcome-evaluation-type');\n\t\toutcomesPercentageCutoff = Number(quizElement.getAttribute('data-outcome-percentage-cutoff')) / 100;\n\t\tclearOutcomeResults(srcId);\n\n\t\tvar questionDivs = $(quizElement).find('div[data-question-type]');\n\n\t\t//this is a check for whole page so iterate through each quiz individually\n\t\tfor (var n = 0; n < questionDivs.length; n++) {\n\t\t\tvar realSrcId = $(questionDivs[n]).attr('id');\n\t\t\tmodal2 = questionDivs[n];\n\n\t\t\tconst quizDerId = realSrcId.substring(0, realSrcId.indexOf('_'));\n\n\t\t\tvar inputs = $(questionDivs[n]).find(\"input[id*=\" + quizDerId + \"]\").toArray();\n\t\t\tvar questionElement = getParentQuestionTopElement(modal2);\n\t\t\tvar questionOutcomeId = fillOutcomeInfoData(modal2);\n\n\t\t\tvar questionType;\n\t\t\tvar isCompletelyCorrect = true;\n\n\t\t\twinAudio = null;\n\t\t\tloseAudio = null;\n\n\t\t\tresetQuizQuestionFeedback(realSrcId);\n\n\t\t\tanswerCheck(srcId, realSrcId, modal2, inputs, questionElement, questionOutcomeId, questionType, isCompletelyCorrect);\n\t\t}\n\n\t\tupdateOutcomeInfo(srcId);\n\t\tshowOutcomeResults(srcId);\n\n\t} else {\n\t\t//this is a check for one quiz so realsrcid is identical to srcid\n\t\trealSrcId = srcId;\n\t\tvar modal = document.getElementById(srcId);\n\t\tconst quizDerId = realSrcId.substring(0, realSrcId.indexOf('_'));\n\n\t\tvar inputs = $(modal).find(\"input[id*=\" + quizDerId + \"]\").toArray();\n\t\tvar questionElement = modal;\n\t\tvar questionOutcomeId = fillOutcomeInfoData(questionElement);\n\n\t\tvar questionType;\n\t\tvar isCompletelyCorrect = true;\n\n\t\tresetQuizQuestionFeedback(realSrcId);\n\n\t\tanswerCheck(srcId, realSrcId, modal, inputs, questionElement, questionOutcomeId, questionType, isCompletelyCorrect);\n\t}\n};\n\nconst getQuizSubelementById = (quizElement, id) => {\n\treturn $(quizElement).find('#' + id).get(0);\n};\n\nconst showHideQuizElement = (elementId, srcId) => {\n\tlet quizElement;\n\tif (srcId) {\n\t\tquizElement = document.getElementById(srcId);\n\t} else {\n\t\tquizElement = document.getElementById(\"quizSrc\");\n\t}\n\tif (getQuizSubelementById(quizElement, elementId).classList.contains('question-element-hide')) {\n\t\tgetQuizSubelementById(quizElement, elementId).classList.remove('question-element-hide');\n\t} else {\n\t\tgetQuizSubelementById(quizElement, elementId).classList.add('question-element-hide');\n\t}\n};\n\nconst getElementParentQuestionId = (element) => {\n\treturn $(element).closest('.question').get(0).getAttribute('id');\n};\n\nconst getParentQuestionTopElement = (element) => {\n\treturn $(element).closest(\"div[id*='uestionId'][data-question-type]\").get(0); // \"uestionId\" is not a typo, id is not consistently used in different environments\n};\nfunction fillOutcomeInfoData(question) {\n\n\tif (question.getAttribute('data-outcome-id') !== null) {\n\t\tvar outcomeId = question.getAttribute('data-outcome-id');\n\n\t\tif (outcomesInfo[outcomeId] === undefined) {\n\t\t\tvar outcomeName = question.getAttribute('data-outcome-name');\n\t\t\tvar outcomeDerInfo = [];\n\n\t\t\tif (question.getAttribute('data-outcome-der') !== null) {\n\t\t\t\toutcomeDerInfo = parseOutcomeDerData(question.getAttribute('data-outcome-der'));\n\t\t\t}\n\n\t\t\toutcomesInfo[outcomeId] = {\n\t\t\t\toutcomeName: outcomeName,\n\t\t\t\toutcomeDer: outcomeDerInfo,\n\t\t\t\tcorrectAnswered: 0,\n\t\t\t\ttotalCount: 0\n\t\t\t};\n\t\t}\n\n\t\treturn outcomeId;\n\t} else {\n\t\treturn null;\n\t}\n}\n\nfunction fillQuestionData(question, outcomeId) {\n\tconst id = question.getAttribute('id');\n\tif (!id) {\n\t\treturn;\n\t}\n\n\tif (!questionData[id]) {\n\t\tquestionData[id] = {\n\t\t\tid,\n\t\t\toutcomeId: outcomeId,\n\t\t\tanswerTotal: 1,\n\t\t\tcorrectCount: 0,\n\t\t\tquestionType: question.getAttribute('data-question-type'),\n\t\t\tpercentageShare: Number(question.getAttribute('data-outcome-percentage-share')),\n\t\t};\n\t} else {\n\t\tquestionData[id].answerTotal += 1;\n\t}\n}\n\nfunction addQuestionCorrectAnswerCount(question) {\n\tconst id = question.getAttribute('id');\n\tif (!id) {\n\t\treturn;\n\t}\n\n\tquestionData[id].correctCount += 1;\n}\n\nfunction updateOutcomeInfo() {\n\tfor (var key in questionData) {\n\t\tvar question = questionData[key];\n\t\tvar outcomeData = outcomesInfo[question.outcomeId];\n\n\t\tif (outcomeData !== undefined) {\n\t\t\taddOutcomeInfoTotal(question.outcomeId);\n\t\t\tif (question.correctCount === question.answerTotal) {\n\t\t\t\taddOutcomeInfoCorrect(question.outcomeId);\n\t\t\t}\n\t\t}\n\t}\n}\n\nfunction resetQuiz(quizId) {\n\tconst quizElement = $(`div[id='${quizId}']`);\n\n\tconst questions = quizElement.find('div[data-question-type]').toArray();\n\tquestions.forEach((question) => {\n\t\tresetQuizQuestion(question.id, true);\n\t});\n\n\thideOutcomeResults(quizId);\n\n\tquizElement.find('.dos-collection-tasks-slider').slick('slickGoTo', 0, true); //reset slide index\n\n\tscrollToElement(quizElement.offset().top);\n};\n\nfunction hideOutcomeResults(quizId) {\n\tconst quizFeedbackSectionElement = $(`section[id*='unit-test-finished'][data-quiz-id='${quizId}']`);\n\n\tquizFeedbackSectionElement.hide();\n};\n\nfunction scrollToElement(topOffset) {\n\tconst headerHeight = $('header.dos-header').height();\n\n\t$('html, body').stop().animate({\n\t\t'scrollTop': topOffset - headerHeight, //remove header hight\n\t}, 800, 'swing', function () { });\n};\n\nfunction showOutcomeResults(quizId) {\n\n\tconst quizEvaluationData = {\n\t\ttotalQuestionWeight: 0,\n\t\tquestions: [],\n\t};\n\tObject.values(questionData).forEach(question => {\n\t\tquizEvaluationData.totalQuestionWeight += question.percentageShare;\n\t\tquizEvaluationData.questions.push({\n\t\t\tcorrect: question.answerTotal === question.correctCount,\n\t\t\t...question,\n\t\t});\n\t});\n\n\tconst correctAnsweredQuestions = quizEvaluationData.questions.filter(question => question.correct === true);\n\n\tconst quizFeedbackSectionElement = $(`section[id*='unit-test-finished'][data-quiz-id='${quizId}']`);\n\n\tquizFeedbackSectionElement.show();\n\n\tscrollToElement(quizFeedbackSectionElement.offset().top);\n\n\tvar correctPercentageAnchor = quizFeedbackSectionElement.find('#correct-question-percentage');\n\tvar outcomelistAnchor = quizFeedbackSectionElement.find('#outcomes-list');\n\tvar learnedOutcomeAnchor = quizFeedbackSectionElement.find('#correct-outcomes');\n\tvar repeatOutcomeAnchor = quizFeedbackSectionElement.find('#incorrect-outcomes');\n\n\tvar correctQuestionCountAnchor = quizFeedbackSectionElement.find('#correct-question-count');\n\tcorrectQuestionCountAnchor.html(correctAnsweredQuestions.length + '/' + quizEvaluationData.questions.length);\n\n\tquizFeedbackSectionElement.find(\"#progressbar\").progressbar({\n\t\tvalue: (correctAnsweredQuestions.length / quizEvaluationData.questions.length) * 100\n\t});\n\n\n\tvar learnedOutcomes = [];\n\tvar repeatOutcomes = [];\n\tif (outcomesEvaluationType === 'percentage') {\n\t\tconst correctAnsweredPercentage = quizEvaluationData.questions.reduce((prevValue, question, index) => {\n\t\t\tconst newShare = question.correct ? question.percentageShare / quizEvaluationData.totalQuestionWeight : 0;\n\t\t\treturn prevValue + newShare;\n\t\t}, 0) * 100;\n\n\t\tquizFeedbackSectionElement.find(\"#correct-outcome-text\").hide();\n\t\tquizFeedbackSectionElement.find(\"#incorrect-outcome-text\").hide();\n\t\tlearnedOutcomeAnchor.hide();\n\t\trepeatOutcomeAnchor.hide();\n\n\t\tcorrectPercentageAnchor.html(Math.round(correctAnsweredPercentage));\n\n\t\tconst allOutcomes = [];\n\t\tObject.values(outcomesInfo).forEach(function (outcomeInfo) {\n\t\t\tallOutcomes.push('<li>' + outcomeInfo.outcomeName + '</li>');\n\t\t});\n\n\t\toutcomelistAnchor.html(allOutcomes);\n\t}\n\n\tif (outcomesEvaluationType === 'cutoff') {\n\t\tObject.values(outcomesInfo).forEach(function (outcomeInfo) {\n\t\t\tif (outcomeInfo.correctAnswered / outcomeInfo.totalCount >= outcomesPercentageCutoff) {\n\t\t\t\tlearnedOutcomes.push('<li>' + outcomeInfo.outcomeName + '</li>');\n\t\t\t} else {\n\t\t\t\trepeatOutcomes.push('<li>' + outcomeInfo.outcomeName + '</li>');\n\t\t\t}\n\t\t});\n\n\t\tquizFeedbackSectionElement.find(\"#percentage-outcome-text\").hide();\n\t\tquizFeedbackSectionElement.find(\"#correct-percentage-text\").hide();\n\t\toutcomelistAnchor.hide();\n\n\t\tconst learnedOutcomesHTML = learnedOutcomes.reduce((prevValue, learnedOutcome, index) => {\n\t\t\treturn prevValue + learnedOutcome;\n\t\t}, '');\n\n\t\tlearnedOutcomeAnchor.html(learnedOutcomesHTML);\n\n\t\tconst repeatOutcomesHTML = repeatOutcomes.reduce((prevValue, repeatOutcome, index) => {\n\t\t\treturn prevValue + repeatOutcome;\n\t\t}, '');\n\n\t\trepeatOutcomeAnchor.html(repeatOutcomesHTML);\n\t}\n\n\tif (learnedOutcomes.length === 0) {\n\t\tquizFeedbackSectionElement.find(\"#correct-outcome-text\").hide();\n\t\tquizFeedbackSectionElement.find(\"#incorrect-outcome-divider\").hide();\n\t} else if (repeatOutcomes.length === 0) {\n\t\tquizFeedbackSectionElement.find(\"#incorrect-outcome-divider\").hide();\n\t\tquizFeedbackSectionElement.find(\"#incorrect-outcome-text\").hide();\n\t\tquizFeedbackSectionElement.find(\"#incorrect-outcome-unit-text\").hide();\n\t}\n\n}\n\nfunction clearOutcomeResults(quizId) {\n\tconst quizFeedbackSectionElement = $(`section[id*='unit-test-finished'][data-quiz-id='${quizId}']`);\n\tvar learnedOutcomeAnchor = quizFeedbackSectionElement.find('#correct-outcomes');\n\tvar repeatOutcomeAnchor = quizFeedbackSectionElement.find('#incorrect-outcomes');\n\tvar correctPercentageAnchor = quizFeedbackSectionElement.find('#correct-question-percentage');\n\tvar outcomelistAnchor = quizFeedbackSectionElement.find('#outcomes-list');\n\tvar correctQuestionCountAnchor = quizFeedbackSectionElement.find('#correct-question-count');\n\n\toutcomesInfo = {};\n\tquestionData = {};\n\n\tquizFeedbackSectionElement.find(\"#correct-outcome-text\").show();\n\tquizFeedbackSectionElement.find(\"#incorrect-outcome-text\").show();\n\tquizFeedbackSectionElement.find(\"#correct-percentage-text\").show();\n\tquizFeedbackSectionElement.find(\"#incorrect-outcome-divider\").show();\n\tlearnedOutcomeAnchor.html('');\n\trepeatOutcomeAnchor.html('');\n\tcorrectPercentageAnchor.html('');\n\toutcomelistAnchor.html('');\n\tcorrectQuestionCountAnchor.html('');\n}\n\nfunction getHrefForDer(der) {\n\tvar derUrl = der.url;\n\tif (derUrl.length === 0) {\n\t\treturn '';\n\t} else {\n\t\treturn 'href=\"' + derUrl + '\"';\n\t}\n}\n\nfunction parseOutcomeDerData(outcomeDerData) {\n\tvar outcomeDersInfo = outcomeDerData.split('|');\n\tvar outcomeDers = [];\n\n\tfor (var i = 0; i < outcomeDersInfo.length; i++) {\n\t\tvar outcomeDerInfo = outcomeDersInfo[i].split(';');\n\t\tvar der = {};\n\t\tfor (j = 0; j < outcomeDerInfo.length; j++) {\n\t\t\tvar outcomeDerParams = outcomeDerInfo[j].split(':');\n\t\t\tder[outcomeDerParams[0]] = outcomeDerParams[1];\n\t\t}\n\n\t\toutcomeDers.push(der);\n\t}\n\n\treturn outcomeDers;\n}\n\nfunction addOutcomeInfoTotal(outcomeId) {\n\tif (outcomeId !== null) {\n\t\toutcomesInfo[outcomeId].totalCount += 1;\n\t}\n}\n\nfunction addOutcomeInfoCorrect(outcomeId) {\n\tif (outcomeId !== null) {\n\t\toutcomesInfo[outcomeId].correctAnswered += 1;\n\t}\n}\n/**\n *\n *  Resets quiz to initial state\n */\nfunction resetQuizQuestion(index, isOnInit = false) {\n\tvar id = '#' + index;\n\n\tresetQuizQuestionFeedback(index);\n\n\t$(id).find(\"input:radio\").prop('checked', false);\n\t$(id).find(\"input:checkbox\").prop('checked', false);\n\t$(id).find(\"input:text\").val(\"\");\n\t$(id).find(\"input[type='number']\").val(\"\");\n\t$(id).find(\"select option\").attr(\"selected\", false);\n\t$(id).find(\"select\").toArray().forEach((answer) => {\n\t\tanswer.value = undefined;\n\t});\n\t$(id).find(\".can-drop-style\").removeClass(\"can-drop-style draggable-active\");\n\n\tvar draggables = $(id).find(\".draggable.dos-answer-draggable\");\n\tif (draggables.length) {\n\t\tinitDragOnElementClick();\n\t}\n\n\tconst dragSortAnswerElements = [];\n\tfor (var i = 0; i < draggables.length; i++) {\n\t\tif (draggables[i].getAttribute('data-dragged-group-value') > -1 && $(id).attr('data-question-type') === questionTypes.dragSortElements) {\n\t\t\tif ($(draggables[i]).children('#popup').length) {\n\t\t\t\t$(draggables[i]).children('#popup')[0].remove();\n\t\t\t}\n\t\t}\n\n\t\tif ($(id).attr('data-question-type') === questionTypes.dragSortElements) {\n\t\t\tdragSortAnswerElements.push(draggables[i]);\n\t\t}\n\n\t\tif ($(id).attr('data-question-type') === questionTypes.dragElements) {\n\t\t\t$(draggables[i]).detach().css({ top: 0, left: 0 }).appendTo($(id).find('.dos-answer-wrapper')[0]);\n\t\t\t$($(`${id} .dropzone`)[i]).css({ transform: 'translateY(10px)' });//.append('&nbsp;');\n\n\t\t\t// isOnInit is here because on page load all questions are reset an that focuses elements in the middle of the page\n\t\t\tif (!isOnInit) {\n\t\t\t\tfocusListItemWS($(id).find('.dropzone')[0]);\n\t\t\t}\n\n\t\t}\n\n\t\tdraggables[i].setAttribute(\"data-dragged-group-value\", \"-1\");\n\t\tdraggables[i].style.left = \"\";\n\t\tdraggables[i].style.top = \"\";\n\t}\n\n\tif (dragSortAnswerElements.length) {\n\t\tconst shuffledDragSortAnswerElements = shuffleArray(dragSortAnswerElements);\n\n\t\tif (shuffledDragSortAnswerElements.length) {\n\t\t\tfor (let i = 0; i < shuffledDragSortAnswerElements.length; i++) {\n\t\t\t\tif (i >= 1) {\n\t\t\t\t\t$(shuffledDragSortAnswerElements[i]).css({ display: 'none', position: 'absolute' }).detach().appendTo($(id).find('.pill-container')[0]);\n\t\t\t\t} else {\n\t\t\t\t\t$(shuffledDragSortAnswerElements[i]).css({ display: 'inline-block', position: 'absolute' }).detach().appendTo($(id).find('.pill-container')[0]);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tif ($(id).attr('data-question-type') === questionTypes.dragOnPicture) {\n\t\tvar draggablesRestricted = $(id).find(\".draggable-restricted\");\n\t\tfor (var i = 0; i < draggablesRestricted.length; i++) {\n\t\t\t$(draggablesRestricted[i]).detach().css({ position: 'relative' }).appendTo($(id).find('.answers-holder')[0]);\n\t\t\tdraggablesRestricted[i].style.left = \"\";\n\t\t\tdraggablesRestricted[i].style.top = \"\";\n\t\t\tdraggablesRestricted[i].setAttribute('data-quiz-width', \"-1\");\n\t\t\tdraggablesRestricted[i].setAttribute('data-quiz-height', \"-1\");\n\t\t\tdraggablesRestricted[i].setAttribute(\"data-quiz-percentage-x\", \"-1\");\n\t\t\tdraggablesRestricted[i].setAttribute(\"data-quiz-percentage-y\", \"-1\");\n\n\t\t\tif (draggablesRestricted[i].classList.contains('can-drop')) {\n\t\t\t\tdraggablesRestricted[i].classList.remove('can-drop');\n\t\t\t}\n\t\t}\n\t}\n\n\tif ($(id).attr('data-question-type') !== questionTypes.dragElements) {\n\t\t// isOnInit is here because on page load all questions are reset an that focuses elements in the middle of the page\n\t\tif (!isOnInit) {\n\t\t\tfocusListItemWS($(id).find('.draggable.dos-answer-draggable, .pair-draggable, .quiz-input, .ui-sortable-handle')[0]);\n\t\t}\n\t}\n\n\tvar draggablesRestricted = $(id).find(\".draggable-restricted\");\n\tfor (var i = 0; i < draggablesRestricted.length; i++) {\n\t\t$(draggablesRestricted[i]).detach().css({ position: 'relative' }).appendTo($(id).find('.answers-holder')[0]);\n\t\tdraggablesRestricted[i].style.left = \"\";\n\t\tdraggablesRestricted[i].style.top = \"\";\n\t\tdraggablesRestricted[i].setAttribute('data-quiz-width', \"-1\");\n\t\tdraggablesRestricted[i].setAttribute('data-quiz-height', \"-1\");\n\t\tdraggablesRestricted[i].setAttribute(\"data-quiz-percentage-x\", \"-1\");\n\t\tdraggablesRestricted[i].setAttribute(\"data-quiz-percentage-y\", \"-1\");\n\t}\n\n\t// ----- reset pair draggables\n\t// shuffle the connect pairs quiz so each time reset is called the ordering is different\n\tvar draggableParents = $(id).find(\".pair-draggable\").parents();\n\t// shuffle draggables\n\tvar shuffledDraggables = shuffleArray($(id).find(\".pair-draggable\").toArray());\n\t// attach shuffled draggables to parents\n\tif ($(id).attr('data-question-type') !== questionTypes.dragOrderElements) {\n\t\tdraggableParents.each(function (idx) {\n\t\t\t// use \"prepend\" because draggables must be the first cell in the row\n\t\t\t$(shuffledDraggables[idx]).prependTo(this);\n\t\t});\n\t} else {\n\t\tdraggableParents.each(function (idx) {\n\t\t\t// use \"prepend\" because draggables must be the first cell in the row\n\t\t\t$(shuffledDraggables[idx]).appendTo(this);\n\t\t});\n\t}\n\n\tconst answerElements = $(id + ' .sortableOrder').find(\"li\").toArray();\n\tconst sortListElement = $(id + ' .sortableOrder');\n\tsortListElement.empty();\n\tif (answerElements.length) {\n\t\tconst shuffledSortList = shuffleArray(answerElements);\n\t\tshuffledSortList.forEach(answer => {\n\t\t\t$(answer).appendTo(sortListElement);\n\t\t});\n\n\t}\n\n\t// REPL start\n\tif ($(id).attr(\"data-question-type\") === \"REPL zadatak\") {\n\t\tCode.reset(index);\n\t}\n\t// REPL end\n};\n\nfunction resetQuizQuestionFeedback(questionId) {\n\tvar id = '#' + questionId;\n\n\t$(`${id} .answer-correct`).replaceWith('');\n\t$(`${id} .answer-incorrect`).replaceWith('');\n\t$(`${id} .correct`).removeClass('correct');\n\t$(`${id} .incorrect`).removeClass('incorrect');\n\t$(id).find(\".danger\").removeClass(\"danger\");\n\t$(id).find(\".success\").removeClass(\"success\");\n\n\tvar smallElements = $(id).find(\"small\");\n\tfor (var i = 0; i < smallElements.length; i++) {\n\t\tsmallElements[i].textContent = \"\";\n\t}\n\n\tvar feedbacks = $(id).find(\".feedback\");\n\tfor (var i = 0; i < feedbacks.length; i++) {\n\t\tfeedbacks[i].classList.add('question-element-hide');\n\t}\n\n\t//Now try to remove messages in grouping and checkbox, move it to a special function if more messages are inserted\n\ttry {\n\t\tdocument.getElementById(\"list-correct-incorrect-\" + questionId).innerHTML = \"\";\n\t} catch (err) {\n\t\t//console.log(\"not group!\");\n\t}\n\ttry {\n\t\tvar checkboxMessages = document.getElementById(\"notCompletelyCorrect\" + questionId);\n\t\t//this.parent.removethis, seems to be the only way to do it\n\t\tcheckboxMessages.parentElement.removeChild(checkboxMessages);\n\t} catch (err) {\n\n\t}\n\ttry {\n\t\tdocument.getElementById(\"checkbox-comment-\" + questionId).innerHTML = \"\";\n\t} catch (err) {\n\n\t}\n\t//remove question feedbacks\n\ttry {\n\t\tdivToClean = document.getElementById(questionId);\n\t\tdivToClean = $(divToClean).find(\"div.question-feedback\")[0];\n\t\tdivToClean.innerHTML = \"\";\n\t} catch (err) {\n\n\t}\n};\n\nconst shuffleArray = (array) => {\n\tconst newArray = [...array];\n\n\tfor (let i = array.length - 1; i > 0; i--) {\n\t\tlet j = Math.floor(Math.random() * (i + 1)); // random index from 0 to i\n\t\t// swap elements array[i] and array[j]\n\t\t[newArray[i], newArray[j]] = [newArray[j], newArray[i]];\n\t}\n\n\treturn newArray;\n};\n\nfunction collapseTags(text) {\n\tvar r = text.replace(/(<|&lt;)br\\s*\\/*(>|&gt;)/g, ' ').replace(/(<br>)/g, \" \").replace(/(&nbsp;)/g, \"\").replace(/(<p>)/, \"\").replace(/(<p>)/g, \"<br>\").replace(/(<\\/p>)/g, \" \").trim();\n\tconsole.log(r);\n\treturn r;\n};\n\n/**\n * Initialize dragable pairs question elements. This method is only a legacy stub because it is called from static JS.\n * // TOOD: change static JS to call \"init\" function directly\n */\nfunction setSortableElements(sortable_1, sortable_2) {\n\tvar combinedColumnSelector = \"#\" + sortable_1 + \",#\" + sortable_2;\n\n\t// find parent\n\tvar questionId = $(combinedColumnSelector).parents(\"[data-question-type]\").attr(\"id\");\n\n\tinitDragPairsElements(questionId);\n}\n\n/**\n * Initialize sort question elements. This method is only a legacy stub because it is called from static JS.\n * // TODO: this should be rewritten to have params like other \"init\" functions\n */\n// function setSortableWitchConnection(sortable_1, sortable_2, sortableGroup) {\n// \tinitSortElements(sortable_1, sortable_2, sortableGroup);\n// }\n\n/**\n * Connect selectable questions (radio, checkbox) with belonging label\n elements.\n * Usually, this is done using \"for\" attribut on LABEL but, for some\n reason,\n * clicking on for-connected label causes MS Edge to trigger stye\n recalculation\n * on entire document which results in super slow radio/checkbox buttons\n (~3s for single click).\n */\nfunction initSelectableAnswers(questionId) {\n\tvar $questionEl = $(\"#\" + questionId);\n\t// find questions input fields (radio, checkbox)\n\t// var $answers = $questionEl.find(\".dos-part-question__content\").find('input[id*=\"332_q\"]');\n\tvar $answers = $questionEl.find(\".question-body .quiz-input\");\n\t$answers.each(function () {\n\t\tvar $answ = $(this);\n\t\t// checkboxes are unselectable, unlike radio buttons\n\t\tvar isUnselectable = $answ.attr(\"type\") === \"checkbox\";\n\t\t// find belonging label and attach event listener which will un/check input field\n\t\t$answ.siblings(\"LABEL\").on(\"click\", function () {\n\t\t\t// unselectables ca n be toggled\n\t\t\tif (isUnselectable) {\n\t\t\t\t$answ.prop('checked', !$answ.prop('checked'));\n\t\t\t}\n\t\t\t// others are always checked\n\t\t\telse {\n\t\t\t\t$answ.prop('checked', true);\n\t\t\t}\n\t\t});\n\t});\n}\n\nfunction giveFeedback(objectid, feedbackText, thisid) {\n\t//add another if that checks if the id is the same so that if you click on two different icons it does not hide the previous ones hint\n\tobject = document.getElementById(thisid);\n\tfeedbackTextId = thisid.replace(\"fbb\", \"feedbackText\");\n\tfeedbackText = document.getElementById(feedbackTextId).textContent;\n\tfeedbackHTML = document.getElementById(feedbackTextId).innerHTML;\n\n\t//TODO find feedback by id\n\tquestionFeedbackDiv = $(object).closest('div.question').find('div.question-feedback')[0];\n\tquestionFeedbackDiv.innerHTML = \"<div class = question-feedback2>\" + feedbackHTML + \"</div>\";\n\tif ($(questionFeedbackDiv).hasClass('question-element-hide')) {\n\t\t//jquery does not have .remove so use a normal object not jquery one\n\t\tquestionFeedbackDiv.classList.remove('question-element-hide');\n\t}\n\t//if the helpdiv was last hidden by some other button, dont hide it, but do hide if it was last removed by the currently clicked button\n\telse if ($(questionFeedbackDiv).attr(\"last-modified-by\") == thisid) {\n\t\tquestionFeedbackDiv.classList.add('question-element-hide');\n\t}\n\t$(questionFeedbackDiv).attr(\"last-modified-by\", thisid);\n\t//console.log(object);\n}\n\nfunction answerCheck(srcId, realSrcId, modal, inputs, questionElement, questionOutcomeId, questionType, isCompletelyCorrect) {\n\n\tfor (var i = 0; i < inputs.length; i++) {\n\t\tfillQuestionData(questionElement, questionOutcomeId);\n\t\tif (inputs[i].type.toLowerCase() == \"checkbox\") {\n\t\t\t//Checkbox must notify if not all correct answers were selected, or if there is at least one incorrect\n\t\t\tquestionType = \"checkbox\";\n\n\t\t\tif (inputs[i].getAttribute(\"data-is-correct\") == \"true\" && inputs[i].checked) {\n\n\t\t\t\tgetQuizSubelementById(modal, inputs[i].id + \"f\").innerHTML = \"  \" + '<div class=\"answer-correct\"> </div>' + \"  \";\n\n\t\t\t\taddQuestionCorrectAnswerCount(questionElement);\n\n\t\t\t\ttry {\n\t\t\t\t\tfeedbackText = getQuizSubelementById(modal, inputs[i].id + \"feedbackText\").textContent;\n\t\t\t\t} catch (err) {\n\t\t\t\t\tfeedbackText = \"\";\n\t\t\t\t}\n\n\t\t\t\tinputId = inputs[i].id;\n\n\t\t\t\t//13 is minimmum with html comment it seems\n\t\t\t\tif (decideToShowFeedback(feedbackText)) {\n\t\t\t\t\tgetQuizSubelementById(modal, inputs[i].id + \"f\").innerHTML += \"<div class = 'feedback-image' feedbackid=\" + inputs[i].id + \"feedbackText\" + \" id = '\" + inputs[i].id + \"fbb' \" + \"></div>\";\n\t\t\t\t\t//if event listener directly calls function with arguments, it will execute on start, so it has to call an anonymous function that passes the args\n\t\t\t\t\tdocument.getElementById(inputs[i].id + \"fbb\").addEventListener(\"click\", function () {\n\t\t\t\t\t\tgiveFeedback(inputId, feedbackText, this.id);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t} else if (inputs[i].getAttribute(\"data-is-correct\") == \"false\" && inputs[i].checked) {\n\t\t\t\tisCompletelyCorrect = false;\n\n\t\t\t\tgetQuizSubelementById(modal, inputs[i].id + \"f\").innerHTML = \"  \" + '<div class=\"answer-incorrect\"> </div>' + \"  \";\n\t\t\t\ttry {\n\t\t\t\t\tfeedbackText = getQuizSubelementById(modal, inputs[i].id + \"feedbackText\").textContent;\n\t\t\t\t} catch (err) {\n\t\t\t\t\tfeedbackText = \"\";\n\t\t\t\t}\n\n\t\t\t\tinputId = inputs[i].id;\n\t\t\t\t//13 is minimmum with html comment it seems\n\t\t\t\tif (decideToShowFeedback(feedbackText)) {\n\t\t\t\t\tgetQuizSubelementById(modal, inputs[i].id + \"f\").innerHTML += \"<div class = 'feedback-image' feedbackid=\" + inputs[i].id + \"feedbackText\" + \" id = '\" + inputs[i].id + \"fbb' \" + \"></div>\";\n\t\t\t\t\t//if event listener directly calls function with arguments, it will execute on start, so it has to call an anonymous function that passes the args\n\t\t\t\t\tdocument.getElementById(inputs[i].id + \"fbb\").addEventListener(\"click\", function () {\n\t\t\t\t\t\tgiveFeedback(inputId, feedbackText, this.id);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t} else if (inputs[i].getAttribute(\"data-is-correct\") == \"false\" && !inputs[i].checked) {\n\t\t\t\taddQuestionCorrectAnswerCount(questionElement);\n\t\t\t} else {\n\t\t\t\t//If unselected was a correct answer, set iscompletelycorrect to 0\n\t\t\t\tif (inputs[i].getAttribute(\"data-is-correct\") == \"true\") {\n\t\t\t\t\tisCompletelyCorrect = false;\n\t\t\t\t}\n\n\t\t\t\tgetQuizSubelementById(modal, inputs[i].id + \"f\").textContent = \"\";\n\n\t\t\t}\n\n\t\t} else if (inputs[i].type.toLowerCase() == \"radio\") {\n\t\t\tquestionType = \"radio\";\n\t\t\tif (inputs[i].getAttribute(\"data-is-correct\") == \"true\" && inputs[i].checked) {\n\n\t\t\t\tif (winAudio) {\n\t\t\t\t\twinAudio.play();\n\t\t\t\t}\n\n\t\t\t\tgetQuizSubelementById(modal, inputs[i].id + \"f\").innerHTML = \"  \" + '<div class=\"answer-correct\"> </div>' + \"  \";\n\n\t\t\t\taddQuestionCorrectAnswerCount(questionElement);\n\t\t\t\ttry {\n\t\t\t\t\tfeedbackText = getQuizSubelementById(modal, inputs[i].id + \"feedbackText\").textContent;\n\t\t\t\t} catch (err) {\n\t\t\t\t\tfeedbackText = \"\";\n\t\t\t\t}\n\n\t\t\t\tinputId = inputs[i].id;\n\n\t\t\t\t//13 is minimmum with html comment it seems\n\t\t\t\tif (decideToShowFeedback(feedbackText)) {\n\t\t\t\t\tgetQuizSubelementById(modal, inputs[i].id + \"f\").innerHTML += \"<div class = 'feedback-image' feedbackid=\" + inputs[i].id + \"feedbackText\" + \" id = '\" + inputs[i].id + \"fbb' \" + \" ></div>\";\n\t\t\t\t\t//if event listener directly calls function with arguments, it will execute on start, so it has to call an anonymous function that passes the args\n\t\t\t\t\tdocument.getElementById(inputs[i].id + \"fbb\").addEventListener(\"click\", function () {\n\t\t\t\t\t\tgiveFeedback(inputId, feedbackText, this.id);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t} else if (inputs[i].getAttribute(\"data-is-correct\") == \"false\" && inputs[i].checked) {\n\n\t\t\t\tif (loseAudio) {\n\t\t\t\t\tloseAudio.play();\n\t\t\t\t}\n\n\t\t\t\tgetQuizSubelementById(modal, inputs[i].id + \"f\").innerHTML = \"  \" + '<div class=\"answer-incorrect\"> </div>' + \"  \";\n\t\t\t\ttry {\n\t\t\t\t\tfeedbackText = getQuizSubelementById(modal, inputs[i].id + \"feedbackText\").textContent;\n\t\t\t\t} catch (err) {\n\t\t\t\t\tfeedbackText = \"\";\n\t\t\t\t}\n\n\t\t\t\tinputId = inputs[i].id;\n\n\t\t\t\t//13 is minimmum with html comment it seems\n\t\t\t\tif (decideToShowFeedback(feedbackText)) {\n\t\t\t\t\tgetQuizSubelementById(modal, inputs[i].id + \"f\").innerHTML += \"<div class = 'feedback-image' feedbackid=\" + inputs[i].id + \"feedbackText\" + \" id = '\" + inputs[i].id + \"fbb' \" + \"></div>\";\n\t\t\t\t\t//if event listener directly calls function with arguments, it will execute on start, so it has to call an anonymous function that passes the args\n\t\t\t\t\tdocument.getElementById(inputs[i].id + \"fbb\").addEventListener(\"click\", function () {\n\t\t\t\t\t\tgiveFeedback(inputId, feedbackText, this.id);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t} else if (inputs[i].getAttribute(\"data-is-correct\") == \"false\" && !inputs[i].checked) {\n\t\t\t\taddQuestionCorrectAnswerCount(questionElement);\n\t\t\t\tgetQuizSubelementById(modal, inputs[i].id + \"f\").textContent = \"\";\n\t\t\t}\n\n\t\t}\n\n\t\t//inputs with data minvalue are actually numeric\n\t\telse if ((inputs[i].type.toLowerCase() == \"text\") && (!inputs[i].getAttribute(\"data-minvalue\"))) {\n\t\t\tquestionType = \"text\";\n\n\t\t\t// is answer case sensitive (boolean attribute, it's value is irrelevant, only attributes existence)\n\t\t\tvar isCaseSensitive = inputs[i].getAttribute(\"data-case-sensitive\") != null;\n\n\t\t\tif (inputs[i].getAttribute(\"data-correct-data\")) {\n\t\t\t\tvar userAnswer = inputs[i].value;\n\t\t\t\tvar rightAnswer = getQuizSubelementById(modal, inputs[i].id + \"f\");\n\t\t\t\tvar answerList = inputs[i].getAttribute(\"data-correct-data\").split(';');\n\t\t\t\tvar correctAnswer = false;\n\t\t\t\tfor (var k = 0; k < answerList.length; k++) {\n\t\t\t\t\t// case INsensitive anser\n\t\t\t\t\tif (!isCaseSensitive && userAnswer.trim().toLowerCase() === (answerList[k].trim().toLowerCase())) {\n\t\t\t\t\t\tcorrectAnswer = true;\n\t\t\t\t\t}\n\t\t\t\t\t// case sensitive answer\n\t\t\t\t\telse if (userAnswer.trim() === (answerList[k].trim())) {\n\t\t\t\t\t\tcorrectAnswer = true;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (correctAnswer) {\n\t\t\t\t\t// add correct class to .dos-eval class\n\t\t\t\t\t$(`#${inputs[i].id}`).closest('.dos-eval')[0].classList.add('correct');\n\n\t\t\t\t\tif (getQuizSubelementById(modal, inputs[i].id + \"feedbackText\")) {\n\t\t\t\t\t\tgetQuizSubelementById(modal, inputs[i].id + \"feedbackText\").classList.add('question-element-hide');\n\t\t\t\t\t}\n\t\t\t\t\taddQuestionCorrectAnswerCount(questionElement);\n\t\t\t\t} else {\n\t\t\t\t\t// add incorrect class to .dos-eval class\n\t\t\t\t\t$(`#${inputs[i].id}`).closest('.dos-eval')[0].classList.add('incorrect');\n\n\t\t\t\t\ttry {\n\t\t\t\t\t\tfeedbackText = getQuizSubelementById(modal, inputs[i].id + \"feedbackText\").textContent;\n\t\t\t\t\t} catch (err) {\n\t\t\t\t\t\tfeedbackText = \"\";\n\t\t\t\t\t}\n\t\t\t\t\tisCompletelyCorrect = false;\n\t\t\t\t\tinputId = inputs[i].id;\n\t\t\t\t\tif (decideToShowFeedback(feedbackText)) {\n\t\t\t\t\t\tgetQuizSubelementById(modal, inputs[i].id + \"f\").innerHTML += \"<div class = 'feedback-image' feedbackid=\" + inputs[i].id + \"feedbackText\" + \" id = '\" + inputs[i].id + \"fbb' \" + \"></div>\";\n\n\t\t\t\t\t\t//if event listener directly calls function with arguments, it will execute on start, so it has to call an anonymous function that passes the args\n\t\t\t\t\t\tdocument.getElementById(inputs[i].id + \"fbb\").addEventListener(\"click\", function () {\n\t\t\t\t\t\t\tgiveFeedback(inputId, feedbackText, this.id);\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t}\n\t\t} else if (inputs[i].type.toLowerCase() == \"number\") {\n\t\t\tquestionType = \"number\";\n\t\t\tvar userAnswer = inputs[i].value;\n\n\t\t\tvar minValue = inputs[i].getAttribute(\"data-minValue\");\n\t\t\tvar maxValue = inputs[i].getAttribute(\"data-maxValue\");\n\t\t\tvar correctAnswer = false;\n\t\t\tvar userNumber = userAnswer;\n\t\t\tif (!isNaN(userNumber)) {\n\t\t\t\tif (parseFloat(userNumber) >= parseFloat(minValue) && parseFloat(userNumber) <= parseFloat(maxValue)) {\n\t\t\t\t\tcorrectAnswer = true;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (correctAnswer) {\n\t\t\t\t// add correct class to .dos-eval class\n\t\t\t\t$(`#${inputs[i].id}`).closest('.dos-eval')[0].classList.add('correct');\n\n\t\t\t\tif (getQuizSubelementById(modal, inputs[i].id + \"feedbackText\")) {\n\t\t\t\t\tgetQuizSubelementById(modal, inputs[i].id + \"feedbackText\").classList.add('question-element-hide');\n\t\t\t\t}\n\t\t\t\taddQuestionCorrectAnswerCount(questionElement);\n\n\t\t\t} else {\n\t\t\t\t// add incorrect class to .dos-eval class\n\t\t\t\t$(`#${inputs[i].id}`).closest('.dos-eval')[0].classList.add('incorrect');\n\n\t\t\t\ttry {\n\t\t\t\t\tfeedbackText = getQuizSubelementById(modal, inputs[i].id + \"feedbackText\").textContent;\n\t\t\t\t} catch (err) {\n\t\t\t\t\tfeedbackText = \"\";\n\t\t\t\t}\n\n\t\t\t\tinputId = inputs[i].id;\n\n\t\t\t\t//13 is minimmum with html comment it seems\n\t\t\t\tif (decideToShowFeedback(feedbackText)) {\n\t\t\t\t\tgetQuizSubelementById(modal, inputs[i].id + \"f\").innerHTML += \"<div class = 'feedback-image' feedbackid=\" + inputs[i].id + \"feedbackText\" + \" id = '\" + inputs[i].id + \"fbb' \" + \"></div>\";\n\t\t\t\t\t//if event listener directly calls function with arguments, it will execute on start, so it has to call an anonymous function that passes the args\n\t\t\t\t\tdocument.getElementById(inputs[i].id + \"fbb\").addEventListener(\"click\", function () {\n\t\t\t\t\t\tgiveFeedback(inputId, feedbackText, this.id);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t} else if ((inputs[i].type.toLowerCase() == \"text\") && (inputs[i].getAttribute(\"data-minvalue\"))) {\n\t\t\t//this is a numeric input of type float, so we can use the library to restrict to num input and determine if , and . are valid decimal separators\n\t\t\tquestionType = \"numeric\";\n\t\t\tvar userAnswer = inputs[i].value;\n\t\t\tvar minValue = inputs[i].getAttribute(\"data-minValue\");\n\t\t\tvar maxValue = inputs[i].getAttribute(\"data-maxValue\");\n\t\t\tvar correctAnswer = false;\n\n\t\t\t//convert ',' to '.' so it can enter into parsefloat\n\t\t\tvar userNumber = userAnswer.replace(\",\", \".\");\n\t\t\tuserNumber = parseFloat(userNumber);\n\n\t\t\tif (!isNaN(userNumber)) {\n\t\t\t\tif (parseFloat(userNumber) >= parseFloat(minValue) && parseFloat(userNumber) <= parseFloat(maxValue)) {\n\t\t\t\t\tcorrectAnswer = true;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (correctAnswer) {\n\t\t\t\t// add correct class to .dos-eval class\n\t\t\t\t$(`#${inputs[i].id}`).closest('.dos-eval')[0].classList.add('correct');\n\n\t\t\t\tif (getQuizSubelementById(modal, inputs[i].id + \"feedbackText\")) {\n\t\t\t\t\tgetQuizSubelementById(modal, inputs[i].id + \"feedbackText\").classList.add('question-element-hide');\n\t\t\t\t}\n\t\t\t\taddQuestionCorrectAnswerCount(questionElement);\n\n\t\t\t\tif (isCompletelyCorrect) {\n\t\t\t\t\tif (winAudio) {\n\t\t\t\t\t\twinAudio.play();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t// add incorrect class to .dos-eval class\n\t\t\t\t$(`#${inputs[i].id}`).closest('.dos-eval')[0].classList.add('incorrect');\n\n\t\t\t\tif (loseAudio) {\n\t\t\t\t\tloseAudio.play();\n\t\t\t\t}\n\t\t\t\ttry {\n\t\t\t\t\tfeedbackText = getQuizSubelementById(modal, inputs[i].id + \"feedbackText\").textContent;\n\t\t\t\t} catch (err) {\n\t\t\t\t\tfeedbackText = \"\";\n\t\t\t\t}\n\n\t\t\t\tinputId = inputs[i].id;\n\n\t\t\t\t//13 is minimmum with html comment it seems\n\t\t\t\tif (decideToShowFeedback(feedbackText)) {\n\t\t\t\t\tgetQuizSubelementById(modal, inputs[i].id + \"f\").innerHTML += \"<div class = 'feedback-image' feedbackid=\" + inputs[i].id + \"feedbackText\" + \" id = '\" + inputs[i].id + \"fbb' \" + \"></div>\";\n\t\t\t\t\t//if event listener directly calls function with arguments, it will execute on start, so it has to call an anonymous function that passes the args\n\t\t\t\t\tdocument.getElementById(inputs[i].id + \"fbb\").addEventListener(\"click\", function () {\n\t\t\t\t\t\tgiveFeedback(inputId, feedbackText, this.id);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t}\n\n\tconst falseAnswers = Array.from(inputs).filter(function (el) {\n\t\tconst enteredValue = el.value;\n\t\tconst dataIsCorrect = el.getAttribute('data-is-correct');\n\t\tconst minValue = el.getAttribute('data-minValue');\n\t\tconst maxValue = el.getAttribute('data-maxValue');\n\t\tconst correctData = el.getAttribute('data-correct-data');\n\t\tlet correctDatas = [];\n\n\t\tif (correctData && correctData.includes(';')) {\n\t\t\tvar temp = correctData.split(';');\n\t\t\tfor (let i = 0; i < temp.length; i++) {\n\t\t\t\tcorrectDatas.push(temp[i].trim());\n\t\t\t}\n\t\t}\n\n\t\tvar isFalse = minValue && maxValue ? enteredValue < minValue || enteredValue > maxValue : correctData && correctData.includes(';') ? (!correctDatas.includes(enteredValue)) : (enteredValue != correctData || correctData === 'false');\n\n\t\treturn isFalse;\n\t});\n\n\tif (questionType == \"text\") {\n\t\tif (isCompletelyCorrect) {\n\t\t\tif (winAudio) {\n\t\t\t\twinAudio.play();\n\t\t\t}\n\t\t} else {\n\t\t\tif (loseAudio) {\n\t\t\t\tloseAudio.play();\n\t\t\t}\n\t\t}\n\t}\n\n\tif (questionType == \"checkbox\") {\n\t\tif (isCompletelyCorrect) {\n\t\t\tif (winAudio) {\n\t\t\t\twinAudio.play();\n\t\t\t}\n\n\t\t\t//Give score in future\n\t\t\ttry {\n\t\t\t\tdocument.getElementById(\"checkbox-comment-\" + realSrcId).innerHTML = \"\";\n\t\t\t} catch (err) {\n\t\t\t}\n\t\t} else {\n\t\t\tif (loseAudio) {\n\t\t\t\tloseAudio.play();\n\t\t\t}\n\n\t\t\ttry {\n\t\t\t\tdocument.getElementById(\"checkbox-comment-\" + realSrcId).innerHTML = \"Zadatak nije u potpunosti točno riješen. Pokušajte ponovo!\";\n\t\t\t} catch (err) {\n\t\t\t}\n\t\t}\n\t} else {\n\t\t//What happens when question type is not checkbox, currently nothing is needed\n\t}\n\n\tvar options = modal.getElementsByTagName(\"option\");\n\tvar processedOptionsForQuestion = [];\n\tvar correctSelections = [];\n\tvar unduplicatedOptions = [];\n\tfor (let i = 0; i < options.length; i++) {\n\t\tif (!unduplicatedOptions.includes(options[i].text)) {\n\t\t\tunduplicatedOptions.push(options[i].text);\n\t\t}\n\t}\n\tfor (var j = 0; j < options.length; j++) {\n\t\tquestionElement = getParentQuestionTopElement(options[j]);\n\t\tquestionOutcomeId = fillOutcomeInfoData(questionElement);\n\t\tif (!(processedOptionsForQuestion.indexOf(options[j].id.split(\"o\")[0]) > -1)) {\n\t\t\tprocessedOptionsForQuestion.push(options[j].id.split(\"o\")[0]);\n\t\t\tfillQuestionData(questionElement, questionOutcomeId);\n\t\t}\n\n\t\tif (options[j].selected == true) {\n\t\t\tif (options[j].value == options[j].id.split(\"a\")[1].split(\"o\")[0]) {\n\t\t\t\t// add correct class to .dos-eval class\n\t\t\t\t$(`#${options[j].id}`).closest('.dos-eval')[0].classList.add('correct');\n\n\t\t\t\taddQuestionCorrectAnswerCount(questionElement);\n\t\t\t\ttry {\n\t\t\t\t\tfeedbackText = getQuizSubelementById(modal, options[j].id + \"feedbackText\").textContent;\n\t\t\t\t} catch (err) {\n\t\t\t\t\tfeedbackText = \"\";\n\t\t\t\t}\n\t\t\t\tinputId = options[j].id;\n\n\t\t\t\tif (!correctSelections.includes(inputId)) {\n\t\t\t\t\tcorrectSelections.push(inputId);\n\t\t\t\t}\n\n\t\t\t\t//13 is minimmum with html comment it seems\n\t\t\t\tif (decideToShowFeedback(feedbackText)) {\n\t\t\t\t\tgetQuizSubelementById(modal, options[j].id + \"f\").innerHTML += \"<div class = 'feedback-image' feedbackid=\" + options[j].id + \"feedbackText\" + \" id = '\" + options[j].id + \"fbb' \" + \"></div>\";\n\n\t\t\t\t\t//if event listener directly calls function with arguments, it will execute on start, so it has to call an anonymous function that passes the args\n\t\t\t\t\tdocument.getElementById(options[j].id + \"fbb\").addEventListener(\"click\", function () {\n\t\t\t\t\t\tgiveFeedback(inputId, feedbackText, this.id);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t// add incorrect class to .dos-eval class\n\t\t\t\t$(`#${options[j].id}`).closest('.dos-eval')[0].classList.add('incorrect');\n\n\t\t\t\ttry {\n\t\t\t\t\tfeedbackText = getQuizSubelementById(modal, options[j].id + \"feedbackText\").textContent;\n\t\t\t\t} catch (err) {\n\t\t\t\t\tfeedbackText = \"\";\n\t\t\t\t}\n\t\t\t\tinputId = options[j].id;\n\n\t\t\t\t//13 is minimmum with html comment it seems\n\t\t\t\tif (decideToShowFeedback(feedbackText)) {\n\t\t\t\t\tgetQuizSubelementById(modal, options[j].id + \"f\").innerHTML += \"<div class = 'feedback-image' feedbackid=\" + options[j].id + \"feedbackText\" + \" id = '\" + options[j].id + \"fbb' \" + \"></div>\";\n\n\t\t\t\t\t//if event listener directly calls function with arguments, it will execute on start, so it has to call an anonymous function that passes the args\n\t\t\t\t\tdocument.getElementById(options[j].id + \"fbb\").addEventListener(\"click\", function () {\n\t\t\t\t\t\tgiveFeedback(inputId, feedbackText, this.id);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tif (unduplicatedOptions.length > 0) {\n\t\tif ((unduplicatedOptions.length === correctSelections.length) || (processedOptionsForQuestion.length == correctSelections.length)) {\n\t\t\tif (winAudio) {\n\t\t\t\twinAudio.play();\n\t\t\t}\n\t\t} else {\n\t\t\tif (loseAudio) {\n\t\t\t\tloseAudio.play();\n\t\t\t}\n\t\t}\n\t}\n\n\tcurrentQuiz = document.getElementById(realSrcId);\n\n\tif ($(currentQuiz).find(\".connect-pairs\").length || $(currentQuiz).attr('data-question-type') === questionTypes.dragOrderElements) {\n\n\t\tquestionOutcomeId = fillOutcomeInfoData(currentQuiz);\n\n\t\tvar groupTable = $(currentQuiz).find(\"table.dos-part-question__content\");\n\n\t\tgroupTable.find(\"tr\").each(function () {\n\t\t\tfillQuestionData(currentQuiz, questionOutcomeId);\n\t\t\t//table pairs must come in two\n\t\t\ttablePairs = $(this).find(\"td\");\n\t\t\tif ($(currentQuiz).attr('data-question-type') === questionTypes.dragOrderElements) { // task type is dragOrderElements\n\t\t\t\tif (tablePairs[0].getAttribute(\"data-correct-pair\") == tablePairs[1].getAttribute(\"data-correct-pair\")) {\n\t\t\t\t\t$($(tablePairs)[1]).addClass(\"success\");\n\t\t\t\t\taddQuestionCorrectAnswerCount(currentQuiz);\n\t\t\t\t} else {\n\t\t\t\t\t$($(tablePairs)[1]).addClass(\"danger\");\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif (tablePairs[0].getAttribute(\"data-correct-pair\") == tablePairs[1].getAttribute(\"data-correct-pair\")) {\n\t\t\t\t\t$(tablePairs).addClass(\"success\");\n\t\t\t\t\taddQuestionCorrectAnswerCount(currentQuiz);\n\t\t\t\t} else {\n\t\t\t\t\t$(tablePairs).addClass(\"danger\");\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tconst falseAnswers = groupTable.find('td').toArray().filter(function (el) {\n\t\t\treturn el.classList.contains('danger');\n\t\t});\n\n\t\tif (falseAnswers.length > 0) {\n\t\t\tif (loseAudio) {\n\t\t\t\tloseAudio.play();\n\t\t\t}\n\t\t} else {\n\t\t\tif (winAudio) {\n\t\t\t\twinAudio.play();\n\t\t\t}\n\t\t}\n\n\t}\n\n\tif (currentQuiz.getAttribute('data-question-type') === questionTypes.dragSortElements) {\n\t\tvar groupElements = modal.getElementsByClassName(\"draggable\");\n\t\tvar groupElementsSuccess = [];\n\t\tvar groupElementsDanger = [];\n\t\tfor (var j = 0; j < groupElements.length; j++) {\n\t\t\tquestionElement = getParentQuestionTopElement(groupElements[j]);\n\t\t\tquestionOutcomeId = fillOutcomeInfoData(questionElement);\n\t\t\tfillQuestionData(questionElement, questionOutcomeId);\n\t\t\tvar correctAnswerField = groupElements[j].getElementsByClassName(\"f\")[0];\n\t\t\tif (groupElements[j].getAttribute(\"data-dragged-group-value\") == groupElements[j].getAttribute(\"data-group\")) {\n\t\t\t\tgroupElementsSuccess.push(groupElements[j]);\n\t\t\t\tgroupElements[j].classList.add(\"success\");\n\t\t\t\taddQuestionCorrectAnswerCount(questionElement);\n\t\t\t} else {\n\t\t\t\tgroupElementsDanger.push(groupElements[j]);\n\t\t\t\tgroupElements[j].classList.add(\"danger\");\n\t\t\t}\n\t\t}\n\t}\n\n\tvar sortableOrderedElements = modal.getElementsByClassName(\"sortableOrderedElements\");\n\tvar incorrectSortables = [];\n\tfor (var j = 0; j < sortableOrderedElements.length; j++) {\n\n\t\tquestionElement = getParentQuestionTopElement(sortableOrderedElements[j]);\n\t\tquestionOutcomeId = fillOutcomeInfoData(questionElement);\n\n\t\tif ($('#' + sortableOrderedElements[j].id.replace('sortableOrder2', 'sortableOrder1')).children('li').length) {\n\t\t\tfor (var i = 0; i < $('#' + sortableOrderedElements[j].id.replace('sortableOrder2', 'sortableOrder1')).children('li').length; i++) {\n\t\t\t\tfillQuestionData(questionElement, questionOutcomeId);\n\t\t\t}\n\t\t} else {\n\t\t\tfor (var i = 0; i < $('#' + sortableOrderedElements[j].id).children('li').length; i++) {\n\t\t\t\tfillQuestionData(questionElement, questionOutcomeId);\n\t\t\t}\n\t\t}\n\n\t\tvar orderedElements = sortableOrderedElements[j].getElementsByTagName(\"li\");\n\t\tfor (var k = 0; k < orderedElements.length; k++) {\n\t\t\tif (k == orderedElements[k].getAttribute(\"id\").split('a')[1]) {\n\t\t\t\torderedElements[k].classList.add('success');\n\t\t\t\taddQuestionCorrectAnswerCount(questionElement);\n\t\t\t} else {\n\t\t\t\torderedElements[k].classList.add('danger');\n\t\t\t\tincorrectSortables.push(orderedElements[k]);\n\t\t\t}\n\t\t}\n\t}\n\n\tif (incorrectSortables.length > 0 && sortableOrderedElements.length > 0 && loseAudio && winAudio) {\n\t\tif (loseAudio) {\n\t\t\tloseAudio.play();\n\t\t}\n\t} else {\n\t\tif (sortableOrderedElements.length > 0) {\n\t\t\tif (winAudio) {\n\t\t\t\twinAudio.play();\n\t\t\t}\n\t\t}\n\t}\n\n\tif (currentQuiz.getAttribute('data-question-type') === questionTypes.dragOnPicture) {\n\t\tvar draggableElementsSuccess = [];\n\t\tvar draggableElementsDanger = [];\n\t\tvar draggableElements = modal.getElementsByClassName(\"draggable-restricted\");\n\t\tisCompletelyCorrect = true;\n\n\t\tfor (var j = 0; j < draggableElements.length; j++) {\n\t\t\tquestionElement = getParentQuestionTopElement(draggableElements[j]);\n\t\t\tquestionOutcomeId = fillOutcomeInfoData(questionElement);\n\t\t\tfillQuestionData(questionElement, questionOutcomeId);\n\n\t\t\tvar pictureDropzone = $(draggableElements[j]).closest(\".question-body\").find(\".picture-dropzone-quiz\");\n\t\t\t//check that draggable element is on right location\n\t\t\tif (isGoodLocation(draggableElements[j].getAttribute(\"data-percentage-x\"), draggableElements[j].getAttribute(\"data-percentage-y\"),\n\t\t\t\tdraggableElements[j].getAttribute(\"data-quiz-percentage-x\"), draggableElements[j].getAttribute(\"data-quiz-percentage-y\"), pictureDropzone.width(), pictureDropzone.height())) {\n\t\t\t\tdraggableElements[j].classList.add('success');\n\n\t\t\t\taddQuestionCorrectAnswerCount(questionElement);\n\t\t\t\tdraggableElementsSuccess.push(draggableElements[j]);\n\t\t\t} else {\n\t\t\t\tdraggableElements[j].classList.add('danger');\n\t\t\t\tisCompletelyCorrect = false;\n\t\t\t\tdraggableElementsDanger.push(draggableElements[j]);\n\t\t\t}\n\n\t\t}\n\n\t\tif (isCompletelyCorrect) {\n\t\t\tif (winAudio) {\n\t\t\t\twinAudio.play();\n\t\t\t}\n\t\t} else if (!isCompletelyCorrect) {\n\t\t\tif (loseAudio) {\n\t\t\t\tloseAudio.play();\n\t\t\t}\n\t\t}\n\t}\n\n\n\tif (currentQuiz.getAttribute('data-question-type') === questionTypes.dragElements) {\n\t\tvar draggableElementsSuccess = [];\n\t\tvar draggableElementsDanger = [];\n\t\tvar draggableElements = modal.getElementsByClassName(\"draggable\");\n\t\tisCompletelyCorrect = true;\n\n\t\tfor (var j = 0; j < draggableElements.length; j++) {\n\t\t\tquestionElement = getParentQuestionTopElement(draggableElements[j]);\n\t\t\tquestionOutcomeId = fillOutcomeInfoData(questionElement);\n\t\t\tfillQuestionData(questionElement, questionOutcomeId);\n\n\t\t\tif (draggableElements[j].getAttribute(\"data-dragged-group-value\") === draggableElements[j].getAttribute(\"data-group\")) {\n\t\t\t\tdraggableElementsSuccess.push(draggableElements[j]);\n\t\t\t\tdraggableElements[j].classList.add(\"success\");\n\t\t\t\taddQuestionCorrectAnswerCount(questionElement);\n\t\t\t} else {\n\t\t\t\tisCompletelyCorrect = false;\n\t\t\t\tdraggableElementsDanger.push(draggableElements[j]);\n\t\t\t\tdraggableElements[j].classList.add(\"danger\");\n\t\t\t}\n\n\t\t}\n\n\t\tif (isCompletelyCorrect) {\n\t\t\tif (winAudio) {\n\t\t\t\twinAudio.play();\n\t\t\t}\n\t\t} else if (!isCompletelyCorrect) {\n\t\t\tif (loseAudio) {\n\t\t\t\tloseAudio.play();\n\t\t\t}\n\t\t}\n\t}\n\n\t// REPL start\n\t//if (!inputs.length) { // there are no inputs in REPL\n\tif ($(\"#\" + realSrcId).attr(\"data-question-type\") === \"REPL zadatak\") {\n\t\tCode.check(realSrcId);\n\t}\n\t// REPL end\n}\n\nfunction decideToShowFeedback(feedbackText) {\n\tfeedbackTextWithoutWhitespace = feedbackText.replace(/\\s/g, \"\");\n\tif (feedbackTextWithoutWhitespace.length > 1) {\n\t\treturn true;\n\t} else return false;\n}\n\n/**\n * Drag counter based z-index - this allows stacking draggables in the order of their last movement instead of DOM order.\n *\n * If draggable elements have an additional z-index applied eg. during dragging, that z-index should be high enough so\n * counter based z-index does not become greater that, otherwise, additional z-index will not be sufficient to stack\n * over other siblings.\n */\nvar DragCounter = {\n\t// element moves/drags counter\n\tdragCounter: 0,\n\n\tonDragStart: function (target) {\n\t\t// increase drag counter on move\n\t\t++this.dragCounter;\n\t\t// clear drag counter inline z-index\n\t\ttarget.style.zIndex = '';\n\t},\n\tonDragEnd: function (target) {\n\t\t// get target's base z-index\n\t\tvar currentZIndex = parseInt(window.getComputedStyle(target).zIndex || 0);\n\t\t// set new z-index\n\t\tif ($(target).closest(\"div[id*='uestionId']\")[0].getAttribute('data-question-type') !== questionTypes.dragSortElements) {\n\t\t\ttarget.style.zIndex = currentZIndex + this.dragCounter;\n\t\t} else {\n\t\t\ttarget.style.zIndex = 1;\n\t\t}\n\n\t}\n};\n\n\nvar Code = (function () {\n\n\tconst LINT_OPTIONS = {\n\t\t\"globals\": {\n\t\t\t\"alert\": true,\n\t\t\t\"print\": true\n\t\t},\n\t\t\"undef\": true,\n\t\t\"unused\": true\n\t};\n\n\tconst AnswerTypes = {\n\t\tIGNORED: 'ignored',\n\t\tSTATIC: 'static',\n\t\tEVALUATED: 'evaluated'\n\t};\n\n\tvar ReplType = {\n\t\tJAVASCRIPT: 'javascript',\n\t\tPYTHON: 'python',\n\t\tBLOCKLY: 'blockly',\n\t};\n\n\tvar InputType = {\n\t\tSTRING: 'string',\n\t\tFLOAT: 'float',\n\t\tINTEGER: 'integer',\n\t\tBOOLEAN: 'boolean',\n\t};\n\n\tconst Styles = {\n\t\tCODE_OUTPUT: 'overflow: auto; height: 300px; border: 1px solid; background-color: white; font-family: monospace; padding: 0.5em; font-size: 0.8em;',\n\t\tCODE_OUTPUT_MARKER: '',\n\t\tCODE_OUTPUT_TEXT: '',\n\t\tCODE_OUTPUT_INPUT: 'display:flex; ',\n\t\tCODE_OUTPUT_INPUT_LABEL: '',\n\t\tCODE_OUTPUT_INPUT_CONTROL: 'flex: 1; outline: none; border: 0 none; text-align: left;',\n\t};\n\n\tvar tasks = {};\n\n\t// private methods\n\t// ---------- utils\n\n\t/** Ensure that empty or invalid values always ends up as an array. */\n\tfunction ensureArrContent(content) {\n\t\tif (content == null) {\n\t\t\treturn [];\n\t\t}\n\n\t\t// handle bug in empty arr representation\n\t\tif (content === 'null') {\n\t\t\treturn [];\n\t\t}\n\n\t\tif (!Array.isArray(content)) {\n\t\t\treturn [content];\n\t\t}\n\n\t\treturn content;\n\t}\n\n\t/** Check if value is \"web empty\" ie. undefined, value or an empty string. */\n\tfunction isEmptyValue(value) {\n\t\treturn value == null || value === '';\n\t}\n\n\n\t// ---------- tasks\n\n\t/** Find and return task by id. Or fail. If that's what you want. */\n\tfunction getTask(id, fail = true) {\n\t\tif (tasks[id] == null && fail) {\n\t\t\tthrow 'Unknown task ' + id;\n\t\t}\n\n\t\treturn tasks[id];\n\t}\n\n\n\t// ---------- code\n\n\tfunction getTaskCode(task) {\n\t\tif (task.params.replType === ReplType.JAVASCRIPT) {\n\t\t\treturn task.editor.getValue();\n\t\t} else if (task.params.replType === ReplType.PYTHON) {\n\t\t\treturn task.editor.getValue();\n\t\t} else if (task.params.replType === ReplType.BLOCKLY) {\n\t\t\treturn Blockly.JavaScript.workspaceToCode(task.editor);\n\t\t} else {\n\t\t\tthrow 'Unknown repl type ' + task.params.replType + ' on task ' + task.params.id;\n\t\t}\n\t}\n\n\tfunction getTaskReferenceCode(task) {\n\t\tconst referenceCode = createTaskReferenceCode(task);\n\n\t\treturn [\n\t\t\t...referenceCode.inputs,\n\t\t\t...referenceCode.code,\n\t\t].join('\\n');\n\t}\n\n\tfunction createInitialTaskCode(task) {\n\t\tif (task.params.replType === ReplType.JAVASCRIPT) {\n\t\t\treturn {\n\t\t\t\tcode: task.params.code,\n\t\t\t\tinputs: createJsInputsCode(task.params.inputs)\n\t\t\t};\n\t\t} else if (task.params.replType === ReplType.PYTHON) {\n\t\t\treturn {\n\t\t\t\tcode: task.params.code,\n\t\t\t\tinputs: createPythonInputsCode(task.params.inputs)\n\t\t\t};\n\t\t} else if (task.params.replType === ReplType.BLOCKLY) {\n\t\t\treturn {\n\t\t\t\tcode: [],\n\t\t\t\tinputs: [],\n\t\t\t};\n\t\t} else {\n\t\t\tthrow 'Error creating editor. Unknown REPL type: ' + task.params.replType;\n\t\t}\n\t}\n\n\tfunction createTaskReferenceCode(task) {\n\t\tif (task.params.replType === ReplType.JAVASCRIPT) {\n\t\t\treturn {\n\t\t\t\tcode: task.params.answerText,\n\t\t\t\tinputs: createJsInputsCode(task.params.inputs),\n\t\t\t};\n\t\t} else if (task.params.replType === ReplType.PYTHON) {\n\t\t\treturn {\n\t\t\t\tcode: task.params.answerText,\n\t\t\t\tinputs: createPythonInputsCode(task.params.inputs),\n\t\t\t};\n\t\t} else if (task.params.replType === ReplType.BLOCKLY) {\n\t\t\treturn {\n\t\t\t\tcode: [],\n\t\t\t\tinputs: [],\n\t\t\t};\n\t\t} else {\n\t\t\tthrow 'Error creating editor. Unknown REPL type: ' + task.params.replType;\n\t\t}\n\t}\n\n\tfunction findOutputElement(id) {\n\t\tvar outputSelector = \"#output-\" + id;\n\t\treturn $(outputSelector);\n\t}\n\n\tfunction findCheckButtonElement(id) {\n\t\tvar selector = \"#check\" + id;\n\t\treturn $(selector);\n\t}\n\n\tfunction clearOutput(id) {\n\t\tfindOutputElement(id).text(\"\");\n\t\tclearResultStatus(id);\n\t}\n\n\tfunction appendToOutput(id, content) {\n\t\tconst $outputEl = findOutputElement(id);\n\t\t$outputEl.append(content);\n\t\t$outputEl.scrollTop($outputEl.prop('scrollHeight'));\n\t}\n\n\tfunction setResultStatus(id, resultClass) {\n\t\tclearResultStatus(id);\n\t\tfindOutputElement(id).addClass(resultClass);\n\t}\n\n\tfunction getTaskResult(id) {\n\t\tvar $outputEl = findOutputElement(id);\n\n\t\treturn $outputEl.children('.code-output-text').map(function () {\n\t\t\treturn $(this).text();\n\t\t})\n\t\t\t.get();\n\t}\n\n\tfunction clearResultStatus(id) {\n\t\tfindOutputElement(id).removeClass('success danger');\n\t}\n\n\tfunction writeReplConsoleOutputMarker(id, value) {\n\t\tappendToOutput(id, $(`<div class=\"code-output-marker\" style=\"${Styles.CODE_OUTPUT_MARKER}\">${value}</div>`));\n\t}\n\n\tfunction writeReplConsoleText(id, value) {\n\t\tappendToOutput(id, $(`<div class=\"code-output-text\" style=\"${Styles.CODE_OUTPUT_TEXT}\">${value}</div>`));\n\t}\n\n\tfunction writeReplConsoleInput(id, label, valueCallback) {\n\t\tconst inputContainerEl = $(`<div class=\"code-output-input\" style=\"${Styles.CODE_OUTPUT_INPUT}\" />`);\n\t\tconst labelEl = $(`<span class=\"code-output-inputLabel\" style=\"${Styles.CODE_OUTPUT_INPUT_LABEL}\" />`).text(label);\n\t\tconst inputEl = $(`<input>`, {\n\t\t\ttype: \"text\",\n\t\t\t\"class\": \"code-output-inputControl\",\n\t\t\tstyle: Styles.CODE_OUTPUT_INPUT_CONTROL,\n\t\t\ton: {\n\t\t\t\tkeypress: function (event) {\n\t\t\t\t\t// on enter disable further input and return value\n\t\t\t\t\tif (event.keyCode == 13) {\n\t\t\t\t\t\t$(this)\n\t\t\t\t\t\t\t.attr(\"disabled\", \"disabled\")\n\t\t\t\t\t\t\t.blur();\n\t\t\t\t\t\tvalueCallback(this.value);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tinputContainerEl.append(labelEl);\n\t\tinputContainerEl.append(inputEl);\n\t\tappendToOutput(id, inputContainerEl);\n\n\t\tinputEl.focus();\n\t}\n\n\n\t/** Do some necessary UI adjustments depending on task's configuration. */\n\tfunction configureUi(task) {\n\t\t__tmp__replaceOutputEl(task.params.id);\n\t\tconfigureCheckButton(task);\n\t}\n\n\t/** Configure check button according to answer type. */\n\tfunction configureCheckButton(task) {\n\t\tconst id = task.params.id;\n\t\tconst $checkButtonEl = findCheckButtonElement(id);\n\n\t\t// IGNORED - hide check button\n\t\tif (task.params.answerType === AnswerTypes.IGNORED) {\n\t\t\t$checkButtonEl.hide();\n\t\t}\n\t}\n\n\t/** Tmp solution that replaces current HTML output TEXTAREA el with DIV. If this new \"Code\" implementation proves OK, this should be done in HTML itself instead. */\n\tfunction __tmp__replaceOutputEl(id) {\n\t\tconst $outputEl = findOutputElement(id);\n\t\t$outputEl.replaceWith($('<div />', {\n\t\t\tid: $outputEl.attr('id'),\n\t\t\tclass: $outputEl.attr('class'),\n\t\t\tstyle: Styles.CODE_OUTPUT,\n\t\t}));\n\t}\n\n\n\t// ---------- Interpreters\n\n\t/** Output writer that passes output to given callback fn. */\n\tfunction createCallbackOutputWriter(callback) {\n\t\treturn {\n\t\t\twrite: (...params) => {\n\t\t\t\tcallback(params.join(''));\n\t\t\t}\n\t\t};\n\t};\n\n\t/** Output writer that buffers output into given buffer (array). */\n\tfunction createBufferedOutputWriter(buffer) {\n\t\treturn {\n\t\t\twrite: (...args) => {\n\t\t\t\tbuffer.push(args.join(''));\n\t\t\t}\n\t\t};\n\t};\n\n\t/** Input reader that reads from default browser prompt. */\n\tfunction createPromptInputReader() {\n\t\treturn {\n\t\t\tread: (label) => {\n\t\t\t\treturn new Promise((resolve, reject) => {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tconst value = prompt(label);\n\t\t\t\t\t\tresolve(value);\n\t\t\t\t\t} catch (err) {\n\t\t\t\t\t\treject(err);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t};\n\t}\n\n\n\t/** Input reader that reads from default browser prompt. */\n\tfunction createInlineInputReader(taskId) {\n\t\treturn {\n\t\t\tread: (label) => {\n\t\t\t\treturn new Promise((resolve, reject) => {\n\t\t\t\t\ttry {\n\t\t\t\t\t\twriteReplConsoleInput(taskId, label, (value) => {\n\t\t\t\t\t\t\tresolve(value);\n\t\t\t\t\t\t});\n\t\t\t\t\t} catch (err) {\n\t\t\t\t\t\treject(err);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t};\n\t}\n\n\t/** Input reader that takes another input reader and records it's every input into a queue. */\n\tfunction createQueueLookupRecorderInputReader(inputReader, inputRecordQueue) {\n\t\treturn {\n\t\t\tread: (text) => {\n\t\t\t\treturn inputReader.read(text)\n\t\t\t\t\t.then((value) => {\n\t\t\t\t\t\tinputRecordQueue.push(value);\n\n\t\t\t\t\t\treturn value;\n\t\t\t\t\t});\n\t\t\t}\n\t\t};\n\t}\n\n\t/** Input reader that takes another input reader and records it's every input into a lookup map. */\n\tfunction createMapLookupRecorderInputReader(inputReader, inputRecordMap) {\n\t\treturn {\n\t\t\tread: (text) => {\n\t\t\t\treturn inputReader.read(text)\n\t\t\t\t\t.then((value) => {\n\t\t\t\t\t\tinputRecordMap[text] = value;\n\n\t\t\t\t\t\treturn value;\n\t\t\t\t\t});\n\t\t\t}\n\t\t};\n\t}\n\n\t/**\n\t * Input reader that uses prepared/recorded lookup queue to return input.\n\t * This reader allows inputs to be accessed/read in the same order they were recorded in.\n\t */\n\tfunction createQueueLookupInputReader(lookupQueue) {\n\t\treturn {\n\t\t\tread: (text) => {\n\t\t\t\treturn new Promise((resolve, reject) => {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tconst value = lookupQueue.shift();\n\t\t\t\t\t\tresolve(value);\n\t\t\t\t\t} catch (err) {\n\t\t\t\t\t\treject(err);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t};\n\t}\n\n\t/**\n\t * Input reader that uses prepared/recorded lookup map to return input.\n\t * This reader allows inputs to be accessed/read by the label they were recorded with. This has a limitation that you must have unique input labels for all inputs.\n\t */\n\tfunction createMapLookupInputReader(lookupMap) {\n\t\treturn {\n\t\t\tread: (text) => {\n\t\t\t\treturn new Promise((resolve, reject) => {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tconst value = lookupMap[text];\n\t\t\t\t\t\tresolve(value);\n\t\t\t\t\t} catch (err) {\n\t\t\t\t\t\treject(err);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t};\n\t}\n\n\t/**\n\t * Possible options:\n\t *  - outputWriter  - output writer impl object\n\t *  - inputReader - input collector impl object\n\t */\n\tfunction runInterpreter(replType, code, options) {\n\t\tif (replType === ReplType.JAVASCRIPT) {\n\t\t\treturn runJsInterpreter(code, options);\n\t\t} else if (replType === ReplType.PYTHON) {\n\t\t\treturn runPythonInterpreter(code, options);\n\t\t} else if (replType === ReplType.BLOCKLY) {\n\t\t\treturn runJsInterpreter(code);\n\t\t} else {\n\t\t\tthrow 'Unknown REPL type: ' + replType;\n\t\t}\n\t}\n\n\t// -- Python interpreter\n\n\tfunction runPythonInterpreter(code, options) {\n\t\tlet expectTrailingNewline = false;\n\t\t// output writer function wrapper\n\t\tvar outputWriterFn = function (...params) {\n\t\t\tif (expectTrailingNewline && params.length === 1 && params.slice(0, 1).shift() === '\\n') {\n\t\t\t\t// ignore python's trailing newline\n\t\t\t} else {\n\t\t\t\tif (options && options.outputWriter) {\n\t\t\t\t\toptions.outputWriter.write(...params);\n\t\t\t\t}\n\t\t\t}\n\t\t\texpectTrailingNewline = !expectTrailingNewline;\n\t\t};\n\n\t\t// input reader function wrapper\n\t\tvar inputReaderFn = function (text) {\n\t\t\tif (options && options.inputReader) {\n\t\t\t\treturn options.inputReader.read(text);\n\t\t\t}\n\t\t\telse {\n\t\t\t\treturn Promise.resolve();\n\t\t\t}\n\t\t};\n\n\t\tSk.configure({\n\t\t\toutput: outputWriterFn,\n\t\t\tinputfun: inputReaderFn,\n\t\t\tinputfunTakesPrompt: true,\n\t\t\tread: (x) => {\n\t\t\t\tif (Sk.builtinFiles === undefined || Sk.builtinFiles[\"files\"][x] === undefined) {\n\t\t\t\t\tthrow \"File not found: '\" + x + \"'\";\n\t\t\t\t}\n\t\t\t\treturn Sk.builtinFiles[\"files\"][x];\n\t\t\t}\n\t\t});\n\n\t\treturn Sk.misceval.asyncToPromise(function () {\n\t\t\treturn Sk.importMainWithBody(\"<stdin>\", false, code, true);\n\t\t});\n\t}\n\n\n\t// -- JS interpreter\n\n\t/**\n\t * JS interpreter\n\t * Dos: https://neil.fraser.name/software/JS-Interpreter/docs.html\n\t */\n\tfunction runJsInterpreter(code, options) {\n\t\treturn new Promise(function (resolve, reject) {\n\t\t\tlet interval;\n\t\t\ttry {\n\t\t\t\tvar interpreter = new Interpreter(code, jsInterpreterInitFn(options));\n\t\t\t\tinterpreter.run();\n\n\t\t\t\t// loop until there are no more steps to performe, then exit\n\t\t\t\tinterval = setInterval(() => {\n\t\t\t\t\tif (!interpreter.step()) {\n\t\t\t\t\t\tclearInterval(interval);\n\t\t\t\t\t\tinterval = null;\n\t\t\t\t\t\tresolve();\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t} catch (err) {\n\t\t\t\tif (interval != null) {\n\t\t\t\t\tclearInterval(interval);\n\t\t\t\t\tinterval = null;\n\t\t\t\t}\n\t\t\t\treject(err);\n\t\t\t}\n\t\t});\n\t}\n\n\tfunction jsInterpreterInitFn(options) {\n\t\treturn (interpreter, scope) => {\n\t\t\t// type coversion utils\n\t\t\tfunction parseBoolFn(strValue) {\n\t\t\t\tif (strValue == null || strValue.trim().length === 0) {\n\t\t\t\t\treturn false;\n\t\t\t\t} else {\n\t\t\t\t\treturn /^true$/i.test(strValue.trim());\n\t\t\t\t}\n\t\t\t}\n\t\t\tinterpreter.setProperty(scope, \"parseBool\", interpreter.createNativeFunction(parseBoolFn));\n\n\t\t\t// output writer function wrapper\n\t\t\tvar outputWriterFn = function (...params) {\n\t\t\t\tif (options && options.outputWriter) {\n\t\t\t\t\toptions.outputWriter.write(...params);\n\t\t\t\t}\n\n\t\t\t\treturn interpreter.UNDEFINED;\n\t\t\t};\n\t\t\tinterpreter.setProperty(scope, \"print\", interpreter.createNativeFunction(outputWriterFn));\n\t\t\tinterpreter.setProperty(scope, \"alert\", interpreter.createNativeFunction(outputWriterFn));\n\n\t\t\t// input reader function wrapper\n\t\t\tvar inputReaderFn = function (text, callback) {\n\t\t\t\tif (options && options.inputReader) {\n\t\t\t\t\toptions.inputReader.read(text)\n\t\t\t\t\t\t.then((value) => {\n\t\t\t\t\t\t\tcallback(value);\n\t\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tcallback();\n\t\t\t\t}\n\t\t\t};\n\t\t\tinterpreter.setProperty(scope, \"input\", interpreter.createAsyncFunction(inputReaderFn));\n\t\t\tinterpreter.setProperty(scope, \"prompt\", interpreter.createAsyncFunction(inputReaderFn));\n\t\t};\n\t}\n\n\tfunction createJsInputsCode(inputs) {\n\t\t// wrap cmd in type converter, if there is type and it's not string (stirn is defualt)\n\t\tfunction typeWrapper(inputType, cmd) {\n\t\t\tif (inputType != null && inputType !== InputType.STRING) {\n\t\t\t\tif (inputType === InputType.BOOLEAN) {\n\t\t\t\t\treturn `parseBool(${cmd})`;\n\t\t\t\t} else if (inputType === InputType.FLOAT) {\n\t\t\t\t\treturn `parseFloat(${cmd})`;\n\t\t\t\t} else if (inputType === InputType.INTEGER) {\n\t\t\t\t\treturn `parseInt(${cmd})`;\n\t\t\t\t}\n\t\t\t\t// no typing, return original value\n\t\t\t} else {\n\t\t\t\treturn cmd;\n\t\t\t}\n\t\t}\n\n\t\treturn (inputs || []).map((input) => {\n\t\t\treturn `var ${input.name} = ${typeWrapper(input.type, 'prompt(\"' + input.label + '\")')};`;\n\t\t});\n\t}\n\n\tfunction createPythonInputsCode(inputs) {\n\t\t// wrap cmd in type converter, if there is type and it's not string (stirn is defualt)\n\t\tfunction typeWrapper(inputType, cmd) {\n\t\t\tif (inputType != null && inputType !== InputType.STRING) {\n\t\t\t\tif (inputType === InputType.BOOLEAN) {\n\t\t\t\t\treturn `bool(${cmd})`;\n\t\t\t\t} else if (inputType === InputType.FLOAT) {\n\t\t\t\t\treturn `float(${cmd})`;\n\t\t\t\t} else if (inputType === InputType.INTEGER) {\n\t\t\t\t\treturn `int(${cmd})`;\n\t\t\t\t}\n\t\t\t\t// no typing, return original value\n\t\t\t} else {\n\t\t\t\treturn cmd;\n\t\t\t}\n\t\t}\n\n\t\treturn (inputs || []).map((input) => {\n\t\t\treturn `${input.name} = ${typeWrapper(input.type, 'input(\"' + input.label + '\")')}`;\n\t\t});\n\t}\n\n\t// ---------- Editor\n\n\tfunction createEditor(task) {\n\t\tif (task.params.replType === ReplType.JAVASCRIPT) {\n\t\t\tconst taskCode = createInitialTaskCode(task);\n\t\t\treturn createCodeEditor(\n\t\t\t\ttask.params.id,\n\t\t\t\ttask.params.replType,\n\t\t\t\ttaskCode.code,\n\t\t\t\ttaskCode.inputs,\n\t\t\t);\n\t\t} else if (task.params.replType === ReplType.PYTHON) {\n\t\t\tconst taskCode = createInitialTaskCode(task);\n\t\t\treturn createCodeEditor(\n\t\t\t\ttask.params.id,\n\t\t\t\ttask.params.replType,\n\t\t\t\ttaskCode.code,\n\t\t\t\ttaskCode.inputs,\n\t\t\t);\n\t\t} else if (task.params.replType === ReplType.BLOCKLY) {\n\t\t\treturn createBlocklyEditor(\n\t\t\t\ttask.params.id,\n\t\t\t\ttask.params.toolbox,\n\t\t\t\ttask.params.workspace\n\t\t\t);\n\t\t} else {\n\t\t\tthrow 'Error creating editor. Unknown REPL type: ' + task.params.replType;\n\t\t}\n\t}\n\n\tfunction resetEditor(id) {\n\t\tconst task = getTask(id);\n\n\t\tif (task.params.replType === ReplType.JAVASCRIPT) {\n\t\t\tconst taskCode = createInitialTaskCode(task);\n\t\t\treturn resetCodeEditor(\n\t\t\t\ttask.editor,\n\t\t\t\ttaskCode.code,\n\t\t\t\ttaskCode.inputs,\n\t\t\t);\n\t\t} else if (task.params.replType === ReplType.PYTHON) {\n\t\t\tconst taskCode = createInitialTaskCode(task);\n\t\t\treturn resetCodeEditor(\n\t\t\t\ttask.editor,\n\t\t\t\ttaskCode.code,\n\t\t\t\ttaskCode.inputs,\n\t\t\t);\n\t\t} else if (task.params.replType === ReplType.BLOCKLY) {\n\t\t\treturn resetBlocklyEditor(task.editor, task.params.toolbox, task.params.workspace);\n\t\t} else {\n\t\t\tthrow 'Error creating editor. Unknown REPL type: ' + task.params.replType;\n\t\t}\n\t}\n\n\t// -- Code editor\n\n\tfunction createCodeEditor(id, type, code, inputs) {\n\t\tvar options = {\n\t\t\tlineNumbers: true,\n\t\t\tmode: type,\n\t\t};\n\t\tif (options.mode === ReplType.JAVASCRIPT) {\n\t\t\toptions.gutters = [\"CodeMirror-lint-markers\"];\n\t\t\t//options.lint = true;\n\t\t\toptions.lint = LINT_OPTIONS;\n\t\t}\n\n\t\tconst editor = CodeMirror(document.getElementById(\"editor-\" + id), options);\n\n\t\tresetCodeEditor(editor, code, inputs);\n\n\t\treturn editor;\n\t};\n\n\tfunction resetCodeEditor(editor, code, inputs) {\n\t\t// rest editor\n\t\teditor.setValue('');\n\t\teditor.clearHistory();\n\n\t\t// set new value\n\t\teditor.setValue([\n\t\t\t// add generated inputs before initial code\n\t\t\t...inputs,\n\t\t\t// add initial code\n\t\t\t...code\n\t\t].join('\\n')\n\t\t);\n\n\t\t// disable editing of generated inputs lines\n\t\tif (inputs && inputs.length > 0) {\n\t\t\teditor.markText({ line: 0, ch: 0 }, { line: inputs.length, ch: 0 }, { readOnly: true, css: 'opacity: 0.4;' });\n\t\t}\n\t}\n\n\n\t// -- Blockly editor\n\n\t// TODO: solve hardcoded media path for Blockly\n\tfunction createBlocklyEditor(id, toolbox, workspace) {\n\t\treturn Blockly.inject(\"editor-\" + id, {\n\t\t\tmedia: \"../explain/static/preview/1.1/js/vendor/blockly/media/\",\n\t\t\tsounds: false,\n\t\t\ttoolbox: toolbox,\n\t\t\ttrashcan: true\n\t\t});\n\t};\n\n\tfunction resetBlocklyEditor(editor, toolbox, workspace) {\n\t\teditor.setValue('');\n\t\t// TODO: check resetting blockly editor\n\t}\n\n\n\n\t// ---------- public functions\n\n\tvar init = function (questionId, replType, inputs, answerText, answerType, replCode, blocklyToolbox, blocklyWorkspace) {\n\t\ttry {\n\t\t\tvar task = {};\n\t\t\ttask.params = {};\n\t\t\ttask.params.id = questionId;\n\t\t\ttask.params.replType = replType;\n\t\t\ttask.params.inputs = ensureArrContent(inputs); // there is a bug that renders old questions as \"null\" (string)\n\t\t\ttask.params.answerText = ensureArrContent(answerText);\n\t\t\ttask.params.answerType = isEmptyValue(answerType) ? AnswerTypes.STATIC : answerType; // old questions don't have answer type\n\t\t\ttask.params.code = ensureArrContent(replCode);\n\t\t\ttask.params.toolbox = blocklyToolbox;\n\t\t\ttask.params.workspace = blocklyWorkspace;\n\n\t\t\ttask.editor = createEditor(task);\n\n\t\t\tconfigureUi(task);\n\n\t\t\ttasks[task.params.id] = task;\n\t\t} catch (err) {\n\t\t\tconsole.error('Error initializing task ' + questionId, err);\n\t\t}\n\t};\n\n\tvar run = function (id) {\n\t\ttry {\n\t\t\tlet task = getTask(id);\n\n\t\t\tlet code = getTaskCode(task);\n\n\t\t\ttask.lastRecordedInputLookup = [];\n\t\t\tPromise.resolve(true)\n\t\t\t\t.then(() => {\n\t\t\t\t\tclearOutput(task.params.id);\n\t\t\t\t\twriteReplConsoleOutputMarker(task.params.id, \"[pocetak programa]\");\n\t\t\t\t})\n\t\t\t\t.then(() => {\n\t\t\t\t\treturn runInterpreter(task.params.replType, code, {\n\t\t\t\t\t\toutputWriter: createCallbackOutputWriter((text) => writeReplConsoleText(task.params.id, text)),\n\t\t\t\t\t\tinputReader: createQueueLookupRecorderInputReader(createInlineInputReader(task.params.id), task.lastRecordedInputLookup),\n\t\t\t\t\t});\n\t\t\t\t})\n\t\t\t\t.catch((err) => {\n\t\t\t\t\twriteReplConsoleText(task.params.id, err.toString());\n\t\t\t\t\tconsole.error('Error running code on task ' + task.params.id, err);\n\t\t\t\t})\n\t\t\t\t.finally(() => {\n\t\t\t\t\twriteReplConsoleOutputMarker(task.params.id, \"[kraj programa]\");\n\t\t\t\t});\n\t\t} catch (err) {\n\t\t\tconsole.error('Error running task ' + id, err);\n\t\t}\n\t};\n\n\tvar check = function (id) {\n\t\ttry {\n\t\t\tvar task = getTask(id);\n\n\t\t\tclearResultStatus(id);\n\n\t\t\tvar resultOutput = getTaskResult(task.params.id);\n\t\t\tlet referenceCode = getTaskReferenceCode(task);\n\n\t\t\tconst referenceOutputBuffer = [];\n\t\t\t// evaluated - output comapraed against evaluated reference code\n\t\t\tif (task.params.answerType === AnswerTypes.EVALUATED) {\n\t\t\t\trunInterpreter(task.params.replType, referenceCode, {\n\t\t\t\t\toutputWriter: createBufferedOutputWriter(referenceOutputBuffer),\n\t\t\t\t\tinputReader: createQueueLookupInputReader(task.lastRecordedInputLookup),\n\t\t\t\t})\n\t\t\t\t\t.then(() => {\n\t\t\t\t\t\tcompareResults(resultOutput, referenceOutputBuffer);\n\t\t\t\t\t})\n\t\t\t\t\t.catch((err) => {\n\t\t\t\t\t\tconsole.error('Error running reference code on task ' + task.params.id, err);\n\t\t\t\t\t});\n\t\t\t\t// static - output compared with static answer\n\t\t\t} else if (task.params.answerType === AnswerTypes.STATIC) {\n\t\t\t\tcompareResults(resultOutput, task.params.answerText);\n\t\t\t\t// ignored - no check, answer is ignored\n\t\t\t} else if (task.params.answerType === AnswerTypes.IGNORED) {\n\t\t\t\t// ignore answer check - this probably shouldn't have even been called\n\t\t\t\treturn;\n\t\t\t\t// unknown answer type\n\t\t\t} else {\n\t\t\t\tconsole.error(`Unknown answer type \"${task.params.answerType}\" in task \"${task.params.id}\"`);\n\t\t\t}\n\n\t\t\tfunction compareResults(resultOutput, referenceOutput) {\n\t\t\t\tvar answerCorrect;\n\t\t\t\tif (referenceOutput.length === resultOutput.length) { // number of lines must match\n\t\t\t\t\tanswerCorrect = true;\n\t\t\t\t\tfor (var i = 0; answerCorrect && i < resultOutput.length; i++) { // each line must be exact as the ones provided by answer\n\t\t\t\t\t\tanswerCorrect = resultOutput[i] === referenceOutput[i];\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tanswerCorrect = false;\n\t\t\t\t}\n\t\t\t\tif (answerCorrect) {\n\t\t\t\t\tsetResultStatus(task.params.id, \"success\");\n\t\t\t\t\tif (winAudio) {\n\t\t\t\t\t\twinAudio.play();\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tsetResultStatus(task.params.id, \"danger\");\n\t\t\t\t\tif (loseAudio) {\n\t\t\t\t\t\tloseAudio.play();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t} catch (err) {\n\t\t\tconsole.error('Error checking task ' + id, err);\n\t\t}\n\t};\n\n\tvar reset = function (id) {\n\t\ttry {\n\t\t\tvar task = getTask(id, false);\n\t\t\tif (task == null) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tresetEditor(task.params.id);\n\t\t\tclearOutput(task.params.id);\n\t\t} catch (err) {\n\t\t\tconsole.error('Error resetting task ' + id, err);\n\t\t}\n\t};\n\n\t// exposing public methods\n\n\treturn {\n\t\tinit: init,\n\t\trun: run,\n\t\tcheck: check,\n\t\treset: reset,\n\t\ttasks: tasks // temp while develop\n\t};\n})();\n\nconst resetAllQuestionsOnPage = () => {\n\tconst questions = $(\"div[id*='questionId'][data-question-type]\").toArray();\n\tquestions.forEach((question) => {\n\t\tresetQuizQuestion(question.id, true);\n\t});\n};\n\n\n\nconst quizInit = () => {\n\tconst questions = $(\"div[id*='questionId'][data-question-type]\").toArray();\n\tquestions.forEach((question) => {\n\t\tinitDragPairsElements(question.id);\n\t});\n\n\n\tresetAllQuestionsOnPage();\n};\n\nquizInit();\n\n$(document).ready(function () {\n\tinitKeyboardDragDrop();\n\tinitAdditionalKeyboardNav();\n\n\t$('input:checkbox').on('click', function (event) {\n\t\tif (!document.activeElement.checked || (event.target !== $(document.activeElement)[0])) {\n\t\t\t$(document.activeElement)[0].blur();\n\t\t}\n\t});\n\n\tif (window.MathJax) {\n\t\tMathJax.Hub.Queue(function () {\n\t\t\t$.each($('input.length-tiny').not(\"input[id*=_q]\"), function (index, value) {\n\t\t\t\tvalue.tabIndex = '-1';\n\t\t\t});\n\t\t});\n\t}\n\n\t$('.checkQuizButton').on('click', function (event) {\n\t\tlet taskId = $(event.target).closest(\"div[id*='uestionId'][data-question-type]\").attr('id');\n\t\tif ($(`#${taskId}`).find('.can-drop')[0] && $(`#${taskId}`).find('.can-drop')[0].classList.contains('can-drop')) {\n\t\t\t$(`#${taskId}`).find('.can-drop')[0].classList.remove('can-drop');\n\t\t}\n\n\t\tif ($(`#${taskId}`).find('.can-drop-style')[0] && $(`#${taskId}`).find('.can-drop-style')[0].classList.contains('can-drop-style')) {\n\t\t\t$(`#${taskId}`).find('.can-drop-style')[0].classList.remove('can-drop-style');\n\t\t}\n\t});\n\n\t$('.resetQuizButton').on('keypress', function (event) {\n\t\tif (event.keyCode === 32 || event.keyCode === 13) {\n\t\t\tresetQuizQuestion($(event.target).closest(\"div[id*='uestionId'][data-question-type]\").attr('id'));\n\n\t\t\tif ($(event.target).closest(\"div[id*='uestionId'][data-question-type]\").attr('data-question-type') !== 'Da/Ne') {\n\t\t\t\t$(`#${$(event.target).closest(\"div[id*='uestionId'][data-question-type]\").attr('id')}`).find(\":tabbable\")[0].focus();\n\t\t\t}\n\t\t}\n\t});\n\n\t$(function () {\n\t\t$('*[draggable!=true]', '.slick-track').unbind('dragstart');\n\t\t$(\".draggable-element\").draggable();\n\t});\n});\n"

/***/ }),
/* 10 */
/***/ (function(module, exports, __webpack_require__) {

// extracted by mini-css-extract-plugin

/***/ }),
/* 11 */
/***/ (function(module, exports, __webpack_require__) {

__webpack_require__(0)(__webpack_require__(12))

/***/ }),
/* 12 */
/***/ (function(module, exports) {

module.exports = "$(document).ready(function() {\n  const keyboardContainers = document.querySelectorAll('.keyboard_container');\n\n  if (keyboardContainers && keyboardContainers.length > 0) {\n    for (var i = 0; i < keyboardContainers.length; i++) {\n      const keysId = keyboardContainers[i].getAttribute('data-key-var');\n      const parentId = keysId.split('keys_');\n      bindKeyboard(keyboardContainers[i], keysId, parentId[1]);\n    }\n  }\n})\n\nfunction bindKeyboard(keyboardContainer, keysId, parentId) {\n  const keys = window[keysId] || eval(keysId);\n  const parent = document.getElementById(parentId);\n  const toggleButton = keyboardContainer.querySelector('.toggle_button');\n  const inputs = parent.getElementsByTagName('input');\n\n  const controlsContainer = parent.getElementsByClassName('dos-part-question__controls')[0];\n  const contentContainer = parent.getElementsByClassName('dos-part-question__content')[0];\n\n  let keyboard = keyboardContainer.querySelector('.keyboard');\n\n  if (!keyboard) {\n    const keyb = document.createElement('div');\n    keyb.classList.add('keyboard');\n\n    keyboardContainer.appendChild(keyb);\n\n    keyboard = keyb;\n  }\n\n  //controlsContainer.parentElement.insertBefore(keyboardContainer, controlsContainer);\n  $(keyboardContainer).insertAfter(contentContainer)\n\n  for (var i = 0; i < inputs.length; i++) {\n    addEvent(inputs[i], 'focus', function () {\n      currentInput = this;\n      if (!keyboardContainer.classList.contains('open')) {\n        keyboardContainer.classList.add('open');\n      }\n    });\n  }\n  insertAllButtons(keyboard);\n\n  function insertAllButtons(keyboard) {\n    const closeButton = document.createElement('button');\n    const closeButtonText = document.createTextNode('X');\n\n    closeButton.classList.add('close_keyboard');\n    closeButton.append(closeButtonText);\n    keyboard.append(closeButton);\n    addEvent(closeButton, 'click', function () {\n      keyboardContainer.classList.remove('open');\n    });\n\n    for (let i = 0; i < keys.length; i++) {\n      const button = document.createElement('button');\n      const buttonText = document.createTextNode(keys[i].code);\n      const attribute = document.createAttribute('name');\n\n      attribute.value = keys[i].name;\n      button.value = keys[i].code;\n      button.setAttributeNode(attribute);\n      button.appendChild(buttonText);\n\n      addEvent(button, 'click', inputChar);\n\n      keyboard.appendChild(button);\n    }\n  }\n}\n\nfunction inputChar() {\n  if (currentInput) {\n    currentInput.focus();\n    currentInput.value += this.value;\n  }\n}\n\nfunction addEvent(element, eventType, func) {\n  const onEventType = eventType.replace(/^\\w/, function (char) {\n    return char.toUpperCase();\n  });\n\n  if (element.addEventListener) {\n    element.addEventListener(eventType, func);\n  } else if (element.attachEvent) {\n    element.attachEvent('on' + onEventType, func);\n  } else {\n    element['on' + onEventType] = func;\n  }\n}"

/***/ }),
/* 13 */
/***/ (function(module, exports, __webpack_require__) {

// extracted by mini-css-extract-plugin

/***/ }),
/* 14 */
/***/ (function(module, exports, __webpack_require__) {

__webpack_require__(0)(__webpack_require__(15))

/***/ }),
/* 15 */
/***/ (function(module, exports) {

module.exports = "const games = document.querySelectorAll(\".memory\");\n\nfor (var i = 0; i < games.length; i++) {\n  memoryGame(games[i]);\n}\n\nfunction memoryGame(game) {\n  const cards = game.querySelectorAll(\".card-holder\");\n  const pointsToWin = cards.length / 2;\n  const tooltip = game.querySelector(\".memory-tooltip\");\n\n  let moveCounter = 0;\n  let points = 0;\n  let hasFlippedCard = false;\n  let lockBoard = false;\n  let firstCard, secondCard;\n\n  tooltip.innerText = \"Broj poteza: \" + moveCounter;\n\n  for (var i = 0; i < cards.length; i++) {\n    const randomPos = Math.floor(Math.random() * cards.length);\n    cards[i].style.order = randomPos;\n    addEvent(cards[i]);\n  }\n\n  function addEvent(element) {\n    if (element.addEventListener) {\n      element.addEventListener(\"click\", flipCard);\n    } else if (element.attachEvent) {\n      element.attachEvent(\"onClick\", flipCard);\n    } else {\n      element[\"onClick\"] = flipCard;\n    }\n  }\n\n  function flipCard() {\n    if (lockBoard || this === firstCard) {\n      return;\n    }\n\n    this.classList.add(\"flip\");\n\n    let cover = this.querySelector(\".cover\");\n    let card = this.querySelector(\".card\");\n\n    setTimeout(function() {\n      cover.classList.add(\"hidden\");\n      card.classList.add(\"visible\");\n    }, 150);\n\n    if (!hasFlippedCard) {\n      hasFlippedCard = true;\n      firstCard = this;\n\n      return;\n    }\n\n    secondCard = this;\n    setTimeout(function() {\n      checkForMatch();\n    }, 300);\n  }\n\n  function checkForMatch() {\n    let isMatch = firstCard.dataset.framework === secondCard.dataset.framework;\n\n    moveCounter++;\n    tooltip.innerText = \"Broj poteza: \" + moveCounter;\n\n    if (isMatch) {\n      points++;\n      disableCards();\n\n      if (points >= pointsToWin) {\n        endGame();\n      }\n    } else {\n      unflipCards();\n    }\n  }\n\n  function disableCards() {\n    firstCard.removeEventListener(\"click\", flipCard);\n    secondCard.removeEventListener(\"click\", flipCard);\n\n    addTooltipToCard(firstCard);\n    addTooltipToCard(secondCard);\n\n    resetSelection();\n  }\n\n  function addTooltipToCard(card) {\n    const tooltipText = document.createTextNode(`${points}`);\n    const tooltip = document.createElement('span');\n    tooltip.appendChild(tooltipText);\n    tooltip.classList.add('pair-tooltip');\n\n    card.style.transitionDuration = '0s'; // remove transition duration to remove unwanted animations\n    card.classList.remove('flip');\n\n    card.querySelector('.card').style.transitionDuration = '0s'; // remove transition duration to remove unwanted animations\n    card.querySelector('.card').style.visibility = 'unset';\n    card.querySelector('.card').style.transform = 'unset';\n    card.appendChild(tooltip);\n  }\n\n  function unflipCards() {\n    lockBoard = true;\n\n    setTimeout(function() {\n      firstCard.classList.remove(\"flip\");\n      secondCard.classList.remove(\"flip\");\n\n      return hideCards();\n    }, 1500);\n\n    function hideCards() {\n      setTimeout(function() {\n        firstCard.querySelector(\".card\").classList.remove(\"visible\");\n        firstCard.querySelector(\".cover\").classList.remove(\"hidden\");\n\n        secondCard.querySelector(\".card\").classList.remove(\"visible\");\n        secondCard.querySelector(\".cover\").classList.remove(\"hidden\");\n\n        resetSelection();\n      }, 150);\n    }\n  }\n\n  function resetSelection() {\n    firstCard = secondCard = null;\n    lockBoard = hasFlippedCard = false;\n  }\n\n  function endGame() {\n    tooltip.innerText = \"Bravo! Ukupan broj poteza: \" + moveCounter;\n  }\n}\n"

/***/ }),
/* 16 */
/***/ (function(module, exports, __webpack_require__) {

// extracted by mini-css-extract-plugin

/***/ }),
/* 17 */
/***/ (function(module, exports, __webpack_require__) {

__webpack_require__(0)(__webpack_require__(18))

/***/ }),
/* 18 */
/***/ (function(module, exports) {

module.exports = "\nconst ORIGIN_DEFAULT = '*';\n\n/**\n * Content window communication client. Communicates with content object using window.postMessage and window.addEventListener API.\n * See https://developer.mozilla.org/en-US/docs/Web/API/Window/postMessage\n */\nconst ContentWindowCommClient = function ContentCommClient(element, options) {\n  // ---- options\n  let debug;\n  let origin;\n\n  init();\n\n\n  // ----- public API\n\n  function init() {\n    if (!element) {\n      throw \"Element is empty.\";\n    }\n  \n    if (!element.postMessage) {\n      throw \"Element does not suport sending messages.\";\n    }\n  \n    if (!element.addEventListener || !element.removeEventListener) {\n      throw \"Element does not suport listening to messages.\";\n    }\n\n    debug = readOption(options != null ? options.debug : undefined, false)\n    origin = readOption(options != null ? options.origin : undefined, ORIGIN_DEFAULT)\n  }\n\n  this.sendMessage = (message) => {\n    this.logMessage(`sending`, message)\n    element.postMessage(message, origin)\n  }\n\n  this.addMessageListener = (callback) => {\n    const eventHandler = (event) => {\n      const message = event.data;\n\n      // react only on messages that have \"type\" property to ignore other 3rd party communication\n      if (message.type != null) {\n        this.logMessage('received', message);\n        callback(message)\n      }\n    }\n\n    element.addEventListener('message', eventHandler);\n\n    // return event unsubscriber\n    return () => {\n      element.removeEventListener('message', eventHandler);\n    }; \n  }\n\n  this.logMessage = (text, content) => {\n    if (debug) {\n      const optionsStr = ` (${JSON.stringify({ origin })})`;\n      console.info(`[ContentComm] ${text}${optionsStr}: ${JSON.stringify(content)}`)\n    }\n  }\n\n  function readOption(value, defaultValue) {\n    return value != null ? value : defaultValue;\n  }\n}\n\n/** Common messages */\nconst ContentCommMessageTypes = {\n  // ----- test messages\n  COMMON_DOS_PING: 'COMMON_DOS_PING',\n  COMMON_CONTENT_PONG: 'COMMON_CONTENT_PONG',\n}\n\n\n// ----- exports\n\nwindow['ContentWindowCommClient'] = ContentWindowCommClient;\n"

/***/ }),
/* 19 */
/***/ (function(module, exports, __webpack_require__) {

__webpack_require__(0)(__webpack_require__(20))

/***/ }),
/* 20 */
/***/ (function(module, exports) {

module.exports = "\nconst IvrContentCommMessageTypes = {\n  DOS_SCROLL_CONTENT_OBJECT_VISIBLE: 'DOS_SCROLL_CONTENT_OBJECT_VISIBLE',\n}\n\n/**\n * Generic IVR content communication client. Communicates with given IVR and listens to it's messages.\n * \n * @param {*} elementId ID of IVR frame element\n * @param {*} options communications options (see \"Communication options\")\n * \n * Communication options\n *  - debug {boolean} enable debug mode (eg. print debug messages on console)\n *  - origin {string} used as origin parameter when posting window messages (window.postMessage)\n */\nconst IvrContentCommClient = function IvrContentClient(elementId, options) {\n  // have communicator and content element been initialized\n  let initialized = false;\n  let initializedPromise;\n  let commClient;\n\n  const iframeElement = $(`#${elementId}`);\n  if (iframeElement.length === 0) {\n    throw `IVR element ${elementId} not found`;\n  }\n  const iframeEl = iframeElement.get().shift();\n  \n\n  // init client\n  init();\n\n  // ----- public API\n\n  /** Returns true if communicator and content element have been initialized and false otherwise. */\n  this.isInitialized = () => {\n    return this.isInitialized;\n  }\n\n  /** Returns promise which is resolved when comm has been initialized. */\n  this.onInitialized = () => {\n    return initializedPromise;\n  }\n\n  /** Send message to IVR. */\n  this.sendMessage = (message) => {\n    commClient.sendMessage(message);\n  }\n\n  /** Listen to IVR messages. Function returns unsubscribe function. */\n  this.addMessageListener = (listener) => {\n    return commClient.addMessageListener(listener);\n  }\n\n\n  // ----- private\n\n  /** Initialize everything */\n  function init() {\n    let resolveRef, rejectRef;\n    initializedPromise = new Promise((resolve, reject) => {\n      // allow external promise handling\n      resolveRef = resolve\n      rejectRef = reject;\n    });\n\n    var contentWindow = iframeEl.contentWindow;\n    commClient = new ContentWindowCommClient(contentWindow, options);\n    contentWindow.addEventListener('load', () => {\n      initialized = true;\n      resolveRef();\n    })  \n  }\n}\n\n/**\n * Scroll visible IVR content communication client. Handles IVR's \"DOS_SCROLL_CONTENT_OBJECT_VISIBLE\".\n * Uses IvrContentCommClient underhood so see there for more details.\n * \n * Additional options:\n *  - topOffset {number} number of pixels to which to scroll body\n */\nconst ScrollVisibleIvrContentCommClient = function IvrContentClient(elementId, options) {\n  // options\n  let topOffset;\n\n  let ivrCommClient;\n\n  // init client\n  init();\n\n  // ----- public API\n\n  /** Returns true if communicator and content element have been initialized and false otherwise. */\n  this.isInitialized = () => {\n    return ivrCommClient && ivrCommClient.isInitialized();\n  }\n\n  /** */\n  this.onInitialized = () => {\n    return ivrCommClient.onInitialized();\n  }\n\n\n  // ----- private\n\n  /** Initialize everything */\n  function init() {\n    topOffset = readOption(options && options.topOffset, 100);\n\n    ivrCommClient = new IvrContentCommClient(elementId, options);\n    ivrCommClient.addMessageListener(handleMessage)\n  }\n\n  function handleMessage(message) {\n    if (IvrContentCommMessageTypes.DOS_SCROLL_CONTENT_OBJECT_VISIBLE === message.type) {\n      handleScrollVisible();\n    }\n  }\n\n  function handleScrollVisible() {\n    $('html, body').animate({\n      scrollTop: $(`#${elementId}`).offset().top - topOffset // Scroll to this location.\n    });\n  }\n\n  function readOption(value, defaultValue) {\n    return value != null ? value : defaultValue;\n  }\n}\n\n\n// ----- exports\n\nwindow['IvrContentCommClient'] = IvrContentCommClient;\nwindow['ScrollVisibleIvrContentCommClient'] = ScrollVisibleIvrContentCommClient;\n"

/***/ })
/******/ ]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vd2VicGFjay9ib290c3RyYXAiLCJ3ZWJwYWNrOi8vLy4uL25vZGVfbW9kdWxlcy9zY3JpcHQtbG9hZGVyL2FkZFNjcmlwdC5qcyIsIndlYnBhY2s6Ly8vLi9wcm9qZWN0L2Nhcm5ldC9pbmRleC5qcyIsIndlYnBhY2s6Ly8vLi9jb21tb24vbWFpbi91dGlsLmpzIiwid2VicGFjazovLy8uL2NvbW1vbi9tYWluL3V0aWwuanM/YjNmNiIsIndlYnBhY2s6Ly8vLi9jb21tb24vbWFpbi9hZGQuY3NzPzE2ZGMiLCJ3ZWJwYWNrOi8vLy4vY29tbW9uL3F1aXovcXVpei5qcyIsIndlYnBhY2s6Ly8vLi9jb21tb24vcXVpei9xdWl6LmpzPzhmZDYiLCJ3ZWJwYWNrOi8vLy4vY29tbW9uL3F1aXovcXVpei5jc3M/NjlmMSIsIndlYnBhY2s6Ly8vLi9jb21tb24vdGlwa292bmljZS9rZXlib2FyZC5qcyIsIndlYnBhY2s6Ly8vLi9jb21tb24vdGlwa292bmljZS9rZXlib2FyZC5qcz8zOWQ5Iiwid2VicGFjazovLy8uL2NvbW1vbi90aXBrb3ZuaWNlL2tleWJvYXJkLmNzcz8wOGNlIiwid2VicGFjazovLy8uL2NvbW1vbi9tZW1vcnkvbWVtb3J5LmpzIiwid2VicGFjazovLy8uL2NvbW1vbi9tZW1vcnkvbWVtb3J5LmpzPzBjNDQiLCJ3ZWJwYWNrOi8vLy4vY29tbW9uL21lbW9yeS9tZW1vcnkuY3NzPzI2OGQiLCJ3ZWJwYWNrOi8vLy4vY29tbW9uL21haW4vY29tbS9jb21tQ2xpZW50LmpzIiwid2VicGFjazovLy8uL2NvbW1vbi9tYWluL2NvbW0vY29tbUNsaWVudC5qcz9hOTQ0Iiwid2VicGFjazovLy8uL2NvbW1vbi9tYWluL2NvbW0vaXZyQ29tbS5qcyIsIndlYnBhY2s6Ly8vLi9jb21tb24vbWFpbi9jb21tL2l2ckNvbW0uanM/OGNjYiJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO1FBQUE7UUFDQTs7UUFFQTtRQUNBOztRQUVBO1FBQ0E7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QUFLLCtFQUErRSxnQ0FBZ0MsNkRBQTZELGlHQUFpRyxPQUFPLEVBQUUsbURBQW1ELHVFQUF1RSxvREFBb0QsMkJBQTJCLHFCQUFxQixPQUFPLFFBQVEsR0FBRyx3T0FBd08sT0FBTyx5SUFBeUksZ0NBQWdDLHdCQUF3QiwrQkFBK0IsaUtBQWlLLDREQUE0RCxLQUFLLDRDQUE0QywyQ0FBMkMsS0FBSywrRUFBK0UsZ0VBQWdFLHFFQUFxRSwwREFBMEQsdUNBQXVDLDBGQUEwRiw4QkFBOEIsT0FBTyxLQUFLLHNDQUFzQywrQkFBK0IseUJBQXlCLFVBQVUsOERBQThELEVBQUUsS0FBSyxnREFBZ0Qsa0RBQWtELEtBQUssR0FBRyxnRkFBZ0Ysa0ZBQWtGLEciLCJmaWxlIjoianMvaW5kZXguanMiLCJzb3VyY2VzQ29udGVudCI6WyIgXHQvLyBUaGUgbW9kdWxlIGNhY2hlXG4gXHR2YXIgaW5zdGFsbGVkTW9kdWxlcyA9IHt9O1xuXG4gXHQvLyBUaGUgcmVxdWlyZSBmdW5jdGlvblxuIFx0ZnVuY3Rpb24gX193ZWJwYWNrX3JlcXVpcmVfXyhtb2R1bGVJZCkge1xuXG4gXHRcdC8vIENoZWNrIGlmIG1vZHVsZSBpcyBpbiBjYWNoZVxuIFx0XHRpZihpbnN0YWxsZWRNb2R1bGVzW21vZHVsZUlkXSkge1xuIFx0XHRcdHJldHVybiBpbnN0YWxsZWRNb2R1bGVzW21vZHVsZUlkXS5leHBvcnRzO1xuIFx0XHR9XG4gXHRcdC8vIENyZWF0ZSBhIG5ldyBtb2R1bGUgKGFuZCBwdXQgaXQgaW50byB0aGUgY2FjaGUpXG4gXHRcdHZhciBtb2R1bGUgPSBpbnN0YWxsZWRNb2R1bGVzW21vZHVsZUlkXSA9IHtcbiBcdFx0XHRpOiBtb2R1bGVJZCxcbiBcdFx0XHRsOiBmYWxzZSxcbiBcdFx0XHRleHBvcnRzOiB7fVxuIFx0XHR9O1xuXG4gXHRcdC8vIEV4ZWN1dGUgdGhlIG1vZHVsZSBmdW5jdGlvblxuIFx0XHRtb2R1bGVzW21vZHVsZUlkXS5jYWxsKG1vZHVsZS5leHBvcnRzLCBtb2R1bGUsIG1vZHVsZS5leHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKTtcblxuIFx0XHQvLyBGbGFnIHRoZSBtb2R1bGUgYXMgbG9hZGVkXG4gXHRcdG1vZHVsZS5sID0gdHJ1ZTtcblxuIFx0XHQvLyBSZXR1cm4gdGhlIGV4cG9ydHMgb2YgdGhlIG1vZHVsZVxuIFx0XHRyZXR1cm4gbW9kdWxlLmV4cG9ydHM7XG4gXHR9XG5cblxuIFx0Ly8gZXhwb3NlIHRoZSBtb2R1bGVzIG9iamVjdCAoX193ZWJwYWNrX21vZHVsZXNfXylcbiBcdF9fd2VicGFja19yZXF1aXJlX18ubSA9IG1vZHVsZXM7XG5cbiBcdC8vIGV4cG9zZSB0aGUgbW9kdWxlIGNhY2hlXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLmMgPSBpbnN0YWxsZWRNb2R1bGVzO1xuXG4gXHQvLyBkZWZpbmUgZ2V0dGVyIGZ1bmN0aW9uIGZvciBoYXJtb255IGV4cG9ydHNcbiBcdF9fd2VicGFja19yZXF1aXJlX18uZCA9IGZ1bmN0aW9uKGV4cG9ydHMsIG5hbWUsIGdldHRlcikge1xuIFx0XHRpZighX193ZWJwYWNrX3JlcXVpcmVfXy5vKGV4cG9ydHMsIG5hbWUpKSB7XG4gXHRcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIG5hbWUsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBnZXR0ZXIgfSk7XG4gXHRcdH1cbiBcdH07XG5cbiBcdC8vIGRlZmluZSBfX2VzTW9kdWxlIG9uIGV4cG9ydHNcbiBcdF9fd2VicGFja19yZXF1aXJlX18uciA9IGZ1bmN0aW9uKGV4cG9ydHMpIHtcbiBcdFx0aWYodHlwZW9mIFN5bWJvbCAhPT0gJ3VuZGVmaW5lZCcgJiYgU3ltYm9sLnRvU3RyaW5nVGFnKSB7XG4gXHRcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFN5bWJvbC50b1N0cmluZ1RhZywgeyB2YWx1ZTogJ01vZHVsZScgfSk7XG4gXHRcdH1cbiBcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICdfX2VzTW9kdWxlJywgeyB2YWx1ZTogdHJ1ZSB9KTtcbiBcdH07XG5cbiBcdC8vIGNyZWF0ZSBhIGZha2UgbmFtZXNwYWNlIG9iamVjdFxuIFx0Ly8gbW9kZSAmIDE6IHZhbHVlIGlzIGEgbW9kdWxlIGlkLCByZXF1aXJlIGl0XG4gXHQvLyBtb2RlICYgMjogbWVyZ2UgYWxsIHByb3BlcnRpZXMgb2YgdmFsdWUgaW50byB0aGUgbnNcbiBcdC8vIG1vZGUgJiA0OiByZXR1cm4gdmFsdWUgd2hlbiBhbHJlYWR5IG5zIG9iamVjdFxuIFx0Ly8gbW9kZSAmIDh8MTogYmVoYXZlIGxpa2UgcmVxdWlyZVxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy50ID0gZnVuY3Rpb24odmFsdWUsIG1vZGUpIHtcbiBcdFx0aWYobW9kZSAmIDEpIHZhbHVlID0gX193ZWJwYWNrX3JlcXVpcmVfXyh2YWx1ZSk7XG4gXHRcdGlmKG1vZGUgJiA4KSByZXR1cm4gdmFsdWU7XG4gXHRcdGlmKChtb2RlICYgNCkgJiYgdHlwZW9mIHZhbHVlID09PSAnb2JqZWN0JyAmJiB2YWx1ZSAmJiB2YWx1ZS5fX2VzTW9kdWxlKSByZXR1cm4gdmFsdWU7XG4gXHRcdHZhciBucyA9IE9iamVjdC5jcmVhdGUobnVsbCk7XG4gXHRcdF9fd2VicGFja19yZXF1aXJlX18ucihucyk7XG4gXHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShucywgJ2RlZmF1bHQnLCB7IGVudW1lcmFibGU6IHRydWUsIHZhbHVlOiB2YWx1ZSB9KTtcbiBcdFx0aWYobW9kZSAmIDIgJiYgdHlwZW9mIHZhbHVlICE9ICdzdHJpbmcnKSBmb3IodmFyIGtleSBpbiB2YWx1ZSkgX193ZWJwYWNrX3JlcXVpcmVfXy5kKG5zLCBrZXksIGZ1bmN0aW9uKGtleSkgeyByZXR1cm4gdmFsdWVba2V5XTsgfS5iaW5kKG51bGwsIGtleSkpO1xuIFx0XHRyZXR1cm4gbnM7XG4gXHR9O1xuXG4gXHQvLyBnZXREZWZhdWx0RXhwb3J0IGZ1bmN0aW9uIGZvciBjb21wYXRpYmlsaXR5IHdpdGggbm9uLWhhcm1vbnkgbW9kdWxlc1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5uID0gZnVuY3Rpb24obW9kdWxlKSB7XG4gXHRcdHZhciBnZXR0ZXIgPSBtb2R1bGUgJiYgbW9kdWxlLl9fZXNNb2R1bGUgP1xuIFx0XHRcdGZ1bmN0aW9uIGdldERlZmF1bHQoKSB7IHJldHVybiBtb2R1bGVbJ2RlZmF1bHQnXTsgfSA6XG4gXHRcdFx0ZnVuY3Rpb24gZ2V0TW9kdWxlRXhwb3J0cygpIHsgcmV0dXJuIG1vZHVsZTsgfTtcbiBcdFx0X193ZWJwYWNrX3JlcXVpcmVfXy5kKGdldHRlciwgJ2EnLCBnZXR0ZXIpO1xuIFx0XHRyZXR1cm4gZ2V0dGVyO1xuIFx0fTtcblxuIFx0Ly8gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm8gPSBmdW5jdGlvbihvYmplY3QsIHByb3BlcnR5KSB7IHJldHVybiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwob2JqZWN0LCBwcm9wZXJ0eSk7IH07XG5cbiBcdC8vIF9fd2VicGFja19wdWJsaWNfcGF0aF9fXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLnAgPSBcIlwiO1xuXG5cbiBcdC8vIExvYWQgZW50cnkgbW9kdWxlIGFuZCByZXR1cm4gZXhwb3J0c1xuIFx0cmV0dXJuIF9fd2VicGFja19yZXF1aXJlX18oX193ZWJwYWNrX3JlcXVpcmVfXy5zID0gNCk7XG4iLCIvKlxuXHRNSVQgTGljZW5zZSBodHRwOi8vd3d3Lm9wZW5zb3VyY2Uub3JnL2xpY2Vuc2VzL21pdC1saWNlbnNlLnBocFxuXHRBdXRob3IgVG9iaWFzIEtvcHBlcnMgQHNva3JhXG4qL1xubW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbihzcmMpIHtcblx0ZnVuY3Rpb24gbG9nKGVycm9yKSB7XG5cdFx0KHR5cGVvZiBjb25zb2xlICE9PSBcInVuZGVmaW5lZFwiKVxuXHRcdCYmIChjb25zb2xlLmVycm9yIHx8IGNvbnNvbGUubG9nKShcIltTY3JpcHQgTG9hZGVyXVwiLCBlcnJvcik7XG5cdH1cblxuXHQvLyBDaGVjayBmb3IgSUUgPTwgOFxuXHRmdW5jdGlvbiBpc0lFKCkge1xuXHRcdHJldHVybiB0eXBlb2YgYXR0YWNoRXZlbnQgIT09IFwidW5kZWZpbmVkXCIgJiYgdHlwZW9mIGFkZEV2ZW50TGlzdGVuZXIgPT09IFwidW5kZWZpbmVkXCI7XG5cdH1cblxuXHR0cnkge1xuXHRcdGlmICh0eXBlb2YgZXhlY1NjcmlwdCAhPT0gXCJ1bmRlZmluZWRcIiAmJiBpc0lFKCkpIHtcblx0XHRcdGV4ZWNTY3JpcHQoc3JjKTtcblx0XHR9IGVsc2UgaWYgKHR5cGVvZiBldmFsICE9PSBcInVuZGVmaW5lZFwiKSB7XG5cdFx0XHRldmFsLmNhbGwobnVsbCwgc3JjKTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0bG9nKFwiRXZhbEVycm9yOiBObyBldmFsIGZ1bmN0aW9uIGF2YWlsYWJsZVwiKTtcblx0XHR9XG5cdH0gY2F0Y2ggKGVycm9yKSB7XG5cdFx0bG9nKGVycm9yKTtcblx0fVxufVxuIiwiXG4vKlxuICpcbiAqIE1haW4gZmlsZXMgYWx3YXlzIChyZXF1aXJlZCkgaW5jbHVkZWQgaW4gYW55IERPUyBidW5kbGVcbiAqXG4gKi9cblxuXG4vLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAvL1xuLy8gLS0tLS0tLS0tLSB1dGlsIC0tLS0tLS0tLS0gLy9cbi8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tIC8vXG5cbmltcG9ydCAnc2NyaXB0LWxvYWRlcj9zb3VyY2VNYXA9dHJ1ZSFAc3JjL2NvbW1vbi9tYWluL3V0aWwuanMnO1xuXG5pbXBvcnQgJ0BzcmMvY29tbW9uL21haW4vYWRkLmNzcyc7XG5cbi8vIFRPRE86IG1hbnVhbGx5IGltcG9ydCBpbWFnZXMgdXNlZCBvdXRzaWRlIHRoaXMgcHJvamVjdFxuLy9pbXBvcnQgJ0BzcmMvY29tbW9uL21haW4vaW1nLzEuanBnJztcblxuXG4vLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAvL1xuLy8gLS0tLS0tLS0tLSBxdWl6IC0tLS0tLS0tLS0gLy9cbi8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tIC8vXG5cbmltcG9ydCAnc2NyaXB0LWxvYWRlcj9zb3VyY2VNYXA9dHJ1ZSFAc3JjL2NvbW1vbi9xdWl6L3F1aXouanMnO1xuaW1wb3J0ICdAc3JjL2NvbW1vbi9xdWl6L3F1aXouY3NzJztcblxuXG4vLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAvL1xuLy8gLS0tLS0tLS0tLSB0aXBrb3ZuaWNlIC0tLS0tLS0tLS0gLy9cbi8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tIC8vXG5cbmltcG9ydCAnc2NyaXB0LWxvYWRlcj9zb3VyY2VNYXA9dHJ1ZSFAc3JjL2NvbW1vbi90aXBrb3ZuaWNlL2tleWJvYXJkLmpzJztcbmltcG9ydCAnQHNyYy9jb21tb24vdGlwa292bmljZS9rZXlib2FyZC5jc3MnO1xuXG5cbi8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gLy9cbi8vIC0tLS0tLS0tLS0gbWVtb3J5IC0tLS0tLS0tLS0gLy9cbi8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gLy9cblxuaW1wb3J0ICdzY3JpcHQtbG9hZGVyP3NvdXJjZU1hcD10cnVlIUBzcmMvY29tbW9uL21lbW9yeS9tZW1vcnkuanMnO1xuaW1wb3J0ICdAc3JjL2NvbW1vbi9tZW1vcnkvbWVtb3J5LmNzcyc7XG5cbi8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAvL1xuLy8gLS0tLS0tLS0tLSBjb250ZW50IG9iamVjdCBjb21tdW5pY2F0aW9uIC0tLS0tLS0tLS0tIC8vXG4vLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gLy9cblxuaW1wb3J0ICdzY3JpcHQtbG9hZGVyP3NvdXJjZU1hcD10cnVlIUBzcmMvY29tbW9uL21haW4vY29tbS9jb21tQ2xpZW50LmpzJztcbmltcG9ydCAnc2NyaXB0LWxvYWRlcj9zb3VyY2VNYXA9dHJ1ZSFAc3JjL2NvbW1vbi9tYWluL2NvbW0vaXZyQ29tbS5qcyc7XG5cblxuLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0gZXhhbXBsZXNcblxuLyogLS0gaW1wb3J0IGV2ZXJ5dGhpbmcgaW4gZm9sZGVyXG5mdW5jdGlvbiByZXF1aXJlQWxsKHIpIHsgci5rZXlzKCkuZm9yRWFjaChyKTsgfVxucmVxdWlyZUFsbChyZXF1aXJlLmNvbnRleHQoJ0BzcmMvbWFpbi9pbWcvJywgdHJ1ZSwgL1xcLmpwZyQvKSk7XG4qLyIsInJlcXVpcmUoXCIhIS92YXIvbGliL2plbmtpbnMvd29ya3NwYWNlL2FsZ2VicmEtZnJvbnRlbmQtaW50ZXJhY3Rpb25zLXRlc3Qvbm9kZV9tb2R1bGVzL3NjcmlwdC1sb2FkZXIvYWRkU2NyaXB0LmpzXCIpKHJlcXVpcmUoXCIhIS92YXIvbGliL2plbmtpbnMvd29ya3NwYWNlL2FsZ2VicmEtZnJvbnRlbmQtaW50ZXJhY3Rpb25zLXRlc3Qvbm9kZV9tb2R1bGVzL3NjcmlwdC1sb2FkZXIvbm9kZV9tb2R1bGVzL3Jhdy1sb2FkZXIvaW5kZXguanMhL3Zhci9saWIvamVua2lucy93b3Jrc3BhY2UvYWxnZWJyYS1mcm9udGVuZC1pbnRlcmFjdGlvbnMtdGVzdC9zcmMvY29tbW9uL21haW4vdXRpbC5qc1wiKSkiLCJtb2R1bGUuZXhwb3J0cyA9IFwiJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24gKCkge1xcblxcbiAgICBpZiAod2luZG93LmxvY2F0aW9uLmhyZWYuaW5kZXhPZihcXFwiaHR0cHM6Ly9kb3MtYWxhdC10ZXN0LnNlZGFtY2xvdWQuY29tL2FwaS9jcmVhdG9yP2RlcklkPTY4NCZkZXJOYW1lPW9iYXZpamVzdGlcXFwiKSA+IC0xKSB7XFxuICAgICAgICAkKFxcXCIuZG9zLWhlYWRlci10aXRsZVxcXCIpLmNzcyhcXFwidmlzaWJpbGl0eVxcXCIsIFxcXCJoaWRkZW5cXFwiKTtcXG4gICAgICAgICQoXFxcIi5kb3MtbWFpbi1pbmZvcm1hdGlvbl9fbmF2XFxcIikuY3NzKFxcXCJ2aXNpYmlsaXR5XFxcIiwgXFxcImhpZGRlblxcXCIpO1xcbiAgICB9XFxuXFxuICAgIC8qJCgnLmRvcy1idG4tc29sdXRpb24nKS5vbignY2xpY2snLCBmdW5jdGlvbiAoZXZlbnQpIHtcXG4gICAgICAgICQodGhpcykuY2xvc2VzdCgnLmRvcy1wYXJ0LXF1ZXN0aW9uJykuZmluZCgnLnF1ZXN0aW9uLWhlbHAnKS5zbGlkZVRvZ2dsZSg0MDApO1xcbiAgICB9KTsqL1xcblxcblxcbiAgICB2YXIgZm9jdXNlZFZpZDtcXG4gICAgdmFyIGFsbHZpZHMgPSAkKCd2aWRlbycpO1xcblxcbiAgICB2YXIgZm9jdXNlZEF1ZGlvO1xcbiAgICB2YXIgYWxsQXVkaW8gPSAkKCdhdWRpbycpO1xcblxcbiAgICBwYXVzZU11bHRpbWVkaWEgPSAobXVsdGltZWRpYUxpc3QsIGN1cnJlbnRQbGF5aW5nSW5kZXgpID0+IHtcXG4gICAgICAgIC8vIHBhdXNlIG11bHRpbWVkaWEsIGV4Y2VwdCBjdXJyZW50IGlmIGV4aXN0c1xcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBtdWx0aW1lZGlhTGlzdC5sZW5ndGg7IGkrKykge1xcbiAgICAgICAgICAgIGlmIChjdXJyZW50UGxheWluZ0luZGV4ID09IG51bGwgfHwgaSAhPT0gY3VycmVudFBsYXlpbmdJbmRleCkge1xcbiAgICAgICAgICAgICAgICBtdWx0aW1lZGlhTGlzdFtpXS5wYXVzZSgpO1xcbiAgICAgICAgICAgIH1cXG4gICAgICAgIH1cXG4gICAgfTtcXG5cXG4gICAgLyoqIHBsYXkgb25seSBvbmUgdmlkZW8gYXQgYSB0aW1lICoqL1xcbiAgICAkKFxcXCJ2aWRlb1xcXCIpLm9uKFxcXCJwbGF5XFxcIiwgZnVuY3Rpb24gKGV2ZW50KSB7XFxuICAgICAgICBmb2N1c2VkVmlkID0gZXZlbnQudGFyZ2V0O1xcbiAgICAgICAgdmFyIGN1cnJlbnRWaWRlb0luZGV4ID0gYWxsdmlkcy5pbmRleCh0aGlzKTtcXG5cXG4gICAgICAgIHBhdXNlTXVsdGltZWRpYShhbGx2aWRzLCBjdXJyZW50VmlkZW9JbmRleCk7XFxuICAgICAgICBwYXVzZU11bHRpbWVkaWEoYWxsQXVkaW8pO1xcbiAgICB9KTtcXG5cXG4gICAgLyoqIHBsYXkgb25seSBvbmUgYXVkaW8gYXQgYSB0aW1lICoqL1xcbiAgICAkKFxcXCJhdWRpb1xcXCIpLm9uKFxcXCJwbGF5XFxcIiwgZnVuY3Rpb24gKGV2ZW50KSB7XFxuICAgICAgICBmb2N1c2VkQXVkaW8gPSBldmVudC50YXJnZXQ7XFxuICAgICAgICB2YXIgY3VycmVudEF1ZGlvSW5kZXggPSBhbGxBdWRpby5pbmRleCh0aGlzKTtcXG5cXG4gICAgICAgIHBhdXNlTXVsdGltZWRpYShhbGxBdWRpbywgY3VycmVudEF1ZGlvSW5kZXgpO1xcbiAgICAgICAgcGF1c2VNdWx0aW1lZGlhKGFsbHZpZHMpO1xcbiAgICB9KTtcXG5cXG4gICAgJChcXFwidmlkZW9cXFwiKS5vbihcXFwiY2xpY2tcXFwiLCBmdW5jdGlvbiAoZSkge1xcbiAgICAgICAgdGhpcy5wbGF5KCk7XFxuICAgIH0pO1xcblxcbiAgICAkKFxcXCJhdWRpb1xcXCIpLm9uKFxcXCJjbGlja1xcXCIsIGZ1bmN0aW9uIChlKSB7XFxuICAgICAgICB0aGlzLnBsYXkoKTtcXG4gICAgfSk7XFxuXFxuICAgIC8vcGF1c2UgbXVsdGltZWRpYSBvbiBzbGlkZSBjaGFuZ2VcXG4gICAgJCgnLmRvcy1jb2xsZWN0aW9uLXRhc2tzLXNsaWRlcicpLm9uKCdiZWZvcmVDaGFuZ2UnLCBmdW5jdGlvbiAoc2xpY2ssIGN1cnJlbnRTbGlkZSwgbmV4dFNsaWRlKSB7XFxuICAgICAgICBjb25zdCBtdWx0aW1lZGlhRWxlbWVudHMgPSAkKHNsaWNrLmN1cnJlbnRUYXJnZXQpLmZpbmQoXFxcImF1ZGlvLCB2aWRlb1xcXCIpO1xcbiAgICAgICAgcGF1c2VNdWx0aW1lZGlhKG11bHRpbWVkaWFFbGVtZW50cyk7XFxuICAgIH0pO1xcblxcblxcbiAgICAkKGRvY3VtZW50LmJvZHkpLmJpbmQoXFxcImtleWRvd25cXFwiLCBmdW5jdGlvbiAoZSkge1xcbiAgICAgICAgaWYgKGUua2V5Q29kZSA9PT0gMjcpIHtcXG4gICAgICAgICAgICAvKiBjbG9zZSBmYW5jeWJveCBvbiBlc2MgKi9cXG4gICAgICAgICAgICB2YXIgJHRhcmdldCA9ICQoXFxcIi5pZnJhbWUtYnRuLnpvb21lZFxcXCIpO1xcblxcbiAgICAgICAgICAgIGlmICgkdGFyZ2V0KSB7XFxuICAgICAgICAgICAgICAgICR0YXJnZXQubmV4dCgpLnRvZ2dsZUNsYXNzKFxcXCJpZnJhbWUtem9vbVxcXCIpO1xcbiAgICAgICAgICAgICAgICAkdGFyZ2V0LnRvZ2dsZUNsYXNzKFxcXCJ6b29tZWRcXFwiKTtcXG4gICAgICAgICAgICAgICAgJHRhcmdldC5iZWZvcmUoJzxkaXYgY2xhc3M9XFxcImlmcmFtZS1vdmVybGF5XFxcIj48L2Rpdj4nKTtcXG4gICAgICAgICAgICAgICAgaWYgKCR0YXJnZXQuaGFzQ2xhc3MoXFxcInpvb21lZFxcXCIpKSB7XFxuICAgICAgICAgICAgICAgICAgICAkdGFyZ2V0LmJlZm9yZSgnPGRpdiBjbGFzcz1cXFwiaWZyYW1lLW92ZXJsYXlcXFwiPjwvZGl2PicpO1xcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xcbiAgICAgICAgICAgICAgICAgICAgJChcXFwiLmlmcmFtZS1vdmVybGF5XFxcIikucmVtb3ZlKCk7XFxuICAgICAgICAgICAgICAgIH1cXG4gICAgICAgICAgICB9XFxuICAgICAgICB9XFxuXFxuICAgICAgICBpZiAoZS5rZXlDb2RlID09PSAzMikge1xcbiAgICAgICAgICAgIGlmIChuYXZpZ2F0b3IudXNlckFnZW50LmluZGV4T2YoXFxcIkNocm9tZVxcXCIpICE9PSAtMSkge1xcbiAgICAgICAgICAgICAgICAvKipcXG4gICAgICAgICAgICAgICAgICAqIGNvbnNvbGUuZXJyb3IoXFxcIndlIGluIGNocm9tZSFcXFwiKTtcXG4gICAgICAgICAgICAgICAgKiBlLnByZXZlbnREZWZhdWx0KCk7XFxuICAgICAgICAgICAgICAgICAgKi9cXG4gICAgICAgICAgICAgICAgaWYgKGZvY3VzZWRWaWQgJiYgZm9jdXNlZFZpZC5wYXVzZWQgPT09IHRydWUpIHtcXG4gICAgICAgICAgICAgICAgICAgIGZvY3VzZWRWaWQucGF1c2UoKTtcXG4gICAgICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcXG4gICAgICAgICAgICAgICAgICAgIGlmIChmb2N1c2VkVmlkKSB7XFxuICAgICAgICAgICAgICAgICAgICAgICAgZm9jdXNlZFZpZC5wbGF5KCk7XFxuICAgICAgICAgICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xcbiAgICAgICAgICAgICAgICAgICAgfVxcbiAgICAgICAgICAgICAgICB9XFxuICAgICAgICAgICAgfVxcbiAgICAgICAgfVxcbiAgICB9KTtcXG5cXG4gICAgJChcXFwiaW5wdXRcXFwiKS5mb2N1cyhmdW5jdGlvbiAoKSB7XFxuICAgICAgICBmb2N1c2VkVmlkID0gXFxcIlxcXCI7XFxuICAgICAgICBmb2N1c2VkQXVkaW8gPSBcXFwiXFxcIjtcXG4gICAgfSk7XFxuXFxuXFxuICAgIC8qIFF1aXogaGFuZGxlcnMgc3RhcnQgKi9cXG4gICAgJChcXFwiLnRha2UtdGVzdCAuYnRuXFxcIikuY2xpY2soZnVuY3Rpb24gKCkge1xcblxcbiAgICAgICAgJChcXFwiI2tub3dsZWRnZS1hc3Nlc3NtZW50XFxcIikudG9nZ2xlKFxcXCJmYXN0XFxcIiwgZnVuY3Rpb24gKCkge1xcbiAgICAgICAgICAgIC8qIGNvbnNvbGUubG9nKFxcXCJjb21wbGV0ZWQgdG9nZ2xlXFxcIik7ICovXFxuICAgICAgICAgICAgJChcXFwiI2tub3dsZWRnZS1hc3Nlc3NtZW50XFxcIikuZmluZCgnZGl2W2RhdGEtcXVlc3Rpb24tdHlwZT1cXFwiUG92bGE/P2VuamUgcmlqZT8/aVxcXCJdJykuZWFjaChmdW5jdGlvbiAoKSB7XFxuICAgICAgICAgICAgICAgIGFkanVzdERyb3B6b25lRGltZW5zaW9ucygkKHRoaXMpLmF0dHIoJ2lkJykpO1xcbiAgICAgICAgICAgIH0pO1xcbiAgICAgICAgfSk7XFxuICAgICAgICAkKFxcXCJzZWN0aW9uLnRha2UtdGVzdFxcXCIpLnRvZ2dsZUNsYXNzKFxcXCJvcGVuZWRcXFwiKTtcXG4gICAgfSk7XFxuXFxuICAgICQoXFxcImJ1dHRvbiNmaW5pc2gtdGVzdFxcXCIpLmNsaWNrKGZ1bmN0aW9uICgpIHtcXG4gICAgICAgICQoXFxcIiN1bml0LXRlc3QtZmluaXNoZWRcXFwiKS5zaG93KFxcXCJmYXN0XFxcIik7XFxuICAgIH0pO1xcblxcbiAgICBpZiAodHlwZW9mIFdlYlZ0dEhlbHBlciA9PT0gXFxcImZ1bmN0aW9uXFxcIikge1xcbiAgICAgICAgKG5ldyBXZWJWdHRIZWxwZXIpLmdlbmVyYXRlVlRUQ3VlcygpO1xcbiAgICB9XFxuXFxuICAgICQoXFxcIi5waWxsXFxcIikud2F0Y2goe1xcbiAgICAgICAgLyogc3BlY2lmeSBDU1Mgc3R5bGVzIG9yIGF0dHJpYnV0ZSBuYW1lcyB0byBtb25pdG9yICovXFxuICAgICAgICBwcm9wZXJ0aWVzOiBcXFwiYXR0cl9kYXRhLWRyYWdnZWQtZ3JvdXAtdmFsdWVcXFwiLFxcblxcbiAgICAgICAgLyogY2FsbGJhY2sgZnVuY3Rpb24gd2hlbiBhIGNoYW5nZSBpcyBkZXRlY3RlZCAqL1xcbiAgICAgICAgY2FsbGJhY2s6IGZ1bmN0aW9uIChkYXRhLCBpKSB7XFxuICAgICAgICAgICAgLy8gJCh0aGlzKS5zaWJsaW5ncygnLnBpbGxbZGF0YS1kcmFnZ2VkLWdyb3VwLXZhbHVlPVxcXCItMVxcXCJdJykuaGlkZSgpO1xcbiAgICAgICAgICAgIC8vICQodGhpcykuc2libGluZ3MoJy5waWxsW2RhdGEtZHJhZ2dlZC1ncm91cC12YWx1ZT1cXFwiLTFcXFwiXTpmaXJzdCcpLmNzcygnZGlzcGxheScsICdpbmxpbmUtYmxvY2snKTtcXG4gICAgICAgICAgICAkKHRoaXMpLnNpYmxpbmdzKCcucGlsbFtkYXRhLWRyYWdnZWQtZ3JvdXAtdmFsdWU9XFxcIi0xXFxcIl06Zmlyc3QnKS5jc3MoJ3Bvc2l0aW9uJywgJ2Fic29sdXRlJyk7XFxuICAgICAgICB9XFxuICAgIH0pO1xcblxcbiAgICAvKiBRdWl6IGhhbmRsZXJzIHN0b3AgKi9cXG5cXG5cXG4gICAgLyoqXFxuICAgICAqIEFkZHMgYXBwcm9wcmlhdGUgY2xhc3NlcyB0byB0ZXh0IGFuZCBudW1lcmljIGlucHV0cywgc28gdGhhdCB0aGV5IGNhbiBiZSBzaXplZCBhcHByb3ByaWF0ZWx5XFxuICAgICAqIGZvciBleGFtcGxlLCBpZiB0aGUgbG9uZ2VzdCBwb3NzaWJsZSBhbnN3ZXIgaXMgXFxcInJlZFxcXCIsIHRoZSBpbnB1dCBmaWVsZCBpcyBzbWFsbGVyIGlmIHRoZSBsb25nZXN0IHBvc3NpYmxlIGlzIFxcXCJvdG9yaW5vbGFyaW5nb2xvZ2lqYVxcXCJcXG4gICAgICovXFxuICAgIGZ1bmN0aW9uIGFkZENsYXNzZXNUb1RleHRJbnB1dHMoKSB7XFxuXFxuICAgICAgICB2YXIgaW5wdXRzID0gJChcXFwiaW5wdXRbdHlwZT0ndGV4dCddW2RhdGEtY29ycmVjdC1kYXRhXVxcXCIpO1xcblxcbiAgICAgICAgZnVuY3Rpb24gYWRkQ2xhc3MoY2xhc3NuYW1lLCBlbGVtZW50KSB7XFxuICAgICAgICAgICAgZWxlbWVudC5jbGFzc05hbWUgKz0gY2xhc3NuYW1lO1xcbiAgICAgICAgfVxcblxcbiAgICAgICAgLyogY29uc29sZS5sb2coaW5wdXRzLmxlbmd0aCk7ICovXFxuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGlucHV0cy5sZW5ndGg7IGkrKykge1xcblxcblxcbiAgICAgICAgICAgIC8qKlxcbiAgICAgICAgICAgICAqIERhdGEtY29ycmVjdC1kYXRhIGNhbiBoYXZlIG11bHRpcGxlIG9wdGlvbnMsIHdlIG5lZWQgdG8gcGFyc2UgdGhlbVxcbiAgICAgICAgICAgICAqIHdlIGFzc3VtZSB0aGF0IDsgaXMgbmV2ZXIgYSBjb3JyZWN0IGFuc3dlclxcbiAgICAgICAgICAgICAqL1xcblxcbiAgICAgICAgICAgIHZhciBjb3JyZWN0YW5zd2VycyA9IGlucHV0c1tpXS5nZXRBdHRyaWJ1dGUoXFxcImRhdGEtY29ycmVjdC1kYXRhXFxcIikuc3BsaXQoXFxcIjtcXFwiKTtcXG4gICAgICAgICAgICB2YXIgbG9uZ2VzdENvcnJlY3RBbnN3ZXIgPSAwO1xcbiAgICAgICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgY29ycmVjdGFuc3dlcnMubGVuZ3RoOyBqKyspIHtcXG4gICAgICAgICAgICAgICAgLyogY29uc29sZS5sb2coaiArIFxcXCIuIGNvcnJlY3QgYW5zd2VyIGlzIFxcXCIgKyBjb3JyZWN0YW5zd2Vyc1tqXSArIFxcXCJhbmQgaXRzIGxlbmd0aCBpcyBcXFwiICsgY29ycmVjdGFuc3dlcnNbal0ubGVuZ3RoKTsgKi9cXG4gICAgICAgICAgICAgICAgaWYgKGNvcnJlY3RhbnN3ZXJzW2pdLmxlbmd0aCA+IGxvbmdlc3RDb3JyZWN0QW5zd2VyKSB7XFxuICAgICAgICAgICAgICAgICAgICBsb25nZXN0Q29ycmVjdEFuc3dlciA9IGNvcnJlY3RhbnN3ZXJzW2pdLmxlbmd0aDtcXG4gICAgICAgICAgICAgICAgfVxcbiAgICAgICAgICAgIH1cXG4gICAgICAgICAgICAvKiBjb25zb2xlLmxvZyhcXFwibG9uZ2VzdCBjb3JyZWN0IGlzIFxcXCIgKyBsb25nZXN0Q29ycmVjdEFuc3dlcik7ICovXFxuICAgICAgICAgICAgaWYgKGxvbmdlc3RDb3JyZWN0QW5zd2VyIDw9IDMpIHtcXG4gICAgICAgICAgICAgICAgYWRkQ2xhc3MoXFxcImxlbmd0aC10aW55XFxcIiwgaW5wdXRzW2ldKTtcXG4gICAgICAgICAgICB9XFxuICAgICAgICAgICAgZWxzZSBpZiAobG9uZ2VzdENvcnJlY3RBbnN3ZXIgPD0gNikge1xcbiAgICAgICAgICAgICAgICBhZGRDbGFzcyhcXFwibGVuZ3RoLXNtYWxsXFxcIiwgaW5wdXRzW2ldKTtcXG4gICAgICAgICAgICAgICAgLyogY29uc29sZS5sb2cgKFxcXCJ5b3Ugc2hvdWxkIGJlIHNtYWxsXFxcIik7ICovXFxuICAgICAgICAgICAgfVxcbiAgICAgICAgICAgIGVsc2UgaWYgKGxvbmdlc3RDb3JyZWN0QW5zd2VyIDw9IDEwKSB7XFxuICAgICAgICAgICAgICAgIGFkZENsYXNzKFxcXCJsZW5ndGgtbWVkaXVtXFxcIiwgaW5wdXRzW2ldKTtcXG4gICAgICAgICAgICAgICAgLyogY29uc29sZS5sb2coXFxcInlvdSBzaG91bGQgYmUgbWVkaXVtXFxcIik7ICovXFxuICAgICAgICAgICAgfVxcbiAgICAgICAgICAgIGVsc2UgaWYgKGxvbmdlc3RDb3JyZWN0QW5zd2VyIDw9IDE1KSB7XFxuICAgICAgICAgICAgICAgIGFkZENsYXNzKFxcXCJsZW5ndGgtbG9uZ1xcXCIsIGlucHV0c1tpXSk7XFxuICAgICAgICAgICAgICAgIC8qIGNvbnNvbGUubG9nKFxcXCJ5b3Ugc2hvdWxkIGJlIGxvbmdcXFwiKTsgKi9cXG4gICAgICAgICAgICB9XFxuICAgICAgICAgICAgZWxzZSB7XFxuICAgICAgICAgICAgICAgIGFkZENsYXNzKFxcXCJsZW5ndGgtdmVyeWxvbmdcXFwiLCBpbnB1dHNbaV0pO1xcbiAgICAgICAgICAgICAgICAvKiBjb25zb2xlLmxvZyAoXFxcInlvdSBhcmUgdmVyeSBsb25nXFxcIik7ICovXFxuICAgICAgICAgICAgfVxcblxcblxcbiAgICAgICAgfVxcbiAgICB9XFxuXFxuICAgIGZ1bmN0aW9uIGFkZENsYXNzZXNUb051bWJlcklucHV0cygpIHtcXG5cXG4gICAgICAgIC8qIGFsbCBoYXZlIGRhdGEtbWludmFsdWUgKi9cXG4gICAgICAgIHZhciBpbnB1dHMgPSAkKFxcXCJpbnB1dFt0eXBlPSdudW1iZXInXVtkYXRhLW1pbnZhbHVlXVxcXCIpO1xcblxcbiAgICAgICAgZnVuY3Rpb24gYWRkQ2xhc3MoY2xhc3NuYW1lLCBlbGVtZW50KSB7XFxuICAgICAgICAgICAgZWxlbWVudC5jbGFzc05hbWUgKz0gY2xhc3NuYW1lO1xcbiAgICAgICAgfVxcblxcbiAgICAgICAgLyogY29uc29sZS5sb2coaW5wdXRzLmxlbmd0aCk7ICovXFxuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGlucHV0cy5sZW5ndGg7IGkrKykge1xcblxcblxcbiAgICAgICAgICAgIC8qKlxcbiAgICAgICAgICAgICAqIERhdGEtY29ycmVjdC1kYXRhIGNhbiBoYXZlIG11bHRpcGxlIG9wdGlvbnMsIHdlIG5lZWQgdG8gcGFyc2UgdGhlbVxcbiAgICAgICAgICAgICAqIHdlIGFzc3VtZSB0aGF0IDsgaXMgbmV2ZXIgYSBjb3JyZWN0IGFuc3dlclxcbiAgICAgICAgICAgICAqL1xcblxcbiAgICAgICAgICAgIHZhciBjb3JyZWN0TWluVmFsdWUgPSBpbnB1dHNbaV0uZ2V0QXR0cmlidXRlKFxcXCJkYXRhLW1pbnZhbHVlXFxcIik7XFxuICAgICAgICAgICAgdmFyIGNvcnJlY3RNYXhWYWx1ZSA9IGlucHV0c1tpXS5nZXRBdHRyaWJ1dGUoXFxcImRhdGEtbWF4dmFsdWVcXFwiKTtcXG4gICAgICAgICAgICB2YXIgbG9uZ2VzdENvcnJlY3RBbnN3ZXIgPSAwO1xcblxcbiAgICAgICAgICAgIGNvcnJlY3RNaW5WYWx1ZSA9IGNvcnJlY3RNaW5WYWx1ZS50b1N0cmluZygpO1xcbiAgICAgICAgICAgIGNvcnJlY3RNYXhWYWx1ZSA9IGNvcnJlY3RNYXhWYWx1ZS50b1N0cmluZygpO1xcbiAgICAgICAgICAgIGlmIChjb3JyZWN0TWluVmFsdWUubGVuZ3RoID4gY29ycmVjdE1heFZhbHVlLmxlbmd0aCkge1xcbiAgICAgICAgICAgICAgICBsb25nZXN0Q29ycmVjdEFuc3dlciA9IGNvcnJlY3RNaW5WYWx1ZS5sZW5ndGg7XFxuICAgICAgICAgICAgfVxcbiAgICAgICAgICAgIGVsc2UgaWYgKGNvcnJlY3RNYXhWYWx1ZS5sZW5ndGggPiBjb3JyZWN0TWluVmFsdWUubGVuZ3RoKSB7XFxuICAgICAgICAgICAgICAgIGxvbmdlc3RDb3JyZWN0QW5zd2VyID0gY29ycmVjdE1heFZhbHVlLmxlbmd0aDtcXG4gICAgICAgICAgICB9XFxuICAgICAgICAgICAgZWxzZSB7XFxuICAgICAgICAgICAgICAgIGxvbmdlc3RDb3JyZWN0QW5zd2VyID0gY29ycmVjdE1heFZhbHVlLmxlbmd0aDtcXG4gICAgICAgICAgICB9XFxuXFxuICAgICAgICAgICAgLyogY29uc29sZS5sb2coXFxcImxvbmdlc3QgY29ycmVjdCBpcyBcXFwiICsgbG9uZ2VzdENvcnJlY3RBbnN3ZXIpOyAqL1xcbiAgICAgICAgICAgIGlmIChsb25nZXN0Q29ycmVjdEFuc3dlciA8PSAzKSB7XFxuICAgICAgICAgICAgICAgIGFkZENsYXNzKFxcXCJsZW5ndGgtdGlueVxcXCIsIGlucHV0c1tpXSk7XFxuICAgICAgICAgICAgfVxcbiAgICAgICAgICAgIGVsc2UgaWYgKGxvbmdlc3RDb3JyZWN0QW5zd2VyIDw9IDYpIHtcXG4gICAgICAgICAgICAgICAgYWRkQ2xhc3MoXFxcImxlbmd0aC1zbWFsbFxcXCIsIGlucHV0c1tpXSk7XFxuICAgICAgICAgICAgICAgIC8qIGNvbnNvbGUubG9nIChcXFwieW91IHNob3VsZCBiZSBzbWFsbFxcXCIpOyAqL1xcbiAgICAgICAgICAgIH1cXG4gICAgICAgICAgICBlbHNlIGlmIChsb25nZXN0Q29ycmVjdEFuc3dlciA8PSAxMCkge1xcbiAgICAgICAgICAgICAgICBhZGRDbGFzcyhcXFwibGVuZ3RoLW1lZGl1bVxcXCIsIGlucHV0c1tpXSk7XFxuICAgICAgICAgICAgICAgIC8qIGNvbnNvbGUubG9nKFxcXCJ5b3Ugc2hvdWxkIGJlIG1lZGl1bVxcXCIpOyAqL1xcbiAgICAgICAgICAgIH1cXG4gICAgICAgICAgICBlbHNlIGlmIChsb25nZXN0Q29ycmVjdEFuc3dlciA8PSAxNSkge1xcbiAgICAgICAgICAgICAgICBhZGRDbGFzcyhcXFwibGVuZ3RoLWxvbmdcXFwiLCBpbnB1dHNbaV0pO1xcbiAgICAgICAgICAgICAgICAvKiBjb25zb2xlLmxvZyhcXFwieW91IHNob3VsZCBiZSBsb25nXFxcIik7ICovXFxuICAgICAgICAgICAgfVxcbiAgICAgICAgICAgIGVsc2Uge1xcbiAgICAgICAgICAgICAgICBhZGRDbGFzcyhcXFwibGVuZ3RoLXZlcnlsb25nXFxcIiwgaW5wdXRzW2ldKTtcXG4gICAgICAgICAgICAgICAgLyogY29uc29sZS5sb2cgKFxcXCJ5b3UgYXJlIHZlcnkgbG9uZ1xcXCIpOyAqL1xcbiAgICAgICAgICAgIH1cXG5cXG5cXG4gICAgICAgIH1cXG4gICAgfVxcbiAgICAvKipcXG4gICAgICogTnVtZXJpYyBpbnB1dHMgYXJlIGlucHV0cyBvZiB0eXBlIHRleHQgd2hvc2UgaW5wdXQgaXMgcmVzdHJpY3RlZCB0byBudW1iZXJzIGFuZCBvdGhlciBtYXRoIGNoYXJhY3RlcnNcXG4gICAgICogaW5wdXQgdHlwZSBudW1iZXIgcmV0dXJucyBlbXB0eSBzdHJpbmcgd2hlbiAnLicgb3IgJywnIGlzIHVzZWQsIGRlcGVuZGluZyBvbiBicm93c2VyIHNldHRpbmdzLCBzb1xcbiAgICAgKiB3ZSBhIGN1c3RvbSwgJ251bWVyaWMnIGlucHV0IGlzIHVzZWRcXG4gICAgICovXFxuXFxuICAgIGZ1bmN0aW9uIGFkZENsYXNzZXNUb051bWVyaWNJbnB1dHMoKSB7XFxuXFxuICAgICAgICAvKiBhbGwgaGF2ZSBkYXRhLW1pbnZhbHVlICovXFxuICAgICAgICB2YXIgaW5wdXRzID0gJChcXFwiaW5wdXRbdHlwZT0ndGV4dCddW2RhdGEtbWludmFsdWVdXFxcIik7XFxuXFxuICAgICAgICBmdW5jdGlvbiBhZGRDbGFzcyhjbGFzc25hbWUsIGVsZW1lbnQpIHtcXG4gICAgICAgICAgICBlbGVtZW50LmNsYXNzTmFtZSArPSBjbGFzc25hbWU7XFxuICAgICAgICB9XFxuXFxuICAgICAgICAvKiBjb25zb2xlLmxvZyhpbnB1dHMubGVuZ3RoKTsgKi9cXG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgaW5wdXRzLmxlbmd0aDsgaSsrKSB7XFxuXFxuXFxuICAgICAgICAgICAgLyoqXFxuICAgICAgICAgICAgICogRGF0YS1jb3JyZWN0LWRhdGEgY2FuIGhhdmUgbXVsdGlwbGUgb3B0aW9ucywgd2UgbmVlZCB0byBwYXJzZSB0aGVtXFxuICAgICAgICAgICAgICogd2UgYXNzdW1lIHRoYXQgOyBpcyBuZXZlciBhIGNvcnJlY3QgYW5zd2VyXFxuICAgICAgICAgICAgICovXFxuXFxuICAgICAgICAgICAgdmFyIGNvcnJlY3RNaW5WYWx1ZSA9IGlucHV0c1tpXS5nZXRBdHRyaWJ1dGUoXFxcImRhdGEtbWludmFsdWVcXFwiKTtcXG4gICAgICAgICAgICB2YXIgY29ycmVjdE1heFZhbHVlID0gaW5wdXRzW2ldLmdldEF0dHJpYnV0ZShcXFwiZGF0YS1tYXh2YWx1ZVxcXCIpO1xcbiAgICAgICAgICAgIHZhciBsb25nZXN0Q29ycmVjdEFuc3dlciA9IDA7XFxuXFxuICAgICAgICAgICAgY29ycmVjdE1pblZhbHVlID0gY29ycmVjdE1pblZhbHVlLnRvU3RyaW5nKCk7XFxuICAgICAgICAgICAgY29ycmVjdE1heFZhbHVlID0gY29ycmVjdE1heFZhbHVlLnRvU3RyaW5nKCk7XFxuICAgICAgICAgICAgaWYgKGNvcnJlY3RNaW5WYWx1ZS5sZW5ndGggPiBjb3JyZWN0TWF4VmFsdWUubGVuZ3RoKSB7XFxuICAgICAgICAgICAgICAgIGxvbmdlc3RDb3JyZWN0QW5zd2VyID0gY29ycmVjdE1pblZhbHVlLmxlbmd0aDtcXG4gICAgICAgICAgICB9XFxuICAgICAgICAgICAgZWxzZSBpZiAoY29ycmVjdE1heFZhbHVlLmxlbmd0aCA+IGNvcnJlY3RNaW5WYWx1ZS5sZW5ndGgpIHtcXG4gICAgICAgICAgICAgICAgbG9uZ2VzdENvcnJlY3RBbnN3ZXIgPSBjb3JyZWN0TWF4VmFsdWUubGVuZ3RoO1xcbiAgICAgICAgICAgIH1cXG4gICAgICAgICAgICBlbHNlIHtcXG4gICAgICAgICAgICAgICAgbG9uZ2VzdENvcnJlY3RBbnN3ZXIgPSBjb3JyZWN0TWF4VmFsdWUubGVuZ3RoO1xcbiAgICAgICAgICAgIH1cXG5cXG4gICAgICAgICAgICAvKiBjb25zb2xlLmxvZyhcXFwibG9uZ2VzdCBjb3JyZWN0IGlzIFxcXCIgKyBsb25nZXN0Q29ycmVjdEFuc3dlcik7ICovXFxuICAgICAgICAgICAgaWYgKGxvbmdlc3RDb3JyZWN0QW5zd2VyIDw9IDMpIHtcXG4gICAgICAgICAgICAgICAgYWRkQ2xhc3MoXFxcImxlbmd0aC10aW55XFxcIiwgaW5wdXRzW2ldKTtcXG4gICAgICAgICAgICB9XFxuICAgICAgICAgICAgZWxzZSBpZiAobG9uZ2VzdENvcnJlY3RBbnN3ZXIgPD0gNikge1xcbiAgICAgICAgICAgICAgICBhZGRDbGFzcyhcXFwibGVuZ3RoLXNtYWxsXFxcIiwgaW5wdXRzW2ldKTtcXG4gICAgICAgICAgICAgICAgLyogY29uc29sZS5sb2cgKFxcXCJ5b3Ugc2hvdWxkIGJlIHNtYWxsXFxcIik7ICovXFxuICAgICAgICAgICAgfVxcbiAgICAgICAgICAgIGVsc2UgaWYgKGxvbmdlc3RDb3JyZWN0QW5zd2VyIDw9IDEwKSB7XFxuICAgICAgICAgICAgICAgIGFkZENsYXNzKFxcXCJsZW5ndGgtbWVkaXVtXFxcIiwgaW5wdXRzW2ldKTtcXG4gICAgICAgICAgICAgICAgLyogY29uc29sZS5sb2coXFxcInlvdSBzaG91bGQgYmUgbWVkaXVtXFxcIik7ICovXFxuICAgICAgICAgICAgfVxcbiAgICAgICAgICAgIGVsc2UgaWYgKGxvbmdlc3RDb3JyZWN0QW5zd2VyIDw9IDE1KSB7XFxuICAgICAgICAgICAgICAgIGFkZENsYXNzKFxcXCJsZW5ndGgtbG9uZ1xcXCIsIGlucHV0c1tpXSk7XFxuICAgICAgICAgICAgICAgIC8qIGNvbnNvbGUubG9nKFxcXCJ5b3Ugc2hvdWxkIGJlIGxvbmdcXFwiKTsgKi9cXG4gICAgICAgICAgICB9XFxuICAgICAgICAgICAgZWxzZSB7XFxuICAgICAgICAgICAgICAgIGFkZENsYXNzKFxcXCJsZW5ndGgtdmVyeWxvbmdcXFwiLCBpbnB1dHNbaV0pO1xcbiAgICAgICAgICAgICAgICAvKiBjb25zb2xlLmxvZyAoXFxcInlvdSBhcmUgdmVyeSBsb25nXFxcIik7ICovXFxuICAgICAgICAgICAgfVxcblxcblxcbiAgICAgICAgfVxcbiAgICB9XFxuXFxuICAgIC8qYWRkQ2xhc3Nlc1RvVGV4dElucHV0cygpO1xcbiAgICBhZGRDbGFzc2VzVG9OdW1iZXJJbnB1dHMoKTtcXG4gICAgYWRkQ2xhc3Nlc1RvTnVtZXJpY0lucHV0cygpO1xcbiAgICAqL1xcblxcbiAgICAvKiBzZWxlY3QgdGhlIHRhcmdldCBub2RlICovXFxuICAgIHZhciB0YXJnZXQgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZShcXFwidGl0bGVcXFwiKTtcXG4gICAgdmFyIG9yaWdpbmFsVGl0bGUgPSBkb2N1bWVudC50aXRsZTtcXG5cXG4gICAgZnVuY3Rpb24gY2hhbmdlVGl0bGUoKSB7XFxuICAgICAgICBkb2N1bWVudC50aXRsZSA9IG9yaWdpbmFsVGl0bGU7XFxuICAgIH1cXG5cXG4gICAgLyogY3JlYXRlIGFuIG9ic2VydmVyIGluc3RhbmNlICovXFxuICAgIHZhciBvYnNlcnZlciA9IG5ldyBNdXRhdGlvbk9ic2VydmVyKGZ1bmN0aW9uIChtdXRhdGlvbnMpIHtcXG4gICAgICAgIG11dGF0aW9ucy5mb3JFYWNoKGZ1bmN0aW9uIChtdXRhdGlvbikge1xcbiAgICAgICAgICAgIGlmIChkb2N1bWVudC50aXRsZSAhPT0gb3JpZ2luYWxUaXRsZSkge1xcbiAgICAgICAgICAgICAgICBjaGFuZ2VUaXRsZSgpO1xcbiAgICAgICAgICAgIH1cXG4gICAgICAgICAgICAvKiBUcmVhdCB0aGUgbXV0YXRpb24gaGVyZS4gVXNlIG11dGF0aW9uLnR5cGUgdG8gc2VlIHdoYXQgaGFwcGVuZWQuICovXFxuICAgICAgICB9KTtcXG4gICAgfSk7XFxuXFxuICAgIC8qIGNvbmZpZ3VyYXRpb24gb2YgdGhlIG9ic2VydmVyOiAqL1xcbiAgICB2YXIgY29uZmlnID0geyBhdHRyaWJ1dGVzOiB0cnVlLCBjaGlsZExpc3Q6IHRydWUsIGNoYXJhY3RlckRhdGE6IHRydWUgfTtcXG5cXG4gICAgLyogcGFzcyBpbiB0aGUgdGFyZ2V0IG5vZGUsIGFzIHdlbGwgYXMgdGhlIG9ic2VydmVyIG9wdGlvbnMgKi9cXG4gICAgb2JzZXJ2ZXIub2JzZXJ2ZSh0YXJnZXRbMF0sIGNvbmZpZyk7XFxuXFxuXFxuXFxuICAgIHZhciByZW5kZXJNYXRoID0gZnVuY3Rpb24gKCkge1xcbiAgICAgICAgTWF0aEpheC5IdWIuUXVldWUoW1xcXCJUeXBlc2V0XFxcIiwgTWF0aEpheC5IdWJdKTtcXG4gICAgfTtcXG5cXG4gICAgdmFyIGlzTWF0aFJlbmRlcmVkID0gZmFsc2U7XFxuXFxuICAgICQoJ21hdGgnKS5jbGljayhmdW5jdGlvbiAoKSB7XFxuICAgICAgICBpZiAoIWlzTWF0aFJlbmRlcmVkKSB7XFxuICAgICAgICAgICAgcmVuZGVyTWF0aCgpO1xcbiAgICAgICAgICAgIGlzTWF0aFJlbmRlcmVkID0gdHJ1ZTtcXG4gICAgICAgIH1cXG4gICAgfSk7XFxuXFxuICAgICQoJ2JvZHkgLmJ0bi1hdWRpby1hbHRlcm5hdGl2ZScpLm9uKCdjbGljaycsIGZ1bmN0aW9uICgpIHtcXG4gICAgICAgICQodGhpcykuY2xvc2VzdCgnLmF1ZGlvLWFsdGVybmF0aXZlLWNvbnRhaW5lcicpLmZpbmQoJy5idG4tYXVkaW8tYWx0ZXJuYXRpdmUtdG9nZ2xlJykuc2xpZGVUb2dnbGUoKTtcXG4gICAgfSk7XFxuXFxuICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgeyB3aW5kb3cuZGlzcGF0Y2hFdmVudChuZXcgRXZlbnQoJ3Jlc2l6ZScpKTsgfSwgMzAwMCk7XFxuXFxuICAgIC8vIGF0dGFjaCBzY3JvbGwgY2xpZW50IHRvIGVhY2ggSVZSIGludGVyYWN0aW9uXFxuICAgICQoJy5pbnRlcmFjdGlvbi1yZXNpemUtY29udGFpbmVyIGlmcmFtZScpLmVhY2goKGlkeCwgaW50ZXJhY3Rpb25FbCkgPT4ge1xcbiAgICAgICAgbmV3IFNjcm9sbFZpc2libGVJdnJDb250ZW50Q29tbUNsaWVudChpbnRlcmFjdGlvbkVsLmlkKTtcXG4gICAgfSlcXG59KVxcblwiIiwiLy8gZXh0cmFjdGVkIGJ5IG1pbmktY3NzLWV4dHJhY3QtcGx1Z2luIiwicmVxdWlyZShcIiEhL3Zhci9saWIvamVua2lucy93b3Jrc3BhY2UvYWxnZWJyYS1mcm9udGVuZC1pbnRlcmFjdGlvbnMtdGVzdC9ub2RlX21vZHVsZXMvc2NyaXB0LWxvYWRlci9hZGRTY3JpcHQuanNcIikocmVxdWlyZShcIiEhL3Zhci9saWIvamVua2lucy93b3Jrc3BhY2UvYWxnZWJyYS1mcm9udGVuZC1pbnRlcmFjdGlvbnMtdGVzdC9ub2RlX21vZHVsZXMvc2NyaXB0LWxvYWRlci9ub2RlX21vZHVsZXMvcmF3LWxvYWRlci9pbmRleC5qcyEvdmFyL2xpYi9qZW5raW5zL3dvcmtzcGFjZS9hbGdlYnJhLWZyb250ZW5kLWludGVyYWN0aW9ucy10ZXN0L3NyYy9jb21tb24vcXVpei9xdWl6LmpzXCIpKSIsIm1vZHVsZS5leHBvcnRzID0gXCIvKipcXG4gKmVuYWJsZUJsb2F0IGlzIGEgdmFyaWFibGUgdGhhdCBlbmFibGVzIG9yIGRpc2FibGVzIHVubmVjZXNzYXJ5IGZlYXR1cmVzLlxcbiAqSWYgeW91IHdpc2ggdG8gZGlzYWJsZSB0aGVtLCBzaW1wbHkgY2hhbmdlIGVuYWJsZUJsb2F0IHRvIGZhbHNlLlxcbiAqXFxuICpUaGUgZmVhdHVyZXMgYXMgb2Ygbm93IGFmZmVjdGVkOlxcbiAqXFxuICogLSBGb3JiaWRkaW5nIGRyb3BzIG91dHNpZGUgZHJvcHpvbmVzIGluIGRyYWcgYW5kIGRyb3AgcXVpenplc1xcbiAqL1xcbmNvbnN0IHF1ZXN0aW9uVHlwZXMgPSB7XFxuXFx0dHJ1ZWZhbHNlOiBcXFwiRGEvTmVcXFwiLFxcblxcdHBhaXI6IFxcXCJKZWRhbiB0b8SNYW4gb2Rnb3ZvclxcXCIsXFxuXFx0bXVsdGk6IFxcXCJWacWhZXN0cnVraSBvZGFiaXJcXFwiLFxcblxcdG1hdGNoaW5nOiBcXFwiVXBhcml2YW5qZSBvZGdvdm9yYVxcXCIsXFxuXFx0d29yZEluc2VydDogXFxcIlVwaXNpdmFuamUgcmlqZcSNaVxcXCIsXFxuXFx0aW5zZXJ0V29yZFRvRWxlbWVudDogXFxcIlVwaXNpdmFuamUgdSBlbGVtZW50ZVxcXCIsXFxuXFx0d29yZFNlbGVjdDogXFxcIk9kYWJpcmFuamUgcmlqZcSNaVxcXCIsXFxuXFx0ZHJhZ0VsZW1lbnRzOiBcXFwiUG92bGHEjWVuamUgcmlqZcSNaVxcXCIsXFxuXFx0ZHJhZ1BhaXJzOiBcXFwiUG92bGHEjWVuamUgcGFyb3ZhXFxcIixcXG5cXHRkcmFnU29ydEVsZW1lbnRzOiBcXFwiUmF6dnJzdGF2YW5qZSBlbGVtZW5hdGFcXFwiLFxcblxcdGRyYWdPcmRlckVsZW1lbnRzOiBcXFwiVXJlxJFpdmFuamUgcG9yZXRrYSBlbGVtZW5hdGFcXFwiLFxcblxcdG51bWVyaWNWYWx1ZTogXFxcIk51bWVyacSNa2lcXFwiLFxcblxcdGRyYWdPblBpY3R1cmU6IFxcXCJQb3ZsYcSNZW5qZSBuYSBzbGlrdVxcXCIsXFxuXFx0cmVwbDogXFxcIlJFUEwgemFkYXRha1xcXCJcXG59O1xcblxcbnZhciBlbmFibGVCbG9hdCA9IHRydWU7XFxuXFxuY29uc3QgVVBJVE5JS0hJTlRQQVRIID0gXFxcIi4uL2ltZy9pbmZvcm1hdGlrYS91cGl0bmlrLWhpbnQuc3ZnXFxcIjtcXG4vL2ZvciBpbnRlcm5ldCBleHBsb3JlclxcbmlmICghU3RyaW5nLnByb3RvdHlwZS5pbmNsdWRlcykge1xcblxcdFN0cmluZy5wcm90b3R5cGUuaW5jbHVkZXMgPSBmdW5jdGlvbiAoc2VhcmNoLCBzdGFydCkge1xcblxcdFxcdGlmICh0eXBlb2Ygc3RhcnQgIT09ICdudW1iZXInKSB7XFxuXFx0XFx0XFx0c3RhcnQgPSAwO1xcblxcdFxcdH1cXG5cXG5cXHRcXHRpZiAoc3RhcnQgKyBzZWFyY2gubGVuZ3RoID4gdGhpcy5sZW5ndGgpIHtcXG5cXHRcXHRcXHRyZXR1cm4gZmFsc2U7XFxuXFx0XFx0fSBlbHNlIHtcXG5cXHRcXHRcXHRyZXR1cm4gdGhpcy5pbmRleE9mKHNlYXJjaCwgc3RhcnQpICE9PSAtMTtcXG5cXHRcXHR9XFxuXFx0fTtcXG59XFxuXFxudmFyIHdpbkF1ZGlvOyAvLz0gbmV3IEF1ZGlvKCcuLi9hdWRpby9Ub2Nuby5tcDMnKTtcXG52YXIgbG9zZUF1ZGlvOyAvLz0gbmV3IEF1ZGlvKCcuLi9hdWRpby9Lcml2by5tcDMnKTtcXG5cXG4vLyAtLS0tLS0tLS0tIGluaXRpYWxpemUgXFxcImRyYWcgZWxlbWVudHNcXFwiIHF1ZXN0aW9uIGVsZW1lbnRzXFxuXFxuZnVuY3Rpb24gaW5pdERyYWdFbGVtZW50c0VsZW1lbnRzKHF1ZXN0aW9uSWQpIHtcXG5cXHR2YXIgcXVlc3Rpb25Db250ZXh0RWxlbWVudCA9IHF1ZXN0aW9uSWQgJiYgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQocXVlc3Rpb25JZCkgfHwgZG9jdW1lbnQ7XFxuXFxuXFx0dmFyIHRhc2tJZDtcXG5cXG5cXHQkKCcuZHJvcHpvbmUsIC5kcm9wem9uZS1ob2xkZXInLCBxdWVzdGlvbkNvbnRleHRFbGVtZW50KVxcblxcdFxcdC5kcm9wcGFibGUoe1xcblxcblxcdFxcdFxcdGFjY2VwdDogJy5kcmFnZ2FibGUuZG9zLWFuc3dlci1kcmFnZ2FibGUnLFxcblxcdFxcdFxcdHJldmVydDogJ2ludmFsaWQnLFxcblxcdFxcdFxcdC8vIFRPRE86IGN1c3RvbSBvdmVybGFwcGluZ1xcblxcdFxcdFxcdHRvbGVyYW5jZTogJ2ludGVyc2VjdCcsXFxuXFxuXFx0XFx0XFx0Ly8gbGlzdGVuIGZvciBkcm9wIHJlbGF0ZWQgZXZlbnRzOlxcblxcblxcdFxcdFxcdGFjdGl2YXRlOiBmdW5jdGlvbiAoZXZlbnQpIHtcXG5cXHRcXHRcXHRcXHQvLyBhZGQgYWN0aXZlIGRyb3B6b25lIGZlZWRiYWNrXFxuXFx0XFx0XFx0XFx0ZXZlbnQudGFyZ2V0LmNsYXNzTGlzdC5hZGQoJ2Ryb3AtYWN0aXZlJyk7XFxuXFx0XFx0XFx0fSxcXG5cXHRcXHRcXHRvdmVyOiBmdW5jdGlvbiAoZXZlbnQsIHVpKSB7XFxuXFx0XFx0XFx0XFx0dmFyIGRyYWdnYWJsZUVsZW1lbnQgPSB1aS5kcmFnZ2FibGUuZ2V0KDApLFxcblxcdFxcdFxcdFxcdFxcdGRyb3B6b25lRWxlbWVudCA9IGV2ZW50LnRhcmdldDtcXG5cXG5cXHRcXHRcXHRcXHQvLyBmZWVkYmFjayB0aGUgcG9zc2liaWxpdHkgb2YgYSBkcm9wXFxuXFx0XFx0XFx0XFx0ZHJvcHpvbmVFbGVtZW50LmNsYXNzTGlzdC5hZGQoJ2Ryb3AtdGFyZ2V0Jyk7XFxuXFx0XFx0XFx0XFx0ZHJvcHpvbmVFbGVtZW50LmNsYXNzTGlzdC5hZGQoJ2JvcmRlci10cmFuc3BhcmVudCcpO1xcblxcblxcdFxcdFxcdFxcdGRyYWdnYWJsZUVsZW1lbnQuY2xhc3NMaXN0LmFkZCgnY2FuLWRyb3Atc3R5bGUnKTtcXG5cXHRcXHRcXHRcXHRkcmFnZ2FibGVFbGVtZW50LmNsYXNzTGlzdC5hZGQoJ2Nhbi1kcm9wJyk7XFxuXFx0XFx0XFx0XFx0ZHJvcHpvbmVFbGVtZW50LmNsYXNzTGlzdC5hZGQoJ2hpZGV0ZXh0Jyk7XFxuXFx0XFx0XFx0XFx0aWYgKCEoTnVtYmVyKGRyb3B6b25lRWxlbWVudC5nZXRBdHRyaWJ1dGUoXFxcInZpc2l0c1xcXCIpKSA+IDApKSB7XFxuXFx0XFx0XFx0XFx0XFx0Ly9pZiBhdHRyaWJ1dGUgdmlzaXRzIGlzIG5vdCBzZXQgb3IgMCwgY2hlY2sgaW4gdGhlIGVsZW1lbnRcXG5cXHRcXHRcXHRcXHRcXHRkcm9wem9uZUVsZW1lbnQuc2V0QXR0cmlidXRlKFxcXCJ2aXNpdHNcXFwiLCBOdW1iZXIoMSkpO1xcblxcdFxcdFxcdFxcdFxcdGRyb3B6b25lRWxlbWVudC5zZXRBdHRyaWJ1dGUoXFxcInZpc2l0ZWRCeURhdGFHcm91cFxcXCIgKyBkcmFnZ2FibGVFbGVtZW50LmdldEF0dHJpYnV0ZShcXFwiZGF0YS1ncm91cFxcXCIpLCBcXFwidmlzaXRlZFxcXCIpO1xcblxcblxcdFxcdFxcdFxcdH0gZWxzZSB7XFxuXFx0XFx0XFx0XFx0XFx0Ly9lbGVtZW50IGhhcyBhbHJlYWR5IGJlZW4gdmlzaXRlZCwgc28gY2hlY2sgaWYgdGhlIHZpc2l0IGlzIG5ld1xcblxcdFxcdFxcdFxcdFxcdGlmIChkcm9wem9uZUVsZW1lbnQuZ2V0QXR0cmlidXRlKFxcXCJ2aXNpdGVkQnlEYXRhR3JvdXBcXFwiICsgZHJhZ2dhYmxlRWxlbWVudC5nZXRBdHRyaWJ1dGUoXFxcImRhdGEtZ3JvdXBcXFwiKSkgPT0gXFxcInZpc2l0ZWRcXFwiKSB7XFxuXFx0XFx0XFx0XFx0XFx0XFx0Ly9UaGUgdmlzaXQgaXMgbm90IG5ld1xcblxcdFxcdFxcdFxcdFxcdH0gZWxzZSB7XFxuXFx0XFx0XFx0XFx0XFx0XFx0Ly9UaGUgdmlzaXQgaXMgbmV3LCBjaGVjayBpbiBhbmQgaW5jcmVtZW50IG51bSBvZiB2aXNpdHNcXG5cXHRcXHRcXHRcXHRcXHRcXHRkcm9wem9uZUVsZW1lbnQuc2V0QXR0cmlidXRlKFxcXCJ2aXNpdGVkQnlEYXRhR3JvdXBcXFwiICsgZHJhZ2dhYmxlRWxlbWVudC5nZXRBdHRyaWJ1dGUoXFxcImRhdGEtZ3JvdXBcXFwiKSwgXFxcInZpc2l0ZWRcXFwiKTtcXG5cXHRcXHRcXHRcXHRcXHRcXHRkcm9wem9uZUVsZW1lbnQuc2V0QXR0cmlidXRlKFxcXCJ2aXNpdHNcXFwiLCBOdW1iZXIoTnVtYmVyKGRyb3B6b25lRWxlbWVudC5nZXRBdHRyaWJ1dGUoXFxcInZpc2l0c1xcXCIpKSArIDEpKTtcXG5cXHRcXHRcXHRcXHRcXHR9XFxuXFx0XFx0XFx0XFx0fVxcblxcblxcdFxcdFxcdFxcdGRyb3B6b25lRWxlbWVudC5zZXRBdHRyaWJ1dGUoXFxcImRhdGEtZHJhZ2dlZC1ncm91cC12YWx1ZVxcXCIsIGV2ZW50LnRhcmdldC5nZXRBdHRyaWJ1dGUoXFxcImlkXFxcIikuc3BsaXQoJ2EnKVsxXSk7XFxuXFx0XFx0XFx0fSxcXG5cXHRcXHRcXHRvdXQ6IGZ1bmN0aW9uIChldmVudCwgdWkpIHtcXG5cXHRcXHRcXHRcXHR2YXIgZHJhZ2dhYmxlRWxlbWVudCA9IHVpLmRyYWdnYWJsZS5nZXQoMCksXFxuXFx0XFx0XFx0XFx0XFx0ZHJvcHpvbmVFbGVtZW50ID0gZXZlbnQudGFyZ2V0O1xcblxcblxcdFxcdFxcdFxcdC8vIHJlbW92ZSB0aGUgZHJvcCBmZWVkYmFjayBzdHlsZVxcblxcdFxcdFxcdFxcdGRyb3B6b25lRWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKCdkcm9wLXRhcmdldCcpO1xcblxcdFxcdFxcdFxcdGRyb3B6b25lRWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKCdib3JkZXItdHJhbnNwYXJlbnQyJyk7XFxuXFxuXFx0XFx0XFx0XFx0ZHJhZ2dhYmxlRWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKCdjYW4tZHJvcC1zdHlsZScpO1xcblxcdFxcdFxcdFxcdGRyYWdnYWJsZUVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZSgnZHJhZ2dhYmxlLWFjdGl2ZScpO1xcblxcdFxcdFxcdFxcdGRyYWdnYWJsZUVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZSgnY2FuLWRyb3AnKTtcXG5cXHRcXHRcXHRcXHRkcmFnZ2FibGVFbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUoJ2VsZW1lbnQtY29ycmVjdCcpO1xcblxcdFxcdFxcdFxcdGRyYWdnYWJsZUVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZSgnZWxlbWVudC1ub3Rjb3JyZWN0Jyk7XFxuXFx0XFx0XFx0XFx0ZHJvcHpvbmVFbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUoJ292ZXInKTtcXG5cXG5cXHRcXHRcXHRcXHRkcm9wem9uZUVsZW1lbnQgPSBkcmFnZ2FibGVFbGVtZW50O1xcblxcdFxcdFxcdFxcdGRyYWdnYWJsZUVsZW1lbnQgPSBkcm9wem9uZUVsZW1lbnQ7XFxuXFx0XFx0XFx0XFx0Ly9DaGVjayBpZiB0aGUgZWxlbWVudCB3YXMgYWxyZWFkeSBjaGVja2VkIGluLiBJZiB5ZXMsIGRlY3JlbWVudCB0aGUgdmlzaXRzIGFuZCBjaGVjayBvdXRcXG5cXG5cXHRcXHRcXHRcXHRwcmV2RHJvcHpvbmUgPSBldmVudC50YXJnZXQuZ2V0QXR0cmlidXRlKFxcXCJpZFxcXCIpO1xcblxcblxcdFxcdFxcdFxcdGlmIChkcm9wem9uZUVsZW1lbnQuZ2V0QXR0cmlidXRlKFxcXCJ2aXNpdGVkQnlEYXRhR3JvdXBcXFwiICsgZHJhZ2dhYmxlRWxlbWVudC5nZXRBdHRyaWJ1dGUoXFxcImRhdGEtZ3JvdXBcXFwiKSkgPT0gXFxcInZpc2l0ZWRcXFwiKSB7XFxuXFx0XFx0XFx0XFx0XFx0Ly9UaGUgZWxlbWVudCBpcyBjaGVja2VkIGluLCBjaGVjayBpdCBvdXRcXG5cXHRcXHRcXHRcXHRcXHRkcm9wem9uZUVsZW1lbnQuc2V0QXR0cmlidXRlKFxcXCJ2aXNpdGVkQnlEYXRhR3JvdXBcXFwiICsgZHJhZ2dhYmxlRWxlbWVudC5nZXRBdHRyaWJ1dGUoXFxcImRhdGEtZ3JvdXBcXFwiKSwgXFxcImNoZWNrZWQtb3V0XFxcIik7XFxuXFx0XFx0XFx0XFx0XFx0Ly9kZWNyZW1lbnQgbnVtYmVyIG9mIHZpc2l0b3JzXFxuXFx0XFx0XFx0XFx0XFx0ZHJvcHpvbmVFbGVtZW50LnNldEF0dHJpYnV0ZShcXFwidmlzaXRzXFxcIiwgTnVtYmVyKE51bWJlcihkcm9wem9uZUVsZW1lbnQuZ2V0QXR0cmlidXRlKFxcXCJ2aXNpdHNcXFwiKSkgLSAxKSk7XFxuXFx0XFx0XFx0XFx0fVxcblxcblxcdFxcdFxcdFxcdC8vSWYgbm8gZWxlbWVudHMgYXJlIGNoZWNrZWQgaW4sIHJlbW92ZSBoaWRldGV4dFxcblxcdFxcdFxcdFxcdC8vIGlmIChOdW1iZXIoZHJvcHpvbmVFbGVtZW50LmdldEF0dHJpYnV0ZShcXFwidmlzaXRzXFxcIikpIDwgMSkge1xcblxcdFxcdFxcdFxcdC8vIFxcdGRyYWdnYWJsZUVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZShcXFwiaGlkZXRleHRcXFwiKTtcXG5cXHRcXHRcXHRcXHQvLyB9XFxuXFxuXFx0XFx0XFx0XFx0Ly8gZHJvcHpvbmVFbGVtZW50LnNldEF0dHJpYnV0ZShcXFwiZGF0YS1kcmFnZ2VkLWdyb3VwLXZhbHVlXFxcIiwgXFxcIi0xXFxcIik7XFxuXFx0XFx0XFx0fSxcXG5cXHRcXHRcXHRkcm9wOiAoZXZlbnQsIHVpKSA9PiB7XFxuXFx0XFx0XFx0XFx0dmFyIGRyYWdnYWJsZUVsZW1lbnQgPSB1aS5kcmFnZ2FibGUuZ2V0KDApO1xcblxcdFxcdFxcdFxcdGRyYWdEcm9wQWN0aW9uKGV2ZW50LnRhcmdldCwgdGFza0lkLCBkcmFnZ2FibGVFbGVtZW50KTtcXG5cXHRcXHRcXHR9LFxcblxcdFxcdFxcdGRlYWN0aXZhdGU6IGZ1bmN0aW9uIChldmVudCwgdWkpIHtcXG5cXHRcXHRcXHRcXHR2YXIgZHJhZ2dhYmxlRWxlbWVudCA9IHVpLmRyYWdnYWJsZS5nZXQoMCksXFxuXFx0XFx0XFx0XFx0XFx0ZHJvcHpvbmVFbGVtZW50ID0gZXZlbnQudGFyZ2V0O1xcblxcblxcdFxcdFxcdFxcdC8vIHJlbW92ZSBhY3RpdmUgZHJvcHpvbmUgZmVlZGJhY2tcXG5cXHRcXHRcXHRcXHRkcm9wem9uZUVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZSgnZHJvcC1hY3RpdmUnKTtcXG5cXHRcXHRcXHRcXHRkcm9wem9uZUVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZSgnZHJvcC10YXJnZXQnKTtcXG5cXHRcXHRcXHRcXHRkcm9wem9uZUVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZSgnb3ZlcicpO1xcblxcdFxcdFxcdFxcdGRyYWdnYWJsZUVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZSgnY2FuLWRyb3AnKTtcXG5cXHRcXHRcXHRcXHRkcm9wem9uZUVsZW1lbnQuY2xhc3NMaXN0LmFkZCgnYm9yZGVyLW5vbmUnKTtcXG5cXHRcXHRcXHR9XFxuXFx0XFx0fSk7XFxuXFxuXFx0Ly8gdGFyZ2V0IGVsZW1lbnRzIHdpdGggdGhlIFxcXCJkcmFnZ2FibGVcXFwiIGNsYXNzXFxuXFx0JCgnLmRyYWdnYWJsZS5kb3MtYW5zd2VyLWRyYWdnYWJsZScsIHF1ZXN0aW9uQ29udGV4dEVsZW1lbnQpXFxuXFx0XFx0LmRyYWdnYWJsZSh7XFxuXFx0XFx0XFx0cmV2ZXJ0OiAnaW52YWxpZCcsXFxuXFx0XFx0XFx0Ly8gVE9ETzogY3VzdG9tIG92ZXJsYXBwaW5nXFxuXFx0XFx0XFx0dG9sZXJhbmNlOiAnaW50ZXJzZWN0JyxcXG5cXHRcXHRcXHRkaXN0YW5jZTogNyxcXG5cXG5cXHRcXHRcXHQvLyBjYWxsIHRoaXMgZnVuY3Rpb24gb24gZXZlcnkgZHJhZ2VuZCBldmVudFxcblxcdFxcdFxcdHN0YXJ0OiBmdW5jdGlvbiAoZXZlbnQpIHtcXG5cXHRcXHRcXHRcXHR2YXIgZHJhZ2dhYmxlRWxlbWVudCA9IGV2ZW50LnRhcmdldDtcXG5cXG5cXHRcXHRcXHRcXHRpZiAoISQoZHJhZ2dhYmxlRWxlbWVudCkucGFyZW50KCkuaGFzQ2xhc3MoJ2Rvcy1hbnN3ZXItd3JhcHBlcicpKSB7XFxuXFx0XFx0XFx0XFx0XFx0JChkcmFnZ2FibGVFbGVtZW50KS5wYXJlbnQoKS5hZGRDbGFzcygnZG9zLWRyb3B6b25lLXdoaWxlLWVsZW1lbnQtZHJhZ2dpbmctc3R5bGUnKTtcXG5cXHRcXHRcXHRcXHR9XFxuXFxuXFx0XFx0XFx0XFx0Ly8gJCgnLmRvcy1hbnN3ZXItd3JhcHBlcicpLmNzcyh7IG92ZXJmbG93OiAnJyB9KTtcXG5cXG5cXHRcXHRcXHRcXHRkcmFnZ2FibGVFbGVtZW50LnN0eWxlLnpJbmRleCA9ICcxMCc7XFxuXFxuXFx0XFx0XFx0XFx0dGFza0lkID0gYCR7JChkcmFnZ2FibGVFbGVtZW50KS5jbG9zZXN0KCdkaXZbaWQqPVxcXCJfcXVlc3Rpb25JZF9cXFwiXScpLmF0dHIoJ2lkJyl9YDtcXG5cXG5cXHRcXHRcXHRcXHREcmFnQ291bnRlci5vbkRyYWdTdGFydChkcmFnZ2FibGVFbGVtZW50KTtcXG5cXG5cXHRcXHRcXHRcXHRkcmFnZ2FibGVFbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUoJ3N1Y2Nlc3MnKTtcXG5cXHRcXHRcXHRcXHRkcmFnZ2FibGVFbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUoJ2RhbmdlcicpO1xcblxcblxcdFxcdFxcdFxcdC8vIG1hcmsgZWxlbWVudCBhcyBiZWluZyBhY3RpdmVcXG5cXHRcXHRcXHRcXHRkcmFnZ2FibGVFbGVtZW50LmNsYXNzTGlzdC5hZGQoJ2RyYWdnYWJsZS1hY3RpdmUnKTtcXG5cXG5cXHRcXHRcXHRcXHQvL3RvIHBhaW50IHRoZW0gb3JhbmdlIVxcblxcdFxcdFxcdFxcdGlmIChkcmFnZ2FibGVFbGVtZW50LmNsYXNzTGlzdC5jb250YWlucygnZGQtc29sdXRpb24nKSkge1xcblxcdFxcdFxcdFxcdFxcdGRyYWdnYWJsZUVsZW1lbnQuY2xhc3NMaXN0LmFkZCgnY2FuLWRyb3AnKTtcXG5cXHRcXHRcXHRcXHR9XFxuXFx0XFx0XFx0fSxcXG5cXG5cXHRcXHRcXHRzdG9wOiBmdW5jdGlvbiAoZXZlbnQpIHtcXG5cXHRcXHRcXHRcXHR2YXIgZHJhZ2dhYmxlRWxlbWVudCA9IGV2ZW50LnRhcmdldDtcXG5cXG5cXHRcXHRcXHRcXHQkKCcuZG9zLWRyb3B6b25lLXdoaWxlLWVsZW1lbnQtZHJhZ2dpbmctc3R5bGUnKS5yZW1vdmVDbGFzcygnZG9zLWRyb3B6b25lLXdoaWxlLWVsZW1lbnQtZHJhZ2dpbmctc3R5bGUnKTtcXG5cXG5cXHRcXHRcXHRcXHQkKCcuZG9zLWFuc3dlci13cmFwcGVyJykuY3NzKHsgb3ZlcmZsb3c6ICd2aXNpYmxlJyB9KTtcXG5cXG5cXHRcXHRcXHRcXHQvL3RvIHJlbW92ZSB0aGUgb3JhbmdlIHBhaW50XFxuXFx0XFx0XFx0XFx0aWYgKGRyYWdnYWJsZUVsZW1lbnQuY2xhc3NMaXN0LmNvbnRhaW5zKCdjYW4tZHJvcCcpKSB7XFxuXFx0XFx0XFx0XFx0XFx0ZHJhZ2dhYmxlRWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKCdjYW4tZHJvcCcpO1xcblxcdFxcdFxcdFxcdH1cXG5cXG5cXHRcXHRcXHRcXHQvLyB1bm1hcmsgYWN0aXZlIGVsZW1lbnRcXG5cXHRcXHRcXHRcXHRkcmFnZ2FibGVFbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUoJ2RyYWdnYWJsZS1hY3RpdmUnKTtcXG5cXHRcXHRcXHRcXHRkcmFnZ2FibGVFbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUoJ2Nhbi1kcm9wLXN0eWxlJyk7XFxuXFxuXFx0XFx0XFx0XFx0RHJhZ0NvdW50ZXIub25EcmFnRW5kKGRyYWdnYWJsZUVsZW1lbnQpO1xcblxcdFxcdFxcdH1cXG5cXHRcXHR9KVxcblxcdFxcdC8vIGNvbnRhaW5tZW50IC0gd2UgYXJlIHRhcmdldGluZyBlbGVtZW50J3MgYW5jZXN0b3IsIG5vdCB1bmlxdWUgZWxlbWVudFxcblxcdFxcdC5lYWNoKGZ1bmN0aW9uICgpIHtcXG5cXHRcXHRcXHQkKHRoaXMpLmRyYWdnYWJsZSh7XFxuXFx0XFx0XFx0XFx0Y29udGFpbm1lbnQ6ICQodGhpcykuY2xvc2VzdCgnLnF1ZXN0aW9uJylcXG5cXHRcXHRcXHR9KTtcXG5cXHRcXHR9KTtcXG59XFxuXFxuLy8gLS0tLS0tLS0tLSBpbml0aWFsaXplIFxcXCJkcmFnIG9uIHBpY3R1cmVcXFwiIHF1ZXN0aW9uIGVsZW1lbnRzXFxuXFxuZnVuY3Rpb24gaW5pdERyYWdPblBpY3R1cmVFbGVtZW50cyhxdWVzdGlvbklkKSB7XFxuXFx0dmFyIHF1ZXN0aW9uQ29udGV4dEVsZW1lbnQgPSBxdWVzdGlvbklkICYmIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKHF1ZXN0aW9uSWQpIHx8IGRvY3VtZW50O1xcblxcblxcdCQoJy5kcmFnZ2FibGUtcmVzdHJpY3RlZCcsIHF1ZXN0aW9uQ29udGV4dEVsZW1lbnQpXFxuXFx0XFx0LmVhY2goZnVuY3Rpb24gKCkge1xcblxcdFxcdFxcdGluaXREcmFnT25QaWN0dXJlQW5zd2VyRWxlbWVudCh0aGlzKTtcXG5cXHRcXHRcXHRpbml0RHJhZ09uUGljdHVyZUFuc3dlckVsZW1lbnRCeUNsaWNrKHRoaXMpO1xcblxcdFxcdH0pO1xcblxcblxcdCQoXFxcIi5waWN0dXJlLWRyb3B6b25lLWNyZWF0b3JcXFwiLCBxdWVzdGlvbkNvbnRleHRFbGVtZW50KVxcblxcdFxcdC5kcm9wcGFibGUoe1xcblxcdFxcdFxcdC8vIG9ubHkgYWNjZXB0IGVsZW1lbnRzIG1hdGNoaW5nIHRoaXMgQ1NTIHNlbGVjdG9yXFxuXFx0XFx0XFx0YWNjZXB0OiAnLmRyYWdnYWJsZS1yZXN0cmljdGVkJyxcXG5cXHRcXHRcXHQvLyBUT0RPOiBjdXN0b20gb3ZlcmxhcHBpbmdcXG5cXHRcXHRcXHR0b2xlcmFuY2U6ICdpbnRlcnNlY3QnLFxcblxcblxcdFxcdFxcdGFjdGl2YXRlOiBmdW5jdGlvbiAoZXZlbnQpIHtcXG5cXHRcXHRcXHRcXHQvLyBhZGQgYWN0aXZlIGRyb3B6b25lIGZlZWRiYWNrXFxuXFx0XFx0XFx0XFx0ZXZlbnQudGFyZ2V0LmNsYXNzTGlzdC5hZGQoJ2Ryb3AtYWN0aXZlJyk7XFxuXFx0XFx0XFx0fSxcXG5cXHRcXHRcXHRvdmVyOiBmdW5jdGlvbiAoZXZlbnQsIHVpKSB7XFxuXFx0XFx0XFx0XFx0dmFyIGRyYWdnYWJsZUVsZW1lbnQgPSB1aS5kcmFnZ2FibGUuZ2V0KDApLFxcblxcdFxcdFxcdFxcdFxcdGRyb3B6b25lRWxlbWVudCA9IGV2ZW50LnRhcmdldDtcXG5cXG5cXHRcXHRcXHRcXHQvLyBmZWVkYmFjayB0aGUgcG9zc2liaWxpdHkgb2YgYSBkcm9wXFxuXFx0XFx0XFx0XFx0ZHJvcHpvbmVFbGVtZW50LmNsYXNzTGlzdC5hZGQoJ2Ryb3AtdGFyZ2V0Jyk7XFxuXFx0XFx0XFx0XFx0ZHJhZ2dhYmxlRWxlbWVudC5jbGFzc0xpc3QuYWRkKCdjYW4tZHJvcCcpO1xcblxcblxcdFxcdFxcdH0sXFxuXFx0XFx0XFx0b3V0OiBmdW5jdGlvbiAoZXZlbnQsIHVpKSB7XFxuXFx0XFx0XFx0XFx0dmFyIGRyYWdnYWJsZUVsZW1lbnQgPSB1aS5kcmFnZ2FibGUuZ2V0KDApLFxcblxcdFxcdFxcdFxcdFxcdGRyb3B6b25lRWxlbWVudCA9IGV2ZW50LnRhcmdldDtcXG5cXG5cXHRcXHRcXHRcXHQvLyByZW1vdmUgdGhlIGRyb3AgZmVlZGJhY2sgc3R5bGVcXG5cXHRcXHRcXHRcXHRkcm9wem9uZUVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZSgnZHJvcC10YXJnZXQnKTtcXG5cXHRcXHRcXHRcXHRkcmFnZ2FibGVFbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUoJ2Nhbi1kcm9wJyk7XFxuXFx0XFx0XFx0XFx0ZHJhZ2dhYmxlRWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKCdlbGVtZW50LWNvcnJlY3QnKTtcXG5cXHRcXHRcXHRcXHRkcmFnZ2FibGVFbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUoJ2VsZW1lbnQtbm90Y29ycmVjdCcpO1xcblxcblxcdFxcdFxcdFxcdGRyYWdnYWJsZUVsZW1lbnQuc2V0QXR0cmlidXRlKCdkYXRhLXBlcmNlbnRhZ2UteCcsIFxcXCItMVxcXCIpO1xcblxcdFxcdFxcdFxcdGRyYWdnYWJsZUVsZW1lbnQuc2V0QXR0cmlidXRlKCdkYXRhLXBlcmNlbnRhZ2UteScsIFxcXCItMVxcXCIpO1xcblxcdFxcdFxcdH0sXFxuXFx0XFx0XFx0ZHJvcDogZnVuY3Rpb24gKGV2ZW50LCB1aSkge1xcblxcdFxcdFxcdFxcdGZ1bmN0aW9uIGZpbmRQb3NpdGlvblBlcmNlbnRhZ2Uoc3RhcnQsIGVuZCwgcG9zaXRpb24pIHtcXG5cXHRcXHRcXHRcXHRcXHRyZXR1cm4gKDEuICogcG9zaXRpb24gLSBzdGFydCkgLyAoZW5kICogMS4gLSBzdGFydCk7XFxuXFx0XFx0XFx0XFx0fVxcblxcblxcdFxcdFxcdFxcdGZ1bmN0aW9uIGNoZWNrUGVyY2VudGFnZShwZXJjZW50YWdlKSB7XFxuXFx0XFx0XFx0XFx0XFx0aWYgKHBlcmNlbnRhZ2UgPCAwKSB7XFxuXFx0XFx0XFx0XFx0XFx0XFx0cmV0dXJuIDA7XFxuXFx0XFx0XFx0XFx0XFx0fSBlbHNlIGlmIChwZXJjZW50YWdlID4gMSkge1xcblxcdFxcdFxcdFxcdFxcdFxcdHJldHVybiAxO1xcblxcdFxcdFxcdFxcdFxcdH1cXG5cXHRcXHRcXHRcXHRcXHRyZXR1cm4gcGVyY2VudGFnZTtcXG5cXHRcXHRcXHRcXHR9XFxuXFxuXFx0XFx0XFx0XFx0dmFyIGRyYWdnYWJsZUVsZW1lbnQgPSB1aS5kcmFnZ2FibGUuZ2V0KDApO1xcblxcdFxcdFxcdFxcdHZhciBkcm9wem9uZUVsZW1lbnQgPSBldmVudC50YXJnZXQ7XFxuXFx0XFx0XFx0XFx0Ly93aXRoIHJlY3QudG9wIG9yIHJlY3QubGVmdCB5b3UgY2FuIGdldCBjb29yZGluYXRlc1xcblxcdFxcdFxcdFxcdHZhciBkcmFnUmVjdCA9IGRyYWdnYWJsZUVsZW1lbnQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XFxuXFx0XFx0XFx0XFx0dmFyIGRyb3BSZWN0ID0gZHJvcHpvbmVFbGVtZW50LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xcblxcdFxcdFxcdFxcdHZhciBjZW50ZXJEcmFnWCA9IChkcmFnUmVjdC5yaWdodCArIGRyYWdSZWN0LmxlZnQpIC8gMi4wO1xcblxcdFxcdFxcdFxcdHZhciBjZW50ZXJEcmFnWSA9IChkcmFnUmVjdC50b3AgKyBkcmFnUmVjdC5ib3R0b20pIC8gMi4wO1xcblxcdFxcdFxcdFxcdHZhciBwZXJjZW50YWdlWCA9IGNoZWNrUGVyY2VudGFnZShmaW5kUG9zaXRpb25QZXJjZW50YWdlKGRyb3BSZWN0LmxlZnQsIGRyb3BSZWN0LnJpZ2h0LCBjZW50ZXJEcmFnWCkpO1xcblxcdFxcdFxcdFxcdHZhciBwZXJjZW50YWdlWSA9IGNoZWNrUGVyY2VudGFnZShmaW5kUG9zaXRpb25QZXJjZW50YWdlKGRyb3BSZWN0LnRvcCwgZHJvcFJlY3QuYm90dG9tLCBjZW50ZXJEcmFnWSkpO1xcblxcblxcdFxcdFxcdFxcdGRyYWdnYWJsZUVsZW1lbnQuc2V0QXR0cmlidXRlKCdkYXRhLXBlcmNlbnRhZ2UteCcsIHBlcmNlbnRhZ2VYKTtcXG5cXHRcXHRcXHRcXHRkcmFnZ2FibGVFbGVtZW50LnNldEF0dHJpYnV0ZSgnZGF0YS1wZXJjZW50YWdlLXknLCBwZXJjZW50YWdlWSk7XFxuXFx0XFx0XFx0XFx0dmFyIGFuc3dlck51bSA9IGRyYWdnYWJsZUVsZW1lbnQuZ2V0QXR0cmlidXRlKCdkYXRhLWFuc3dlci1udW1iZXInKTtcXG5cXHRcXHRcXHRcXHR2YXIgcXVlc3Rpb25OdW0gPSBkcmFnZ2FibGVFbGVtZW50LmlkLnNwbGl0KFxcXCJxXFxcIilbMV0uc3BsaXQoXFxcImFcXFwiKVswXTtcXG5cXHRcXHRcXHRcXHRpZiAoIXF1ZXN0aW9uTnVtKSB7XFxuXFx0XFx0XFx0XFx0XFx0cXVlc3Rpb25OdW0gPSAwO1xcblxcdFxcdFxcdFxcdH1cXG5cXHRcXHRcXHRcXHR2YXIgYW5zd2VyTnVtID0gZHJhZ2dhYmxlRWxlbWVudC5pZC5zcGxpdChcXFwiYVxcXCIpWzFdO1xcblxcdFxcdFxcdFxcdGFuZ3VsYXIuZWxlbWVudChkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnUXVpek1vZGFsJykpLnNjb3BlKCkuc2V0UGVyY2VudGFnZXMocGVyY2VudGFnZVgsIHBlcmNlbnRhZ2VZLCBxdWVzdGlvbk51bSwgYW5zd2VyTnVtKTtcXG5cXHRcXHRcXHR9LFxcblxcdFxcdFxcdGRlYWN0aXZhdGU6IGZ1bmN0aW9uIChldmVudCwgdWkpIHtcXG5cXHRcXHRcXHRcXHR2YXIgZHJhZ2dhYmxlRWxlbWVudCA9IHVpLmRyYWdnYWJsZS5nZXQoMCksXFxuXFx0XFx0XFx0XFx0XFx0ZHJvcHpvbmVFbGVtZW50ID0gZXZlbnQudGFyZ2V0O1xcblxcblxcdFxcdFxcdFxcdC8vIHJlbW92ZSBhY3RpdmUgZHJvcHpvbmUgZmVlZGJhY2tcXG5cXHRcXHRcXHRcXHRkcm9wem9uZUVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZSgnZHJvcC1hY3RpdmUnKTtcXG5cXHRcXHRcXHRcXHRkcm9wem9uZUVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZSgnZHJvcC10YXJnZXQnKTtcXG5cXHRcXHRcXHRcXHRkcmFnZ2FibGVFbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUoJ2Nhbi1kcm9wJyk7XFxuXFx0XFx0XFx0fVxcblxcdFxcdH0pO1xcblxcblxcblxcdCQoJy5waWN0dXJlLWRyb3B6b25lLXF1aXonLCBxdWVzdGlvbkNvbnRleHRFbGVtZW50KVxcblxcdFxcdC5kcm9wcGFibGUoe1xcblxcdFxcdFxcdC8vIG9ubHkgYWNjZXB0IGVsZW1lbnRzIG1hdGNoaW5nIHRoaXMgQ1NTIHNlbGVjdG9yXFxuXFx0XFx0XFx0YWNjZXB0OiAnLmRyYWdnYWJsZS1yZXN0cmljdGVkJyxcXG5cXHRcXHRcXHQvLyBUT0RPOiBjdXN0b20gb3ZlcmxhcHBpbmdcXG5cXHRcXHRcXHR0b2xlcmFuY2U6ICdpbnRlcnNlY3QnLFxcblxcblxcdFxcdFxcdC8vIGxpc3RlbiBmb3IgZHJvcCByZWxhdGVkIGV2ZW50czpcXG5cXG5cXHRcXHRcXHRvbmRyb3BhY3RpdmF0ZTogZnVuY3Rpb24gKGV2ZW50KSB7XFxuXFx0XFx0XFx0XFx0dmFyIGRyb3B6b25lRWxlbWVudCA9IGV2ZW50LnRhcmdldDtcXG5cXHRcXHRcXHRcXHR2YXIgY29udGFpbmVyRWxlbWVudCA9ICQoZHJvcHpvbmVFbGVtZW50KS5wYXJlbnRzKFxcXCIuZHJhZ2dhYmxlLWFyZWFcXFwiKS5nZXQoMCk7XFxuXFxuXFx0XFx0XFx0XFx0Ly8gYWRkIGFjdGl2ZSBkcm9wem9uZSBmZWVkYmFja1xcblxcdFxcdFxcdFxcdGRyb3B6b25lRWxlbWVudC5jbGFzc0xpc3QuYWRkKCdkcm9wLWFjdGl2ZScpO1xcblxcblxcblxcdFxcdFxcdFxcdGlmICghZHJvcHpvbmVFbGVtZW50LmNsYXNzTGlzdC5jb250YWlucyhcXFwiZHJhZ2dhYmxlLWluaXRpYWxpemVkXFxcIikpIHtcXG5cXHRcXHRcXHRcXHRcXHRkcm9wem9uZUVsZW1lbnQuY2xhc3NMaXN0LmFkZChcXFwiZHJhZ2dhYmxlLWluaXRpYWxpemVkXFxcIik7XFxuXFxuXFx0XFx0XFx0XFx0XFx0ZnVuY3Rpb24gcmVjYWxjdWxhdGVQb3NpdGlvbnMoKSB7XFxuXFx0XFx0XFx0XFx0XFx0XFx0dmFyIGRyb3BSZWN0ID0gZHJvcHpvbmVFbGVtZW50LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xcblxcblxcdFxcdFxcdFxcdFxcdFxcdCQoXFxcIi5kcmFnZ2FibGUtcmVzdHJpY3RlZFxcXCIsIGNvbnRhaW5lckVsZW1lbnQpXFxuXFx0XFx0XFx0XFx0XFx0XFx0XFx0LmVhY2goZnVuY3Rpb24gKGlkeCwgZHJhZ2dhYmxlRWxlbWVudCkge1xcblxcdFxcdFxcdFxcdFxcdFxcdFxcdFxcdC8vIHNraXAgcmVwb3NpdGlvbmluZyBpZiBlbGVtZW50IGlzIGN1cnJlbnRseSBhY3RpdmVcXG5cXHRcXHRcXHRcXHRcXHRcXHRcXHRcXHRpZiAoZHJhZ2dhYmxlRWxlbWVudC5jbGFzc0xpc3QuY29udGFpbnMoXFxcImRyYWdnYWJsZS1hY3RpdmVcXFwiKSkge1xcblxcdFxcdFxcdFxcdFxcdFxcdFxcdFxcdFxcdHJldHVybjtcXG5cXHRcXHRcXHRcXHRcXHRcXHRcXHRcXHR9XFxuXFxuXFx0XFx0XFx0XFx0XFx0XFx0XFx0XFx0Ly8gZ2V0IHBvc2l0aW9uZWQgZHJhZ2dhYmxlcycgcG9zaXRpb25zXFxuXFx0XFx0XFx0XFx0XFx0XFx0XFx0XFx0dmFyIHF1aXpQZXJjZW50YWdlWFZhbHVlID0gcGFyc2VGbG9hdChkcmFnZ2FibGVFbGVtZW50LmdldEF0dHJpYnV0ZShcXFwiZGF0YS1xdWl6LXBlcmNlbnRhZ2UteFxcXCIpIHx8IC0xKTtcXG5cXHRcXHRcXHRcXHRcXHRcXHRcXHRcXHR2YXIgcXVpelBlcmNlbnRhZ2VZVmFsdWUgPSBwYXJzZUZsb2F0KGRyYWdnYWJsZUVsZW1lbnQuZ2V0QXR0cmlidXRlKFxcXCJkYXRhLXF1aXotcGVyY2VudGFnZS15XFxcIikgfHwgLTEpO1xcblxcdFxcdFxcdFxcdFxcdFxcdFxcdFxcdHZhciBxdWl6V2lkdGggPSBwYXJzZUZsb2F0KGRyYWdnYWJsZUVsZW1lbnQuZ2V0QXR0cmlidXRlKFxcXCJkYXRhLXF1aXotd2lkdGhcXFwiKSB8fCAtMSk7XFxuXFx0XFx0XFx0XFx0XFx0XFx0XFx0XFx0dmFyIHF1aXpIZWlnaHQgPSBwYXJzZUZsb2F0KGRyYWdnYWJsZUVsZW1lbnQuZ2V0QXR0cmlidXRlKFxcXCJkYXRhLXF1aXotaGVpZ2h0XFxcIikgfHwgLTEpO1xcblxcblxcdFxcdFxcdFxcdFxcdFxcdFxcdFxcdC8vIHNldCBwb3NpdGlvbiBvbmx5IGlmIGVsIGhhcyBhbHJlYWR5IGJlZW4gcG9zaXRpb25lZFxcblxcdFxcdFxcdFxcdFxcdFxcdFxcdFxcdGlmIChxdWl6UGVyY2VudGFnZVhWYWx1ZSA+PSAwICYmIHF1aXpQZXJjZW50YWdlWFZhbHVlID49IDApIHtcXG5cXHRcXHRcXHRcXHRcXHRcXHRcXHRcXHRcXHQvKlxcblxcdFxcdFxcdFxcdFxcdFxcdFxcdFxcdFxcdCAqIERyYWdnYWJsZXMgYXJlIHBvc2l0aW9uZWQgcmVsYXRpdmVseSB0byBzdGFydGluZyBwb3NpdGlvbi4gSW4gb3JkZXIgdG8gcmVwb3NpdGlvbiB0aGVtIHByb3Blcmx5IGFmdGVyXFxuXFx0XFx0XFx0XFx0XFx0XFx0XFx0XFx0XFx0ICogcmVzaXplLCB3ZSBoYXZlIHRvIHJlc2V0IHRoZWlyIHBvc2l0aW9uaW5nIHRvIGdldCBuZXcgc3RhcnRpbmcgcG9pbnRzIGFuZCB0aGVuIGNhbGN1bGF0ZSBuZXcgcG9zdGlvbnNcXG5cXHRcXHRcXHRcXHRcXHRcXHRcXHRcXHRcXHQgKiByZWxhdGl2ZWx5IHRvIHRoZW0uXFxuXFx0XFx0XFx0XFx0XFx0XFx0XFx0XFx0XFx0ICovXFxuXFx0XFx0XFx0XFx0XFx0XFx0XFx0XFx0XFx0ZHJhZ2dhYmxlRWxlbWVudC5zdHlsZS50cmFuc2Zvcm0gPSBcXFwiXFxcIjtcXG5cXG5cXHRcXHRcXHRcXHRcXHRcXHRcXHRcXHRcXHQvLyBkcmFnZ2FibGUgcmVjdGFuZ2xlXFxuXFx0XFx0XFx0XFx0XFx0XFx0XFx0XFx0XFx0dmFyIGRyYWdSZWN0ID0gZHJhZ2dhYmxlRWxlbWVudC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcXG5cXG5cXG5cXHRcXHRcXHRcXHRcXHRcXHRcXHRcXHRcXHQvLyAtLS0tLSBjYWxjdWxhdGUgWFxcblxcdFxcdFxcdFxcdFxcdFxcdFxcdFxcdFxcdHZhciBxdWl6UGVyY2VudGFnZVggPSBwYXJzZUZsb2F0KHF1aXpQZXJjZW50YWdlWFZhbHVlKTtcXG5cXHRcXHRcXHRcXHRcXHRcXHRcXHRcXHRcXHQvLyBwZXJjZW50YWdlcyBhcmUgY2FsY3VsYXRlZCBhY2NvcmRpbmcgdG8gZHJhZ2dhYmxlJ3MgY2VudGVyIHBvaW50LCBzbyB3ZSBoYXZlIHRvIHJldmVyc2UgdGhhdCBjYWxjdWxhdGlvbiB0byBnZXQgbmV3IGFic29sdXRlIHBvc2l0aW9uXFxuXFx0XFx0XFx0XFx0XFx0XFx0XFx0XFx0XFx0dmFyIG5ld0Fic29sdXRlTGVmdCA9IGRyb3BSZWN0LmxlZnQgKyBkcm9wUmVjdC53aWR0aCAqIHF1aXpQZXJjZW50YWdlWCAtIChxdWl6V2lkdGgpIC8gMjtcXG5cXHRcXHRcXHRcXHRcXHRcXHRcXHRcXHRcXHQvLyBuZXcgcmVsYXRpdmUgcG9zaXRpb25cXG5cXHRcXHRcXHRcXHRcXHRcXHRcXHRcXHRcXHR2YXIgbmV3TGVmdCA9IG5ld0Fic29sdXRlTGVmdCAtIGRyYWdSZWN0LmxlZnQ7XFxuXFx0XFx0XFx0XFx0XFx0XFx0XFx0XFx0XFx0Ly8gc2V0IG5ldyBob3Jpem9udGFsIHBvc2l0aW9uXFxuXFx0XFx0XFx0XFx0XFx0XFx0XFx0XFx0XFx0Ly9kcmFnZ2FibGVFbGVtZW50LnN0eWxlLmxlZnQgPSBuZXdMZWZ0ICsgXFxcInB4XFxcIjtcXG5cXG5cXG5cXHRcXHRcXHRcXHRcXHRcXHRcXHRcXHRcXHQvLyAtLS0tLSBjYWxjdWxhdGUgWVxcblxcdFxcdFxcdFxcdFxcdFxcdFxcdFxcdFxcdHZhciBxdWl6UGVyY2VudGFnZVkgPSBwYXJzZUZsb2F0KHF1aXpQZXJjZW50YWdlWVZhbHVlKTtcXG5cXHRcXHRcXHRcXHRcXHRcXHRcXHRcXHRcXHQvLyBwZXJjZW50YWdlcyBhcmUgY2FsY3VsYXRlZCBhY2NvcmRpbmcgdG8gZHJhZ2dhYmxlJ3MgY2VudGVyIHBvaW50LCBzbyB3ZSBoYXZlIHRvIHJldmVyc2UgdGhhdCBjYWxjdWxhdGlvbiB0byBnZXQgbmV3IGFic29sdXRlIHBvc2l0aW9uXFxuXFx0XFx0XFx0XFx0XFx0XFx0XFx0XFx0XFx0dmFyIG5ld0Fic29sdXRlVG9wID0gZHJvcFJlY3QudG9wICsgZHJvcFJlY3QuaGVpZ2h0ICogcXVpelBlcmNlbnRhZ2VZIC0gKHF1aXpIZWlnaHQpIC8gMjtcXG5cXHRcXHRcXHRcXHRcXHRcXHRcXHRcXHRcXHQvLyBuZXcgcmVsYXRpdmUgcG9zaXRpb25cXG5cXHRcXHRcXHRcXHRcXHRcXHRcXHRcXHRcXHR2YXIgbmV3VG9wID0gbmV3QWJzb2x1dGVUb3AgLSBkcmFnUmVjdC50b3A7XFxuXFxuXFxuXFx0XFx0XFx0XFx0XFx0XFx0XFx0XFx0XFx0ZHJhZ2dhYmxlRWxlbWVudC5zdHlsZS5sZWZ0ID0gbmV3TGVmdDtcXG5cXHRcXHRcXHRcXHRcXHRcXHRcXHRcXHRcXHRkcmFnZ2FibGVFbGVtZW50LnN0eWxlLnRvcCA9IG5ld1RvcDtcXG5cXHRcXHRcXHRcXHRcXHRcXHRcXHRcXHR9XFxuXFx0XFx0XFx0XFx0XFx0XFx0XFx0fSk7XFxuXFx0XFx0XFx0XFx0XFx0fVxcblxcblxcdFxcdFxcdFxcdFxcdC8vIG1vbml0b3IgZHJhZ2dhYmxlJ3MgY29udGFpbmVyIHJlc2l6ZSAodXNlIHRpbWVvdXQgdG8gdGhyb3RsZSBldmVudHMpXFxuXFx0XFx0XFx0XFx0XFx0dmFyIFJFU0laRV9FVkVOVF9USFJPVExFX1RJTUVPVVQgPSAxMDA7XFxuXFx0XFx0XFx0XFx0XFx0dmFyIHRpbWVvdXRIYW5kbGU7XFxuXFx0XFx0XFx0XFx0XFx0bmV3IFJlc2l6ZVNlbnNvcihjb250YWluZXJFbGVtZW50LCBmdW5jdGlvbiAoKSB7XFxuXFx0XFx0XFx0XFx0XFx0XFx0aWYgKHRpbWVvdXRIYW5kbGUpIGNsZWFyVGltZW91dCh0aW1lb3V0SGFuZGxlKTtcXG5cXHRcXHRcXHRcXHRcXHRcXHR0aW1lb3V0SGFuZGxlID0gc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XFxuXFx0XFx0XFx0XFx0XFx0XFx0XFx0dGltZW91dEhhbmRsZSA9IG51bGw7XFxuXFx0XFx0XFx0XFx0XFx0XFx0XFx0cmVjYWxjdWxhdGVQb3NpdGlvbnMoKTtcXG5cXHRcXHRcXHRcXHRcXHRcXHR9LCBSRVNJWkVfRVZFTlRfVEhST1RMRV9USU1FT1VUKTtcXG5cXHRcXHRcXHRcXHRcXHR9KTtcXG5cXHRcXHRcXHRcXHR9XFxuXFx0XFx0XFx0fSxcXG5cXG5cXHRcXHRcXHRhY3RpdmF0ZTogZnVuY3Rpb24gKGV2ZW50KSB7XFxuXFx0XFx0XFx0XFx0Ly8gYWRkIGFjdGl2ZSBkcm9wem9uZSBmZWVkYmFja1xcblxcdFxcdFxcdFxcdGV2ZW50LnRhcmdldC5jbGFzc0xpc3QuYWRkKCdkcm9wLWFjdGl2ZScpO1xcblxcdFxcdFxcdH0sXFxuXFx0XFx0XFx0b3ZlcjogZnVuY3Rpb24gKGV2ZW50LCB1aSkge1xcblxcdFxcdFxcdFxcdHZhciBkcmFnZ2FibGVFbGVtZW50ID0gdWkuZHJhZ2dhYmxlLmdldCgwKSxcXG5cXHRcXHRcXHRcXHRcXHRkcm9wem9uZUVsZW1lbnQgPSBldmVudC50YXJnZXQ7XFxuXFxuXFx0XFx0XFx0XFx0Ly8gZmVlZGJhY2sgdGhlIHBvc3NpYmlsaXR5IG9mIGEgZHJvcFxcblxcdFxcdFxcdFxcdGRyb3B6b25lRWxlbWVudC5jbGFzc0xpc3QuYWRkKCdkcm9wLXRhcmdldCcpO1xcblxcdFxcdFxcdFxcdGRyYWdnYWJsZUVsZW1lbnQuY2xhc3NMaXN0LmFkZCgnY2FuLWRyb3AnKTtcXG5cXHRcXHRcXHRcXHRkcmFnZ2FibGVFbGVtZW50LmNsYXNzTGlzdC5hZGQoJ2Nhbi1kcm9wLXN0eWxlJyk7XFxuXFxuXFx0XFx0XFx0fSxcXG5cXHRcXHRcXHRvdXQ6IGZ1bmN0aW9uIChldmVudCwgdWkpIHtcXG5cXHRcXHRcXHRcXHR2YXIgZHJhZ2dhYmxlRWxlbWVudCA9IHVpLmRyYWdnYWJsZS5nZXQoMCksXFxuXFx0XFx0XFx0XFx0XFx0ZHJvcHpvbmVFbGVtZW50ID0gZXZlbnQudGFyZ2V0O1xcblxcblxcdFxcdFxcdFxcdC8vIHJlbW92ZSB0aGUgZHJvcCBmZWVkYmFjayBzdHlsZVxcblxcdFxcdFxcdFxcdGRyb3B6b25lRWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKCdkcm9wLXRhcmdldCcpO1xcblxcdFxcdFxcdFxcdGRyYWdnYWJsZUVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZSgnY2FuLWRyb3AnKTtcXG5cXHRcXHRcXHRcXHRkcmFnZ2FibGVFbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUoJ2VsZW1lbnQtY29ycmVjdCcpO1xcblxcdFxcdFxcdFxcdGRyYWdnYWJsZUVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZSgnZWxlbWVudC1ub3Rjb3JyZWN0Jyk7XFxuXFx0XFx0XFx0XFx0ZHJhZ2dhYmxlRWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKCdjYW4tZHJvcC1zdHlsZScpO1xcblxcdFxcdFxcdFxcdGRyYWdnYWJsZUVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZSgnZHJhZ2dhYmxlLWFjdGl2ZScpO1xcblxcblxcdFxcdFxcdFxcdGRyYWdnYWJsZUVsZW1lbnQuc2V0QXR0cmlidXRlKCdkYXRhLXF1aXotd2lkdGgnLCBcXFwiLTFcXFwiKTtcXG5cXHRcXHRcXHRcXHRkcmFnZ2FibGVFbGVtZW50LnNldEF0dHJpYnV0ZSgnZGF0YS1xdWl6LWhlaWdodCcsIFxcXCItMVxcXCIpO1xcblxcblxcdFxcdFxcdFxcdGRyYWdnYWJsZUVsZW1lbnQuc2V0QXR0cmlidXRlKCdkYXRhLXF1aXotcGVyY2VudGFnZS14JywgXFxcIi0xXFxcIik7XFxuXFx0XFx0XFx0XFx0ZHJhZ2dhYmxlRWxlbWVudC5zZXRBdHRyaWJ1dGUoJ2RhdGEtcXVpei1wZXJjZW50YWdlLXknLCBcXFwiLTFcXFwiKTtcXG5cXHRcXHRcXHR9LFxcblxcdFxcdFxcdGRyb3A6IGZ1bmN0aW9uIChldmVudCwgdWkpIHtcXG5cXHRcXHRcXHRcXHRmdW5jdGlvbiBmaW5kUG9zaXRpb25QZXJjZW50YWdlKHN0YXJ0LCBlbmQsIHBvc2l0aW9uKSB7XFxuXFx0XFx0XFx0XFx0XFx0cmV0dXJuIChwb3NpdGlvbiAtIHN0YXJ0KSAvIChlbmQgLSBzdGFydCk7XFxuXFx0XFx0XFx0XFx0fVxcblxcblxcdFxcdFxcdFxcdGZ1bmN0aW9uIGNoZWNrUGVyY2VudGFnZShwZXJjZW50YWdlKSB7XFxuXFx0XFx0XFx0XFx0XFx0aWYgKHBlcmNlbnRhZ2UgPCAwKSB7XFxuXFx0XFx0XFx0XFx0XFx0XFx0cmV0dXJuIDA7XFxuXFx0XFx0XFx0XFx0XFx0fSBlbHNlIGlmIChwZXJjZW50YWdlID4gMSkge1xcblxcdFxcdFxcdFxcdFxcdFxcdHJldHVybiAxO1xcblxcdFxcdFxcdFxcdFxcdH1cXG5cXHRcXHRcXHRcXHRcXHRyZXR1cm4gcGVyY2VudGFnZTtcXG5cXHRcXHRcXHRcXHR9XFxuXFxuXFx0XFx0XFx0XFx0dmFyIGRyYWdnYWJsZUVsZW1lbnQgPSB1aS5kcmFnZ2FibGUuZ2V0KDApLFxcblxcdFxcdFxcdFxcdFxcdGRyb3B6b25lRWxlbWVudCA9IGV2ZW50LnRhcmdldDtcXG5cXG5cXHRcXHRcXHRcXHQvL3dpdGggcmVjdC50b3Agb3IgcmVjdC5sZWZ0IHlvdSBjYW4gZ2V0IGNvb3JkaW5hdGVzXFxuXFx0XFx0XFx0XFx0dmFyIGRyYWdSZWN0ID0gZHJhZ2dhYmxlRWxlbWVudC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcXG5cXHRcXHRcXHRcXHR2YXIgZHJvcFJlY3QgPSBkcm9wem9uZUVsZW1lbnQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XFxuXFxuXFx0XFx0XFx0XFx0dmFyIGNlbnRlckRyYWdYID0gKGRyYWdSZWN0LnJpZ2h0ICsgZHJhZ1JlY3QubGVmdCkgLyAyO1xcblxcdFxcdFxcdFxcdHZhciBjZW50ZXJEcmFnWSA9IChkcmFnUmVjdC50b3AgKyBkcmFnUmVjdC5ib3R0b20pIC8gMjtcXG5cXG5cXHRcXHRcXHRcXHR2YXIgcGVyY2VudGFnZVggPSBjaGVja1BlcmNlbnRhZ2UoZmluZFBvc2l0aW9uUGVyY2VudGFnZShkcm9wUmVjdC5sZWZ0LCBkcm9wUmVjdC5yaWdodCwgY2VudGVyRHJhZ1gpKTtcXG5cXHRcXHRcXHRcXHR2YXIgcGVyY2VudGFnZVkgPSBjaGVja1BlcmNlbnRhZ2UoZmluZFBvc2l0aW9uUGVyY2VudGFnZShkcm9wUmVjdC50b3AsIGRyb3BSZWN0LmJvdHRvbSwgY2VudGVyRHJhZ1kpKTtcXG5cXG5cXHRcXHRcXHRcXHRkcmFnZ2FibGVFbGVtZW50LnNldEF0dHJpYnV0ZSgnZGF0YS1xdWl6LXdpZHRoJywgZHJhZ1JlY3Qud2lkdGgpO1xcblxcdFxcdFxcdFxcdGRyYWdnYWJsZUVsZW1lbnQuc2V0QXR0cmlidXRlKCdkYXRhLXF1aXotaGVpZ2h0JywgZHJhZ1JlY3QuaGVpZ2h0KTtcXG5cXG5cXHRcXHRcXHRcXHRkcmFnZ2FibGVFbGVtZW50LnNldEF0dHJpYnV0ZSgnZGF0YS1xdWl6LXBlcmNlbnRhZ2UteCcsIHBlcmNlbnRhZ2VYKTtcXG5cXHRcXHRcXHRcXHRkcmFnZ2FibGVFbGVtZW50LnNldEF0dHJpYnV0ZSgnZGF0YS1xdWl6LXBlcmNlbnRhZ2UteScsIHBlcmNlbnRhZ2VZKTtcXG5cXG5cXHRcXHRcXHRcXHR2YXIgcXVlc3Rpb25OdW0gPSBkcmFnZ2FibGVFbGVtZW50LmlkLnNwbGl0KFxcXCJxXFxcIilbMV0uc3BsaXQoXFxcImFcXFwiKVswXTtcXG5cXHRcXHRcXHRcXHR2YXIgYW5zd2VyTnVtID0gZHJhZ2dhYmxlRWxlbWVudC5pZC5zcGxpdChcXFwiYVxcXCIpWzFdO1xcblxcblxcdFxcdFxcdFxcdC8vIHNuYXAgZHJhZ2dhYmxlIHRvIGRyb3B6b25lXFxuXFx0XFx0XFx0XFx0aWYgKGRyYWdnYWJsZUVsZW1lbnQuY2xhc3NMaXN0LmNvbnRhaW5zKFxcXCJkZC1zb2x1dGlvblxcXCIpICYmICFkcm9wem9uZUVsZW1lbnQuY2xhc3NMaXN0LmNvbnRhaW5zKFxcXCJwaWN0dXJlLWRyb3B6b25lLXF1aXpcXFwiKSkge1xcblxcdFxcdFxcdFxcdFxcdHVpLmRyYWdnYWJsZS5wb3NpdGlvbih7XFxuXFx0XFx0XFx0XFx0XFx0XFx0b2Y6ICQodGhpcyksXFxuXFx0XFx0XFx0XFx0XFx0XFx0bXk6ICdjZW50ZXInLFxcblxcdFxcdFxcdFxcdFxcdFxcdGF0OiAnbWlkZGxlJ1xcblxcdFxcdFxcdFxcdFxcdH0pO1xcblxcdFxcdFxcdFxcdH1cXG5cXHRcXHRcXHR9LFxcblxcdFxcdFxcdGRlYWN0aXZhdGU6IGZ1bmN0aW9uIChldmVudCwgdWkpIHtcXG5cXHRcXHRcXHRcXHR2YXIgZHJhZ2dhYmxlRWxlbWVudCA9IHVpLmRyYWdnYWJsZS5nZXQoMCksXFxuXFx0XFx0XFx0XFx0XFx0ZHJvcHpvbmVFbGVtZW50ID0gZXZlbnQudGFyZ2V0O1xcblxcblxcdFxcdFxcdFxcdC8vIHJlbW92ZSBhY3RpdmUgZHJvcHpvbmUgZmVlZGJhY2tcXG5cXHRcXHRcXHRcXHRkcm9wem9uZUVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZSgnZHJvcC1hY3RpdmUnKTtcXG5cXHRcXHRcXHRcXHRkcm9wem9uZUVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZSgnZHJvcC10YXJnZXQnKTtcXG5cXHRcXHRcXHRcXHRkcmFnZ2FibGVFbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUoJ2Nhbi1kcm9wJyk7XFxuXFx0XFx0XFx0fVxcblxcdFxcdH0pO1xcbn1cXG5cXG4vLyBEcmFnIG9uIHBpY3R1cmUgZWxlbWVudHMgY2FuIGJlIGFkZGVkIGR5bmFtaWNhbGx5IGluIHF1aXogZWRpdG9yIHRodXMgdGhpcyBoYXMgYmVlbiBleHRyYWN0ZWQgdG8gYSBzZXBhcmF0ZSBmdW5jdGlvblxcbmZ1bmN0aW9uIGluaXREcmFnT25QaWN0dXJlQW5zd2VyRWxlbWVudChlbGVtZW50KSB7XFxuXFx0JChlbGVtZW50KVxcblxcdFxcdC5kcmFnZ2FibGUoe1xcblxcdFxcdFxcdHJldmVydDogJ2ludmFsaWQnLFxcblxcdFxcdFxcdGRpc3RhbmNlOiA3LFxcblxcblxcdFxcdFxcdHN0YXJ0OiBmdW5jdGlvbiAoZXZlbnQpIHtcXG5cXHRcXHRcXHRcXHR2YXIgZHJhZ2dhYmxlRWxlbWVudCA9IGV2ZW50LnRhcmdldDtcXG5cXG5cXHRcXHRcXHRcXHRkcmFnZ2FibGVFbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUoJ3N1Y2Nlc3MnKTtcXG5cXHRcXHRcXHRcXHRkcmFnZ2FibGVFbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUoJ2RhbmdlcicpO1xcblxcdFxcdFxcdFxcdGRyYWdnYWJsZUVsZW1lbnQuY2xhc3NMaXN0LmFkZCgnY2FuLWRyb3AnKTtcXG5cXG5cXHRcXHRcXHRcXHQvLyBtYXJrIGVsZW1lbnQgYXMgYmVpbmcgYWN0aXZlXFxuXFx0XFx0XFx0XFx0ZHJhZ2dhYmxlRWxlbWVudC5jbGFzc0xpc3QuYWRkKCdkcmFnZ2FibGUtYWN0aXZlJyk7XFxuXFxuXFx0XFx0XFx0XFx0RHJhZ0NvdW50ZXIub25EcmFnU3RhcnQoZHJhZ2dhYmxlRWxlbWVudCk7XFxuXFx0XFx0XFx0fSxcXG5cXHRcXHRcXHRzdG9wOiBmdW5jdGlvbiAoZXZlbnQpIHtcXG5cXHRcXHRcXHRcXHR2YXIgZHJhZ2dhYmxlRWxlbWVudCA9IGV2ZW50LnRhcmdldDtcXG5cXG5cXHRcXHRcXHRcXHRkcmFnZ2FibGVFbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUoJ2Nhbi1kcm9wJyk7XFxuXFxuXFx0XFx0XFx0XFx0Ly8gdW5tYXJrIGFjdGl2ZSBlbGVtZW50XFxuXFx0XFx0XFx0XFx0ZHJhZ2dhYmxlRWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKCdkcmFnZ2FibGUtYWN0aXZlJyk7XFxuXFxuXFx0XFx0XFx0XFx0RHJhZ0NvdW50ZXIub25EcmFnRW5kKGRyYWdnYWJsZUVsZW1lbnQpO1xcblxcdFxcdFxcdH1cXG5cXHRcXHR9KVxcblxcdFxcdC8vIGNvbnRhaW5tZW50IC0gd2UgYXJlIHRhcmdldGluZyBlbGVtZW50J3MgYW5jZXN0b3IsIG5vdCB1bmlxdWUgZWxlbWVudFxcblxcdFxcdC5lYWNoKGZ1bmN0aW9uICgpIHtcXG5cXHRcXHRcXHQkKHRoaXMpLmRyYWdnYWJsZSh7XFxuXFx0XFx0XFx0XFx0Y29udGFpbm1lbnQ6ICQodGhpcykuY2xvc2VzdCgnLmRyYWdnYWJsZS1hcmVhJylcXG5cXHRcXHRcXHR9KTtcXG5cXHRcXHR9KTtcXG59XFxuXFxuLy8gLS0tLS0tLS0tLSBpbml0aWFsaXplIFxcXCJjbGljayB0byBncmFiLCBjbGljayB0byByZWxlYXNlXFxcIiBmb3IgZHJhZyBvbiBwaWN0dXJlIGVsZW1lbnRzXFxuXFxuZnVuY3Rpb24gaW5pdERyYWdPblBpY3R1cmVBbnN3ZXJFbGVtZW50QnlDbGljayhlbGVtZW50KSB7XFxuXFx0bGV0IGRyYWdnYWJsZUVsZW1lbnQ7XFxuXFx0bGV0IHRhc2tJZDtcXG5cXG5cXHQkKGVsZW1lbnQpLm9mZignZHJhZ2dhYmxlIGNsaWNrJykub24oJ2NsaWNrJywgZnVuY3Rpb24gKGV2ZW50KSB7XFxuXFx0XFx0aWYgKGV2ZW50LndoaWNoID09PSAxKSB7XFxuXFx0XFx0XFx0dGFza0lkID0gZ2V0UGFyZW50UXVlc3Rpb25Ub3BFbGVtZW50KGV2ZW50LnRhcmdldCkuZ2V0QXR0cmlidXRlKCdpZCcpO1xcblxcblxcdFxcdFxcdGlmICgkKCcuZHJhZ2dhYmxlLXJlc3RyaWN0ZWQuY2FuLWRyb3AnKS5sZW5ndGgpIHtcXG5cXHRcXHRcXHRcXHQkKCcuZHJhZ2dhYmxlLXJlc3RyaWN0ZWQuY2FuLWRyb3AnKS5yZW1vdmVDbGFzcygnY2FuLWRyb3AgZHJhZ2dhYmxlLWFjdGl2ZSBvdmVyJyk7XFxuXFx0XFx0XFx0fVxcblxcblxcdFxcdFxcdGRyYWdnYWJsZUVsZW1lbnQgPSBlbGVtZW50O1xcblxcdFxcdFxcdGRyYWdnYWJsZUVsZW1lbnQuY2xhc3NMaXN0LmFkZCgnY2FuLWRyb3AnKTtcXG5cXG5cXHRcXHRcXHRkcm9wQW5zd2VyRWxlbWVudE9uUGljdHVyZShkcmFnZ2FibGVFbGVtZW50LCB0YXNrSWQpO1xcblxcdFxcdH1cXG5cXHR9KTtcXG59XFxuXFxuZnVuY3Rpb24gZHJvcEFuc3dlckVsZW1lbnRPblBpY3R1cmUoZHJhZ2dhYmxlRWxlbWVudCwgdGFza0lkKSB7XFxuXFx0JChgIyR7dGFza0lkfSAucGljdHVyZS1kcm9wYXJlYWApLm9mZignY2xpY2snKS5vbignY2xpY2snLCBmdW5jdGlvbiAoZXZlbnQpIHtcXG5cXHRcXHRmdW5jdGlvbiBmaW5kUG9zaXRpb25QZXJjZW50YWdlKHN0YXJ0LCBlbmQsIHBvc2l0aW9uKSB7XFxuXFx0XFx0XFx0cmV0dXJuIChwb3NpdGlvbiAtIHN0YXJ0KSAvIChlbmQgLSBzdGFydCk7XFxuXFx0XFx0fVxcblxcblxcdFxcdGZ1bmN0aW9uIGNoZWNrUGVyY2VudGFnZShwZXJjZW50YWdlKSB7XFxuXFx0XFx0XFx0aWYgKHBlcmNlbnRhZ2UgPCAwKSB7XFxuXFx0XFx0XFx0XFx0cmV0dXJuIDA7XFxuXFx0XFx0XFx0fSBlbHNlIGlmIChwZXJjZW50YWdlID4gMSkge1xcblxcdFxcdFxcdFxcdHJldHVybiAxO1xcblxcdFxcdFxcdH1cXG5cXHRcXHRcXHRyZXR1cm4gcGVyY2VudGFnZTtcXG5cXHRcXHR9XFxuXFxuXFx0XFx0dmFyIGRyb3B6b25lRWxlbWVudCA9IGV2ZW50LnRhcmdldDtcXG5cXG5cXHRcXHQvL3dpdGggcmVjdC50b3Agb3IgcmVjdC5sZWZ0IHlvdSBjYW4gZ2V0IGNvb3JkaW5hdGVzXFxuXFx0XFx0dmFyIGRyYWdSZWN0ID0gZHJhZ2dhYmxlRWxlbWVudC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcXG5cXHRcXHR2YXIgZHJvcFJlY3QgPSBkcm9wem9uZUVsZW1lbnQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XFxuXFxuXFx0XFx0dmFyIHBlcmNlbnRhZ2VYID0gY2hlY2tQZXJjZW50YWdlKGZpbmRQb3NpdGlvblBlcmNlbnRhZ2UoZHJvcFJlY3QubGVmdCwgZHJvcFJlY3QucmlnaHQsIGV2ZW50LmNsaWVudFgpKTtcXG5cXHRcXHR2YXIgcGVyY2VudGFnZVkgPSBjaGVja1BlcmNlbnRhZ2UoZmluZFBvc2l0aW9uUGVyY2VudGFnZShkcm9wUmVjdC50b3AsIGRyb3BSZWN0LmJvdHRvbSwgZXZlbnQuY2xpZW50WSkpO1xcblxcblxcdFxcdGRyYWdnYWJsZUVsZW1lbnQuc2V0QXR0cmlidXRlKCdkYXRhLXF1aXotd2lkdGgnLCBkcmFnUmVjdC53aWR0aCk7XFxuXFx0XFx0ZHJhZ2dhYmxlRWxlbWVudC5zZXRBdHRyaWJ1dGUoJ2RhdGEtcXVpei1oZWlnaHQnLCBkcmFnUmVjdC5oZWlnaHQpO1xcblxcblxcdFxcdGRyYWdnYWJsZUVsZW1lbnQuc2V0QXR0cmlidXRlKCdkYXRhLXF1aXotcGVyY2VudGFnZS14JywgcGVyY2VudGFnZVgpO1xcblxcdFxcdGRyYWdnYWJsZUVsZW1lbnQuc2V0QXR0cmlidXRlKCdkYXRhLXF1aXotcGVyY2VudGFnZS15JywgcGVyY2VudGFnZVkpO1xcblxcblxcdFxcdC8vIGdldCBwb3NpdGlvbmVkIGRyYWdnYWJsZXMnIHBvc2l0aW9uc1xcblxcdFxcdHZhciBxdWl6UGVyY2VudGFnZVhWYWx1ZSA9IHBhcnNlRmxvYXQoZHJhZ2dhYmxlRWxlbWVudC5nZXRBdHRyaWJ1dGUoJ2RhdGEtcXVpei1wZXJjZW50YWdlLXgnKSB8fCAtMSk7XFxuXFx0XFx0dmFyIHF1aXpQZXJjZW50YWdlWVZhbHVlID0gcGFyc2VGbG9hdChkcmFnZ2FibGVFbGVtZW50LmdldEF0dHJpYnV0ZSgnZGF0YS1xdWl6LXBlcmNlbnRhZ2UteScpIHx8IC0xKTtcXG5cXHRcXHR2YXIgcXVpeldpZHRoID0gcGFyc2VGbG9hdChkcmFnZ2FibGVFbGVtZW50LmdldEF0dHJpYnV0ZSgnZGF0YS1xdWl6LXdpZHRoJykgfHwgLTEpO1xcblxcdFxcdHZhciBxdWl6SGVpZ2h0ID0gcGFyc2VGbG9hdChkcmFnZ2FibGVFbGVtZW50LmdldEF0dHJpYnV0ZSgnZGF0YS1xdWl6LWhlaWdodCcpIHx8IC0xKTtcXG5cXG5cXHRcXHQvLyBnZXQgcG9zaXRpb25lZCBkcmFnZ2FibGVzJyBwb3NpdGlvbnNcXG5cXHRcXHRpZiAocXVpelBlcmNlbnRhZ2VYVmFsdWUgPj0gMCAmJiBxdWl6UGVyY2VudGFnZVhWYWx1ZSA+PSAwKSB7XFxuXFx0XFx0XFx0LypcXG5cXHRcXHRcXHRcXHRcXHRcXHQgKiBEcmFnZ2FibGVzIGFyZSBwb3NpdGlvbmVkIHJlbGF0aXZlbHkgdG8gc3RhcnRpbmcgcG9zaXRpb24uIEluIG9yZGVyIHRvIHJlcG9zaXRpb24gdGhlbSBwcm9wZXJseSBhZnRlclxcblxcdFxcdFxcdFxcdFxcdFxcdCAqIHJlc2l6ZSwgd2UgaGF2ZSB0byByZXNldCB0aGVpciBwb3NpdGlvbmluZyB0byBnZXQgbmV3IHN0YXJ0aW5nIHBvaW50cyBhbmQgdGhlbiBjYWxjdWxhdGUgbmV3IHBvc3Rpb25zXFxuXFx0XFx0XFx0XFx0XFx0XFx0ICogcmVsYXRpdmVseSB0byB0aGVtLlxcblxcdFxcdFxcdFxcdFxcdFxcdCAqL1xcblxcdFxcdFxcdGRyYWdnYWJsZUVsZW1lbnQuc3R5bGUudHJhbnNmb3JtID0gJyc7XFxuXFx0XFx0XFx0Ly8gLS0tLS0gY2FsY3VsYXRlIFhcXG5cXHRcXHRcXHR2YXIgcXVpelBlcmNlbnRhZ2VYID0gcGFyc2VGbG9hdChxdWl6UGVyY2VudGFnZVhWYWx1ZSk7XFxuXFx0XFx0XFx0Ly8gcGVyY2VudGFnZXMgYXJlIGNhbGN1bGF0ZWQgYWNjb3JkaW5nIHRvIGRyYWdnYWJsZSdzIGNlbnRlciBwb2ludCwgc28gd2UgaGF2ZSB0byByZXZlcnNlIHRoYXQgY2FsY3VsYXRpb24gdG8gZ2V0IG5ldyBhYnNvbHV0ZSBwb3NpdGlvblxcblxcdFxcdFxcdHZhciBuZXdBYnNvbHV0ZUxlZnQgPSBkcm9wUmVjdC5sZWZ0ICsgZHJvcFJlY3Qud2lkdGggKiBxdWl6UGVyY2VudGFnZVggLSBxdWl6V2lkdGggLyAyO1xcblxcdFxcdFxcdC8vIG5ldyByZWxhdGl2ZSBwb3NpdGlvblxcblxcdFxcdFxcdHZhciBuZXdMZWZ0ID0gbmV3QWJzb2x1dGVMZWZ0IC0gZHJhZ1JlY3QubGVmdDtcXG5cXHRcXHRcXHQvLyBzZXQgbmV3IGhvcml6b250YWwgcG9zaXRpb25cXG5cXG5cXHRcXHRcXHQvLyAtLS0tLSBjYWxjdWxhdGUgWVxcblxcdFxcdFxcdHZhciBxdWl6UGVyY2VudGFnZVkgPSBwYXJzZUZsb2F0KHF1aXpQZXJjZW50YWdlWVZhbHVlKTtcXG5cXHRcXHRcXHQvLyBwZXJjZW50YWdlcyBhcmUgY2FsY3VsYXRlZCBhY2NvcmRpbmcgdG8gZHJhZ2dhYmxlJ3MgY2VudGVyIHBvaW50LCBzbyB3ZSBoYXZlIHRvIHJldmVyc2UgdGhhdCBjYWxjdWxhdGlvbiB0byBnZXQgbmV3IGFic29sdXRlIHBvc2l0aW9uXFxuXFx0XFx0XFx0dmFyIG5ld0Fic29sdXRlVG9wID0gZHJvcFJlY3QudG9wICsgZHJvcFJlY3QuaGVpZ2h0ICogcXVpelBlcmNlbnRhZ2VZIC0gcXVpekhlaWdodCAvIDI7XFxuXFx0XFx0XFx0Ly8gbmV3IHJlbGF0aXZlIHBvc2l0aW9uXFxuXFx0XFx0XFx0dmFyIG5ld1RvcCA9IG5ld0Fic29sdXRlVG9wIC0gZHJhZ1JlY3QudG9wO1xcblxcblxcdFxcdFxcdGlmICghZHJhZ2dhYmxlRWxlbWVudC5zdHlsZS5sZWZ0ICYmICFkcmFnZ2FibGVFbGVtZW50LnN0eWxlLnRvcCkge1xcblxcdFxcdFxcdFxcdCQoZHJhZ2dhYmxlRWxlbWVudCkuY3NzKHtcXG5cXHRcXHRcXHRcXHRcXHR0b3A6IG5ld1RvcCxcXG5cXHRcXHRcXHRcXHRcXHRsZWZ0OiBuZXdMZWZ0LFxcblxcdFxcdFxcdFxcdFxcdGJhY2tncm91bmQ6ICcjZmZmJyxcXG5cXHRcXHRcXHRcXHRcXHRjb2xvcjogJyMwMDAnLFxcblxcdFxcdFxcdFxcdH0pO1xcblxcdFxcdFxcdH0gZWxzZSB7XFxuXFx0XFx0XFx0XFx0bmV3TGVmdCA9IG5ld0xlZnQgKyBwYXJzZUZsb2F0KGRyYWdnYWJsZUVsZW1lbnQuc3R5bGUubGVmdCk7XFxuXFx0XFx0XFx0XFx0bmV3VG9wID0gbmV3VG9wICsgcGFyc2VGbG9hdChkcmFnZ2FibGVFbGVtZW50LnN0eWxlLnRvcCk7XFxuXFx0XFx0XFx0XFx0JChkcmFnZ2FibGVFbGVtZW50KS5jc3Moe1xcblxcdFxcdFxcdFxcdFxcdHRvcDogbmV3VG9wLFxcblxcdFxcdFxcdFxcdFxcdGxlZnQ6IG5ld0xlZnQsXFxuXFx0XFx0XFx0XFx0XFx0YmFja2dyb3VuZDogJyNmZmYnLFxcblxcdFxcdFxcdFxcdFxcdGNvbG9yOiAnIzAwMCcsXFxuXFx0XFx0XFx0XFx0fSk7XFxuXFx0XFx0XFx0fVxcblxcdFxcdH1cXG5cXHR9KTtcXG59XFxuXFxuLy8gLS0tLS0tLS0tLSBpbml0aWFsaXplIFxcXCJjbGljayB0byBncmFiLCBjbGljayB0byByZWxlYXNlXFxcIiBmb3IgZHJhZyBlbGVtZW50c1xcblxcbmZ1bmN0aW9uIGluaXREcmFnT25FbGVtZW50Q2xpY2soKSB7XFxuXFx0bGV0IHRhc2tJZDtcXG5cXHRsZXQgdGFza1R5cGU7XFxuXFx0bGV0IGRyYWdnYWJsZUVsZW1lbnQ7XFxuXFx0bGV0IGRyb3B6b25lRWxlbWVudDtcXG5cXG5cXHQkKCcuZHJhZ2dhYmxlLmRvcy1hbnN3ZXItZHJhZ2dhYmxlLCAucGFpci1kcmFnZ2FibGUnKS5vZmYoJ2RyYWdnYWJsZSBjbGljaycpLm9uKCdjbGljaycsIGZ1bmN0aW9uIChldmVudCkge1xcblxcdFxcdC8vIGlmIGxlZnQgbW91c2UgY2xpY2tcXG5cXHRcXHRpZiAoZXZlbnQud2hpY2ggPT09IDEpIHtcXG5cXHRcXHRcXHRpZiAoJCgnLmRyYWdnYWJsZS5kb3MtYW5zd2VyLWRyYWdnYWJsZSwgLnBhaXItZHJhZ2dhYmxlJykuZHJhZ2dhYmxlKCkpIHtcXG5cXHRcXHRcXHRcXHQkKCcuZHJhZ2dhYmxlLmRvcy1hbnN3ZXItZHJhZ2dhYmxlLCAucGFpci1kcmFnZ2FibGUnKS5kcmFnZ2FibGUoJ2Rpc2FibGUnKTtcXG5cXHRcXHRcXHR9XFxuXFxuXFx0XFx0XFx0dGFza0lkID0gYCR7JChldmVudC50YXJnZXQpLmNsb3Nlc3QoJ2RpdltpZCo9XFxcIl9xdWVzdGlvbklkX1xcXCJdJykuYXR0cignaWQnKX1gO1xcblxcblxcdFxcdFxcdC8vIGZpbmQgcXVlc3Rpb24gdHlwZVxcblxcdFxcdFxcdGlmICh0YXNrSWQpIHtcXG5cXHRcXHRcXHRcXHR0YXNrVHlwZSA9ICQoJChgZGl2W2lkKj0nJHt0YXNrSWR9J11gKVswXSkuYXR0cignZGF0YS1xdWVzdGlvbi10eXBlJyk7XFxuXFx0XFx0XFx0fVxcblxcblxcdFxcdFxcdGlmICgkKCcuZHJhZ2dhYmxlLmNhbi1kcm9wLXN0eWxlJykubGVuZ3RoICYmIHRhc2tUeXBlID09PSBxdWVzdGlvblR5cGVzLmRyYWdFbGVtZW50cykge1xcblxcdFxcdFxcdFxcdCQoJy5kcmFnZ2FibGUuY2FuLWRyb3Atc3R5bGUnKS5yZW1vdmVDbGFzcygnY2FuLWRyb3Atc3R5bGUgZHJhZ2dhYmxlLWFjdGl2ZSBvdmVyJyk7XFxuXFx0XFx0XFx0fVxcblxcblxcdFxcdFxcdGlmICh0YXNrVHlwZSA9PT0gcXVlc3Rpb25UeXBlcy5kcmFnUGFpcnMgfHwgdGFza1R5cGUgPT09IHF1ZXN0aW9uVHlwZXMuZHJhZ09yZGVyRWxlbWVudHMpIHtcXG5cXHRcXHRcXHRcXHRpZiAoIWRyYWdnYWJsZUVsZW1lbnQpIHtcXG5cXHRcXHRcXHRcXHRcXHRpZiAoJChldmVudC50YXJnZXQpLnBhcmVudHMoJy5kcmFnZ2FibGUuZG9zLWFuc3dlci1kcmFnZ2FibGUsIC5wYWlyLWRyYWdnYWJsZScpWzBdKSB7XFxuXFx0XFx0XFx0XFx0XFx0XFx0ZHJhZ2dhYmxlRWxlbWVudCA9ICQoZXZlbnQudGFyZ2V0KS5wYXJlbnRzKCcuZHJhZ2dhYmxlLmRvcy1hbnN3ZXItZHJhZ2dhYmxlLCAucGFpci1kcmFnZ2FibGUnKVswXTtcXG5cXHRcXHRcXHRcXHRcXHRcXHRkcmFnZ2FibGVFbGVtZW50LmZvY3VzKCk7XFxuXFx0XFx0XFx0XFx0XFx0fSBlbHNlIHtcXG5cXHRcXHRcXHRcXHRcXHRcXHRkcmFnZ2FibGVFbGVtZW50ID0gZXZlbnQudGFyZ2V0O1xcblxcdFxcdFxcdFxcdFxcdFxcdGRyYWdnYWJsZUVsZW1lbnQuZm9jdXMoKTtcXG5cXHRcXHRcXHRcXHRcXHR9XFxuXFx0XFx0XFx0XFx0fSBlbHNlIHtcXG5cXHRcXHRcXHRcXHRcXHRpZiAoJChkcmFnZ2FibGVFbGVtZW50KS5jbG9zZXN0KCdkaXZbaWQqPVxcXCJfcXVlc3Rpb25JZF9cXFwiXScpLmF0dHIoJ2lkJykgPT09ICQoZXZlbnQudGFyZ2V0KS5jbG9zZXN0KCdkaXZbaWQqPVxcXCJfcXVlc3Rpb25JZF9cXFwiXScpLmF0dHIoJ2lkJykpIHtcXG5cXHRcXHRcXHRcXHRcXHRcXHRpZiAoJChldmVudC50YXJnZXQpLnBhcmVudHMoJy5kcmFnZ2FibGUuZG9zLWFuc3dlci1kcmFnZ2FibGUsIC5wYWlyLWRyYWdnYWJsZScpWzBdKSB7XFxuXFx0XFx0XFx0XFx0XFx0XFx0XFx0ZHJvcHpvbmVFbGVtZW50ID0gJChldmVudC50YXJnZXQpLnBhcmVudHMoJy5kcmFnZ2FibGUuZG9zLWFuc3dlci1kcmFnZ2FibGUsIC5wYWlyLWRyYWdnYWJsZScpWzBdO1xcblxcdFxcdFxcdFxcdFxcdFxcdH0gZWxzZSB7XFxuXFx0XFx0XFx0XFx0XFx0XFx0XFx0ZHJvcHpvbmVFbGVtZW50ID0gZXZlbnQudGFyZ2V0O1xcblxcdFxcdFxcdFxcdFxcdFxcdH1cXG5cXHRcXHRcXHRcXHRcXHR9IGVsc2Uge1xcblxcdFxcdFxcdFxcdFxcdFxcdGlmICgkKGV2ZW50LnRhcmdldCkucGFyZW50cygnLmRyYWdnYWJsZS5kb3MtYW5zd2VyLWRyYWdnYWJsZSwgLnBhaXItZHJhZ2dhYmxlJylbMF0pIHtcXG5cXHRcXHRcXHRcXHRcXHRcXHRcXHRkcmFnZ2FibGVFbGVtZW50ID0gJChldmVudC50YXJnZXQpLnBhcmVudHMoJy5kcmFnZ2FibGUuZG9zLWFuc3dlci1kcmFnZ2FibGUsIC5wYWlyLWRyYWdnYWJsZScpWzBdO1xcblxcdFxcdFxcdFxcdFxcdFxcdH0gZWxzZSB7XFxuXFx0XFx0XFx0XFx0XFx0XFx0XFx0ZHJhZ2dhYmxlRWxlbWVudCA9IGV2ZW50LnRhcmdldDtcXG5cXHRcXHRcXHRcXHRcXHRcXHR9XFxuXFx0XFx0XFx0XFx0XFx0fVxcblxcdFxcdFxcdFxcdH1cXG5cXG5cXHRcXHRcXHRcXHRpZiAoZHJhZ2dhYmxlRWxlbWVudCAmJiBkcm9wem9uZUVsZW1lbnQgJiYgdGFza0lkID09PSAkKGRyYWdnYWJsZUVsZW1lbnQpLmNsb3Nlc3QoJ2RpdltpZCo9XFxcIl9xdWVzdGlvbklkX1xcXCJdJykuYXR0cignaWQnKSkge1xcblxcdFxcdFxcdFxcdFxcdGRyYWdnYWJsZUVsZW1lbnQuYmx1cigpO1xcblxcdFxcdFxcdFxcdFxcdHJlcGxhY2VQYWlycyhkcm9wem9uZUVsZW1lbnQsIGRyYWdnYWJsZUVsZW1lbnQpO1xcblxcblxcdFxcdFxcdFxcdFxcdGRyYWdnYWJsZUVsZW1lbnQgPSBudWxsO1xcblxcdFxcdFxcdFxcdFxcdGRyb3B6b25lRWxlbWVudCA9IG51bGw7XFxuXFx0XFx0XFx0XFx0XFx0dGFza1R5cGUgPSBudWxsO1xcblxcdFxcdFxcdFxcdFxcdHRhc2tJZCA9IG51bGw7XFxuXFx0XFx0XFx0XFx0fVxcblxcdFxcdFxcdH0gZWxzZSB7XFxuXFx0XFx0XFx0XFx0aWYgKCQoZXZlbnQudGFyZ2V0KS5wYXJlbnRzKCcuZHJhZ2dhYmxlLmRvcy1hbnN3ZXItZHJhZ2dhYmxlLCAucGFpci1kcmFnZ2FibGUnKVswXSkge1xcblxcdFxcdFxcdFxcdFxcdGRyYWdnYWJsZUVsZW1lbnQgPSAkKGV2ZW50LnRhcmdldCkucGFyZW50cygnLmRyYWdnYWJsZS5kb3MtYW5zd2VyLWRyYWdnYWJsZSwgLnBhaXItZHJhZ2dhYmxlJylbMF07XFxuXFx0XFx0XFx0XFx0fSBlbHNlIHtcXG5cXHRcXHRcXHRcXHRcXHRkcmFnZ2FibGVFbGVtZW50ID0gZXZlbnQudGFyZ2V0O1xcblxcdFxcdFxcdFxcdH1cXG5cXG5cXHRcXHRcXHRcXHRpZiAodGFza1R5cGUgPT09IHF1ZXN0aW9uVHlwZXMuZHJhZ0VsZW1lbnRzKSB7XFxuXFx0XFx0XFx0XFx0XFx0JChkcmFnZ2FibGVFbGVtZW50KS5hZGRDbGFzcygnY2FuLWRyb3Atc3R5bGUnKTtcXG5cXHRcXHRcXHRcXHR9XFxuXFx0XFx0XFx0fVxcblxcdFxcdFxcdCQoJy5kcmFnZ2FibGUuZG9zLWFuc3dlci1kcmFnZ2FibGUsIC5wYWlyLWRyYWdnYWJsZScpLmRyYWdnYWJsZSgnZW5hYmxlJyk7XFxuXFx0XFx0fVxcblxcdH0pO1xcblxcblxcdCQoJy5kcm9wem9uZSwgLmRyb3B6b25lLWhvbGRlciwgLnVpLWRyb3BwYWJsZScpLm9uKCdjbGljaycsIGZ1bmN0aW9uIChldmVudCkge1xcblxcdFxcdGlmIChldmVudC53aGljaCA9PT0gMSkge1xcblxcdFxcdFxcdHRhc2tJZCA9IGAkeyQoZXZlbnQudGFyZ2V0KS5jbG9zZXN0KCdkaXZbaWQqPVxcXCJfcXVlc3Rpb25JZF9cXFwiXScpLmF0dHIoJ2lkJyl9YDtcXG5cXG5cXHRcXHRcXHRpZiAoZXZlbnQudGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucygnZHJvcHpvbmUnKSAmJiB0YXNrSWQgPT09ICQoZHJhZ2dhYmxlRWxlbWVudCkuY2xvc2VzdCgnZGl2W2lkKj1cXFwiX3F1ZXN0aW9uSWRfXFxcIl0nKS5hdHRyKCdpZCcpKSB7XFxuXFx0XFx0XFx0XFx0ZHJhZ0Ryb3BBY3Rpb24oZXZlbnQudGFyZ2V0LCB0YXNrSWQsIGRyYWdnYWJsZUVsZW1lbnQpO1xcblxcdFxcdFxcdFxcdGRyYWdnYWJsZUVsZW1lbnQgPSBudWxsO1xcblxcdFxcdFxcdFxcdGRyb3B6b25lRWxlbWVudCA9IG51bGw7XFxuXFx0XFx0XFx0XFx0dGFza1R5cGUgPSBudWxsO1xcblxcdFxcdFxcdFxcdHRhc2tJZCA9IG51bGw7XFxuXFx0XFx0XFx0fVxcblxcdFxcdH1cXG5cXHR9KTtcXG59XFxuXFxuLy8gLS0tLS0tLS0tLSBpbml0aWFsaXplIFxcXCJkcmFnIHBhaXJzXFxcIiBxdWVzdGlvbiBlbGVtZW50c1xcblxcbmZ1bmN0aW9uIGluaXREcmFnUGFpcnNFbGVtZW50cyhxdWVzdGlvbklkKSB7XFxuXFx0cmVzZXRRdWl6UXVlc3Rpb24ocXVlc3Rpb25JZCwgdHJ1ZSk7XFxuXFxuXFx0dmFyIHF1ZXN0aW9uQ29udGV4dEVsZW1lbnQgPSBxdWVzdGlvbklkICYmIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKHF1ZXN0aW9uSWQpIHx8IGRvY3VtZW50O1xcblxcblxcdGxldCBkcmFnZ2FibGVFbGVtZW50O1xcblxcdGxldCBkcm9wem9uZUVsZW1lbnQ7XFxuXFxuXFx0Ly8gLS0tLS0gaW5pdGlhbGl6ZSBzd2l0Y2hhYmxlIHBhaXJzXFxuXFx0JChcXFwiLnBhaXItZHJhZ2dhYmxlXFxcIiwgcXVlc3Rpb25Db250ZXh0RWxlbWVudClcXG5cXHRcXHQuZHJhZ2dhYmxlKHtcXG5cXHRcXHRcXHRyZXZlcnQ6ICdpbnZhbGlkJyxcXG5cXHRcXHRcXHQvLyBUT0RPOiBjdXN0b20gb3ZlcmxhcHBpbmdcXG5cXHRcXHRcXHR0b2xlcmFuY2U6ICdpbnRlcnNlY3QnLFxcblxcdFxcdFxcdGRpc3RhbmNlOiA3LFxcblxcblxcdFxcdFxcdHN0YXJ0OiBmdW5jdGlvbiAoZXZlbnQpIHtcXG5cXHRcXHRcXHRcXHRkcmFnZ2FibGVFbGVtZW50ID0gZXZlbnQudGFyZ2V0O1xcblxcdFxcdFxcdFxcdCQoXFxcIi5wYWlyLWRyYWdnYWJsZVxcXCIpLm9mZignY2xpY2snKTtcXG5cXG5cXHRcXHRcXHRcXHQvLyBtYXJrIGVsZW1lbnQgYXMgYmVpbmcgYWN0aXZlXFxuXFx0XFx0XFx0XFx0ZHJhZ2dhYmxlRWxlbWVudC5jbGFzc0xpc3QuYWRkKCdkcmFnZ2FibGUtYWN0aXZlJyk7XFxuXFx0XFx0XFx0fSxcXG5cXG5cXHRcXHRcXHQvLyBjYWxsIHRoaXMgZnVuY3Rpb24gb24gZXZlcnkgZHJhZ2VuZCBldmVudFxcblxcdFxcdFxcdHN0b3A6IGZ1bmN0aW9uIChldmVudCkge1xcblxcdFxcdFxcdFxcdGV2ZW50LnRhcmdldC5zdHlsZS5sZWZ0ID0gXFxcIlxcXCI7XFxuXFx0XFx0XFx0XFx0ZXZlbnQudGFyZ2V0LnN0eWxlLnRvcCA9IFxcXCJcXFwiO1xcblxcblxcdFxcdFxcdFxcdC8vIHVubWFyayBhY3RpdmUgZWxlbWVudFxcblxcdFxcdFxcdFxcdGV2ZW50LnRhcmdldC5jbGFzc0xpc3QucmVtb3ZlKCdkcmFnZ2FibGUtYWN0aXZlJyk7XFxuXFx0XFx0XFx0XFx0ZXZlbnQudGFyZ2V0LmNsYXNzTGlzdC5yZW1vdmUoJ2Nhbi1kcm9wLXN0eWxlJyk7XFxuXFx0XFx0XFx0XFx0aWYgKCQoZXZlbnQudGFyZ2V0KS5jbG9zZXN0KFxcXCJkaXZbaWQqPSd1ZXN0aW9uSWQnXVxcXCIpLmZpbmQoJy5vdmVyJylbMF0pIHtcXG5cXHRcXHRcXHRcXHRcXHQkKGV2ZW50LnRhcmdldCkuY2xvc2VzdChcXFwiZGl2W2lkKj0ndWVzdGlvbklkJ11cXFwiKS5maW5kKCcub3ZlcicpWzBdLmNsYXNzTGlzdC5yZW1vdmUoJ292ZXInKTtcXG5cXHRcXHRcXHRcXHR9XFxuXFx0XFx0XFx0XFx0aW5pdERyYWdPbkVsZW1lbnRDbGljaygpO1xcblxcdFxcdFxcdH1cXG5cXHRcXHR9KVxcblxcdFxcdC8vIGNvbnRhaW5tZW50IC0gd2UgYXJlIHRhcmdldGluZyBlbGVtZW50J3MgYW5jZXN0b3IsIG5vdCB1bmlxdWUgZWxlbWVudFxcblxcdFxcdC5lYWNoKGZ1bmN0aW9uICgpIHtcXG5cXHRcXHRcXHQkKHRoaXMpLmRyYWdnYWJsZSh7XFxuXFx0XFx0XFx0XFx0Y29udGFpbm1lbnQ6ICQodGhpcykuY2xvc2VzdCgnLnF1ZXN0aW9uJylcXG5cXHRcXHRcXHR9KTtcXG5cXHRcXHR9KTtcXG5cXG5cXG5cXHQvLyBlbmFibGUgZHJhZ2dhYmxlcyB0byBiZSBkcm9wcGVkIGludG8gdGhpc1xcblxcdCQoXFxcIi5wYWlyLWRyYWdnYWJsZVxcXCIsIHF1ZXN0aW9uQ29udGV4dEVsZW1lbnQpXFxuXFx0XFx0LmRyb3BwYWJsZSh7XFxuXFx0XFx0XFx0Ly8gVE9ETzogY3VzdG9tIG92ZXJsYXBwaW5nXFxuXFx0XFx0XFx0dG9sZXJhbmNlOiAnaW50ZXJzZWN0JyxcXG5cXG5cXHRcXHRcXHRvdmVyOiBmdW5jdGlvbiAoZXZlbnQpIHtcXG5cXHRcXHRcXHRcXHRkcm9wem9uZUVsZW1lbnQgPSBldmVudC50YXJnZXQ7XFxuXFx0XFx0XFx0XFx0ZHJvcHpvbmVFbGVtZW50LmNsYXNzTGlzdC5hZGQoJ292ZXInKTtcXG5cXHRcXHRcXHR9LFxcblxcdFxcdFxcdG91dDogZnVuY3Rpb24gKGV2ZW50KSB7XFxuXFx0XFx0XFx0XFx0Ly8gcmVtb3ZlIHRoZSBkcm9wIGZlZWRiYWNrIHN0eWxlXFxuXFx0XFx0XFx0XFx0ZXZlbnQudGFyZ2V0LmNsYXNzTGlzdC5yZW1vdmUoJ292ZXInKTtcXG5cXHRcXHRcXHR9LFxcblxcdFxcdFxcdGRyb3A6IGZ1bmN0aW9uIChldmVudCwgdWkpIHtcXG5cXHRcXHRcXHRcXHQvLyB0aGUgc2FtZSBlbCBjYW4gYmUgZHJhZ2dhYmxlIEFORCBkcm9wem9uZSwgd2UgaGF2ZSB0byByZW1vdmUgYWN0aXZpdHkgY2xhc3MgdG8gcHJldmVudCBpdCBmcm9tIGJlaW5nIGNvcGllZCB0byBkcm9wem9uZSBlbFxcblxcdFxcdFxcdFxcdGlmIChkcmFnZ2FibGVFbGVtZW50KSB7XFxuXFx0XFx0XFx0XFx0XFx0ZHJhZ2dhYmxlRWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKCdkcmFnZ2FibGUtYWN0aXZlJyk7XFxuXFx0XFx0XFx0XFx0XFx0ZHJhZ2dhYmxlRWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKCdjYW4tZHJvcC1zdHlsZScpO1xcblxcdFxcdFxcdFxcdH1cXG5cXHRcXHRcXHRcXHRldmVudC50YXJnZXQuY2xhc3NMaXN0LnJlbW92ZSgnb3ZlcicpO1xcblxcblxcdFxcdFxcdFxcdGlmIChkcm9wem9uZUVsZW1lbnQgJiYgZHJhZ2dhYmxlRWxlbWVudCkge1xcblxcdFxcdFxcdFxcdFxcdHJlcGxhY2VQYWlycyhkcm9wem9uZUVsZW1lbnQsIGRyYWdnYWJsZUVsZW1lbnQpO1xcblxcdFxcdFxcdFxcdFxcdGRyYWdnYWJsZUVsZW1lbnQgPSBudWxsO1xcblxcdFxcdFxcdFxcdFxcdGRyb3B6b25lRWxlbWVudCA9IG51bGw7XFxuXFx0XFx0XFx0XFx0fVxcblxcdFxcdFxcdH1cXG5cXHRcXHR9KVxcblxcdFxcdC8vIFRPRE86IHVzZSBDU1Mgc2VsZWN0aW9uIHByZXZlbnRpb25cXG5cXHRcXHQuZGlzYWJsZVNlbGVjdGlvbigpO1xcbn1cXG5cXG5mdW5jdGlvbiBpbml0S2V5Ym9hcmREcmFnRHJvcCgpIHtcXG5cXHRsZXQgZHJhZ2dhYmxlVGFza0lkcyA9IFtdO1xcblxcblxcdCQoJy5kcmFnZ2FibGUuZG9zLWFuc3dlci1kcmFnZ2FibGUsIC5wYWlyLWRyYWdnYWJsZScpLmVhY2goKGluZGV4LCBlbCkgPT4ge1xcblxcdFxcdGlmIChkcmFnZ2FibGVUYXNrSWRzLmluZGV4T2YoJChlbCkuY2xvc2VzdCgnZGl2W2lkKj1cXFwiX3F1ZXN0aW9uSWRfXFxcIl0nKS5hdHRyKCdpZCcpKSA8IDApIHtcXG5cXHRcXHRcXHRkcmFnZ2FibGVUYXNrSWRzLnB1c2goJChlbCkuY2xvc2VzdCgnZGl2W2lkKj1cXFwiX3F1ZXN0aW9uSWRfXFxcIl0nKS5hdHRyKCdpZCcpKTtcXG5cXHRcXHR9XFxuXFx0fSk7XFxuXFxuXFx0ZHJhZ2dhYmxlVGFza0lkcy5mb3JFYWNoKCh0YXNrSWQsIGluZGV4KSA9PiB7XFxuXFx0XFx0aWYgKCQoYCMke3Rhc2tJZH1gKS5hdHRyKCdkYXRhLXF1ZXN0aW9uLXR5cGUnKSAhPT0gcXVlc3Rpb25UeXBlcy5kcmFnRWxlbWVudHMpIHtcXG5cXHRcXHRcXHQkKGAjJHt0YXNrSWR9IC5kcmFnZ2FibGUsIC5wYWlyLWRyYWdnYWJsZWApLmVhY2goKGluZGV4LCBlbCkgPT4ge1xcblxcdFxcdFxcdFxcdGVsLnNldEF0dHJpYnV0ZSgndGFiaW5kZXgnLCAwKTtcXG5cXHRcXHRcXHRcXHRlbC5zZXRBdHRyaWJ1dGUoJ2FyaWEtbGFiZWwnLCBgJHtlbC5pbm5lclRleHR9IC0gZHJhZ2dhYmxlYCk7XFxuXFx0XFx0XFx0XFx0ZWwuc2V0QXR0cmlidXRlKCdhcmlhLWdyYWJiZWQnLCAnZmFsc2UnKTtcXG5cXHRcXHRcXHRcXHRlbC5zZXRBdHRyaWJ1dGUoJ2FyaWEtaGFzcG9wdXAnLCAndHJ1ZScpO1xcblxcdFxcdFxcdFxcdGVsLnNldEF0dHJpYnV0ZSgncm9sZScsICdsaXN0aXRlbScpO1xcblxcblxcdFxcdFxcdFxcdGRyYWcuaW5pdGlhbGlzZShlbCk7XFxuXFx0XFx0XFx0fSk7XFxuXFx0XFx0XFx0JChgIyR7dGFza0lkfSAuZHJvcHpvbmVgKS5lYWNoKChpbmRleCwgZWwpID0+IHtcXG5cXHRcXHRcXHRcXHRlbC5zZXRBdHRyaWJ1dGUoJ3RhYmluZGV4JywgMCk7XFxuXFx0XFx0XFx0XFx0ZWwuc2V0QXR0cmlidXRlKCdhcmlhLXNlbGVjdGVkJywgJ3RydWUnKTtcXG5cXHRcXHRcXHRcXHRlbC5zZXRBdHRyaWJ1dGUoJ3JvbGUnLCAnYnV0dG9uJyk7XFxuXFx0XFx0XFx0fSk7XFxuXFx0XFx0fSBlbHNlIHtcXG5cXHRcXHRcXHQkKGAjJHt0YXNrSWR9IC5kcm9wem9uZWApLmVhY2goKGluZGV4LCBlbCkgPT4ge1xcblxcdFxcdFxcdFxcdGVsLnNldEF0dHJpYnV0ZSgndGFiaW5kZXgnLCAwKTtcXG5cXHRcXHRcXHRcXHRlbC5zZXRBdHRyaWJ1dGUoJ2FyaWEtc2VsZWN0ZWQnLCAndHJ1ZScpO1xcblxcdFxcdFxcdFxcdGVsLnNldEF0dHJpYnV0ZSgnYXJpYS1oYXNwb3B1cCcsICd0cnVlJyk7XFxuXFx0XFx0XFx0XFx0ZWwuc2V0QXR0cmlidXRlKCdyb2xlJywgJ2xpc3RpdGVtJyk7XFxuXFxuXFx0XFx0XFx0XFx0ZHJhZy5pbml0aWFsaXNlKGVsKTtcXG5cXHRcXHRcXHR9KTtcXG5cXHRcXHR9XFxuXFx0fSk7XFxuXFxuXFx0ZHJhZ2dhYmxlVGFza0lkcy5mb3JFYWNoKHRhc2tJZCA9PiB7XFxuXFx0XFx0bGV0IGFzc2lnbWVudENvbnRyb2xFbGVtZW50ID0gJCgkKGAjJHt0YXNrSWR9YClbMF0pLmZpbmQoJy5kb3MtcGFydC1xdWVzdGlvbl9fY29udHJvbHMnKVswXTtcXG5cXHRcXHQkKGFzc2lnbWVudENvbnRyb2xFbGVtZW50KS5jaGlsZHJlbigpLmVhY2goKGluZGV4LCBjaGlsZEVsZW1lbnQpID0+IHtcXG5cXHRcXHRcXHRjaGlsZEVsZW1lbnQuc2V0QXR0cmlidXRlKCd0YWJpbmRleCcsIDApO1xcblxcdFxcdH0pO1xcblxcdFxcdGFzc2lnbWVudENvbnRyb2xzQ2xpY2tIYW5kbGVyKCQoYXNzaWdtZW50Q29udHJvbEVsZW1lbnQpLmNoaWxkcmVuKClbMV0sIHRhc2tJZCk7XFxuXFx0fSk7XFxufVxcblxcbmZ1bmN0aW9uIGFzc2lnbWVudENvbnRyb2xzQ2xpY2tIYW5kbGVyKGZvY3VzZWRFbGVtZW50LCB0YXNrSWQpIHtcXG5cXHRpZiAoZm9jdXNlZEVsZW1lbnQpIHtcXG5cXHRcXHRmb2N1c2VkRWxlbWVudC5vbmtleWRvd24gPSBmdW5jdGlvbiAoZm9jdXNlZEVsZW1lbnQpIHtcXG5cXHRcXHRcXHRpZiAoZm9jdXNlZEVsZW1lbnQua2V5Q29kZSA9PT0gMTMpIHtcXG5cXHRcXHRcXHRcXHRyZXNldFF1aXpRdWVzdGlvbih0YXNrSWQpO1xcblxcdFxcdFxcdH1cXG5cXHRcXHR9O1xcblxcdH1cXG59XFxuXFxuZnVuY3Rpb24gcmVwbGFjZVBhaXJzKGRyb3B6b25lRWxlbWVudCwgZHJhZ2dhYmxlRWxlbWVudCkge1xcblxcdHZhciBkcm9wem9uZUVsZW1lbnRDb250ZW50O1xcblxcdHZhciBkcm9wem9uZUVsZW1lbnRDb3JyZWN0UGFpcjtcXG5cXHR2YXIgZHJvcHpvbmVFbGVtZW50Q2xhc3NsaXN0O1xcblxcdGlmIChkcm9wem9uZUVsZW1lbnQgJiYgZHJhZ2dhYmxlRWxlbWVudCkge1xcblxcdFxcdGRyb3B6b25lRWxlbWVudENvbnRlbnQgPSBkcm9wem9uZUVsZW1lbnQuaW5uZXJIVE1MO1xcblxcdFxcdGRyb3B6b25lRWxlbWVudENvcnJlY3RQYWlyID0gZHJvcHpvbmVFbGVtZW50LmRhdGFzZXQuY29ycmVjdFBhaXI7XFxuXFx0XFx0ZHJvcHpvbmVFbGVtZW50Q2xhc3NsaXN0ID0gZHJvcHpvbmVFbGVtZW50LmNsYXNzTGlzdC52YWx1ZTtcXG5cXG5cXHRcXHQvLyB1cGRhdGUgZHJvcHpvbmVzIGNvbnRlbnRcXG5cXHRcXHRkcm9wem9uZUVsZW1lbnQuaW5uZXJIVE1MID0gZHJhZ2dhYmxlRWxlbWVudC5pbm5lckhUTUw7XFxuXFx0XFx0ZHJvcHpvbmVFbGVtZW50LmRhdGFzZXQuY29ycmVjdFBhaXIgPSBkcmFnZ2FibGVFbGVtZW50LmRhdGFzZXQuY29ycmVjdFBhaXI7XFxuXFx0XFx0ZHJvcHpvbmVFbGVtZW50LmNsYXNzTGlzdC52YWx1ZSA9IGRyYWdnYWJsZUVsZW1lbnQuY2xhc3NMaXN0LnZhbHVlO1xcblxcblxcdFxcdC8vIHVwZGF0ZSBkcmFnZ2FibGUncyBjb250ZW50XFxuXFx0XFx0ZHJhZ2dhYmxlRWxlbWVudC5pbm5lckhUTUwgPSBkcm9wem9uZUVsZW1lbnRDb250ZW50O1xcblxcdFxcdGRyYWdnYWJsZUVsZW1lbnQuZGF0YXNldC5jb3JyZWN0UGFpciA9IGRyb3B6b25lRWxlbWVudENvcnJlY3RQYWlyO1xcblxcdFxcdGRyYWdnYWJsZUVsZW1lbnQuY2xhc3NMaXN0LnZhbHVlID0gZHJvcHpvbmVFbGVtZW50Q2xhc3NsaXN0O1xcblxcdH1cXG5cXG5cXHRyZXR1cm47XFxufVxcblxcbmZ1bmN0aW9uIGRyYWdEcm9wQWN0aW9uKGV2ZW50LCB0YXNrSWQsIGRyYWdnYWJsZUVsZW1lbnQpIHtcXG5cXHRpZiAodGFza0lkKSB7XFxuXFx0XFx0dGFza1R5cGUgPSAkKCQoYGRpdltpZCo9JyR7dGFza0lkfSddYClbMF0pLmF0dHIoJ2RhdGEtcXVlc3Rpb24tdHlwZScpO1xcblxcdH1cXG5cXG5cXHRpZiAodGFza1R5cGUgJiYgdGFza1R5cGUgPT09ICdSYXp2cnN0YXZhbmplIGVsZW1lbmF0YScpIHtcXG5cXHRcXHRldmVudC5zdHlsZS5oZWlnaHQgPSAnYXV0byc7XFxuXFx0XFx0ZXZlbnQuc3R5bGUuZGlzcGxheSA9ICdpbmxpbmUtYmxvY2snO1xcblxcdH1cXG5cXG5cXHRpZiAoZHJhZ2dhYmxlRWxlbWVudCAhPT0gZXZlbnQgJiYgdGFza0lkID09PSAkKGV2ZW50KS5jbG9zZXN0KCdkaXZbaWQqPVxcXCJfcXVlc3Rpb25JZF9cXFwiXScpLmF0dHIoJ2lkJykpIHtcXG5cXHRcXHQkKGRyYWdnYWJsZUVsZW1lbnQpLmRldGFjaCgpLmNzcyh7IHRvcDogMCwgbGVmdDogMCB9KS5hcHBlbmRUbyhldmVudCk7XFxuXFx0fVxcblxcblxcdCQoJy5jYW4tZHJvcC1zdHlsZScpLnJlbW92ZUNsYXNzKCdjYW4tZHJvcC1zdHlsZSBkcmFnZ2FibGUtYWN0aXZlIG92ZXInKTtcXG5cXG5cXHRpZiAodGFza1R5cGUgPT09ICdQb3ZsYcSNZW5qZSBwYXJvdmEnKSB7XFxuXFx0XFx0aWYgKCQoZXZlbnQpLmF0dHIoXFxcImRhdGEtY29ycmVjdC1wYWlyXFxcIikpIHtcXG5cXHRcXHRcXHRldmVudC5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IgPSAnI0ZGRkZGRic7XFxuXFx0XFx0XFx0ZHJhZ2dhYmxlRWxlbWVudC5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IgPSAnI0ZGRkZGRic7XFxuXFx0XFx0fVxcblxcdH1cXG5cXG5cXHRpZiAodGFza1R5cGUgJiYgdGFza0lkID09PSAkKGV2ZW50KS5jbG9zZXN0KCdkaXZbaWQqPVxcXCJfcXVlc3Rpb25JZF9cXFwiXScpLmF0dHIoJ2lkJykpIHtcXG5cXHRcXHRpZiAoIWV2ZW50LmNsYXNzTGlzdC5jb250YWlucyhcXFwicGlsbC1jb250YWluZXJcXFwiKSkge1xcblxcdFxcdFxcdGlmIChldmVudC5nZXRBdHRyaWJ1dGUoXFxcImlkXFxcIikgJiYgZHJhZ2dhYmxlRWxlbWVudCkge1xcblxcdFxcdFxcdFxcdGRyYWdnYWJsZUVsZW1lbnQuc2V0QXR0cmlidXRlKCdkYXRhLWRyYWdnZWQtZ3JvdXAtdmFsdWUnLCBldmVudC5nZXRBdHRyaWJ1dGUoXFxcImlkXFxcIikuc3BsaXQoJ2EnKVsxXSk7XFxuXFx0XFx0XFx0fSBlbHNlIHtcXG5cXHRcXHRcXHRcXHRpZiAoZHJhZ2dhYmxlRWxlbWVudCkge1xcblxcdFxcdFxcdFxcdFxcdGRyYWdnYWJsZUVsZW1lbnQuc2V0QXR0cmlidXRlKCdkYXRhLWRyYWdnZWQtZ3JvdXAtdmFsdWUnLCAnLTEnKTtcXG5cXHRcXHRcXHRcXHR9XFxuXFx0XFx0XFx0fVxcblxcblxcdFxcdFxcdCQoJChgIyR7dGFza0lkfWApLmZpbmQoJy5waWxsLWNvbnRhaW5lcicpLmNoaWxkcmVuKClbMF0pLmNzcyh7ICdkaXNwbGF5JzogJ2lubGluZS1ibG9jaycgfSk7XFxuXFx0XFx0XFx0JCgkKGRyYWdnYWJsZUVsZW1lbnQpLmNsb3Nlc3QoJy5oaWRldGV4dCcpWzBdKS5yZW1vdmVDbGFzcygnaGlkZXRleHQnKTtcXG5cXHRcXHRcXHQkKCQoZHJhZ2dhYmxlRWxlbWVudCkuY2xvc2VzdCgnLnNvcnRncm91cCcpWzBdKS5jc3MoeyAnZm9udC13ZWlnaHQnOiAnMzAwJywgJ2ZvbnQtc2l6ZSc6IDE4IH0pO1xcblxcdFxcdFxcdC8vIHNuYXAgZHJhZ2dhYmxlIHRvIGRyb3B6b25lXFxuXFx0XFx0XFx0aWYgKHRhc2tUeXBlID09PSAnUmF6dnJzdGF2YW5qZSBlbGVtZW5hdGEnKSB7XFxuXFx0XFx0XFx0XFx0JChkcmFnZ2FibGVFbGVtZW50KS5wb3NpdGlvbih7XFxuXFx0XFx0XFx0XFx0XFx0b2Y6ICQoZXZlbnQpLFxcblxcdFxcdFxcdFxcdFxcdG15OiBcXFwibGVmdCB0b3BcXFwiLFxcblxcdFxcdFxcdFxcdFxcdGF0OiBcXFwibGVmdCB0b3BcXFwiLFxcblxcdFxcdFxcdFxcdH0pLmNzcyh7XFxuXFx0XFx0XFx0XFx0XFx0J3Bvc2l0aW9uJzogJ3JlbGF0aXZlJyxcXG5cXHRcXHRcXHRcXHRcXHQnbGVmdCc6ICcwcHgnLFxcblxcdFxcdFxcdFxcdFxcdCd0b3AnOiAnMHB4JyxcXG5cXHRcXHRcXHRcXHRcXHQnZmxvYXQnOiAnbGVmdCcsXFxuXFx0XFx0XFx0XFx0XFx0J2JvcmRlci1yYWRpdXMnOiAnMnB4JyxcXG5cXHRcXHRcXHRcXHRcXHQndGV4dC1hbGlnbic6ICdjZW50ZXInLFxcblxcdFxcdFxcdFxcdFxcdCdjdXJzb3InOiAncG9pbnRlcicsXFxuXFx0XFx0XFx0XFx0XFx0J3otaW5kZXgnOiAxLFxcblxcdFxcdFxcdFxcdFxcdCdsaW5lLWhlaWdodCc6ICcxMzAlJyxcXG5cXHRcXHRcXHRcXHRcXHQnbWFyZ2luJzogJzVweCcsXFxuXFx0XFx0XFx0XFx0fSkucmVtb3ZlQ2xhc3MoJ2Nhbi1kcm9wLXN0eWxlIGRyYWdnYWJsZS1hY3RpdmUgZm9jdXMnKTtcXG5cXHRcXHRcXHR9IGVsc2UgaWYgKHRhc2tUeXBlID09PSAnUG92bGHEjWVuamUgcmlqZcSNaScpIHtcXG5cXHRcXHRcXHRcXHRpZiAoJChldmVudCkuY2hpbGRyZW4oKS5sZW5ndGggPiAxKSB7XFxuXFx0XFx0XFx0XFx0XFx0JCgkKGV2ZW50KS5jaGlsZHJlbigpWzBdKS5kZXRhY2goKS5jc3Moe1xcblxcdFxcdFxcdFxcdFxcdFxcdHRvcDogMCxcXG5cXHRcXHRcXHRcXHRcXHRcXHRsZWZ0OiAwLFxcblxcdFxcdFxcdFxcdFxcdH0pLmFwcGVuZFRvKCQoYCMke3Rhc2tJZH1gKS5maW5kKCcuZG9zLWFuc3dlci13cmFwcGVyJylbMF0pLmF0dHIoJ2RhdGEtZHJhZ2dlZC1ncm91cC12YWx1ZScsICctMScpO1xcblxcdFxcdFxcdFxcdH1cXG5cXG5cXHRcXHRcXHRcXHRpZiAoZXZlbnQuY2xhc3NMaXN0LmNvbnRhaW5zKCdkcm9wem9uZS1ob2xkZXInKSkge1xcblxcdFxcdFxcdFxcdFxcdCQoZHJhZ2dhYmxlRWxlbWVudCkuZGV0YWNoKCkuY3NzKHtcXG5cXHRcXHRcXHRcXHRcXHRcXHR0b3A6IDAsXFxuXFx0XFx0XFx0XFx0XFx0XFx0bGVmdDogMCxcXG5cXHRcXHRcXHRcXHRcXHR9KS5hcHBlbmRUbygkKGAjJHt0YXNrSWR9YCkuZmluZCgnLmRvcy1hbnN3ZXItd3JhcHBlcicpWzBdKTtcXG5cXHRcXHRcXHRcXHR9IGVsc2Uge1xcblxcdFxcdFxcdFxcdFxcdCQoZXZlbnQpLmNzcyh7XFxuXFx0XFx0XFx0XFx0XFx0XFx0Ly8gJ3otaW5kZXgnOiAwLFxcblxcdFxcdFxcdFxcdFxcdFxcdCd0cmFuc2Zvcm0nOiAndHJhbnNsYXRlWSgxMHB4KScsXFxuXFx0XFx0XFx0XFx0XFx0XFx0Ly8gJ2hlaWdodCc6ICc3MnB4JyxcXG5cXHRcXHRcXHRcXHRcXHRcXHQncG9zaXRpb24nOiAncmVsYXRpdmUnLFxcblxcdFxcdFxcdFxcdFxcdFxcdC8vJ3dpZHRoJzogJChkcmFnZ2FibGVFbGVtZW50KS53aWR0aCgpICsgcGFyc2VJbnQoJChkcmFnZ2FibGVFbGVtZW50KS5jc3MoJ3BhZGRpbmctbGVmdCcpKSArIHBhcnNlSW50KCQoZHJhZ2dhYmxlRWxlbWVudCkuY3NzKCdwYWRkaW5nLXJpZ2h0JykpICsgKHBhcnNlSW50KCQoZHJhZ2dhYmxlRWxlbWVudCkuY3NzKCdib3JkZXItd2lkdGgnKSkgKiAyKSArICdweCcsXFxuXFx0XFx0XFx0XFx0XFx0fSk7XFxuXFxuXFx0XFx0XFx0XFx0XFx0JChkcmFnZ2FibGVFbGVtZW50KS5wb3NpdGlvbih7XFxuXFx0XFx0XFx0XFx0XFx0XFx0b2Y6ICQoZXZlbnQpLFxcblxcdFxcdFxcdFxcdFxcdFxcdG15OiBcXFwibGVmdCBtaWRkbGVcXFwiLFxcblxcdFxcdFxcdFxcdFxcdFxcdGF0OiBcXFwibGVmdCBtaWRkbGVcXFwiLFxcblxcdFxcdFxcdFxcdFxcdH0pLmNzcyh7XFxuXFx0XFx0XFx0XFx0XFx0XFx0J3Bvc2l0aW9uJzogJ3JlbGF0aXZlJyxcXG5cXHRcXHRcXHRcXHRcXHRcXHQnZmxvYXQnOiAnbGVmdCcsXFxuXFx0XFx0XFx0XFx0XFx0XFx0J3RleHQtYWxpZ24nOiAnY2VudGVyJyxcXG5cXHRcXHRcXHRcXHRcXHRcXHQnY3Vyc29yJzogJ3BvaW50ZXInLFxcblxcdFxcdFxcdFxcdFxcdFxcdC8vICd3b3JkLXdyYXAnOiAnYnJlYWstd29yZCcsXFxuXFx0XFx0XFx0XFx0XFx0fSkucmVtb3ZlQ2xhc3MoJ2Nhbi1kcm9wLXN0eWxlIGRyYWdnYWJsZS1hY3RpdmUgZm9jdXMnKTtcXG5cXHRcXHRcXHRcXHR9XFxuXFx0XFx0XFx0fVxcblxcdFxcdH1cXG5cXG5cXHRcXHRldmVudC5jbGFzc0xpc3QucmVtb3ZlKCdkcm9wLXBvbGplLWhvdmVyJyk7XFxuXFx0XFx0ZXZlbnQuY2xhc3NMaXN0LnJlbW92ZSgnb3ZlcicpO1xcblxcdH1cXG59XFxuXFxubGV0IGRyYWcgPSB7XFxuXFx0Y3VycmVudE9iamVjdDogbnVsbCxcXG5cXHR0YXNrSWQ6IG51bGwsXFxuXFx0dGFza1R5cGU6IG51bGwsXFxuXFx0aW5pdGlhbGlzZTogZnVuY3Rpb24gKGVsZW1lbnQpIHtcXG5cXHRcXHQvLyBBZGQgZXZlbnQgaGFuZGxlcnNcXG5cXHRcXHRlbGVtZW50Lm9uY2xpY2sgPSBmdW5jdGlvbiAoKSB7XFxuXFx0XFx0XFx0dGhpcy5mb2N1cygpO1xcblxcdFxcdH07XFxuXFx0XFx0ZWxlbWVudC5vbmtleWRvd24gPSBkcmFnLmtleWJvYXJkRHJhZ0Ryb3A7XFxuXFx0XFx0ZG9jdW1lbnQuYm9keS5vbmNsaWNrID0gZHJhZy5yZW1vdmVQb3B1cDtcXG5cXHR9LFxcblxcblxcdGtleWJvYXJkRHJhZ0Ryb3A6IGZ1bmN0aW9uIChldmVudCkge1xcblxcdFxcdGZvY3VzZWRJdGVtID0gZXZlbnQudGFyZ2V0O1xcblxcdFxcdGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XFxuXFx0XFx0ZHJhZy5jdXJyZW50T2JqZWN0ID0gdGhpcztcXG5cXHRcXHRkcmFnLnRhc2tJZCA9IGAkeyQoZm9jdXNlZEl0ZW0pLmNsb3Nlc3QoJ2RpdltpZCo9XFxcIl9xdWVzdGlvbklkX1xcXCJdJykuYXR0cignaWQnKX1gO1xcblxcdFxcdGlmIChkcmFnLnRhc2tJZCkge1xcblxcdFxcdFxcdGlmICgkKGBkaXZbaWQqPScke2RyYWcudGFza0lkfSddYClbMF0pIHtcXG5cXHRcXHRcXHRcXHRkcmFnLnRhc2tUeXBlID0gJChgZGl2W2lkKj0nJHtkcmFnLnRhc2tJZH0nXWApWzBdLmdldEF0dHJpYnV0ZSgnZGF0YS1xdWVzdGlvbi10eXBlJyk7XFxuXFx0XFx0XFx0fVxcblxcdFxcdH1cXG5cXHRcXHRsZXQgYW5zd2VySWQgPSBkcmFnLnRhc2tJZC5zcGxpdCgndWVzdGlvbklkXycpWzBdICsgZHJhZy50YXNrSWQuc3BsaXQoJ3Vlc3Rpb25JZF8nKVsxXSArICdhJztcXG5cXHRcXHRsZXQgb2JqTWVudSwgb2JqSXRlbTtcXG5cXHRcXHRsZXQgb2JqRXZlbnQgPSBldmVudCB8fCB3aW5kb3cuZXZlbnQ7XFxuXFxuXFx0XFx0aWYgKG9iakV2ZW50LmtleUNvZGUgPT09IDMyKSB7XFxuXFx0XFx0XFx0aWYgKCEkKGZvY3VzZWRJdGVtKS5jaGlsZHJlbignI3BvcHVwJykubGVuZ3RoKSB7XFxuXFx0XFx0XFx0XFx0b2JqTWVudSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3VsJyk7XFxuXFx0XFx0XFx0XFx0b2JqTWVudS5zZXRBdHRyaWJ1dGUoJ2lkJywgJ3BvcHVwJyk7XFxuXFx0XFx0XFx0XFx0b2JqTWVudS5zZXRBdHRyaWJ1dGUoJ3JvbGUnLCAnbWVudScpO1xcblxcdFxcdFxcdFxcdG9iak1lbnUuc2V0QXR0cmlidXRlKCdzdHlsZScsICdtYXJnaW46IDI1cHggNXB4IDIwcHg7Jyk7XFxuXFxuXFx0XFx0XFx0XFx0aWYgKGRyYWcudGFza1R5cGUgPT09ICdSYXp2cnN0YXZhbmplIGVsZW1lbmF0YScpIHtcXG5cXHRcXHRcXHRcXHRcXHRmb3IgKGkgPSAwOyBpIDwgJChgW2lkKj1cXFwiJHthbnN3ZXJJZH1cXFwiXWApLmxlbmd0aDsgaSsrKSB7XFxuXFx0XFx0XFx0XFx0XFx0XFx0aWYgKCEkKGZvY3VzZWRJdGVtKS5hdHRyKCdrZXlib2FyZC1kcmFnLW1lbnUnKSkge1xcblxcdFxcdFxcdFxcdFxcdFxcdFxcdG9iakl0ZW0gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdsaScpO1xcblxcdFxcdFxcdFxcdFxcdFxcdFxcdG9iakl0ZW0uaW5uZXJIVE1MID0gYCR7JCgkKGBbaWQqPVxcXCIke2Fuc3dlcklkfVxcXCJdYClbaV0pLnBhcmVudCgpLmZpbmQoJy5kb3MtZHJhZy1hcmVhX19sYWJlbCcpLnRleHQoKX1gO1xcblxcdFxcdFxcdFxcdFxcdFxcdFxcdG9iakl0ZW0udGFiSW5kZXggPSAwO1xcblxcdFxcdFxcdFxcdFxcdFxcdFxcdG9iakl0ZW0uc2V0QXR0cmlidXRlKCdyb2xlJywgJ21lbnVpdGVtJyk7XFxuXFx0XFx0XFx0XFx0XFx0XFx0XFx0b2JqSXRlbS5zZXRBdHRyaWJ1dGUoJ2tleWJvYXJkLWRyYWctbWVudScsIHRydWUpO1xcblxcdFxcdFxcdFxcdFxcdFxcdFxcdGlmICghJChmb2N1c2VkSXRlbSkucGFyZW50KClbMF0uY2xhc3NMaXN0LmNvbnRhaW5zKCdkcm9wem9uZScpKSB7XFxuXFx0XFx0XFx0XFx0XFx0XFx0XFx0XFx0Zm9jdXNlZEl0ZW0uc3R5bGUucG9zaXRpb24gPSAnYWJzb2x1dGUnO1xcblxcdFxcdFxcdFxcdFxcdFxcdFxcdH1cXG5cXHRcXHRcXHRcXHRcXHRcXHR9XFxuXFx0XFx0XFx0XFx0XFx0XFx0b2JqSXRlbS5vbmtleWRvd24gPSBkcmFnLmhhbmRsZUl0ZW1DaG9pY2U7XFxuXFx0XFx0XFx0XFx0XFx0XFx0b2JqTWVudS5hcHBlbmRDaGlsZChvYmpJdGVtKTtcXG5cXHRcXHRcXHRcXHRcXHRcXHRmb2N1c2VkSXRlbS5hcHBlbmRDaGlsZChvYmpNZW51KTtcXG5cXHRcXHRcXHRcXHRcXHRcXHRmb2N1c2VkSXRlbS5zZXRBdHRyaWJ1dGUoJ3N0eWxlJywgJ3otaW5kZXg6IDI7Jyk7XFxuXFx0XFx0XFx0XFx0XFx0fVxcblxcblxcdFxcdFxcdFxcdFxcdCQob2JqTWVudSkuY2hpbGRyZW4oKS5lYWNoKChpbmRleCwgZWwpID0+IHtcXG5cXHRcXHRcXHRcXHRcXHRcXHRlbC5pZCA9IGFuc3dlcklkICsgaW5kZXg7XFxuXFx0XFx0XFx0XFx0XFx0fSk7XFxuXFx0XFx0XFx0XFx0fSBlbHNlIGlmIChkcmFnLnRhc2tUeXBlID09PSAnUG92bGHEjWVuamUgcGFyb3ZhJykge1xcblxcdFxcdFxcdFxcdFxcdGZvciAoaSA9IDA7IGkgPCAkKGAjJHtkcmFnLnRhc2tJZH1gKS5maW5kKCcucGFpci1zdGF0aWMnKS5sZW5ndGg7IGkrKykge1xcblxcdFxcdFxcdFxcdFxcdFxcdGlmICghJChmb2N1c2VkSXRlbSkuYXR0cigna2V5Ym9hcmQtZHJhZy1tZW51JykpIHtcXG5cXHRcXHRcXHRcXHRcXHRcXHRcXHRvYmpJdGVtID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnbGknKTtcXG5cXHRcXHRcXHRcXHRcXHRcXHRcXHRvYmpJdGVtLmlubmVySFRNTCA9IGAkeyQoJChgIyR7ZHJhZy50YXNrSWR9YCkuZmluZCgnLnBhaXItc3RhdGljJylbaV0pLnRleHQoKX1gO1xcblxcdFxcdFxcdFxcdFxcdFxcdFxcdG9iakl0ZW0udGFiSW5kZXggPSAwO1xcblxcdFxcdFxcdFxcdFxcdFxcdFxcdG9iakl0ZW0uc2V0QXR0cmlidXRlKCdkYXRhLWNvcnJlY3QtcGFpcicsIGAkeyQoJChgIyR7ZHJhZy50YXNrSWR9YCkuZmluZCgnLnBhaXItc3RhdGljJylbaV0pLmF0dHIoJ2RhdGEtY29ycmVjdC1wYWlyJyl9YCk7XFxuXFx0XFx0XFx0XFx0XFx0XFx0XFx0b2JqSXRlbS5zZXRBdHRyaWJ1dGUoJ3JvbGUnLCAnbWVudWl0ZW0nKTtcXG5cXHRcXHRcXHRcXHRcXHRcXHRcXHRvYmpJdGVtLnNldEF0dHJpYnV0ZSgna2V5Ym9hcmQtZHJhZy1tZW51JywgdHJ1ZSk7XFxuXFx0XFx0XFx0XFx0XFx0XFx0fVxcblxcdFxcdFxcdFxcdFxcdFxcdG9iakl0ZW0ub25rZXlkb3duID0gZHJhZy5oYW5kbGVJdGVtQ2hvaWNlO1xcblxcdFxcdFxcdFxcdFxcdFxcdG9iak1lbnUuYXBwZW5kQ2hpbGQob2JqSXRlbSk7XFxuXFx0XFx0XFx0XFx0XFx0XFx0Zm9jdXNlZEl0ZW0uYXBwZW5kQ2hpbGQob2JqTWVudSk7XFxuXFx0XFx0XFx0XFx0XFx0XFx0Zm9jdXNlZEl0ZW0uc2V0QXR0cmlidXRlKCdzdHlsZScsICd6LWluZGV4OiAyOycpO1xcblxcdFxcdFxcdFxcdFxcdH1cXG5cXHRcXHRcXHRcXHR9IGVsc2UgaWYgKGRyYWcudGFza1R5cGUgPT09ICdQb3ZsYcSNZW5qZSByaWplxI1pJykge1xcblxcdFxcdFxcdFxcdFxcdGZvciAoaSA9IDA7IGkgPCAkKGAjJHtkcmFnLnRhc2tJZH1gKS5maW5kKCcuZHJhZ2dhYmxlLmRvcy1hbnN3ZXItZHJhZ2dhYmxlJykubGVuZ3RoOyBpKyspIHtcXG5cXHRcXHRcXHRcXHRcXHRcXHRpZiAoISQoZm9jdXNlZEl0ZW0pLmF0dHIoJ2tleWJvYXJkLWRyYWctbWVudScpKSB7XFxuXFx0XFx0XFx0XFx0XFx0XFx0XFx0b2JqSXRlbSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2xpJyk7XFxuXFx0XFx0XFx0XFx0XFx0XFx0XFx0b2JqSXRlbS5pbm5lckhUTUwgPSBgJHskKCQoYCMke2RyYWcudGFza0lkfWApLmZpbmQoJy5kcmFnZ2FibGUuZG9zLWFuc3dlci1kcmFnZ2FibGUnKVtpXSkudGV4dCgpfWA7XFxuXFx0XFx0XFx0XFx0XFx0XFx0XFx0b2JqSXRlbS50YWJJbmRleCA9IDA7XFxuXFx0XFx0XFx0XFx0XFx0XFx0XFx0b2JqSXRlbS5zZXRBdHRyaWJ1dGUoJ2RhdGEtY29ycmVjdC1wYWlyJywgYCR7JCgkKGAjJHtkcmFnLnRhc2tJZH1gKS5maW5kKCcuZHJhZ2dhYmxlLmRvcy1hbnN3ZXItZHJhZ2dhYmxlJylbaV0pLmF0dHIoJ2RhdGEtZ3JvdXAnKX1gKTtcXG5cXHRcXHRcXHRcXHRcXHRcXHRcXHRvYmpJdGVtLnNldEF0dHJpYnV0ZSgnZHJhZ2dhYmxlLWluZGV4JywgaSk7XFxuXFx0XFx0XFx0XFx0XFx0XFx0XFx0b2JqSXRlbS5zZXRBdHRyaWJ1dGUoJ3JvbGUnLCAnbWVudWl0ZW0nKTtcXG5cXHRcXHRcXHRcXHRcXHRcXHRcXHRvYmpJdGVtLnNldEF0dHJpYnV0ZSgna2V5Ym9hcmQtZHJhZy1tZW51JywgdHJ1ZSk7XFxuXFx0XFx0XFx0XFx0XFx0XFx0fVxcblxcdFxcdFxcdFxcdFxcdFxcdGlmIChvYmpJdGVtKSB7XFxuXFx0XFx0XFx0XFx0XFx0XFx0XFx0b2JqSXRlbS5vbmtleWRvd24gPSBkcmFnLmhhbmRsZUl0ZW1DaG9pY2U7XFxuXFx0XFx0XFx0XFx0XFx0XFx0fVxcblxcdFxcdFxcdFxcdFxcdFxcdG9iak1lbnUuYXBwZW5kQ2hpbGQob2JqSXRlbSk7XFxuXFx0XFx0XFx0XFx0XFx0XFx0Zm9jdXNlZEl0ZW0uYXBwZW5kQ2hpbGQob2JqTWVudSk7XFxuXFx0XFx0XFx0XFx0XFx0XFx0Zm9jdXNlZEl0ZW0uc2V0QXR0cmlidXRlKCdzdHlsZScsICd6LWluZGV4OiAyOycpO1xcblxcdFxcdFxcdFxcdFxcdH1cXG5cXHRcXHRcXHRcXHR9IGVsc2UgaWYgKGRyYWcudGFza1R5cGUgPT09ICdVcmXEkWl2YW5qZSBwb3JldGthIGVsZW1lbmF0YScpIHtcXG5cXHRcXHRcXHRcXHRcXHRmb3IgKGkgPSAwOyBpIDwgJChgIyR7ZHJhZy50YXNrSWR9YCkuZmluZCgnLnBhaXItc3RhdGljJykubGVuZ3RoOyBpKyspIHtcXG5cXHRcXHRcXHRcXHRcXHRcXHRpZiAoISQoZm9jdXNlZEl0ZW0pLmF0dHIoJ2tleWJvYXJkLWRyYWctbWVudScpKSB7XFxuXFx0XFx0XFx0XFx0XFx0XFx0XFx0b2JqSXRlbSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2xpJyk7XFxuXFx0XFx0XFx0XFx0XFx0XFx0XFx0b2JqSXRlbS5pbm5lckhUTUwgPSBgJHskKCQoYCMke2RyYWcudGFza0lkfWApLmZpbmQoJy5wYWlyLXN0YXRpYycpW2ldKS50ZXh0KCl9YDtcXG5cXHRcXHRcXHRcXHRcXHRcXHRcXHRvYmpJdGVtLnRhYkluZGV4ID0gMDtcXG5cXHRcXHRcXHRcXHRcXHRcXHRcXHRvYmpJdGVtLnNldEF0dHJpYnV0ZSgnZGF0YS1jb3JyZWN0LXBhaXInLCBgJHskKCQoYCMke2RyYWcudGFza0lkfWApLmZpbmQoJy5wYWlyLXN0YXRpYycpW2ldKS5hdHRyKCdkYXRhLWNvcnJlY3QtcGFpcicpfWApO1xcblxcdFxcdFxcdFxcdFxcdFxcdFxcdG9iakl0ZW0uc2V0QXR0cmlidXRlKCdyb2xlJywgJ21lbnVpdGVtJyk7XFxuXFx0XFx0XFx0XFx0XFx0XFx0XFx0b2JqSXRlbS5zZXRBdHRyaWJ1dGUoJ2tleWJvYXJkLWRyYWctbWVudScsIHRydWUpO1xcblxcdFxcdFxcdFxcdFxcdFxcdH1cXG5cXHRcXHRcXHRcXHRcXHRcXHRvYmpJdGVtLm9ua2V5ZG93biA9IGRyYWcuaGFuZGxlSXRlbUNob2ljZTtcXG5cXHRcXHRcXHRcXHRcXHRcXHRvYmpNZW51LmFwcGVuZENoaWxkKG9iakl0ZW0pO1xcblxcdFxcdFxcdFxcdFxcdFxcdGZvY3VzZWRJdGVtLmFwcGVuZENoaWxkKG9iak1lbnUpO1xcblxcdFxcdFxcdFxcdFxcdFxcdGZvY3VzZWRJdGVtLnNldEF0dHJpYnV0ZSgnc3R5bGUnLCAnei1pbmRleDogMjsnKTtcXG5cXHRcXHRcXHRcXHRcXHR9XFxuXFx0XFx0XFx0XFx0fVxcblxcblxcdFxcdFxcdFxcdG9iak1lbnUuZmlyc3RDaGlsZC5mb2N1cygpO1xcblxcdFxcdFxcdFxcdG9iak1lbnUuZmlyc3RDaGlsZC5jbGFzc05hbWUgPSAnZm9jdXMnO1xcblxcdFxcdFxcdH1cXG5cXHRcXHR9XFxuXFxuXFx0XFx0aWYgKG9iakV2ZW50LmtleUNvZGUgPT09IDkgJiYgIW9iakV2ZW50LnNoaWZ0S2V5KSB7XFxuXFx0XFx0XFx0aWYgKChkcmFnLnRhc2tUeXBlID09PSAnUG92bGHEjWVuamUgcGFyb3ZhJyB8fCBkcmFnLnRhc2tUeXBlID09PSAnVXJlxJFpdmFuamUgcG9yZXRrYSBlbGVtZW5hdGEnKSAmJiBvYmpFdmVudC50YXJnZXQucGFyZW50Tm9kZS5uZXh0RWxlbWVudFNpYmxpbmcpIHtcXG5cXHRcXHRcXHRcXHQkKG9iakV2ZW50LnRhcmdldC5wYXJlbnROb2RlLm5leHRFbGVtZW50U2libGluZykuY2hpbGRyZW4oJy5wYWlyLWRyYWdnYWJsZScpWzBdLmZvY3VzKCk7XFxuXFx0XFx0XFx0fSBlbHNlIGlmIChkcmFnLnRhc2tUeXBlID09PSAnUG92bGHEjWVuamUgcmlqZcSNaScpIHtcXG5cXHRcXHRcXHRcXHRsZXQgbmV4dElkID0gYCR7b2JqRXZlbnQudGFyZ2V0LmdldEF0dHJpYnV0ZSgnaWQnKS5zdWJzdHJpbmcoMCwgb2JqRXZlbnQudGFyZ2V0LmdldEF0dHJpYnV0ZSgnaWQnKS5sZW5ndGggLSAxKX0ke3BhcnNlSW50KG9iakV2ZW50LnRhcmdldC5nZXRBdHRyaWJ1dGUoJ2lkJylbb2JqRXZlbnQudGFyZ2V0LmdldEF0dHJpYnV0ZSgnaWQnKS5sZW5ndGggLSAxXSkgKyAxfWA7XFxuXFx0XFx0XFx0XFx0aWYgKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKG5leHRJZCkpIHtcXG5cXHRcXHRcXHRcXHRcXHRkb2N1bWVudC5nZXRFbGVtZW50QnlJZChuZXh0SWQpLmZvY3VzKCk7XFxuXFx0XFx0XFx0XFx0fSBlbHNlIHtcXG5cXHRcXHRcXHRcXHRcXHRpZiAoJChgIyR7ZHJhZy50YXNrSWR9YCkuZmluZCgnLmRvcy1wYXJ0LXF1ZXN0aW9uX19jb250cm9scycpLmNoaWxkcmVuKClbMF0pIHtcXG5cXHRcXHRcXHRcXHRcXHRcXHQkKGAjJHtkcmFnLnRhc2tJZH1gKS5maW5kKCcuZG9zLXBhcnQtcXVlc3Rpb25fX2NvbnRyb2xzJykuY2hpbGRyZW4oKVswXS5mb2N1cygpO1xcblxcdFxcdFxcdFxcdFxcdH1cXG5cXHRcXHRcXHRcXHR9XFxuXFx0XFx0XFx0fSBlbHNlIHtcXG5cXHRcXHRcXHRcXHRpZiAoJChgIyR7ZHJhZy50YXNrSWR9YCkuZmluZCgnLmRvcy1wYXJ0LXF1ZXN0aW9uX19jb250cm9scycpLmNoaWxkcmVuKClbMF0pIHtcXG5cXHRcXHRcXHRcXHRcXHQkKGAjJHtkcmFnLnRhc2tJZH1gKS5maW5kKCcuZG9zLXBhcnQtcXVlc3Rpb25fX2NvbnRyb2xzJykuY2hpbGRyZW4oKVswXS5mb2N1cygpO1xcblxcdFxcdFxcdFxcdH1cXG5cXHRcXHRcXHR9XFxuXFx0XFx0fVxcblxcblxcdFxcdGlmIChvYmpFdmVudC5rZXlDb2RlID09PSA5ICYmIG9iakV2ZW50LnNoaWZ0S2V5KSB7XFxuXFx0XFx0XFx0JChcXFwiOnRhYmJhYmxlXFxcIilbJChcXFwiOnRhYmJhYmxlXFxcIikuaW5kZXgoJCh0aGlzKVswXSkgLSAxXS5mb2N1cygpO1xcblxcdFxcdH1cXG5cXHR9LFxcblxcblxcdGhhbmRsZUl0ZW1DaG9pY2U6IGZ1bmN0aW9uIChpdGVtKSB7XFxuXFx0XFx0aWYgKGl0ZW0ua2V5Q29kZSA9PT0gMzgpIHsgLy8gVXAgYXJyb3dcXG5cXHRcXHRcXHRpdGVtLnRhcmdldC5jbGFzc0xpc3QucmVtb3ZlKCdmb2N1cycpO1xcblxcdFxcdFxcdGlmICghaXRlbS50YXJnZXQucHJldmlvdXNTaWJsaW5nKSB7XFxuXFx0XFx0XFx0XFx0Zm9jdXNMaXN0SXRlbVdTKGl0ZW0udGFyZ2V0Lm5leHRTaWJsaW5nKTtcXG5cXHRcXHRcXHRcXHRyZXR1cm47XFxuXFx0XFx0XFx0fVxcblxcdFxcdFxcdGZvY3VzTGlzdEl0ZW1XUyhpdGVtLnRhcmdldC5wcmV2aW91c1NpYmxpbmcpO1xcblxcdFxcdH0gZWxzZSBpZiAoaXRlbS5rZXlDb2RlID09PSA0MCkgeyAvLyBEb3duIGFycm93XFxuXFx0XFx0XFx0aXRlbS50YXJnZXQuY2xhc3NMaXN0LnJlbW92ZSgnZm9jdXMnKTtcXG5cXHRcXHRcXHRpZiAoIWl0ZW0udGFyZ2V0Lm5leHRTaWJsaW5nKSB7XFxuXFx0XFx0XFx0XFx0Zm9jdXNMaXN0SXRlbVdTKGl0ZW0udGFyZ2V0LnByZXZpb3VzU2libGluZyk7XFxuXFx0XFx0XFx0XFx0cmV0dXJuO1xcblxcdFxcdFxcdH1cXG5cXHRcXHRcXHRmb2N1c0xpc3RJdGVtV1MoaXRlbS50YXJnZXQubmV4dFNpYmxpbmcpO1xcblxcdFxcdH0gZWxzZSBpZiAoaXRlbS5rZXlDb2RlID09PSAzOSkgeyAvLyBMZWZ0IGFycm93XFxuXFx0XFx0XFx0aXRlbS50YXJnZXQuY2xhc3NMaXN0LnJlbW92ZSgnZm9jdXMnKTtcXG5cXHRcXHRcXHRpZiAoIWl0ZW0udGFyZ2V0LnByZXZpb3VzU2libGluZykge1xcblxcdFxcdFxcdFxcdGZvY3VzTGlzdEl0ZW1XUyhpdGVtLnRhcmdldC5uZXh0U2libGluZyk7XFxuXFx0XFx0XFx0XFx0cmV0dXJuO1xcblxcdFxcdFxcdH1cXG5cXHRcXHRcXHRmb2N1c0xpc3RJdGVtV1MoaXRlbS50YXJnZXQucHJldmlvdXNTaWJsaW5nKTtcXG5cXHRcXHR9IGVsc2UgaWYgKGl0ZW0ua2V5Q29kZSA9PT0gMzcpIHsgLy8gUmlnaHQgYXJyb3dcXG5cXHRcXHRcXHRpdGVtLnRhcmdldC5jbGFzc0xpc3QucmVtb3ZlKCdmb2N1cycpO1xcblxcdFxcdFxcdGlmICghaXRlbS50YXJnZXQubmV4dFNpYmxpbmcpIHtcXG5cXHRcXHRcXHRcXHRmb2N1c0xpc3RJdGVtV1MoaXRlbS50YXJnZXQucHJldmlvdXNTaWJsaW5nKTtcXG5cXHRcXHRcXHRcXHRyZXR1cm47XFxuXFx0XFx0XFx0fVxcblxcdFxcdFxcdGZvY3VzTGlzdEl0ZW1XUyhpdGVtLnRhcmdldC5uZXh0U2libGluZyk7XFxuXFx0XFx0fSBlbHNlIGlmIChpdGVtLmtleUNvZGUgPT09IDEzKSB7IC8vIEVudGVyIGtleVxcblxcdFxcdFxcdGRyYWcubW92ZUZvY3VzZWRJdGVtVG9Ecm9wem9uZShpdGVtLnRhcmdldCk7XFxuXFx0XFx0XFx0Zm9jdXNMaXN0SXRlbVdTKCQoYCMke2RyYWcudGFza0lkfWApLmZpbmQoJy5kcmFnZ2FibGUuZG9zLWFuc3dlci1kcmFnZ2FibGUsIC5wYWlyLWRyYWdnYWJsZScpWzBdKTtcXG5cXHRcXHR9IGVsc2UgaWYgKGl0ZW0ua2V5Q29kZSA9PT0gOSB8fCBpdGVtLmtleUNvZGUgPT09IDI3KSB7IC8vIDkgaXMgVGFiIC0gMjcgaXMgRXNjXFxuXFx0XFx0XFx0ZHJhZy5oYW5kbGVCbHVyKGl0ZW0pO1xcblxcdFxcdH1cXG5cXHR9LFxcblxcblxcdGhhbmRsZUJsdXI6IGZ1bmN0aW9uIChpdGVtKSB7XFxuXFx0XFx0aWYgKGRyYWcudGFza1R5cGUgPT09ICdQb3ZsYcSNZW5qZSBwYXJvdmEnIHx8IGRyYWcudGFza1R5cGUgPT09ICdVcmXEkWl2YW5qZSBwb3JldGthIGVsZW1lbmF0YScpIHtcXG5cXHRcXHRcXHRkcmFnLnJlbW92ZVBvcHVwKCk7XFxuXFx0XFx0XFx0cmV0dXJuO1xcblxcdFxcdH1cXG5cXG5cXHRcXHRkcmFnLmN1cnJlbnRPYmplY3QucmVtb3ZlQXR0cmlidXRlKCdhcmlhLW93bnMnKTtcXG5cXHRcXHRpZiAoaXRlbS50YXJnZXQucGFyZW50Tm9kZSkge1xcblxcdFxcdFxcdGl0ZW0udGFyZ2V0LnBhcmVudE5vZGUucmVtb3ZlKCk7XFxuXFx0XFx0fVxcblxcdFxcdGRyYWcuY3VycmVudE9iamVjdC5mb2N1cygpO1xcblxcdFxcdGRyYWcucmVtb3ZlUG9wdXAoKTtcXG5cXHR9LFxcblxcblxcdHJlbW92ZVBvcHVwOiBmdW5jdGlvbiAoKSB7XFxuXFx0XFx0ZG9jdW1lbnQub25rZXlkb3duID0gbnVsbDtcXG5cXG5cXHRcXHRsZXQgb2JqUG9wdXAgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncG9wdXAnKTtcXG5cXHRcXHRpZiAob2JqUG9wdXApIHtcXG5cXHRcXHRcXHRsZXQgb2JqUG9wdXBQYXJlbnQgPSBvYmpQb3B1cC5wYXJlbnROb2RlO1xcblxcdFxcdFxcdCQob2JqUG9wdXApLnJlbW92ZSgpO1xcblxcdFxcdFxcdG9ialBvcHVwUGFyZW50LmJsdXIoKTtcXG5cXHRcXHR9XFxuXFx0fSxcXG5cXG5cXHRtb3ZlRm9jdXNlZEl0ZW1Ub0Ryb3B6b25lOiBmdW5jdGlvbiAoaXRlbSkge1xcblxcdFxcdGlmIChkcmFnLnRhc2tUeXBlID09PSAnUmF6dnJzdGF2YW5qZSBlbGVtZW5hdGEnKSB7XFxuXFx0XFx0XFx0bGV0IGRyb3B6b25lID0gJChgIyR7JChpdGVtKS5hdHRyKCdpZCcpfS5kcm9wem9uZWApWzBdO1xcblxcdFxcdFxcdGxldCBkcmFnZ2FibGUgPSAkKGl0ZW0pLnBhcmVudHMoJy5kcmFnZ2FibGUuZG9zLWFuc3dlci1kcmFnZ2FibGUsIC5wYWlyLWRyYWdnYWJsZScpWzBdO1xcblxcdFxcdFxcdGRyYWcucmVtb3ZlUG9wdXAoKTtcXG5cXG5cXHRcXHRcXHRkcmFnRHJvcEFjdGlvbihkcm9wem9uZSwgZHJhZy50YXNrSWQsIGRyYWdnYWJsZSk7XFxuXFx0XFx0fSBlbHNlIGlmIChkcmFnLnRhc2tUeXBlID09PSAnUG92bGHEjWVuamUgcGFyb3ZhJykge1xcblxcdFxcdFxcdGxldCBkcm9wem9uZSA9ICQoYFtkYXRhLWNvcnJlY3QtcGFpcio9JyR7aXRlbS5nZXRBdHRyaWJ1dGUoJ2RhdGEtY29ycmVjdC1wYWlyJyl9J10ucGFpci1zdGF0aWNgKS5wYXJlbnQoKS5jaGlsZHJlbigpWzBdO1xcblxcdFxcdFxcdGxldCBkcmFnZ2FibGUgPSAkKGl0ZW0pLnBhcmVudHMoJy5kcmFnZ2FibGUuZG9zLWFuc3dlci1kcmFnZ2FibGUsIC5wYWlyLWRyYWdnYWJsZScpWzBdO1xcblxcdFxcdFxcdGRyYWcucmVtb3ZlUG9wdXAoKTtcXG5cXHRcXHRcXHRyZXBsYWNlUGFpcnMoZHJvcHpvbmUsIGRyYWdnYWJsZSk7XFxuXFx0XFx0fSBlbHNlIGlmIChkcmFnLnRhc2tUeXBlID09PSAnUG92bGHEjWVuamUgcmlqZcSNaScpIHtcXG5cXHRcXHRcXHRsZXQgZHJvcHpvbmUgPSAkKGl0ZW0pLnBhcmVudHMoJy5kcm9wem9uZScpWzBdO1xcblxcdFxcdFxcdGxldCBkcmFnZ2FibGUgPSAkKGAjJHtkcmFnLnRhc2tJZH0gLmRyYWdnYWJsZWApWyQoaXRlbSkuYXR0cignZHJhZ2dhYmxlLWluZGV4JyldO1xcblxcdFxcdFxcdGRyYWcucmVtb3ZlUG9wdXAoKTtcXG5cXHRcXHRcXHRkcmFnZ2FibGUuY2xhc3NMaXN0LmFkZCgnY2FuLWRyb3Atc3R5bGUnKTtcXG5cXG5cXHRcXHRcXHRkcmFnRHJvcEFjdGlvbihkcm9wem9uZSwgZHJhZy50YXNrSWQsIGRyYWdnYWJsZSk7XFxuXFx0XFx0fSBlbHNlIGlmIChkcmFnLnRhc2tUeXBlID09PSAnVXJlxJFpdmFuamUgcG9yZXRrYSBlbGVtZW5hdGEnKSB7XFxuXFx0XFx0XFx0bGV0IGRyb3B6b25lID0gJChgW2RhdGEtY29ycmVjdC1wYWlyKj0nJHtpdGVtLmdldEF0dHJpYnV0ZSgnZGF0YS1jb3JyZWN0LXBhaXInKX0nXS5wYWlyLXN0YXRpY2ApLnBhcmVudCgpLmNoaWxkcmVuKCcucGFpci1kcmFnZ2FibGUnKVswXTtcXG5cXHRcXHRcXHRsZXQgZHJhZ2dhYmxlID0gJChpdGVtKS5wYXJlbnRzKCcuZHJhZ2dhYmxlLmRvcy1hbnN3ZXItZHJhZ2dhYmxlLCAucGFpci1kcmFnZ2FibGUnKVswXTtcXG5cXHRcXHRcXHRkcmFnLnJlbW92ZVBvcHVwKCk7XFxuXFx0XFx0XFx0cmVwbGFjZVBhaXJzKGRyb3B6b25lLCBkcmFnZ2FibGUpO1xcblxcdFxcdH1cXG5cXHR9XFxufTtcXG5cXG4vLyBoYW5kbGVzIGZvY3VzaW5nIGxpc3QgaXRlbSB0aGF0IHBvcHMgdXAgd2hlbiB3ZWFrIHNpZ2h0ZWQvYmxpbmQgcGVvcGxlIHVzZSB0aGUgYXBwXFxuZnVuY3Rpb24gZm9jdXNMaXN0SXRlbVdTKGxpc3RJdGVtKSB7XFxuXFx0aWYgKGxpc3RJdGVtKSB7XFxuXFx0XFx0bGlzdEl0ZW0uZm9jdXMoKTtcXG5cXHRcXHRsaXN0SXRlbS5jbGFzc05hbWUgKz0gJyBmb2N1cyc7XFxuXFx0fVxcbn1cXG5cXG5cXG5cXG5mdW5jdGlvbiBpbml0QWRkaXRpb25hbEtleWJvYXJkTmF2KCkge1xcblxcdCQoJ2lucHV0OnRleHQnKS5mb2N1cyhmdW5jdGlvbiAoZXZlbnQpIHtcXG5cXHRcXHR2YXIgdGFza0lkID0gJyMnICsgJChldmVudC50YXJnZXQpLmNsb3Nlc3QoXFxcImRpdltpZCo9J3Vlc3Rpb25JZCddW2RhdGEtcXVlc3Rpb24tdHlwZV1cXFwiKS5hdHRyKCdpZCcpO1xcblxcdFxcdHZhciBrZXlib2FyZENvbnRhaW5lciA9ICQodGFza0lkKS5maW5kKCcua2V5Ym9hcmRfY29udGFpbmVyLmRvcy1wYXJ0Jyk7XFxuXFx0XFx0dmFyIGtleWJvYXJkRXhpc3RzID0ga2V5Ym9hcmRDb250YWluZXIubGVuZ3RoID4gMDtcXG5cXHRcXHR2YXIgaXNLZXlib2FyZFNob3duID0ga2V5Ym9hcmRDb250YWluZXIuYXR0cignZGlzcGxheScpICE9PSAnbm9uZSc7XFxuXFx0XFx0dmFyIGJ1dHRvbnMgPSAkKGtleWJvYXJkQ29udGFpbmVyWzBdKS5maW5kKCdidXR0b24nKTtcXG5cXG5cXHRcXHRldmVudC50YXJnZXQub25rZXlkb3duID0gZnVuY3Rpb24gKGV2dCkge1xcblxcdFxcdFxcdGlmIChrZXlib2FyZEV4aXN0cyAmJiBpc0tleWJvYXJkU2hvd24pIHtcXG5cXHRcXHRcXHRcXHRpZiAoZXZ0LmtleUNvZGUgPT09IDM3KSB7XFxuXFx0XFx0XFx0XFx0XFx0ZXZ0LnByZXZlbnREZWZhdWx0KCk7XFxuXFx0XFx0XFx0XFx0XFx0JCgkKGJ1dHRvbnMpWzBdKS5mb2N1cygpO1xcblxcdFxcdFxcdFxcdH1cXG5cXHRcXHRcXHRcXHRpZiAoZXZ0LmtleUNvZGUgPT09IDM4KSB7XFxuXFx0XFx0XFx0XFx0XFx0ZXZ0LnByZXZlbnREZWZhdWx0KCk7XFxuXFx0XFx0XFx0XFx0XFx0JCgkKGJ1dHRvbnMpWzBdKS5mb2N1cygpO1xcblxcdFxcdFxcdFxcdH1cXG5cXHRcXHRcXHRcXHRpZiAoZXZ0LmtleUNvZGUgPT09IDM5KSB7XFxuXFx0XFx0XFx0XFx0XFx0ZXZ0LnByZXZlbnREZWZhdWx0KCk7XFxuXFx0XFx0XFx0XFx0XFx0JCgkKGJ1dHRvbnMpWzBdKS5mb2N1cygpO1xcblxcdFxcdFxcdFxcdH1cXG5cXHRcXHRcXHRcXHRpZiAoZXZ0LmtleUNvZGUgPT09IDQwKSB7XFxuXFx0XFx0XFx0XFx0XFx0ZXZ0LnByZXZlbnREZWZhdWx0KCk7XFxuXFx0XFx0XFx0XFx0XFx0JCgkKGJ1dHRvbnMpWzBdKS5mb2N1cygpO1xcblxcdFxcdFxcdFxcdH1cXG5cXHRcXHRcXHR9XFxuXFx0XFx0fTtcXG5cXG5cXHRcXHRidXR0b25zLm9uKCdrZXlkb3duJywgZnVuY3Rpb24gKGV2dCkge1xcblxcdFxcdFxcdGlmIChldnQua2V5Q29kZSA9PT0gMjcpIHsgLy8gZXNjXFxuXFx0XFx0XFx0XFx0ZXZlbnQudGFyZ2V0LmZvY3VzKCk7XFxuXFx0XFx0XFx0fVxcblxcblxcdFxcdFxcdGlmIChldnQua2V5Q29kZSA9PT0gOSAmJiBldnQuc2hpZnRLZXkgJiYgZXZ0LnRhcmdldCA9PT0gYnV0dG9uc1swXSkge1xcblxcdFxcdFxcdFxcdGV2dC5wcmV2ZW50RGVmYXVsdCgpO1xcblxcdFxcdFxcdFxcdGV2ZW50LnRhcmdldC5mb2N1cygpO1xcblxcdFxcdFxcdH1cXG5cXHRcXHR9KTtcXG5cXHR9KTtcXG59XFxuXFxuXFxuXFxuLy8gLS0tLS0tLS0tLSBpbml0aWFsaXplIHN0YXRpYyBlbGVtZW50c1xcbmluaXREcmFnRWxlbWVudHNFbGVtZW50cygpO1xcbmluaXREcmFnT25FbGVtZW50Q2xpY2soKTtcXG5pbml0RHJhZ09uUGljdHVyZUVsZW1lbnRzKCk7XFxuaW5pdEtleWJvYXJkRHJhZ0Ryb3AoKTtcXG4vL2luaXREcmFnUGFpcnNFbGVtZW50cygpOyAvLyB0aGlzIGluaXQgaXMgY2FsbGVkIGluIFxcXCJzZXRTb3J0YWJsZUVsZW1lbnRzKClcXFwiIGR1ZSB0byBsZWdhY3kgcmVhc29uc1xcbi8vaW5pdFNvcnRFbGVtZW50cygpOyAvLyB0aGlzIGluaXQgaXMgY2FsbGVkIGluIFxcXCJzZXRTb3J0YWJsZVdpdGNoQ29ubmVjdGlvbigpXFxcIiBkdWUgdG8gbGVnYWN5IHJlYXNvbnNcXG5cXG5cXG5mdW5jdGlvbiBjaGVja1F1ZXN0aW9uQW5zd2VyKHF1ZXN0aW9uSWQpIHtcXG5cXHRjaGVja1F1aXpBbnN3ZXJzKHF1ZXN0aW9uSWQpO1xcbn1cXG5cXG5mdW5jdGlvbiB0b2dnbGVTb2x1dGlvbihpZCkge1xcblxcdHZhciBzb2x1dGlvbklkID0gJyMnICsgaWQ7XFxuXFx0JChzb2x1dGlvbklkKS50b2dnbGVDbGFzcyhcXFwicXVlc3Rpb24tZWxlbWVudC1oaWRlXFxcIik7XFxufVxcblxcbmZ1bmN0aW9uIGlzQ2xvc2VFbm91Z2gocmVhbFBvc2l0aW9uLCBwb3NpdGlvbiwgZGV2aWF0b24pIHtcXG5cXHRyZXR1cm4gTWF0aC5hYnMocmVhbFBvc2l0aW9uIC0gcG9zaXRpb24pIDw9IGRldmlhdG9uO1xcbn1cXG5cXG4vKipcXG4gKiBDYWxjdWxhdGVzIGlmIHRoZSBkcm9wcGVkIGVsZW1lbnQgaXMgY2xvc2VyIHRoYW4gYWxsb3dlZCBkZXZpYXRpb24gdG8gdGhlIGRyb3AgcG9pbnQgaW4gZHJhZyB0byBpbWFnZSBxdWl6emVzXFxuICogVGhlIGRldmlhdGlvbiBpcyB0aGUgc2FtZSBpbiBYIGFuZCBZIGJlY2F1c2Ugc21hbGxlciBkaW1lbnNpb24gZGV2aWF0aW9uIGlzIHNjYWxlZC4gVGhpcyBhdm9pZHMgdGhlIHNpdHVhdGlvblxcbiAqIGluIHdoaWNoIGFsbG93ZWQgZGV2aWF0aW9uIHdvdWxkIGJlIHRpbnkgaW4gWSBkaXJlY3Rpb24gYW5kIG5vcm1hbCBpbiBYIGRpcmVjdGlvbiBpbiBjYXNlcyB3aGVyZSBmb3IgZXhhbXBsZSB0aGUgaW1hZ2VcXG4gKiBpcyBzaG9ydCBpbiBoZWlnaHQgYnV0IGxvbmcgaW4gd2lkdGhcXG4gKi9cXG5mdW5jdGlvbiBpc0dvb2RMb2NhdGlvbihyZWFsUG9zaXRpb25YLCByZWFsUG9zaXRpb25ZLCBwb3NpdGlvblgsIHBvc2l0aW9uWSwgd2lkdGgsIGhlaWdodCkge1xcblxcblxcdC8vU2V0IGRldmlhdGlvbiB0byBiZSBlcXVhbCBmb3IgeCBhbmQgeVxcblxcdHZhciBkZXZpYXRpb24gPSAwLjA2O1xcblxcdGlmICh3aWR0aCA+PSBoZWlnaHQpIHtcXG5cXHRcXHR2YXIgZGV2aWF0aW9uWCA9IGRldmlhdGlvbjtcXG5cXHRcXHR2YXIgZGV2aWF0aW9uWSA9IGRldmlhdGlvbiAqIHdpZHRoIC8gaGVpZ2h0O1xcblxcdFxcdGlmIChkZXZpYXRpb25ZID4gMSkge1xcblxcdFxcdFxcdGRldmlhdGlvblkgPSAxO1xcblxcdFxcdH1cXG5cXHR9IGVsc2Uge1xcblxcdFxcdHZhciBkZXZpYXRpb25ZID0gZGV2aWF0aW9uO1xcblxcdFxcdHZhciBkZXZpYXRpb25YID0gZGV2aWF0aW9uICogaGVpZ2h0IC8gd2lkdGg7XFxuXFx0XFx0aWYgKGRldmlhdGlvblggPiAxKSB7XFxuXFx0XFx0XFx0ZGV2aWF0aW9uWCA9IDE7XFxuXFx0XFx0fVxcblxcblxcdH1cXG5cXG5cXHRpZiAoaXNDbG9zZUVub3VnaChyZWFsUG9zaXRpb25YLCBwb3NpdGlvblgsIGRldmlhdGlvblgpICYmIGlzQ2xvc2VFbm91Z2gocmVhbFBvc2l0aW9uWSwgcG9zaXRpb25ZLCBkZXZpYXRpb25ZKSkge1xcblxcdFxcdHJldHVybiB0cnVlO1xcblxcdH1cXG5cXHRyZXR1cm4gZmFsc2U7XFxufVxcbnZhciBvdXRjb21lc0luZm8gPSB7fTtcXG52YXIgcXVlc3Rpb25EYXRhID0ge307XFxudmFyIG91dGNvbWVzRXZhbHVhdGlvblR5cGUgPSAnJztcXG52YXIgb3V0Y29tZXNQZXJjZW50YWdlQ3V0b2ZmID0gMDtcXG5cXG52YXIgc2luZ2xlQW5zd2VyUXVlc3Rpb25UeXBlcyA9IFtxdWVzdGlvblR5cGVzLnRydWVmYWxzZSwgcXVlc3Rpb25UeXBlcy5wYWlyXTtcXG5cXG5mdW5jdGlvbiBjaGVja1F1aXpBbnN3ZXJzKHNyY0lkKSB7XFxuXFxuXFx0aWYgKHNyY0lkID09IHVuZGVmaW5lZCkge1xcblxcdFxcdHNyY0lkID0gXFxcInF1aXpTcmNcXFwiO1xcblxcdH0gZWxzZSBpZiAoc3JjSWQuaW5kZXhPZigncXVpeicpICE9PSAtMSkge1xcblxcdFxcdHZhciBxdWl6RWxlbWVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKHNyY0lkKTtcXG5cXG5cXHRcXHRvdXRjb21lc0V2YWx1YXRpb25UeXBlID0gcXVpekVsZW1lbnQuZ2V0QXR0cmlidXRlKCdkYXRhLW91dGNvbWUtZXZhbHVhdGlvbi10eXBlJyk7XFxuXFx0XFx0b3V0Y29tZXNQZXJjZW50YWdlQ3V0b2ZmID0gTnVtYmVyKHF1aXpFbGVtZW50LmdldEF0dHJpYnV0ZSgnZGF0YS1vdXRjb21lLXBlcmNlbnRhZ2UtY3V0b2ZmJykpIC8gMTAwO1xcblxcdFxcdGNsZWFyT3V0Y29tZVJlc3VsdHMoc3JjSWQpO1xcblxcblxcdFxcdHZhciBxdWVzdGlvbkRpdnMgPSAkKHF1aXpFbGVtZW50KS5maW5kKCdkaXZbZGF0YS1xdWVzdGlvbi10eXBlXScpO1xcblxcblxcdFxcdC8vdGhpcyBpcyBhIGNoZWNrIGZvciB3aG9sZSBwYWdlIHNvIGl0ZXJhdGUgdGhyb3VnaCBlYWNoIHF1aXogaW5kaXZpZHVhbGx5XFxuXFx0XFx0Zm9yICh2YXIgbiA9IDA7IG4gPCBxdWVzdGlvbkRpdnMubGVuZ3RoOyBuKyspIHtcXG5cXHRcXHRcXHR2YXIgcmVhbFNyY0lkID0gJChxdWVzdGlvbkRpdnNbbl0pLmF0dHIoJ2lkJyk7XFxuXFx0XFx0XFx0bW9kYWwyID0gcXVlc3Rpb25EaXZzW25dO1xcblxcblxcdFxcdFxcdGNvbnN0IHF1aXpEZXJJZCA9IHJlYWxTcmNJZC5zdWJzdHJpbmcoMCwgcmVhbFNyY0lkLmluZGV4T2YoJ18nKSk7XFxuXFxuXFx0XFx0XFx0dmFyIGlucHV0cyA9ICQocXVlc3Rpb25EaXZzW25dKS5maW5kKFxcXCJpbnB1dFtpZCo9XFxcIiArIHF1aXpEZXJJZCArIFxcXCJdXFxcIikudG9BcnJheSgpO1xcblxcdFxcdFxcdHZhciBxdWVzdGlvbkVsZW1lbnQgPSBnZXRQYXJlbnRRdWVzdGlvblRvcEVsZW1lbnQobW9kYWwyKTtcXG5cXHRcXHRcXHR2YXIgcXVlc3Rpb25PdXRjb21lSWQgPSBmaWxsT3V0Y29tZUluZm9EYXRhKG1vZGFsMik7XFxuXFxuXFx0XFx0XFx0dmFyIHF1ZXN0aW9uVHlwZTtcXG5cXHRcXHRcXHR2YXIgaXNDb21wbGV0ZWx5Q29ycmVjdCA9IHRydWU7XFxuXFxuXFx0XFx0XFx0d2luQXVkaW8gPSBudWxsO1xcblxcdFxcdFxcdGxvc2VBdWRpbyA9IG51bGw7XFxuXFxuXFx0XFx0XFx0cmVzZXRRdWl6UXVlc3Rpb25GZWVkYmFjayhyZWFsU3JjSWQpO1xcblxcblxcdFxcdFxcdGFuc3dlckNoZWNrKHNyY0lkLCByZWFsU3JjSWQsIG1vZGFsMiwgaW5wdXRzLCBxdWVzdGlvbkVsZW1lbnQsIHF1ZXN0aW9uT3V0Y29tZUlkLCBxdWVzdGlvblR5cGUsIGlzQ29tcGxldGVseUNvcnJlY3QpO1xcblxcdFxcdH1cXG5cXG5cXHRcXHR1cGRhdGVPdXRjb21lSW5mbyhzcmNJZCk7XFxuXFx0XFx0c2hvd091dGNvbWVSZXN1bHRzKHNyY0lkKTtcXG5cXG5cXHR9IGVsc2Uge1xcblxcdFxcdC8vdGhpcyBpcyBhIGNoZWNrIGZvciBvbmUgcXVpeiBzbyByZWFsc3JjaWQgaXMgaWRlbnRpY2FsIHRvIHNyY2lkXFxuXFx0XFx0cmVhbFNyY0lkID0gc3JjSWQ7XFxuXFx0XFx0dmFyIG1vZGFsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoc3JjSWQpO1xcblxcdFxcdGNvbnN0IHF1aXpEZXJJZCA9IHJlYWxTcmNJZC5zdWJzdHJpbmcoMCwgcmVhbFNyY0lkLmluZGV4T2YoJ18nKSk7XFxuXFxuXFx0XFx0dmFyIGlucHV0cyA9ICQobW9kYWwpLmZpbmQoXFxcImlucHV0W2lkKj1cXFwiICsgcXVpekRlcklkICsgXFxcIl1cXFwiKS50b0FycmF5KCk7XFxuXFx0XFx0dmFyIHF1ZXN0aW9uRWxlbWVudCA9IG1vZGFsO1xcblxcdFxcdHZhciBxdWVzdGlvbk91dGNvbWVJZCA9IGZpbGxPdXRjb21lSW5mb0RhdGEocXVlc3Rpb25FbGVtZW50KTtcXG5cXG5cXHRcXHR2YXIgcXVlc3Rpb25UeXBlO1xcblxcdFxcdHZhciBpc0NvbXBsZXRlbHlDb3JyZWN0ID0gdHJ1ZTtcXG5cXG5cXHRcXHRyZXNldFF1aXpRdWVzdGlvbkZlZWRiYWNrKHJlYWxTcmNJZCk7XFxuXFxuXFx0XFx0YW5zd2VyQ2hlY2soc3JjSWQsIHJlYWxTcmNJZCwgbW9kYWwsIGlucHV0cywgcXVlc3Rpb25FbGVtZW50LCBxdWVzdGlvbk91dGNvbWVJZCwgcXVlc3Rpb25UeXBlLCBpc0NvbXBsZXRlbHlDb3JyZWN0KTtcXG5cXHR9XFxufTtcXG5cXG5jb25zdCBnZXRRdWl6U3ViZWxlbWVudEJ5SWQgPSAocXVpekVsZW1lbnQsIGlkKSA9PiB7XFxuXFx0cmV0dXJuICQocXVpekVsZW1lbnQpLmZpbmQoJyMnICsgaWQpLmdldCgwKTtcXG59O1xcblxcbmNvbnN0IHNob3dIaWRlUXVpekVsZW1lbnQgPSAoZWxlbWVudElkLCBzcmNJZCkgPT4ge1xcblxcdGxldCBxdWl6RWxlbWVudDtcXG5cXHRpZiAoc3JjSWQpIHtcXG5cXHRcXHRxdWl6RWxlbWVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKHNyY0lkKTtcXG5cXHR9IGVsc2Uge1xcblxcdFxcdHF1aXpFbGVtZW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXFxcInF1aXpTcmNcXFwiKTtcXG5cXHR9XFxuXFx0aWYgKGdldFF1aXpTdWJlbGVtZW50QnlJZChxdWl6RWxlbWVudCwgZWxlbWVudElkKS5jbGFzc0xpc3QuY29udGFpbnMoJ3F1ZXN0aW9uLWVsZW1lbnQtaGlkZScpKSB7XFxuXFx0XFx0Z2V0UXVpelN1YmVsZW1lbnRCeUlkKHF1aXpFbGVtZW50LCBlbGVtZW50SWQpLmNsYXNzTGlzdC5yZW1vdmUoJ3F1ZXN0aW9uLWVsZW1lbnQtaGlkZScpO1xcblxcdH0gZWxzZSB7XFxuXFx0XFx0Z2V0UXVpelN1YmVsZW1lbnRCeUlkKHF1aXpFbGVtZW50LCBlbGVtZW50SWQpLmNsYXNzTGlzdC5hZGQoJ3F1ZXN0aW9uLWVsZW1lbnQtaGlkZScpO1xcblxcdH1cXG59O1xcblxcbmNvbnN0IGdldEVsZW1lbnRQYXJlbnRRdWVzdGlvbklkID0gKGVsZW1lbnQpID0+IHtcXG5cXHRyZXR1cm4gJChlbGVtZW50KS5jbG9zZXN0KCcucXVlc3Rpb24nKS5nZXQoMCkuZ2V0QXR0cmlidXRlKCdpZCcpO1xcbn07XFxuXFxuY29uc3QgZ2V0UGFyZW50UXVlc3Rpb25Ub3BFbGVtZW50ID0gKGVsZW1lbnQpID0+IHtcXG5cXHRyZXR1cm4gJChlbGVtZW50KS5jbG9zZXN0KFxcXCJkaXZbaWQqPSd1ZXN0aW9uSWQnXVtkYXRhLXF1ZXN0aW9uLXR5cGVdXFxcIikuZ2V0KDApOyAvLyBcXFwidWVzdGlvbklkXFxcIiBpcyBub3QgYSB0eXBvLCBpZCBpcyBub3QgY29uc2lzdGVudGx5IHVzZWQgaW4gZGlmZmVyZW50IGVudmlyb25tZW50c1xcbn07XFxuZnVuY3Rpb24gZmlsbE91dGNvbWVJbmZvRGF0YShxdWVzdGlvbikge1xcblxcblxcdGlmIChxdWVzdGlvbi5nZXRBdHRyaWJ1dGUoJ2RhdGEtb3V0Y29tZS1pZCcpICE9PSBudWxsKSB7XFxuXFx0XFx0dmFyIG91dGNvbWVJZCA9IHF1ZXN0aW9uLmdldEF0dHJpYnV0ZSgnZGF0YS1vdXRjb21lLWlkJyk7XFxuXFxuXFx0XFx0aWYgKG91dGNvbWVzSW5mb1tvdXRjb21lSWRdID09PSB1bmRlZmluZWQpIHtcXG5cXHRcXHRcXHR2YXIgb3V0Y29tZU5hbWUgPSBxdWVzdGlvbi5nZXRBdHRyaWJ1dGUoJ2RhdGEtb3V0Y29tZS1uYW1lJyk7XFxuXFx0XFx0XFx0dmFyIG91dGNvbWVEZXJJbmZvID0gW107XFxuXFxuXFx0XFx0XFx0aWYgKHF1ZXN0aW9uLmdldEF0dHJpYnV0ZSgnZGF0YS1vdXRjb21lLWRlcicpICE9PSBudWxsKSB7XFxuXFx0XFx0XFx0XFx0b3V0Y29tZURlckluZm8gPSBwYXJzZU91dGNvbWVEZXJEYXRhKHF1ZXN0aW9uLmdldEF0dHJpYnV0ZSgnZGF0YS1vdXRjb21lLWRlcicpKTtcXG5cXHRcXHRcXHR9XFxuXFxuXFx0XFx0XFx0b3V0Y29tZXNJbmZvW291dGNvbWVJZF0gPSB7XFxuXFx0XFx0XFx0XFx0b3V0Y29tZU5hbWU6IG91dGNvbWVOYW1lLFxcblxcdFxcdFxcdFxcdG91dGNvbWVEZXI6IG91dGNvbWVEZXJJbmZvLFxcblxcdFxcdFxcdFxcdGNvcnJlY3RBbnN3ZXJlZDogMCxcXG5cXHRcXHRcXHRcXHR0b3RhbENvdW50OiAwXFxuXFx0XFx0XFx0fTtcXG5cXHRcXHR9XFxuXFxuXFx0XFx0cmV0dXJuIG91dGNvbWVJZDtcXG5cXHR9IGVsc2Uge1xcblxcdFxcdHJldHVybiBudWxsO1xcblxcdH1cXG59XFxuXFxuZnVuY3Rpb24gZmlsbFF1ZXN0aW9uRGF0YShxdWVzdGlvbiwgb3V0Y29tZUlkKSB7XFxuXFx0Y29uc3QgaWQgPSBxdWVzdGlvbi5nZXRBdHRyaWJ1dGUoJ2lkJyk7XFxuXFx0aWYgKCFpZCkge1xcblxcdFxcdHJldHVybjtcXG5cXHR9XFxuXFxuXFx0aWYgKCFxdWVzdGlvbkRhdGFbaWRdKSB7XFxuXFx0XFx0cXVlc3Rpb25EYXRhW2lkXSA9IHtcXG5cXHRcXHRcXHRpZCxcXG5cXHRcXHRcXHRvdXRjb21lSWQ6IG91dGNvbWVJZCxcXG5cXHRcXHRcXHRhbnN3ZXJUb3RhbDogMSxcXG5cXHRcXHRcXHRjb3JyZWN0Q291bnQ6IDAsXFxuXFx0XFx0XFx0cXVlc3Rpb25UeXBlOiBxdWVzdGlvbi5nZXRBdHRyaWJ1dGUoJ2RhdGEtcXVlc3Rpb24tdHlwZScpLFxcblxcdFxcdFxcdHBlcmNlbnRhZ2VTaGFyZTogTnVtYmVyKHF1ZXN0aW9uLmdldEF0dHJpYnV0ZSgnZGF0YS1vdXRjb21lLXBlcmNlbnRhZ2Utc2hhcmUnKSksXFxuXFx0XFx0fTtcXG5cXHR9IGVsc2Uge1xcblxcdFxcdHF1ZXN0aW9uRGF0YVtpZF0uYW5zd2VyVG90YWwgKz0gMTtcXG5cXHR9XFxufVxcblxcbmZ1bmN0aW9uIGFkZFF1ZXN0aW9uQ29ycmVjdEFuc3dlckNvdW50KHF1ZXN0aW9uKSB7XFxuXFx0Y29uc3QgaWQgPSBxdWVzdGlvbi5nZXRBdHRyaWJ1dGUoJ2lkJyk7XFxuXFx0aWYgKCFpZCkge1xcblxcdFxcdHJldHVybjtcXG5cXHR9XFxuXFxuXFx0cXVlc3Rpb25EYXRhW2lkXS5jb3JyZWN0Q291bnQgKz0gMTtcXG59XFxuXFxuZnVuY3Rpb24gdXBkYXRlT3V0Y29tZUluZm8oKSB7XFxuXFx0Zm9yICh2YXIga2V5IGluIHF1ZXN0aW9uRGF0YSkge1xcblxcdFxcdHZhciBxdWVzdGlvbiA9IHF1ZXN0aW9uRGF0YVtrZXldO1xcblxcdFxcdHZhciBvdXRjb21lRGF0YSA9IG91dGNvbWVzSW5mb1txdWVzdGlvbi5vdXRjb21lSWRdO1xcblxcblxcdFxcdGlmIChvdXRjb21lRGF0YSAhPT0gdW5kZWZpbmVkKSB7XFxuXFx0XFx0XFx0YWRkT3V0Y29tZUluZm9Ub3RhbChxdWVzdGlvbi5vdXRjb21lSWQpO1xcblxcdFxcdFxcdGlmIChxdWVzdGlvbi5jb3JyZWN0Q291bnQgPT09IHF1ZXN0aW9uLmFuc3dlclRvdGFsKSB7XFxuXFx0XFx0XFx0XFx0YWRkT3V0Y29tZUluZm9Db3JyZWN0KHF1ZXN0aW9uLm91dGNvbWVJZCk7XFxuXFx0XFx0XFx0fVxcblxcdFxcdH1cXG5cXHR9XFxufVxcblxcbmZ1bmN0aW9uIHJlc2V0UXVpeihxdWl6SWQpIHtcXG5cXHRjb25zdCBxdWl6RWxlbWVudCA9ICQoYGRpdltpZD0nJHtxdWl6SWR9J11gKTtcXG5cXG5cXHRjb25zdCBxdWVzdGlvbnMgPSBxdWl6RWxlbWVudC5maW5kKCdkaXZbZGF0YS1xdWVzdGlvbi10eXBlXScpLnRvQXJyYXkoKTtcXG5cXHRxdWVzdGlvbnMuZm9yRWFjaCgocXVlc3Rpb24pID0+IHtcXG5cXHRcXHRyZXNldFF1aXpRdWVzdGlvbihxdWVzdGlvbi5pZCwgdHJ1ZSk7XFxuXFx0fSk7XFxuXFxuXFx0aGlkZU91dGNvbWVSZXN1bHRzKHF1aXpJZCk7XFxuXFxuXFx0cXVpekVsZW1lbnQuZmluZCgnLmRvcy1jb2xsZWN0aW9uLXRhc2tzLXNsaWRlcicpLnNsaWNrKCdzbGlja0dvVG8nLCAwLCB0cnVlKTsgLy9yZXNldCBzbGlkZSBpbmRleFxcblxcblxcdHNjcm9sbFRvRWxlbWVudChxdWl6RWxlbWVudC5vZmZzZXQoKS50b3ApO1xcbn07XFxuXFxuZnVuY3Rpb24gaGlkZU91dGNvbWVSZXN1bHRzKHF1aXpJZCkge1xcblxcdGNvbnN0IHF1aXpGZWVkYmFja1NlY3Rpb25FbGVtZW50ID0gJChgc2VjdGlvbltpZCo9J3VuaXQtdGVzdC1maW5pc2hlZCddW2RhdGEtcXVpei1pZD0nJHtxdWl6SWR9J11gKTtcXG5cXG5cXHRxdWl6RmVlZGJhY2tTZWN0aW9uRWxlbWVudC5oaWRlKCk7XFxufTtcXG5cXG5mdW5jdGlvbiBzY3JvbGxUb0VsZW1lbnQodG9wT2Zmc2V0KSB7XFxuXFx0Y29uc3QgaGVhZGVySGVpZ2h0ID0gJCgnaGVhZGVyLmRvcy1oZWFkZXInKS5oZWlnaHQoKTtcXG5cXG5cXHQkKCdodG1sLCBib2R5Jykuc3RvcCgpLmFuaW1hdGUoe1xcblxcdFxcdCdzY3JvbGxUb3AnOiB0b3BPZmZzZXQgLSBoZWFkZXJIZWlnaHQsIC8vcmVtb3ZlIGhlYWRlciBoaWdodFxcblxcdH0sIDgwMCwgJ3N3aW5nJywgZnVuY3Rpb24gKCkgeyB9KTtcXG59O1xcblxcbmZ1bmN0aW9uIHNob3dPdXRjb21lUmVzdWx0cyhxdWl6SWQpIHtcXG5cXG5cXHRjb25zdCBxdWl6RXZhbHVhdGlvbkRhdGEgPSB7XFxuXFx0XFx0dG90YWxRdWVzdGlvbldlaWdodDogMCxcXG5cXHRcXHRxdWVzdGlvbnM6IFtdLFxcblxcdH07XFxuXFx0T2JqZWN0LnZhbHVlcyhxdWVzdGlvbkRhdGEpLmZvckVhY2gocXVlc3Rpb24gPT4ge1xcblxcdFxcdHF1aXpFdmFsdWF0aW9uRGF0YS50b3RhbFF1ZXN0aW9uV2VpZ2h0ICs9IHF1ZXN0aW9uLnBlcmNlbnRhZ2VTaGFyZTtcXG5cXHRcXHRxdWl6RXZhbHVhdGlvbkRhdGEucXVlc3Rpb25zLnB1c2goe1xcblxcdFxcdFxcdGNvcnJlY3Q6IHF1ZXN0aW9uLmFuc3dlclRvdGFsID09PSBxdWVzdGlvbi5jb3JyZWN0Q291bnQsXFxuXFx0XFx0XFx0Li4ucXVlc3Rpb24sXFxuXFx0XFx0fSk7XFxuXFx0fSk7XFxuXFxuXFx0Y29uc3QgY29ycmVjdEFuc3dlcmVkUXVlc3Rpb25zID0gcXVpekV2YWx1YXRpb25EYXRhLnF1ZXN0aW9ucy5maWx0ZXIocXVlc3Rpb24gPT4gcXVlc3Rpb24uY29ycmVjdCA9PT0gdHJ1ZSk7XFxuXFxuXFx0Y29uc3QgcXVpekZlZWRiYWNrU2VjdGlvbkVsZW1lbnQgPSAkKGBzZWN0aW9uW2lkKj0ndW5pdC10ZXN0LWZpbmlzaGVkJ11bZGF0YS1xdWl6LWlkPScke3F1aXpJZH0nXWApO1xcblxcblxcdHF1aXpGZWVkYmFja1NlY3Rpb25FbGVtZW50LnNob3coKTtcXG5cXG5cXHRzY3JvbGxUb0VsZW1lbnQocXVpekZlZWRiYWNrU2VjdGlvbkVsZW1lbnQub2Zmc2V0KCkudG9wKTtcXG5cXG5cXHR2YXIgY29ycmVjdFBlcmNlbnRhZ2VBbmNob3IgPSBxdWl6RmVlZGJhY2tTZWN0aW9uRWxlbWVudC5maW5kKCcjY29ycmVjdC1xdWVzdGlvbi1wZXJjZW50YWdlJyk7XFxuXFx0dmFyIG91dGNvbWVsaXN0QW5jaG9yID0gcXVpekZlZWRiYWNrU2VjdGlvbkVsZW1lbnQuZmluZCgnI291dGNvbWVzLWxpc3QnKTtcXG5cXHR2YXIgbGVhcm5lZE91dGNvbWVBbmNob3IgPSBxdWl6RmVlZGJhY2tTZWN0aW9uRWxlbWVudC5maW5kKCcjY29ycmVjdC1vdXRjb21lcycpO1xcblxcdHZhciByZXBlYXRPdXRjb21lQW5jaG9yID0gcXVpekZlZWRiYWNrU2VjdGlvbkVsZW1lbnQuZmluZCgnI2luY29ycmVjdC1vdXRjb21lcycpO1xcblxcblxcdHZhciBjb3JyZWN0UXVlc3Rpb25Db3VudEFuY2hvciA9IHF1aXpGZWVkYmFja1NlY3Rpb25FbGVtZW50LmZpbmQoJyNjb3JyZWN0LXF1ZXN0aW9uLWNvdW50Jyk7XFxuXFx0Y29ycmVjdFF1ZXN0aW9uQ291bnRBbmNob3IuaHRtbChjb3JyZWN0QW5zd2VyZWRRdWVzdGlvbnMubGVuZ3RoICsgJy8nICsgcXVpekV2YWx1YXRpb25EYXRhLnF1ZXN0aW9ucy5sZW5ndGgpO1xcblxcblxcdHF1aXpGZWVkYmFja1NlY3Rpb25FbGVtZW50LmZpbmQoXFxcIiNwcm9ncmVzc2JhclxcXCIpLnByb2dyZXNzYmFyKHtcXG5cXHRcXHR2YWx1ZTogKGNvcnJlY3RBbnN3ZXJlZFF1ZXN0aW9ucy5sZW5ndGggLyBxdWl6RXZhbHVhdGlvbkRhdGEucXVlc3Rpb25zLmxlbmd0aCkgKiAxMDBcXG5cXHR9KTtcXG5cXG5cXG5cXHR2YXIgbGVhcm5lZE91dGNvbWVzID0gW107XFxuXFx0dmFyIHJlcGVhdE91dGNvbWVzID0gW107XFxuXFx0aWYgKG91dGNvbWVzRXZhbHVhdGlvblR5cGUgPT09ICdwZXJjZW50YWdlJykge1xcblxcdFxcdGNvbnN0IGNvcnJlY3RBbnN3ZXJlZFBlcmNlbnRhZ2UgPSBxdWl6RXZhbHVhdGlvbkRhdGEucXVlc3Rpb25zLnJlZHVjZSgocHJldlZhbHVlLCBxdWVzdGlvbiwgaW5kZXgpID0+IHtcXG5cXHRcXHRcXHRjb25zdCBuZXdTaGFyZSA9IHF1ZXN0aW9uLmNvcnJlY3QgPyBxdWVzdGlvbi5wZXJjZW50YWdlU2hhcmUgLyBxdWl6RXZhbHVhdGlvbkRhdGEudG90YWxRdWVzdGlvbldlaWdodCA6IDA7XFxuXFx0XFx0XFx0cmV0dXJuIHByZXZWYWx1ZSArIG5ld1NoYXJlO1xcblxcdFxcdH0sIDApICogMTAwO1xcblxcblxcdFxcdHF1aXpGZWVkYmFja1NlY3Rpb25FbGVtZW50LmZpbmQoXFxcIiNjb3JyZWN0LW91dGNvbWUtdGV4dFxcXCIpLmhpZGUoKTtcXG5cXHRcXHRxdWl6RmVlZGJhY2tTZWN0aW9uRWxlbWVudC5maW5kKFxcXCIjaW5jb3JyZWN0LW91dGNvbWUtdGV4dFxcXCIpLmhpZGUoKTtcXG5cXHRcXHRsZWFybmVkT3V0Y29tZUFuY2hvci5oaWRlKCk7XFxuXFx0XFx0cmVwZWF0T3V0Y29tZUFuY2hvci5oaWRlKCk7XFxuXFxuXFx0XFx0Y29ycmVjdFBlcmNlbnRhZ2VBbmNob3IuaHRtbChNYXRoLnJvdW5kKGNvcnJlY3RBbnN3ZXJlZFBlcmNlbnRhZ2UpKTtcXG5cXG5cXHRcXHRjb25zdCBhbGxPdXRjb21lcyA9IFtdO1xcblxcdFxcdE9iamVjdC52YWx1ZXMob3V0Y29tZXNJbmZvKS5mb3JFYWNoKGZ1bmN0aW9uIChvdXRjb21lSW5mbykge1xcblxcdFxcdFxcdGFsbE91dGNvbWVzLnB1c2goJzxsaT4nICsgb3V0Y29tZUluZm8ub3V0Y29tZU5hbWUgKyAnPC9saT4nKTtcXG5cXHRcXHR9KTtcXG5cXG5cXHRcXHRvdXRjb21lbGlzdEFuY2hvci5odG1sKGFsbE91dGNvbWVzKTtcXG5cXHR9XFxuXFxuXFx0aWYgKG91dGNvbWVzRXZhbHVhdGlvblR5cGUgPT09ICdjdXRvZmYnKSB7XFxuXFx0XFx0T2JqZWN0LnZhbHVlcyhvdXRjb21lc0luZm8pLmZvckVhY2goZnVuY3Rpb24gKG91dGNvbWVJbmZvKSB7XFxuXFx0XFx0XFx0aWYgKG91dGNvbWVJbmZvLmNvcnJlY3RBbnN3ZXJlZCAvIG91dGNvbWVJbmZvLnRvdGFsQ291bnQgPj0gb3V0Y29tZXNQZXJjZW50YWdlQ3V0b2ZmKSB7XFxuXFx0XFx0XFx0XFx0bGVhcm5lZE91dGNvbWVzLnB1c2goJzxsaT4nICsgb3V0Y29tZUluZm8ub3V0Y29tZU5hbWUgKyAnPC9saT4nKTtcXG5cXHRcXHRcXHR9IGVsc2Uge1xcblxcdFxcdFxcdFxcdHJlcGVhdE91dGNvbWVzLnB1c2goJzxsaT4nICsgb3V0Y29tZUluZm8ub3V0Y29tZU5hbWUgKyAnPC9saT4nKTtcXG5cXHRcXHRcXHR9XFxuXFx0XFx0fSk7XFxuXFxuXFx0XFx0cXVpekZlZWRiYWNrU2VjdGlvbkVsZW1lbnQuZmluZChcXFwiI3BlcmNlbnRhZ2Utb3V0Y29tZS10ZXh0XFxcIikuaGlkZSgpO1xcblxcdFxcdHF1aXpGZWVkYmFja1NlY3Rpb25FbGVtZW50LmZpbmQoXFxcIiNjb3JyZWN0LXBlcmNlbnRhZ2UtdGV4dFxcXCIpLmhpZGUoKTtcXG5cXHRcXHRvdXRjb21lbGlzdEFuY2hvci5oaWRlKCk7XFxuXFxuXFx0XFx0Y29uc3QgbGVhcm5lZE91dGNvbWVzSFRNTCA9IGxlYXJuZWRPdXRjb21lcy5yZWR1Y2UoKHByZXZWYWx1ZSwgbGVhcm5lZE91dGNvbWUsIGluZGV4KSA9PiB7XFxuXFx0XFx0XFx0cmV0dXJuIHByZXZWYWx1ZSArIGxlYXJuZWRPdXRjb21lO1xcblxcdFxcdH0sICcnKTtcXG5cXG5cXHRcXHRsZWFybmVkT3V0Y29tZUFuY2hvci5odG1sKGxlYXJuZWRPdXRjb21lc0hUTUwpO1xcblxcblxcdFxcdGNvbnN0IHJlcGVhdE91dGNvbWVzSFRNTCA9IHJlcGVhdE91dGNvbWVzLnJlZHVjZSgocHJldlZhbHVlLCByZXBlYXRPdXRjb21lLCBpbmRleCkgPT4ge1xcblxcdFxcdFxcdHJldHVybiBwcmV2VmFsdWUgKyByZXBlYXRPdXRjb21lO1xcblxcdFxcdH0sICcnKTtcXG5cXG5cXHRcXHRyZXBlYXRPdXRjb21lQW5jaG9yLmh0bWwocmVwZWF0T3V0Y29tZXNIVE1MKTtcXG5cXHR9XFxuXFxuXFx0aWYgKGxlYXJuZWRPdXRjb21lcy5sZW5ndGggPT09IDApIHtcXG5cXHRcXHRxdWl6RmVlZGJhY2tTZWN0aW9uRWxlbWVudC5maW5kKFxcXCIjY29ycmVjdC1vdXRjb21lLXRleHRcXFwiKS5oaWRlKCk7XFxuXFx0XFx0cXVpekZlZWRiYWNrU2VjdGlvbkVsZW1lbnQuZmluZChcXFwiI2luY29ycmVjdC1vdXRjb21lLWRpdmlkZXJcXFwiKS5oaWRlKCk7XFxuXFx0fSBlbHNlIGlmIChyZXBlYXRPdXRjb21lcy5sZW5ndGggPT09IDApIHtcXG5cXHRcXHRxdWl6RmVlZGJhY2tTZWN0aW9uRWxlbWVudC5maW5kKFxcXCIjaW5jb3JyZWN0LW91dGNvbWUtZGl2aWRlclxcXCIpLmhpZGUoKTtcXG5cXHRcXHRxdWl6RmVlZGJhY2tTZWN0aW9uRWxlbWVudC5maW5kKFxcXCIjaW5jb3JyZWN0LW91dGNvbWUtdGV4dFxcXCIpLmhpZGUoKTtcXG5cXHRcXHRxdWl6RmVlZGJhY2tTZWN0aW9uRWxlbWVudC5maW5kKFxcXCIjaW5jb3JyZWN0LW91dGNvbWUtdW5pdC10ZXh0XFxcIikuaGlkZSgpO1xcblxcdH1cXG5cXG59XFxuXFxuZnVuY3Rpb24gY2xlYXJPdXRjb21lUmVzdWx0cyhxdWl6SWQpIHtcXG5cXHRjb25zdCBxdWl6RmVlZGJhY2tTZWN0aW9uRWxlbWVudCA9ICQoYHNlY3Rpb25baWQqPSd1bml0LXRlc3QtZmluaXNoZWQnXVtkYXRhLXF1aXotaWQ9JyR7cXVpeklkfSddYCk7XFxuXFx0dmFyIGxlYXJuZWRPdXRjb21lQW5jaG9yID0gcXVpekZlZWRiYWNrU2VjdGlvbkVsZW1lbnQuZmluZCgnI2NvcnJlY3Qtb3V0Y29tZXMnKTtcXG5cXHR2YXIgcmVwZWF0T3V0Y29tZUFuY2hvciA9IHF1aXpGZWVkYmFja1NlY3Rpb25FbGVtZW50LmZpbmQoJyNpbmNvcnJlY3Qtb3V0Y29tZXMnKTtcXG5cXHR2YXIgY29ycmVjdFBlcmNlbnRhZ2VBbmNob3IgPSBxdWl6RmVlZGJhY2tTZWN0aW9uRWxlbWVudC5maW5kKCcjY29ycmVjdC1xdWVzdGlvbi1wZXJjZW50YWdlJyk7XFxuXFx0dmFyIG91dGNvbWVsaXN0QW5jaG9yID0gcXVpekZlZWRiYWNrU2VjdGlvbkVsZW1lbnQuZmluZCgnI291dGNvbWVzLWxpc3QnKTtcXG5cXHR2YXIgY29ycmVjdFF1ZXN0aW9uQ291bnRBbmNob3IgPSBxdWl6RmVlZGJhY2tTZWN0aW9uRWxlbWVudC5maW5kKCcjY29ycmVjdC1xdWVzdGlvbi1jb3VudCcpO1xcblxcblxcdG91dGNvbWVzSW5mbyA9IHt9O1xcblxcdHF1ZXN0aW9uRGF0YSA9IHt9O1xcblxcblxcdHF1aXpGZWVkYmFja1NlY3Rpb25FbGVtZW50LmZpbmQoXFxcIiNjb3JyZWN0LW91dGNvbWUtdGV4dFxcXCIpLnNob3coKTtcXG5cXHRxdWl6RmVlZGJhY2tTZWN0aW9uRWxlbWVudC5maW5kKFxcXCIjaW5jb3JyZWN0LW91dGNvbWUtdGV4dFxcXCIpLnNob3coKTtcXG5cXHRxdWl6RmVlZGJhY2tTZWN0aW9uRWxlbWVudC5maW5kKFxcXCIjY29ycmVjdC1wZXJjZW50YWdlLXRleHRcXFwiKS5zaG93KCk7XFxuXFx0cXVpekZlZWRiYWNrU2VjdGlvbkVsZW1lbnQuZmluZChcXFwiI2luY29ycmVjdC1vdXRjb21lLWRpdmlkZXJcXFwiKS5zaG93KCk7XFxuXFx0bGVhcm5lZE91dGNvbWVBbmNob3IuaHRtbCgnJyk7XFxuXFx0cmVwZWF0T3V0Y29tZUFuY2hvci5odG1sKCcnKTtcXG5cXHRjb3JyZWN0UGVyY2VudGFnZUFuY2hvci5odG1sKCcnKTtcXG5cXHRvdXRjb21lbGlzdEFuY2hvci5odG1sKCcnKTtcXG5cXHRjb3JyZWN0UXVlc3Rpb25Db3VudEFuY2hvci5odG1sKCcnKTtcXG59XFxuXFxuZnVuY3Rpb24gZ2V0SHJlZkZvckRlcihkZXIpIHtcXG5cXHR2YXIgZGVyVXJsID0gZGVyLnVybDtcXG5cXHRpZiAoZGVyVXJsLmxlbmd0aCA9PT0gMCkge1xcblxcdFxcdHJldHVybiAnJztcXG5cXHR9IGVsc2Uge1xcblxcdFxcdHJldHVybiAnaHJlZj1cXFwiJyArIGRlclVybCArICdcXFwiJztcXG5cXHR9XFxufVxcblxcbmZ1bmN0aW9uIHBhcnNlT3V0Y29tZURlckRhdGEob3V0Y29tZURlckRhdGEpIHtcXG5cXHR2YXIgb3V0Y29tZURlcnNJbmZvID0gb3V0Y29tZURlckRhdGEuc3BsaXQoJ3wnKTtcXG5cXHR2YXIgb3V0Y29tZURlcnMgPSBbXTtcXG5cXG5cXHRmb3IgKHZhciBpID0gMDsgaSA8IG91dGNvbWVEZXJzSW5mby5sZW5ndGg7IGkrKykge1xcblxcdFxcdHZhciBvdXRjb21lRGVySW5mbyA9IG91dGNvbWVEZXJzSW5mb1tpXS5zcGxpdCgnOycpO1xcblxcdFxcdHZhciBkZXIgPSB7fTtcXG5cXHRcXHRmb3IgKGogPSAwOyBqIDwgb3V0Y29tZURlckluZm8ubGVuZ3RoOyBqKyspIHtcXG5cXHRcXHRcXHR2YXIgb3V0Y29tZURlclBhcmFtcyA9IG91dGNvbWVEZXJJbmZvW2pdLnNwbGl0KCc6Jyk7XFxuXFx0XFx0XFx0ZGVyW291dGNvbWVEZXJQYXJhbXNbMF1dID0gb3V0Y29tZURlclBhcmFtc1sxXTtcXG5cXHRcXHR9XFxuXFxuXFx0XFx0b3V0Y29tZURlcnMucHVzaChkZXIpO1xcblxcdH1cXG5cXG5cXHRyZXR1cm4gb3V0Y29tZURlcnM7XFxufVxcblxcbmZ1bmN0aW9uIGFkZE91dGNvbWVJbmZvVG90YWwob3V0Y29tZUlkKSB7XFxuXFx0aWYgKG91dGNvbWVJZCAhPT0gbnVsbCkge1xcblxcdFxcdG91dGNvbWVzSW5mb1tvdXRjb21lSWRdLnRvdGFsQ291bnQgKz0gMTtcXG5cXHR9XFxufVxcblxcbmZ1bmN0aW9uIGFkZE91dGNvbWVJbmZvQ29ycmVjdChvdXRjb21lSWQpIHtcXG5cXHRpZiAob3V0Y29tZUlkICE9PSBudWxsKSB7XFxuXFx0XFx0b3V0Y29tZXNJbmZvW291dGNvbWVJZF0uY29ycmVjdEFuc3dlcmVkICs9IDE7XFxuXFx0fVxcbn1cXG4vKipcXG4gKlxcbiAqICBSZXNldHMgcXVpeiB0byBpbml0aWFsIHN0YXRlXFxuICovXFxuZnVuY3Rpb24gcmVzZXRRdWl6UXVlc3Rpb24oaW5kZXgsIGlzT25Jbml0ID0gZmFsc2UpIHtcXG5cXHR2YXIgaWQgPSAnIycgKyBpbmRleDtcXG5cXG5cXHRyZXNldFF1aXpRdWVzdGlvbkZlZWRiYWNrKGluZGV4KTtcXG5cXG5cXHQkKGlkKS5maW5kKFxcXCJpbnB1dDpyYWRpb1xcXCIpLnByb3AoJ2NoZWNrZWQnLCBmYWxzZSk7XFxuXFx0JChpZCkuZmluZChcXFwiaW5wdXQ6Y2hlY2tib3hcXFwiKS5wcm9wKCdjaGVja2VkJywgZmFsc2UpO1xcblxcdCQoaWQpLmZpbmQoXFxcImlucHV0OnRleHRcXFwiKS52YWwoXFxcIlxcXCIpO1xcblxcdCQoaWQpLmZpbmQoXFxcImlucHV0W3R5cGU9J251bWJlciddXFxcIikudmFsKFxcXCJcXFwiKTtcXG5cXHQkKGlkKS5maW5kKFxcXCJzZWxlY3Qgb3B0aW9uXFxcIikuYXR0cihcXFwic2VsZWN0ZWRcXFwiLCBmYWxzZSk7XFxuXFx0JChpZCkuZmluZChcXFwic2VsZWN0XFxcIikudG9BcnJheSgpLmZvckVhY2goKGFuc3dlcikgPT4ge1xcblxcdFxcdGFuc3dlci52YWx1ZSA9IHVuZGVmaW5lZDtcXG5cXHR9KTtcXG5cXHQkKGlkKS5maW5kKFxcXCIuY2FuLWRyb3Atc3R5bGVcXFwiKS5yZW1vdmVDbGFzcyhcXFwiY2FuLWRyb3Atc3R5bGUgZHJhZ2dhYmxlLWFjdGl2ZVxcXCIpO1xcblxcblxcdHZhciBkcmFnZ2FibGVzID0gJChpZCkuZmluZChcXFwiLmRyYWdnYWJsZS5kb3MtYW5zd2VyLWRyYWdnYWJsZVxcXCIpO1xcblxcdGlmIChkcmFnZ2FibGVzLmxlbmd0aCkge1xcblxcdFxcdGluaXREcmFnT25FbGVtZW50Q2xpY2soKTtcXG5cXHR9XFxuXFxuXFx0Y29uc3QgZHJhZ1NvcnRBbnN3ZXJFbGVtZW50cyA9IFtdO1xcblxcdGZvciAodmFyIGkgPSAwOyBpIDwgZHJhZ2dhYmxlcy5sZW5ndGg7IGkrKykge1xcblxcdFxcdGlmIChkcmFnZ2FibGVzW2ldLmdldEF0dHJpYnV0ZSgnZGF0YS1kcmFnZ2VkLWdyb3VwLXZhbHVlJykgPiAtMSAmJiAkKGlkKS5hdHRyKCdkYXRhLXF1ZXN0aW9uLXR5cGUnKSA9PT0gcXVlc3Rpb25UeXBlcy5kcmFnU29ydEVsZW1lbnRzKSB7XFxuXFx0XFx0XFx0aWYgKCQoZHJhZ2dhYmxlc1tpXSkuY2hpbGRyZW4oJyNwb3B1cCcpLmxlbmd0aCkge1xcblxcdFxcdFxcdFxcdCQoZHJhZ2dhYmxlc1tpXSkuY2hpbGRyZW4oJyNwb3B1cCcpWzBdLnJlbW92ZSgpO1xcblxcdFxcdFxcdH1cXG5cXHRcXHR9XFxuXFxuXFx0XFx0aWYgKCQoaWQpLmF0dHIoJ2RhdGEtcXVlc3Rpb24tdHlwZScpID09PSBxdWVzdGlvblR5cGVzLmRyYWdTb3J0RWxlbWVudHMpIHtcXG5cXHRcXHRcXHRkcmFnU29ydEFuc3dlckVsZW1lbnRzLnB1c2goZHJhZ2dhYmxlc1tpXSk7XFxuXFx0XFx0fVxcblxcblxcdFxcdGlmICgkKGlkKS5hdHRyKCdkYXRhLXF1ZXN0aW9uLXR5cGUnKSA9PT0gcXVlc3Rpb25UeXBlcy5kcmFnRWxlbWVudHMpIHtcXG5cXHRcXHRcXHQkKGRyYWdnYWJsZXNbaV0pLmRldGFjaCgpLmNzcyh7IHRvcDogMCwgbGVmdDogMCB9KS5hcHBlbmRUbygkKGlkKS5maW5kKCcuZG9zLWFuc3dlci13cmFwcGVyJylbMF0pO1xcblxcdFxcdFxcdCQoJChgJHtpZH0gLmRyb3B6b25lYClbaV0pLmNzcyh7IHRyYW5zZm9ybTogJ3RyYW5zbGF0ZVkoMTBweCknIH0pOy8vLmFwcGVuZCgnJm5ic3A7Jyk7XFxuXFxuXFx0XFx0XFx0Ly8gaXNPbkluaXQgaXMgaGVyZSBiZWNhdXNlIG9uIHBhZ2UgbG9hZCBhbGwgcXVlc3Rpb25zIGFyZSByZXNldCBhbiB0aGF0IGZvY3VzZXMgZWxlbWVudHMgaW4gdGhlIG1pZGRsZSBvZiB0aGUgcGFnZVxcblxcdFxcdFxcdGlmICghaXNPbkluaXQpIHtcXG5cXHRcXHRcXHRcXHRmb2N1c0xpc3RJdGVtV1MoJChpZCkuZmluZCgnLmRyb3B6b25lJylbMF0pO1xcblxcdFxcdFxcdH1cXG5cXG5cXHRcXHR9XFxuXFxuXFx0XFx0ZHJhZ2dhYmxlc1tpXS5zZXRBdHRyaWJ1dGUoXFxcImRhdGEtZHJhZ2dlZC1ncm91cC12YWx1ZVxcXCIsIFxcXCItMVxcXCIpO1xcblxcdFxcdGRyYWdnYWJsZXNbaV0uc3R5bGUubGVmdCA9IFxcXCJcXFwiO1xcblxcdFxcdGRyYWdnYWJsZXNbaV0uc3R5bGUudG9wID0gXFxcIlxcXCI7XFxuXFx0fVxcblxcblxcdGlmIChkcmFnU29ydEFuc3dlckVsZW1lbnRzLmxlbmd0aCkge1xcblxcdFxcdGNvbnN0IHNodWZmbGVkRHJhZ1NvcnRBbnN3ZXJFbGVtZW50cyA9IHNodWZmbGVBcnJheShkcmFnU29ydEFuc3dlckVsZW1lbnRzKTtcXG5cXG5cXHRcXHRpZiAoc2h1ZmZsZWREcmFnU29ydEFuc3dlckVsZW1lbnRzLmxlbmd0aCkge1xcblxcdFxcdFxcdGZvciAobGV0IGkgPSAwOyBpIDwgc2h1ZmZsZWREcmFnU29ydEFuc3dlckVsZW1lbnRzLmxlbmd0aDsgaSsrKSB7XFxuXFx0XFx0XFx0XFx0aWYgKGkgPj0gMSkge1xcblxcdFxcdFxcdFxcdFxcdCQoc2h1ZmZsZWREcmFnU29ydEFuc3dlckVsZW1lbnRzW2ldKS5jc3MoeyBkaXNwbGF5OiAnbm9uZScsIHBvc2l0aW9uOiAnYWJzb2x1dGUnIH0pLmRldGFjaCgpLmFwcGVuZFRvKCQoaWQpLmZpbmQoJy5waWxsLWNvbnRhaW5lcicpWzBdKTtcXG5cXHRcXHRcXHRcXHR9IGVsc2Uge1xcblxcdFxcdFxcdFxcdFxcdCQoc2h1ZmZsZWREcmFnU29ydEFuc3dlckVsZW1lbnRzW2ldKS5jc3MoeyBkaXNwbGF5OiAnaW5saW5lLWJsb2NrJywgcG9zaXRpb246ICdhYnNvbHV0ZScgfSkuZGV0YWNoKCkuYXBwZW5kVG8oJChpZCkuZmluZCgnLnBpbGwtY29udGFpbmVyJylbMF0pO1xcblxcdFxcdFxcdFxcdH1cXG5cXHRcXHRcXHR9XFxuXFx0XFx0fVxcblxcdH1cXG5cXG5cXHRpZiAoJChpZCkuYXR0cignZGF0YS1xdWVzdGlvbi10eXBlJykgPT09IHF1ZXN0aW9uVHlwZXMuZHJhZ09uUGljdHVyZSkge1xcblxcdFxcdHZhciBkcmFnZ2FibGVzUmVzdHJpY3RlZCA9ICQoaWQpLmZpbmQoXFxcIi5kcmFnZ2FibGUtcmVzdHJpY3RlZFxcXCIpO1xcblxcdFxcdGZvciAodmFyIGkgPSAwOyBpIDwgZHJhZ2dhYmxlc1Jlc3RyaWN0ZWQubGVuZ3RoOyBpKyspIHtcXG5cXHRcXHRcXHQkKGRyYWdnYWJsZXNSZXN0cmljdGVkW2ldKS5kZXRhY2goKS5jc3MoeyBwb3NpdGlvbjogJ3JlbGF0aXZlJyB9KS5hcHBlbmRUbygkKGlkKS5maW5kKCcuYW5zd2Vycy1ob2xkZXInKVswXSk7XFxuXFx0XFx0XFx0ZHJhZ2dhYmxlc1Jlc3RyaWN0ZWRbaV0uc3R5bGUubGVmdCA9IFxcXCJcXFwiO1xcblxcdFxcdFxcdGRyYWdnYWJsZXNSZXN0cmljdGVkW2ldLnN0eWxlLnRvcCA9IFxcXCJcXFwiO1xcblxcdFxcdFxcdGRyYWdnYWJsZXNSZXN0cmljdGVkW2ldLnNldEF0dHJpYnV0ZSgnZGF0YS1xdWl6LXdpZHRoJywgXFxcIi0xXFxcIik7XFxuXFx0XFx0XFx0ZHJhZ2dhYmxlc1Jlc3RyaWN0ZWRbaV0uc2V0QXR0cmlidXRlKCdkYXRhLXF1aXotaGVpZ2h0JywgXFxcIi0xXFxcIik7XFxuXFx0XFx0XFx0ZHJhZ2dhYmxlc1Jlc3RyaWN0ZWRbaV0uc2V0QXR0cmlidXRlKFxcXCJkYXRhLXF1aXotcGVyY2VudGFnZS14XFxcIiwgXFxcIi0xXFxcIik7XFxuXFx0XFx0XFx0ZHJhZ2dhYmxlc1Jlc3RyaWN0ZWRbaV0uc2V0QXR0cmlidXRlKFxcXCJkYXRhLXF1aXotcGVyY2VudGFnZS15XFxcIiwgXFxcIi0xXFxcIik7XFxuXFxuXFx0XFx0XFx0aWYgKGRyYWdnYWJsZXNSZXN0cmljdGVkW2ldLmNsYXNzTGlzdC5jb250YWlucygnY2FuLWRyb3AnKSkge1xcblxcdFxcdFxcdFxcdGRyYWdnYWJsZXNSZXN0cmljdGVkW2ldLmNsYXNzTGlzdC5yZW1vdmUoJ2Nhbi1kcm9wJyk7XFxuXFx0XFx0XFx0fVxcblxcdFxcdH1cXG5cXHR9XFxuXFxuXFx0aWYgKCQoaWQpLmF0dHIoJ2RhdGEtcXVlc3Rpb24tdHlwZScpICE9PSBxdWVzdGlvblR5cGVzLmRyYWdFbGVtZW50cykge1xcblxcdFxcdC8vIGlzT25Jbml0IGlzIGhlcmUgYmVjYXVzZSBvbiBwYWdlIGxvYWQgYWxsIHF1ZXN0aW9ucyBhcmUgcmVzZXQgYW4gdGhhdCBmb2N1c2VzIGVsZW1lbnRzIGluIHRoZSBtaWRkbGUgb2YgdGhlIHBhZ2VcXG5cXHRcXHRpZiAoIWlzT25Jbml0KSB7XFxuXFx0XFx0XFx0Zm9jdXNMaXN0SXRlbVdTKCQoaWQpLmZpbmQoJy5kcmFnZ2FibGUuZG9zLWFuc3dlci1kcmFnZ2FibGUsIC5wYWlyLWRyYWdnYWJsZSwgLnF1aXotaW5wdXQsIC51aS1zb3J0YWJsZS1oYW5kbGUnKVswXSk7XFxuXFx0XFx0fVxcblxcdH1cXG5cXG5cXHR2YXIgZHJhZ2dhYmxlc1Jlc3RyaWN0ZWQgPSAkKGlkKS5maW5kKFxcXCIuZHJhZ2dhYmxlLXJlc3RyaWN0ZWRcXFwiKTtcXG5cXHRmb3IgKHZhciBpID0gMDsgaSA8IGRyYWdnYWJsZXNSZXN0cmljdGVkLmxlbmd0aDsgaSsrKSB7XFxuXFx0XFx0JChkcmFnZ2FibGVzUmVzdHJpY3RlZFtpXSkuZGV0YWNoKCkuY3NzKHsgcG9zaXRpb246ICdyZWxhdGl2ZScgfSkuYXBwZW5kVG8oJChpZCkuZmluZCgnLmFuc3dlcnMtaG9sZGVyJylbMF0pO1xcblxcdFxcdGRyYWdnYWJsZXNSZXN0cmljdGVkW2ldLnN0eWxlLmxlZnQgPSBcXFwiXFxcIjtcXG5cXHRcXHRkcmFnZ2FibGVzUmVzdHJpY3RlZFtpXS5zdHlsZS50b3AgPSBcXFwiXFxcIjtcXG5cXHRcXHRkcmFnZ2FibGVzUmVzdHJpY3RlZFtpXS5zZXRBdHRyaWJ1dGUoJ2RhdGEtcXVpei13aWR0aCcsIFxcXCItMVxcXCIpO1xcblxcdFxcdGRyYWdnYWJsZXNSZXN0cmljdGVkW2ldLnNldEF0dHJpYnV0ZSgnZGF0YS1xdWl6LWhlaWdodCcsIFxcXCItMVxcXCIpO1xcblxcdFxcdGRyYWdnYWJsZXNSZXN0cmljdGVkW2ldLnNldEF0dHJpYnV0ZShcXFwiZGF0YS1xdWl6LXBlcmNlbnRhZ2UteFxcXCIsIFxcXCItMVxcXCIpO1xcblxcdFxcdGRyYWdnYWJsZXNSZXN0cmljdGVkW2ldLnNldEF0dHJpYnV0ZShcXFwiZGF0YS1xdWl6LXBlcmNlbnRhZ2UteVxcXCIsIFxcXCItMVxcXCIpO1xcblxcdH1cXG5cXG5cXHQvLyAtLS0tLSByZXNldCBwYWlyIGRyYWdnYWJsZXNcXG5cXHQvLyBzaHVmZmxlIHRoZSBjb25uZWN0IHBhaXJzIHF1aXogc28gZWFjaCB0aW1lIHJlc2V0IGlzIGNhbGxlZCB0aGUgb3JkZXJpbmcgaXMgZGlmZmVyZW50XFxuXFx0dmFyIGRyYWdnYWJsZVBhcmVudHMgPSAkKGlkKS5maW5kKFxcXCIucGFpci1kcmFnZ2FibGVcXFwiKS5wYXJlbnRzKCk7XFxuXFx0Ly8gc2h1ZmZsZSBkcmFnZ2FibGVzXFxuXFx0dmFyIHNodWZmbGVkRHJhZ2dhYmxlcyA9IHNodWZmbGVBcnJheSgkKGlkKS5maW5kKFxcXCIucGFpci1kcmFnZ2FibGVcXFwiKS50b0FycmF5KCkpO1xcblxcdC8vIGF0dGFjaCBzaHVmZmxlZCBkcmFnZ2FibGVzIHRvIHBhcmVudHNcXG5cXHRpZiAoJChpZCkuYXR0cignZGF0YS1xdWVzdGlvbi10eXBlJykgIT09IHF1ZXN0aW9uVHlwZXMuZHJhZ09yZGVyRWxlbWVudHMpIHtcXG5cXHRcXHRkcmFnZ2FibGVQYXJlbnRzLmVhY2goZnVuY3Rpb24gKGlkeCkge1xcblxcdFxcdFxcdC8vIHVzZSBcXFwicHJlcGVuZFxcXCIgYmVjYXVzZSBkcmFnZ2FibGVzIG11c3QgYmUgdGhlIGZpcnN0IGNlbGwgaW4gdGhlIHJvd1xcblxcdFxcdFxcdCQoc2h1ZmZsZWREcmFnZ2FibGVzW2lkeF0pLnByZXBlbmRUbyh0aGlzKTtcXG5cXHRcXHR9KTtcXG5cXHR9IGVsc2Uge1xcblxcdFxcdGRyYWdnYWJsZVBhcmVudHMuZWFjaChmdW5jdGlvbiAoaWR4KSB7XFxuXFx0XFx0XFx0Ly8gdXNlIFxcXCJwcmVwZW5kXFxcIiBiZWNhdXNlIGRyYWdnYWJsZXMgbXVzdCBiZSB0aGUgZmlyc3QgY2VsbCBpbiB0aGUgcm93XFxuXFx0XFx0XFx0JChzaHVmZmxlZERyYWdnYWJsZXNbaWR4XSkuYXBwZW5kVG8odGhpcyk7XFxuXFx0XFx0fSk7XFxuXFx0fVxcblxcblxcdGNvbnN0IGFuc3dlckVsZW1lbnRzID0gJChpZCArICcgLnNvcnRhYmxlT3JkZXInKS5maW5kKFxcXCJsaVxcXCIpLnRvQXJyYXkoKTtcXG5cXHRjb25zdCBzb3J0TGlzdEVsZW1lbnQgPSAkKGlkICsgJyAuc29ydGFibGVPcmRlcicpO1xcblxcdHNvcnRMaXN0RWxlbWVudC5lbXB0eSgpO1xcblxcdGlmIChhbnN3ZXJFbGVtZW50cy5sZW5ndGgpIHtcXG5cXHRcXHRjb25zdCBzaHVmZmxlZFNvcnRMaXN0ID0gc2h1ZmZsZUFycmF5KGFuc3dlckVsZW1lbnRzKTtcXG5cXHRcXHRzaHVmZmxlZFNvcnRMaXN0LmZvckVhY2goYW5zd2VyID0+IHtcXG5cXHRcXHRcXHQkKGFuc3dlcikuYXBwZW5kVG8oc29ydExpc3RFbGVtZW50KTtcXG5cXHRcXHR9KTtcXG5cXG5cXHR9XFxuXFxuXFx0Ly8gUkVQTCBzdGFydFxcblxcdGlmICgkKGlkKS5hdHRyKFxcXCJkYXRhLXF1ZXN0aW9uLXR5cGVcXFwiKSA9PT0gXFxcIlJFUEwgemFkYXRha1xcXCIpIHtcXG5cXHRcXHRDb2RlLnJlc2V0KGluZGV4KTtcXG5cXHR9XFxuXFx0Ly8gUkVQTCBlbmRcXG59O1xcblxcbmZ1bmN0aW9uIHJlc2V0UXVpelF1ZXN0aW9uRmVlZGJhY2socXVlc3Rpb25JZCkge1xcblxcdHZhciBpZCA9ICcjJyArIHF1ZXN0aW9uSWQ7XFxuXFxuXFx0JChgJHtpZH0gLmFuc3dlci1jb3JyZWN0YCkucmVwbGFjZVdpdGgoJycpO1xcblxcdCQoYCR7aWR9IC5hbnN3ZXItaW5jb3JyZWN0YCkucmVwbGFjZVdpdGgoJycpO1xcblxcdCQoYCR7aWR9IC5jb3JyZWN0YCkucmVtb3ZlQ2xhc3MoJ2NvcnJlY3QnKTtcXG5cXHQkKGAke2lkfSAuaW5jb3JyZWN0YCkucmVtb3ZlQ2xhc3MoJ2luY29ycmVjdCcpO1xcblxcdCQoaWQpLmZpbmQoXFxcIi5kYW5nZXJcXFwiKS5yZW1vdmVDbGFzcyhcXFwiZGFuZ2VyXFxcIik7XFxuXFx0JChpZCkuZmluZChcXFwiLnN1Y2Nlc3NcXFwiKS5yZW1vdmVDbGFzcyhcXFwic3VjY2Vzc1xcXCIpO1xcblxcblxcdHZhciBzbWFsbEVsZW1lbnRzID0gJChpZCkuZmluZChcXFwic21hbGxcXFwiKTtcXG5cXHRmb3IgKHZhciBpID0gMDsgaSA8IHNtYWxsRWxlbWVudHMubGVuZ3RoOyBpKyspIHtcXG5cXHRcXHRzbWFsbEVsZW1lbnRzW2ldLnRleHRDb250ZW50ID0gXFxcIlxcXCI7XFxuXFx0fVxcblxcblxcdHZhciBmZWVkYmFja3MgPSAkKGlkKS5maW5kKFxcXCIuZmVlZGJhY2tcXFwiKTtcXG5cXHRmb3IgKHZhciBpID0gMDsgaSA8IGZlZWRiYWNrcy5sZW5ndGg7IGkrKykge1xcblxcdFxcdGZlZWRiYWNrc1tpXS5jbGFzc0xpc3QuYWRkKCdxdWVzdGlvbi1lbGVtZW50LWhpZGUnKTtcXG5cXHR9XFxuXFxuXFx0Ly9Ob3cgdHJ5IHRvIHJlbW92ZSBtZXNzYWdlcyBpbiBncm91cGluZyBhbmQgY2hlY2tib3gsIG1vdmUgaXQgdG8gYSBzcGVjaWFsIGZ1bmN0aW9uIGlmIG1vcmUgbWVzc2FnZXMgYXJlIGluc2VydGVkXFxuXFx0dHJ5IHtcXG5cXHRcXHRkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcXFwibGlzdC1jb3JyZWN0LWluY29ycmVjdC1cXFwiICsgcXVlc3Rpb25JZCkuaW5uZXJIVE1MID0gXFxcIlxcXCI7XFxuXFx0fSBjYXRjaCAoZXJyKSB7XFxuXFx0XFx0Ly9jb25zb2xlLmxvZyhcXFwibm90IGdyb3VwIVxcXCIpO1xcblxcdH1cXG5cXHR0cnkge1xcblxcdFxcdHZhciBjaGVja2JveE1lc3NhZ2VzID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXFxcIm5vdENvbXBsZXRlbHlDb3JyZWN0XFxcIiArIHF1ZXN0aW9uSWQpO1xcblxcdFxcdC8vdGhpcy5wYXJlbnQucmVtb3ZldGhpcywgc2VlbXMgdG8gYmUgdGhlIG9ubHkgd2F5IHRvIGRvIGl0XFxuXFx0XFx0Y2hlY2tib3hNZXNzYWdlcy5wYXJlbnRFbGVtZW50LnJlbW92ZUNoaWxkKGNoZWNrYm94TWVzc2FnZXMpO1xcblxcdH0gY2F0Y2ggKGVycikge1xcblxcblxcdH1cXG5cXHR0cnkge1xcblxcdFxcdGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFxcXCJjaGVja2JveC1jb21tZW50LVxcXCIgKyBxdWVzdGlvbklkKS5pbm5lckhUTUwgPSBcXFwiXFxcIjtcXG5cXHR9IGNhdGNoIChlcnIpIHtcXG5cXG5cXHR9XFxuXFx0Ly9yZW1vdmUgcXVlc3Rpb24gZmVlZGJhY2tzXFxuXFx0dHJ5IHtcXG5cXHRcXHRkaXZUb0NsZWFuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQocXVlc3Rpb25JZCk7XFxuXFx0XFx0ZGl2VG9DbGVhbiA9ICQoZGl2VG9DbGVhbikuZmluZChcXFwiZGl2LnF1ZXN0aW9uLWZlZWRiYWNrXFxcIilbMF07XFxuXFx0XFx0ZGl2VG9DbGVhbi5pbm5lckhUTUwgPSBcXFwiXFxcIjtcXG5cXHR9IGNhdGNoIChlcnIpIHtcXG5cXG5cXHR9XFxufTtcXG5cXG5jb25zdCBzaHVmZmxlQXJyYXkgPSAoYXJyYXkpID0+IHtcXG5cXHRjb25zdCBuZXdBcnJheSA9IFsuLi5hcnJheV07XFxuXFxuXFx0Zm9yIChsZXQgaSA9IGFycmF5Lmxlbmd0aCAtIDE7IGkgPiAwOyBpLS0pIHtcXG5cXHRcXHRsZXQgaiA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIChpICsgMSkpOyAvLyByYW5kb20gaW5kZXggZnJvbSAwIHRvIGlcXG5cXHRcXHQvLyBzd2FwIGVsZW1lbnRzIGFycmF5W2ldIGFuZCBhcnJheVtqXVxcblxcdFxcdFtuZXdBcnJheVtpXSwgbmV3QXJyYXlbal1dID0gW25ld0FycmF5W2pdLCBuZXdBcnJheVtpXV07XFxuXFx0fVxcblxcblxcdHJldHVybiBuZXdBcnJheTtcXG59O1xcblxcbmZ1bmN0aW9uIGNvbGxhcHNlVGFncyh0ZXh0KSB7XFxuXFx0dmFyIHIgPSB0ZXh0LnJlcGxhY2UoLyg8fCZsdDspYnJcXFxccypcXFxcLyooPnwmZ3Q7KS9nLCAnICcpLnJlcGxhY2UoLyg8YnI+KS9nLCBcXFwiIFxcXCIpLnJlcGxhY2UoLygmbmJzcDspL2csIFxcXCJcXFwiKS5yZXBsYWNlKC8oPHA+KS8sIFxcXCJcXFwiKS5yZXBsYWNlKC8oPHA+KS9nLCBcXFwiPGJyPlxcXCIpLnJlcGxhY2UoLyg8XFxcXC9wPikvZywgXFxcIiBcXFwiKS50cmltKCk7XFxuXFx0Y29uc29sZS5sb2cocik7XFxuXFx0cmV0dXJuIHI7XFxufTtcXG5cXG4vKipcXG4gKiBJbml0aWFsaXplIGRyYWdhYmxlIHBhaXJzIHF1ZXN0aW9uIGVsZW1lbnRzLiBUaGlzIG1ldGhvZCBpcyBvbmx5IGEgbGVnYWN5IHN0dWIgYmVjYXVzZSBpdCBpcyBjYWxsZWQgZnJvbSBzdGF0aWMgSlMuXFxuICogLy8gVE9PRDogY2hhbmdlIHN0YXRpYyBKUyB0byBjYWxsIFxcXCJpbml0XFxcIiBmdW5jdGlvbiBkaXJlY3RseVxcbiAqL1xcbmZ1bmN0aW9uIHNldFNvcnRhYmxlRWxlbWVudHMoc29ydGFibGVfMSwgc29ydGFibGVfMikge1xcblxcdHZhciBjb21iaW5lZENvbHVtblNlbGVjdG9yID0gXFxcIiNcXFwiICsgc29ydGFibGVfMSArIFxcXCIsI1xcXCIgKyBzb3J0YWJsZV8yO1xcblxcblxcdC8vIGZpbmQgcGFyZW50XFxuXFx0dmFyIHF1ZXN0aW9uSWQgPSAkKGNvbWJpbmVkQ29sdW1uU2VsZWN0b3IpLnBhcmVudHMoXFxcIltkYXRhLXF1ZXN0aW9uLXR5cGVdXFxcIikuYXR0cihcXFwiaWRcXFwiKTtcXG5cXG5cXHRpbml0RHJhZ1BhaXJzRWxlbWVudHMocXVlc3Rpb25JZCk7XFxufVxcblxcbi8qKlxcbiAqIEluaXRpYWxpemUgc29ydCBxdWVzdGlvbiBlbGVtZW50cy4gVGhpcyBtZXRob2QgaXMgb25seSBhIGxlZ2FjeSBzdHViIGJlY2F1c2UgaXQgaXMgY2FsbGVkIGZyb20gc3RhdGljIEpTLlxcbiAqIC8vIFRPRE86IHRoaXMgc2hvdWxkIGJlIHJld3JpdHRlbiB0byBoYXZlIHBhcmFtcyBsaWtlIG90aGVyIFxcXCJpbml0XFxcIiBmdW5jdGlvbnNcXG4gKi9cXG4vLyBmdW5jdGlvbiBzZXRTb3J0YWJsZVdpdGNoQ29ubmVjdGlvbihzb3J0YWJsZV8xLCBzb3J0YWJsZV8yLCBzb3J0YWJsZUdyb3VwKSB7XFxuLy8gXFx0aW5pdFNvcnRFbGVtZW50cyhzb3J0YWJsZV8xLCBzb3J0YWJsZV8yLCBzb3J0YWJsZUdyb3VwKTtcXG4vLyB9XFxuXFxuLyoqXFxuICogQ29ubmVjdCBzZWxlY3RhYmxlIHF1ZXN0aW9ucyAocmFkaW8sIGNoZWNrYm94KSB3aXRoIGJlbG9uZ2luZyBsYWJlbFxcbiBlbGVtZW50cy5cXG4gKiBVc3VhbGx5LCB0aGlzIGlzIGRvbmUgdXNpbmcgXFxcImZvclxcXCIgYXR0cmlidXQgb24gTEFCRUwgYnV0LCBmb3Igc29tZVxcbiByZWFzb24sXFxuICogY2xpY2tpbmcgb24gZm9yLWNvbm5lY3RlZCBsYWJlbCBjYXVzZXMgTVMgRWRnZSB0byB0cmlnZ2VyIHN0eWVcXG4gcmVjYWxjdWxhdGlvblxcbiAqIG9uIGVudGlyZSBkb2N1bWVudCB3aGljaCByZXN1bHRzIGluIHN1cGVyIHNsb3cgcmFkaW8vY2hlY2tib3ggYnV0dG9uc1xcbiAofjNzIGZvciBzaW5nbGUgY2xpY2spLlxcbiAqL1xcbmZ1bmN0aW9uIGluaXRTZWxlY3RhYmxlQW5zd2VycyhxdWVzdGlvbklkKSB7XFxuXFx0dmFyICRxdWVzdGlvbkVsID0gJChcXFwiI1xcXCIgKyBxdWVzdGlvbklkKTtcXG5cXHQvLyBmaW5kIHF1ZXN0aW9ucyBpbnB1dCBmaWVsZHMgKHJhZGlvLCBjaGVja2JveClcXG5cXHQvLyB2YXIgJGFuc3dlcnMgPSAkcXVlc3Rpb25FbC5maW5kKFxcXCIuZG9zLXBhcnQtcXVlc3Rpb25fX2NvbnRlbnRcXFwiKS5maW5kKCdpbnB1dFtpZCo9XFxcIjMzMl9xXFxcIl0nKTtcXG5cXHR2YXIgJGFuc3dlcnMgPSAkcXVlc3Rpb25FbC5maW5kKFxcXCIucXVlc3Rpb24tYm9keSAucXVpei1pbnB1dFxcXCIpO1xcblxcdCRhbnN3ZXJzLmVhY2goZnVuY3Rpb24gKCkge1xcblxcdFxcdHZhciAkYW5zdyA9ICQodGhpcyk7XFxuXFx0XFx0Ly8gY2hlY2tib3hlcyBhcmUgdW5zZWxlY3RhYmxlLCB1bmxpa2UgcmFkaW8gYnV0dG9uc1xcblxcdFxcdHZhciBpc1Vuc2VsZWN0YWJsZSA9ICRhbnN3LmF0dHIoXFxcInR5cGVcXFwiKSA9PT0gXFxcImNoZWNrYm94XFxcIjtcXG5cXHRcXHQvLyBmaW5kIGJlbG9uZ2luZyBsYWJlbCBhbmQgYXR0YWNoIGV2ZW50IGxpc3RlbmVyIHdoaWNoIHdpbGwgdW4vY2hlY2sgaW5wdXQgZmllbGRcXG5cXHRcXHQkYW5zdy5zaWJsaW5ncyhcXFwiTEFCRUxcXFwiKS5vbihcXFwiY2xpY2tcXFwiLCBmdW5jdGlvbiAoKSB7XFxuXFx0XFx0XFx0Ly8gdW5zZWxlY3RhYmxlcyBjYSBuIGJlIHRvZ2dsZWRcXG5cXHRcXHRcXHRpZiAoaXNVbnNlbGVjdGFibGUpIHtcXG5cXHRcXHRcXHRcXHQkYW5zdy5wcm9wKCdjaGVja2VkJywgISRhbnN3LnByb3AoJ2NoZWNrZWQnKSk7XFxuXFx0XFx0XFx0fVxcblxcdFxcdFxcdC8vIG90aGVycyBhcmUgYWx3YXlzIGNoZWNrZWRcXG5cXHRcXHRcXHRlbHNlIHtcXG5cXHRcXHRcXHRcXHQkYW5zdy5wcm9wKCdjaGVja2VkJywgdHJ1ZSk7XFxuXFx0XFx0XFx0fVxcblxcdFxcdH0pO1xcblxcdH0pO1xcbn1cXG5cXG5mdW5jdGlvbiBnaXZlRmVlZGJhY2sob2JqZWN0aWQsIGZlZWRiYWNrVGV4dCwgdGhpc2lkKSB7XFxuXFx0Ly9hZGQgYW5vdGhlciBpZiB0aGF0IGNoZWNrcyBpZiB0aGUgaWQgaXMgdGhlIHNhbWUgc28gdGhhdCBpZiB5b3UgY2xpY2sgb24gdHdvIGRpZmZlcmVudCBpY29ucyBpdCBkb2VzIG5vdCBoaWRlIHRoZSBwcmV2aW91cyBvbmVzIGhpbnRcXG5cXHRvYmplY3QgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCh0aGlzaWQpO1xcblxcdGZlZWRiYWNrVGV4dElkID0gdGhpc2lkLnJlcGxhY2UoXFxcImZiYlxcXCIsIFxcXCJmZWVkYmFja1RleHRcXFwiKTtcXG5cXHRmZWVkYmFja1RleHQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChmZWVkYmFja1RleHRJZCkudGV4dENvbnRlbnQ7XFxuXFx0ZmVlZGJhY2tIVE1MID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoZmVlZGJhY2tUZXh0SWQpLmlubmVySFRNTDtcXG5cXG5cXHQvL1RPRE8gZmluZCBmZWVkYmFjayBieSBpZFxcblxcdHF1ZXN0aW9uRmVlZGJhY2tEaXYgPSAkKG9iamVjdCkuY2xvc2VzdCgnZGl2LnF1ZXN0aW9uJykuZmluZCgnZGl2LnF1ZXN0aW9uLWZlZWRiYWNrJylbMF07XFxuXFx0cXVlc3Rpb25GZWVkYmFja0Rpdi5pbm5lckhUTUwgPSBcXFwiPGRpdiBjbGFzcyA9IHF1ZXN0aW9uLWZlZWRiYWNrMj5cXFwiICsgZmVlZGJhY2tIVE1MICsgXFxcIjwvZGl2PlxcXCI7XFxuXFx0aWYgKCQocXVlc3Rpb25GZWVkYmFja0RpdikuaGFzQ2xhc3MoJ3F1ZXN0aW9uLWVsZW1lbnQtaGlkZScpKSB7XFxuXFx0XFx0Ly9qcXVlcnkgZG9lcyBub3QgaGF2ZSAucmVtb3ZlIHNvIHVzZSBhIG5vcm1hbCBvYmplY3Qgbm90IGpxdWVyeSBvbmVcXG5cXHRcXHRxdWVzdGlvbkZlZWRiYWNrRGl2LmNsYXNzTGlzdC5yZW1vdmUoJ3F1ZXN0aW9uLWVsZW1lbnQtaGlkZScpO1xcblxcdH1cXG5cXHQvL2lmIHRoZSBoZWxwZGl2IHdhcyBsYXN0IGhpZGRlbiBieSBzb21lIG90aGVyIGJ1dHRvbiwgZG9udCBoaWRlIGl0LCBidXQgZG8gaGlkZSBpZiBpdCB3YXMgbGFzdCByZW1vdmVkIGJ5IHRoZSBjdXJyZW50bHkgY2xpY2tlZCBidXR0b25cXG5cXHRlbHNlIGlmICgkKHF1ZXN0aW9uRmVlZGJhY2tEaXYpLmF0dHIoXFxcImxhc3QtbW9kaWZpZWQtYnlcXFwiKSA9PSB0aGlzaWQpIHtcXG5cXHRcXHRxdWVzdGlvbkZlZWRiYWNrRGl2LmNsYXNzTGlzdC5hZGQoJ3F1ZXN0aW9uLWVsZW1lbnQtaGlkZScpO1xcblxcdH1cXG5cXHQkKHF1ZXN0aW9uRmVlZGJhY2tEaXYpLmF0dHIoXFxcImxhc3QtbW9kaWZpZWQtYnlcXFwiLCB0aGlzaWQpO1xcblxcdC8vY29uc29sZS5sb2cob2JqZWN0KTtcXG59XFxuXFxuZnVuY3Rpb24gYW5zd2VyQ2hlY2soc3JjSWQsIHJlYWxTcmNJZCwgbW9kYWwsIGlucHV0cywgcXVlc3Rpb25FbGVtZW50LCBxdWVzdGlvbk91dGNvbWVJZCwgcXVlc3Rpb25UeXBlLCBpc0NvbXBsZXRlbHlDb3JyZWN0KSB7XFxuXFxuXFx0Zm9yICh2YXIgaSA9IDA7IGkgPCBpbnB1dHMubGVuZ3RoOyBpKyspIHtcXG5cXHRcXHRmaWxsUXVlc3Rpb25EYXRhKHF1ZXN0aW9uRWxlbWVudCwgcXVlc3Rpb25PdXRjb21lSWQpO1xcblxcdFxcdGlmIChpbnB1dHNbaV0udHlwZS50b0xvd2VyQ2FzZSgpID09IFxcXCJjaGVja2JveFxcXCIpIHtcXG5cXHRcXHRcXHQvL0NoZWNrYm94IG11c3Qgbm90aWZ5IGlmIG5vdCBhbGwgY29ycmVjdCBhbnN3ZXJzIHdlcmUgc2VsZWN0ZWQsIG9yIGlmIHRoZXJlIGlzIGF0IGxlYXN0IG9uZSBpbmNvcnJlY3RcXG5cXHRcXHRcXHRxdWVzdGlvblR5cGUgPSBcXFwiY2hlY2tib3hcXFwiO1xcblxcblxcdFxcdFxcdGlmIChpbnB1dHNbaV0uZ2V0QXR0cmlidXRlKFxcXCJkYXRhLWlzLWNvcnJlY3RcXFwiKSA9PSBcXFwidHJ1ZVxcXCIgJiYgaW5wdXRzW2ldLmNoZWNrZWQpIHtcXG5cXG5cXHRcXHRcXHRcXHRnZXRRdWl6U3ViZWxlbWVudEJ5SWQobW9kYWwsIGlucHV0c1tpXS5pZCArIFxcXCJmXFxcIikuaW5uZXJIVE1MID0gXFxcIiAgXFxcIiArICc8ZGl2IGNsYXNzPVxcXCJhbnN3ZXItY29ycmVjdFxcXCI+IDwvZGl2PicgKyBcXFwiICBcXFwiO1xcblxcblxcdFxcdFxcdFxcdGFkZFF1ZXN0aW9uQ29ycmVjdEFuc3dlckNvdW50KHF1ZXN0aW9uRWxlbWVudCk7XFxuXFxuXFx0XFx0XFx0XFx0dHJ5IHtcXG5cXHRcXHRcXHRcXHRcXHRmZWVkYmFja1RleHQgPSBnZXRRdWl6U3ViZWxlbWVudEJ5SWQobW9kYWwsIGlucHV0c1tpXS5pZCArIFxcXCJmZWVkYmFja1RleHRcXFwiKS50ZXh0Q29udGVudDtcXG5cXHRcXHRcXHRcXHR9IGNhdGNoIChlcnIpIHtcXG5cXHRcXHRcXHRcXHRcXHRmZWVkYmFja1RleHQgPSBcXFwiXFxcIjtcXG5cXHRcXHRcXHRcXHR9XFxuXFxuXFx0XFx0XFx0XFx0aW5wdXRJZCA9IGlucHV0c1tpXS5pZDtcXG5cXG5cXHRcXHRcXHRcXHQvLzEzIGlzIG1pbmltbXVtIHdpdGggaHRtbCBjb21tZW50IGl0IHNlZW1zXFxuXFx0XFx0XFx0XFx0aWYgKGRlY2lkZVRvU2hvd0ZlZWRiYWNrKGZlZWRiYWNrVGV4dCkpIHtcXG5cXHRcXHRcXHRcXHRcXHRnZXRRdWl6U3ViZWxlbWVudEJ5SWQobW9kYWwsIGlucHV0c1tpXS5pZCArIFxcXCJmXFxcIikuaW5uZXJIVE1MICs9IFxcXCI8ZGl2IGNsYXNzID0gJ2ZlZWRiYWNrLWltYWdlJyBmZWVkYmFja2lkPVxcXCIgKyBpbnB1dHNbaV0uaWQgKyBcXFwiZmVlZGJhY2tUZXh0XFxcIiArIFxcXCIgaWQgPSAnXFxcIiArIGlucHV0c1tpXS5pZCArIFxcXCJmYmInIFxcXCIgKyBcXFwiPjwvZGl2PlxcXCI7XFxuXFx0XFx0XFx0XFx0XFx0Ly9pZiBldmVudCBsaXN0ZW5lciBkaXJlY3RseSBjYWxscyBmdW5jdGlvbiB3aXRoIGFyZ3VtZW50cywgaXQgd2lsbCBleGVjdXRlIG9uIHN0YXJ0LCBzbyBpdCBoYXMgdG8gY2FsbCBhbiBhbm9ueW1vdXMgZnVuY3Rpb24gdGhhdCBwYXNzZXMgdGhlIGFyZ3NcXG5cXHRcXHRcXHRcXHRcXHRkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpbnB1dHNbaV0uaWQgKyBcXFwiZmJiXFxcIikuYWRkRXZlbnRMaXN0ZW5lcihcXFwiY2xpY2tcXFwiLCBmdW5jdGlvbiAoKSB7XFxuXFx0XFx0XFx0XFx0XFx0XFx0Z2l2ZUZlZWRiYWNrKGlucHV0SWQsIGZlZWRiYWNrVGV4dCwgdGhpcy5pZCk7XFxuXFx0XFx0XFx0XFx0XFx0fSk7XFxuXFx0XFx0XFx0XFx0fVxcblxcdFxcdFxcdH0gZWxzZSBpZiAoaW5wdXRzW2ldLmdldEF0dHJpYnV0ZShcXFwiZGF0YS1pcy1jb3JyZWN0XFxcIikgPT0gXFxcImZhbHNlXFxcIiAmJiBpbnB1dHNbaV0uY2hlY2tlZCkge1xcblxcdFxcdFxcdFxcdGlzQ29tcGxldGVseUNvcnJlY3QgPSBmYWxzZTtcXG5cXG5cXHRcXHRcXHRcXHRnZXRRdWl6U3ViZWxlbWVudEJ5SWQobW9kYWwsIGlucHV0c1tpXS5pZCArIFxcXCJmXFxcIikuaW5uZXJIVE1MID0gXFxcIiAgXFxcIiArICc8ZGl2IGNsYXNzPVxcXCJhbnN3ZXItaW5jb3JyZWN0XFxcIj4gPC9kaXY+JyArIFxcXCIgIFxcXCI7XFxuXFx0XFx0XFx0XFx0dHJ5IHtcXG5cXHRcXHRcXHRcXHRcXHRmZWVkYmFja1RleHQgPSBnZXRRdWl6U3ViZWxlbWVudEJ5SWQobW9kYWwsIGlucHV0c1tpXS5pZCArIFxcXCJmZWVkYmFja1RleHRcXFwiKS50ZXh0Q29udGVudDtcXG5cXHRcXHRcXHRcXHR9IGNhdGNoIChlcnIpIHtcXG5cXHRcXHRcXHRcXHRcXHRmZWVkYmFja1RleHQgPSBcXFwiXFxcIjtcXG5cXHRcXHRcXHRcXHR9XFxuXFxuXFx0XFx0XFx0XFx0aW5wdXRJZCA9IGlucHV0c1tpXS5pZDtcXG5cXHRcXHRcXHRcXHQvLzEzIGlzIG1pbmltbXVtIHdpdGggaHRtbCBjb21tZW50IGl0IHNlZW1zXFxuXFx0XFx0XFx0XFx0aWYgKGRlY2lkZVRvU2hvd0ZlZWRiYWNrKGZlZWRiYWNrVGV4dCkpIHtcXG5cXHRcXHRcXHRcXHRcXHRnZXRRdWl6U3ViZWxlbWVudEJ5SWQobW9kYWwsIGlucHV0c1tpXS5pZCArIFxcXCJmXFxcIikuaW5uZXJIVE1MICs9IFxcXCI8ZGl2IGNsYXNzID0gJ2ZlZWRiYWNrLWltYWdlJyBmZWVkYmFja2lkPVxcXCIgKyBpbnB1dHNbaV0uaWQgKyBcXFwiZmVlZGJhY2tUZXh0XFxcIiArIFxcXCIgaWQgPSAnXFxcIiArIGlucHV0c1tpXS5pZCArIFxcXCJmYmInIFxcXCIgKyBcXFwiPjwvZGl2PlxcXCI7XFxuXFx0XFx0XFx0XFx0XFx0Ly9pZiBldmVudCBsaXN0ZW5lciBkaXJlY3RseSBjYWxscyBmdW5jdGlvbiB3aXRoIGFyZ3VtZW50cywgaXQgd2lsbCBleGVjdXRlIG9uIHN0YXJ0LCBzbyBpdCBoYXMgdG8gY2FsbCBhbiBhbm9ueW1vdXMgZnVuY3Rpb24gdGhhdCBwYXNzZXMgdGhlIGFyZ3NcXG5cXHRcXHRcXHRcXHRcXHRkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpbnB1dHNbaV0uaWQgKyBcXFwiZmJiXFxcIikuYWRkRXZlbnRMaXN0ZW5lcihcXFwiY2xpY2tcXFwiLCBmdW5jdGlvbiAoKSB7XFxuXFx0XFx0XFx0XFx0XFx0XFx0Z2l2ZUZlZWRiYWNrKGlucHV0SWQsIGZlZWRiYWNrVGV4dCwgdGhpcy5pZCk7XFxuXFx0XFx0XFx0XFx0XFx0fSk7XFxuXFx0XFx0XFx0XFx0fVxcblxcdFxcdFxcdH0gZWxzZSBpZiAoaW5wdXRzW2ldLmdldEF0dHJpYnV0ZShcXFwiZGF0YS1pcy1jb3JyZWN0XFxcIikgPT0gXFxcImZhbHNlXFxcIiAmJiAhaW5wdXRzW2ldLmNoZWNrZWQpIHtcXG5cXHRcXHRcXHRcXHRhZGRRdWVzdGlvbkNvcnJlY3RBbnN3ZXJDb3VudChxdWVzdGlvbkVsZW1lbnQpO1xcblxcdFxcdFxcdH0gZWxzZSB7XFxuXFx0XFx0XFx0XFx0Ly9JZiB1bnNlbGVjdGVkIHdhcyBhIGNvcnJlY3QgYW5zd2VyLCBzZXQgaXNjb21wbGV0ZWx5Y29ycmVjdCB0byAwXFxuXFx0XFx0XFx0XFx0aWYgKGlucHV0c1tpXS5nZXRBdHRyaWJ1dGUoXFxcImRhdGEtaXMtY29ycmVjdFxcXCIpID09IFxcXCJ0cnVlXFxcIikge1xcblxcdFxcdFxcdFxcdFxcdGlzQ29tcGxldGVseUNvcnJlY3QgPSBmYWxzZTtcXG5cXHRcXHRcXHRcXHR9XFxuXFxuXFx0XFx0XFx0XFx0Z2V0UXVpelN1YmVsZW1lbnRCeUlkKG1vZGFsLCBpbnB1dHNbaV0uaWQgKyBcXFwiZlxcXCIpLnRleHRDb250ZW50ID0gXFxcIlxcXCI7XFxuXFxuXFx0XFx0XFx0fVxcblxcblxcdFxcdH0gZWxzZSBpZiAoaW5wdXRzW2ldLnR5cGUudG9Mb3dlckNhc2UoKSA9PSBcXFwicmFkaW9cXFwiKSB7XFxuXFx0XFx0XFx0cXVlc3Rpb25UeXBlID0gXFxcInJhZGlvXFxcIjtcXG5cXHRcXHRcXHRpZiAoaW5wdXRzW2ldLmdldEF0dHJpYnV0ZShcXFwiZGF0YS1pcy1jb3JyZWN0XFxcIikgPT0gXFxcInRydWVcXFwiICYmIGlucHV0c1tpXS5jaGVja2VkKSB7XFxuXFxuXFx0XFx0XFx0XFx0aWYgKHdpbkF1ZGlvKSB7XFxuXFx0XFx0XFx0XFx0XFx0d2luQXVkaW8ucGxheSgpO1xcblxcdFxcdFxcdFxcdH1cXG5cXG5cXHRcXHRcXHRcXHRnZXRRdWl6U3ViZWxlbWVudEJ5SWQobW9kYWwsIGlucHV0c1tpXS5pZCArIFxcXCJmXFxcIikuaW5uZXJIVE1MID0gXFxcIiAgXFxcIiArICc8ZGl2IGNsYXNzPVxcXCJhbnN3ZXItY29ycmVjdFxcXCI+IDwvZGl2PicgKyBcXFwiICBcXFwiO1xcblxcblxcdFxcdFxcdFxcdGFkZFF1ZXN0aW9uQ29ycmVjdEFuc3dlckNvdW50KHF1ZXN0aW9uRWxlbWVudCk7XFxuXFx0XFx0XFx0XFx0dHJ5IHtcXG5cXHRcXHRcXHRcXHRcXHRmZWVkYmFja1RleHQgPSBnZXRRdWl6U3ViZWxlbWVudEJ5SWQobW9kYWwsIGlucHV0c1tpXS5pZCArIFxcXCJmZWVkYmFja1RleHRcXFwiKS50ZXh0Q29udGVudDtcXG5cXHRcXHRcXHRcXHR9IGNhdGNoIChlcnIpIHtcXG5cXHRcXHRcXHRcXHRcXHRmZWVkYmFja1RleHQgPSBcXFwiXFxcIjtcXG5cXHRcXHRcXHRcXHR9XFxuXFxuXFx0XFx0XFx0XFx0aW5wdXRJZCA9IGlucHV0c1tpXS5pZDtcXG5cXG5cXHRcXHRcXHRcXHQvLzEzIGlzIG1pbmltbXVtIHdpdGggaHRtbCBjb21tZW50IGl0IHNlZW1zXFxuXFx0XFx0XFx0XFx0aWYgKGRlY2lkZVRvU2hvd0ZlZWRiYWNrKGZlZWRiYWNrVGV4dCkpIHtcXG5cXHRcXHRcXHRcXHRcXHRnZXRRdWl6U3ViZWxlbWVudEJ5SWQobW9kYWwsIGlucHV0c1tpXS5pZCArIFxcXCJmXFxcIikuaW5uZXJIVE1MICs9IFxcXCI8ZGl2IGNsYXNzID0gJ2ZlZWRiYWNrLWltYWdlJyBmZWVkYmFja2lkPVxcXCIgKyBpbnB1dHNbaV0uaWQgKyBcXFwiZmVlZGJhY2tUZXh0XFxcIiArIFxcXCIgaWQgPSAnXFxcIiArIGlucHV0c1tpXS5pZCArIFxcXCJmYmInIFxcXCIgKyBcXFwiID48L2Rpdj5cXFwiO1xcblxcdFxcdFxcdFxcdFxcdC8vaWYgZXZlbnQgbGlzdGVuZXIgZGlyZWN0bHkgY2FsbHMgZnVuY3Rpb24gd2l0aCBhcmd1bWVudHMsIGl0IHdpbGwgZXhlY3V0ZSBvbiBzdGFydCwgc28gaXQgaGFzIHRvIGNhbGwgYW4gYW5vbnltb3VzIGZ1bmN0aW9uIHRoYXQgcGFzc2VzIHRoZSBhcmdzXFxuXFx0XFx0XFx0XFx0XFx0ZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaW5wdXRzW2ldLmlkICsgXFxcImZiYlxcXCIpLmFkZEV2ZW50TGlzdGVuZXIoXFxcImNsaWNrXFxcIiwgZnVuY3Rpb24gKCkge1xcblxcdFxcdFxcdFxcdFxcdFxcdGdpdmVGZWVkYmFjayhpbnB1dElkLCBmZWVkYmFja1RleHQsIHRoaXMuaWQpO1xcblxcdFxcdFxcdFxcdFxcdH0pO1xcblxcdFxcdFxcdFxcdH1cXG5cXHRcXHRcXHR9IGVsc2UgaWYgKGlucHV0c1tpXS5nZXRBdHRyaWJ1dGUoXFxcImRhdGEtaXMtY29ycmVjdFxcXCIpID09IFxcXCJmYWxzZVxcXCIgJiYgaW5wdXRzW2ldLmNoZWNrZWQpIHtcXG5cXG5cXHRcXHRcXHRcXHRpZiAobG9zZUF1ZGlvKSB7XFxuXFx0XFx0XFx0XFx0XFx0bG9zZUF1ZGlvLnBsYXkoKTtcXG5cXHRcXHRcXHRcXHR9XFxuXFxuXFx0XFx0XFx0XFx0Z2V0UXVpelN1YmVsZW1lbnRCeUlkKG1vZGFsLCBpbnB1dHNbaV0uaWQgKyBcXFwiZlxcXCIpLmlubmVySFRNTCA9IFxcXCIgIFxcXCIgKyAnPGRpdiBjbGFzcz1cXFwiYW5zd2VyLWluY29ycmVjdFxcXCI+IDwvZGl2PicgKyBcXFwiICBcXFwiO1xcblxcdFxcdFxcdFxcdHRyeSB7XFxuXFx0XFx0XFx0XFx0XFx0ZmVlZGJhY2tUZXh0ID0gZ2V0UXVpelN1YmVsZW1lbnRCeUlkKG1vZGFsLCBpbnB1dHNbaV0uaWQgKyBcXFwiZmVlZGJhY2tUZXh0XFxcIikudGV4dENvbnRlbnQ7XFxuXFx0XFx0XFx0XFx0fSBjYXRjaCAoZXJyKSB7XFxuXFx0XFx0XFx0XFx0XFx0ZmVlZGJhY2tUZXh0ID0gXFxcIlxcXCI7XFxuXFx0XFx0XFx0XFx0fVxcblxcblxcdFxcdFxcdFxcdGlucHV0SWQgPSBpbnB1dHNbaV0uaWQ7XFxuXFxuXFx0XFx0XFx0XFx0Ly8xMyBpcyBtaW5pbW11bSB3aXRoIGh0bWwgY29tbWVudCBpdCBzZWVtc1xcblxcdFxcdFxcdFxcdGlmIChkZWNpZGVUb1Nob3dGZWVkYmFjayhmZWVkYmFja1RleHQpKSB7XFxuXFx0XFx0XFx0XFx0XFx0Z2V0UXVpelN1YmVsZW1lbnRCeUlkKG1vZGFsLCBpbnB1dHNbaV0uaWQgKyBcXFwiZlxcXCIpLmlubmVySFRNTCArPSBcXFwiPGRpdiBjbGFzcyA9ICdmZWVkYmFjay1pbWFnZScgZmVlZGJhY2tpZD1cXFwiICsgaW5wdXRzW2ldLmlkICsgXFxcImZlZWRiYWNrVGV4dFxcXCIgKyBcXFwiIGlkID0gJ1xcXCIgKyBpbnB1dHNbaV0uaWQgKyBcXFwiZmJiJyBcXFwiICsgXFxcIj48L2Rpdj5cXFwiO1xcblxcdFxcdFxcdFxcdFxcdC8vaWYgZXZlbnQgbGlzdGVuZXIgZGlyZWN0bHkgY2FsbHMgZnVuY3Rpb24gd2l0aCBhcmd1bWVudHMsIGl0IHdpbGwgZXhlY3V0ZSBvbiBzdGFydCwgc28gaXQgaGFzIHRvIGNhbGwgYW4gYW5vbnltb3VzIGZ1bmN0aW9uIHRoYXQgcGFzc2VzIHRoZSBhcmdzXFxuXFx0XFx0XFx0XFx0XFx0ZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaW5wdXRzW2ldLmlkICsgXFxcImZiYlxcXCIpLmFkZEV2ZW50TGlzdGVuZXIoXFxcImNsaWNrXFxcIiwgZnVuY3Rpb24gKCkge1xcblxcdFxcdFxcdFxcdFxcdFxcdGdpdmVGZWVkYmFjayhpbnB1dElkLCBmZWVkYmFja1RleHQsIHRoaXMuaWQpO1xcblxcdFxcdFxcdFxcdFxcdH0pO1xcblxcdFxcdFxcdFxcdH1cXG5cXHRcXHRcXHR9IGVsc2UgaWYgKGlucHV0c1tpXS5nZXRBdHRyaWJ1dGUoXFxcImRhdGEtaXMtY29ycmVjdFxcXCIpID09IFxcXCJmYWxzZVxcXCIgJiYgIWlucHV0c1tpXS5jaGVja2VkKSB7XFxuXFx0XFx0XFx0XFx0YWRkUXVlc3Rpb25Db3JyZWN0QW5zd2VyQ291bnQocXVlc3Rpb25FbGVtZW50KTtcXG5cXHRcXHRcXHRcXHRnZXRRdWl6U3ViZWxlbWVudEJ5SWQobW9kYWwsIGlucHV0c1tpXS5pZCArIFxcXCJmXFxcIikudGV4dENvbnRlbnQgPSBcXFwiXFxcIjtcXG5cXHRcXHRcXHR9XFxuXFxuXFx0XFx0fVxcblxcblxcdFxcdC8vaW5wdXRzIHdpdGggZGF0YSBtaW52YWx1ZSBhcmUgYWN0dWFsbHkgbnVtZXJpY1xcblxcdFxcdGVsc2UgaWYgKChpbnB1dHNbaV0udHlwZS50b0xvd2VyQ2FzZSgpID09IFxcXCJ0ZXh0XFxcIikgJiYgKCFpbnB1dHNbaV0uZ2V0QXR0cmlidXRlKFxcXCJkYXRhLW1pbnZhbHVlXFxcIikpKSB7XFxuXFx0XFx0XFx0cXVlc3Rpb25UeXBlID0gXFxcInRleHRcXFwiO1xcblxcblxcdFxcdFxcdC8vIGlzIGFuc3dlciBjYXNlIHNlbnNpdGl2ZSAoYm9vbGVhbiBhdHRyaWJ1dGUsIGl0J3MgdmFsdWUgaXMgaXJyZWxldmFudCwgb25seSBhdHRyaWJ1dGVzIGV4aXN0ZW5jZSlcXG5cXHRcXHRcXHR2YXIgaXNDYXNlU2Vuc2l0aXZlID0gaW5wdXRzW2ldLmdldEF0dHJpYnV0ZShcXFwiZGF0YS1jYXNlLXNlbnNpdGl2ZVxcXCIpICE9IG51bGw7XFxuXFxuXFx0XFx0XFx0aWYgKGlucHV0c1tpXS5nZXRBdHRyaWJ1dGUoXFxcImRhdGEtY29ycmVjdC1kYXRhXFxcIikpIHtcXG5cXHRcXHRcXHRcXHR2YXIgdXNlckFuc3dlciA9IGlucHV0c1tpXS52YWx1ZTtcXG5cXHRcXHRcXHRcXHR2YXIgcmlnaHRBbnN3ZXIgPSBnZXRRdWl6U3ViZWxlbWVudEJ5SWQobW9kYWwsIGlucHV0c1tpXS5pZCArIFxcXCJmXFxcIik7XFxuXFx0XFx0XFx0XFx0dmFyIGFuc3dlckxpc3QgPSBpbnB1dHNbaV0uZ2V0QXR0cmlidXRlKFxcXCJkYXRhLWNvcnJlY3QtZGF0YVxcXCIpLnNwbGl0KCc7Jyk7XFxuXFx0XFx0XFx0XFx0dmFyIGNvcnJlY3RBbnN3ZXIgPSBmYWxzZTtcXG5cXHRcXHRcXHRcXHRmb3IgKHZhciBrID0gMDsgayA8IGFuc3dlckxpc3QubGVuZ3RoOyBrKyspIHtcXG5cXHRcXHRcXHRcXHRcXHQvLyBjYXNlIElOc2Vuc2l0aXZlIGFuc2VyXFxuXFx0XFx0XFx0XFx0XFx0aWYgKCFpc0Nhc2VTZW5zaXRpdmUgJiYgdXNlckFuc3dlci50cmltKCkudG9Mb3dlckNhc2UoKSA9PT0gKGFuc3dlckxpc3Rba10udHJpbSgpLnRvTG93ZXJDYXNlKCkpKSB7XFxuXFx0XFx0XFx0XFx0XFx0XFx0Y29ycmVjdEFuc3dlciA9IHRydWU7XFxuXFx0XFx0XFx0XFx0XFx0fVxcblxcdFxcdFxcdFxcdFxcdC8vIGNhc2Ugc2Vuc2l0aXZlIGFuc3dlclxcblxcdFxcdFxcdFxcdFxcdGVsc2UgaWYgKHVzZXJBbnN3ZXIudHJpbSgpID09PSAoYW5zd2VyTGlzdFtrXS50cmltKCkpKSB7XFxuXFx0XFx0XFx0XFx0XFx0XFx0Y29ycmVjdEFuc3dlciA9IHRydWU7XFxuXFx0XFx0XFx0XFx0XFx0fVxcblxcdFxcdFxcdFxcdH1cXG5cXHRcXHRcXHRcXHRpZiAoY29ycmVjdEFuc3dlcikge1xcblxcdFxcdFxcdFxcdFxcdC8vIGFkZCBjb3JyZWN0IGNsYXNzIHRvIC5kb3MtZXZhbCBjbGFzc1xcblxcdFxcdFxcdFxcdFxcdCQoYCMke2lucHV0c1tpXS5pZH1gKS5jbG9zZXN0KCcuZG9zLWV2YWwnKVswXS5jbGFzc0xpc3QuYWRkKCdjb3JyZWN0Jyk7XFxuXFxuXFx0XFx0XFx0XFx0XFx0aWYgKGdldFF1aXpTdWJlbGVtZW50QnlJZChtb2RhbCwgaW5wdXRzW2ldLmlkICsgXFxcImZlZWRiYWNrVGV4dFxcXCIpKSB7XFxuXFx0XFx0XFx0XFx0XFx0XFx0Z2V0UXVpelN1YmVsZW1lbnRCeUlkKG1vZGFsLCBpbnB1dHNbaV0uaWQgKyBcXFwiZmVlZGJhY2tUZXh0XFxcIikuY2xhc3NMaXN0LmFkZCgncXVlc3Rpb24tZWxlbWVudC1oaWRlJyk7XFxuXFx0XFx0XFx0XFx0XFx0fVxcblxcdFxcdFxcdFxcdFxcdGFkZFF1ZXN0aW9uQ29ycmVjdEFuc3dlckNvdW50KHF1ZXN0aW9uRWxlbWVudCk7XFxuXFx0XFx0XFx0XFx0fSBlbHNlIHtcXG5cXHRcXHRcXHRcXHRcXHQvLyBhZGQgaW5jb3JyZWN0IGNsYXNzIHRvIC5kb3MtZXZhbCBjbGFzc1xcblxcdFxcdFxcdFxcdFxcdCQoYCMke2lucHV0c1tpXS5pZH1gKS5jbG9zZXN0KCcuZG9zLWV2YWwnKVswXS5jbGFzc0xpc3QuYWRkKCdpbmNvcnJlY3QnKTtcXG5cXG5cXHRcXHRcXHRcXHRcXHR0cnkge1xcblxcdFxcdFxcdFxcdFxcdFxcdGZlZWRiYWNrVGV4dCA9IGdldFF1aXpTdWJlbGVtZW50QnlJZChtb2RhbCwgaW5wdXRzW2ldLmlkICsgXFxcImZlZWRiYWNrVGV4dFxcXCIpLnRleHRDb250ZW50O1xcblxcdFxcdFxcdFxcdFxcdH0gY2F0Y2ggKGVycikge1xcblxcdFxcdFxcdFxcdFxcdFxcdGZlZWRiYWNrVGV4dCA9IFxcXCJcXFwiO1xcblxcdFxcdFxcdFxcdFxcdH1cXG5cXHRcXHRcXHRcXHRcXHRpc0NvbXBsZXRlbHlDb3JyZWN0ID0gZmFsc2U7XFxuXFx0XFx0XFx0XFx0XFx0aW5wdXRJZCA9IGlucHV0c1tpXS5pZDtcXG5cXHRcXHRcXHRcXHRcXHRpZiAoZGVjaWRlVG9TaG93RmVlZGJhY2soZmVlZGJhY2tUZXh0KSkge1xcblxcdFxcdFxcdFxcdFxcdFxcdGdldFF1aXpTdWJlbGVtZW50QnlJZChtb2RhbCwgaW5wdXRzW2ldLmlkICsgXFxcImZcXFwiKS5pbm5lckhUTUwgKz0gXFxcIjxkaXYgY2xhc3MgPSAnZmVlZGJhY2staW1hZ2UnIGZlZWRiYWNraWQ9XFxcIiArIGlucHV0c1tpXS5pZCArIFxcXCJmZWVkYmFja1RleHRcXFwiICsgXFxcIiBpZCA9ICdcXFwiICsgaW5wdXRzW2ldLmlkICsgXFxcImZiYicgXFxcIiArIFxcXCI+PC9kaXY+XFxcIjtcXG5cXG5cXHRcXHRcXHRcXHRcXHRcXHQvL2lmIGV2ZW50IGxpc3RlbmVyIGRpcmVjdGx5IGNhbGxzIGZ1bmN0aW9uIHdpdGggYXJndW1lbnRzLCBpdCB3aWxsIGV4ZWN1dGUgb24gc3RhcnQsIHNvIGl0IGhhcyB0byBjYWxsIGFuIGFub255bW91cyBmdW5jdGlvbiB0aGF0IHBhc3NlcyB0aGUgYXJnc1xcblxcdFxcdFxcdFxcdFxcdFxcdGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGlucHV0c1tpXS5pZCArIFxcXCJmYmJcXFwiKS5hZGRFdmVudExpc3RlbmVyKFxcXCJjbGlja1xcXCIsIGZ1bmN0aW9uICgpIHtcXG5cXHRcXHRcXHRcXHRcXHRcXHRcXHRnaXZlRmVlZGJhY2soaW5wdXRJZCwgZmVlZGJhY2tUZXh0LCB0aGlzLmlkKTtcXG5cXHRcXHRcXHRcXHRcXHRcXHR9KTtcXG5cXHRcXHRcXHRcXHRcXHR9XFxuXFx0XFx0XFx0XFx0fVxcblxcblxcdFxcdFxcdH1cXG5cXHRcXHR9IGVsc2UgaWYgKGlucHV0c1tpXS50eXBlLnRvTG93ZXJDYXNlKCkgPT0gXFxcIm51bWJlclxcXCIpIHtcXG5cXHRcXHRcXHRxdWVzdGlvblR5cGUgPSBcXFwibnVtYmVyXFxcIjtcXG5cXHRcXHRcXHR2YXIgdXNlckFuc3dlciA9IGlucHV0c1tpXS52YWx1ZTtcXG5cXG5cXHRcXHRcXHR2YXIgbWluVmFsdWUgPSBpbnB1dHNbaV0uZ2V0QXR0cmlidXRlKFxcXCJkYXRhLW1pblZhbHVlXFxcIik7XFxuXFx0XFx0XFx0dmFyIG1heFZhbHVlID0gaW5wdXRzW2ldLmdldEF0dHJpYnV0ZShcXFwiZGF0YS1tYXhWYWx1ZVxcXCIpO1xcblxcdFxcdFxcdHZhciBjb3JyZWN0QW5zd2VyID0gZmFsc2U7XFxuXFx0XFx0XFx0dmFyIHVzZXJOdW1iZXIgPSB1c2VyQW5zd2VyO1xcblxcdFxcdFxcdGlmICghaXNOYU4odXNlck51bWJlcikpIHtcXG5cXHRcXHRcXHRcXHRpZiAocGFyc2VGbG9hdCh1c2VyTnVtYmVyKSA+PSBwYXJzZUZsb2F0KG1pblZhbHVlKSAmJiBwYXJzZUZsb2F0KHVzZXJOdW1iZXIpIDw9IHBhcnNlRmxvYXQobWF4VmFsdWUpKSB7XFxuXFx0XFx0XFx0XFx0XFx0Y29ycmVjdEFuc3dlciA9IHRydWU7XFxuXFx0XFx0XFx0XFx0fVxcblxcdFxcdFxcdH1cXG5cXG5cXHRcXHRcXHRpZiAoY29ycmVjdEFuc3dlcikge1xcblxcdFxcdFxcdFxcdC8vIGFkZCBjb3JyZWN0IGNsYXNzIHRvIC5kb3MtZXZhbCBjbGFzc1xcblxcdFxcdFxcdFxcdCQoYCMke2lucHV0c1tpXS5pZH1gKS5jbG9zZXN0KCcuZG9zLWV2YWwnKVswXS5jbGFzc0xpc3QuYWRkKCdjb3JyZWN0Jyk7XFxuXFxuXFx0XFx0XFx0XFx0aWYgKGdldFF1aXpTdWJlbGVtZW50QnlJZChtb2RhbCwgaW5wdXRzW2ldLmlkICsgXFxcImZlZWRiYWNrVGV4dFxcXCIpKSB7XFxuXFx0XFx0XFx0XFx0XFx0Z2V0UXVpelN1YmVsZW1lbnRCeUlkKG1vZGFsLCBpbnB1dHNbaV0uaWQgKyBcXFwiZmVlZGJhY2tUZXh0XFxcIikuY2xhc3NMaXN0LmFkZCgncXVlc3Rpb24tZWxlbWVudC1oaWRlJyk7XFxuXFx0XFx0XFx0XFx0fVxcblxcdFxcdFxcdFxcdGFkZFF1ZXN0aW9uQ29ycmVjdEFuc3dlckNvdW50KHF1ZXN0aW9uRWxlbWVudCk7XFxuXFxuXFx0XFx0XFx0fSBlbHNlIHtcXG5cXHRcXHRcXHRcXHQvLyBhZGQgaW5jb3JyZWN0IGNsYXNzIHRvIC5kb3MtZXZhbCBjbGFzc1xcblxcdFxcdFxcdFxcdCQoYCMke2lucHV0c1tpXS5pZH1gKS5jbG9zZXN0KCcuZG9zLWV2YWwnKVswXS5jbGFzc0xpc3QuYWRkKCdpbmNvcnJlY3QnKTtcXG5cXG5cXHRcXHRcXHRcXHR0cnkge1xcblxcdFxcdFxcdFxcdFxcdGZlZWRiYWNrVGV4dCA9IGdldFF1aXpTdWJlbGVtZW50QnlJZChtb2RhbCwgaW5wdXRzW2ldLmlkICsgXFxcImZlZWRiYWNrVGV4dFxcXCIpLnRleHRDb250ZW50O1xcblxcdFxcdFxcdFxcdH0gY2F0Y2ggKGVycikge1xcblxcdFxcdFxcdFxcdFxcdGZlZWRiYWNrVGV4dCA9IFxcXCJcXFwiO1xcblxcdFxcdFxcdFxcdH1cXG5cXG5cXHRcXHRcXHRcXHRpbnB1dElkID0gaW5wdXRzW2ldLmlkO1xcblxcblxcdFxcdFxcdFxcdC8vMTMgaXMgbWluaW1tdW0gd2l0aCBodG1sIGNvbW1lbnQgaXQgc2VlbXNcXG5cXHRcXHRcXHRcXHRpZiAoZGVjaWRlVG9TaG93RmVlZGJhY2soZmVlZGJhY2tUZXh0KSkge1xcblxcdFxcdFxcdFxcdFxcdGdldFF1aXpTdWJlbGVtZW50QnlJZChtb2RhbCwgaW5wdXRzW2ldLmlkICsgXFxcImZcXFwiKS5pbm5lckhUTUwgKz0gXFxcIjxkaXYgY2xhc3MgPSAnZmVlZGJhY2staW1hZ2UnIGZlZWRiYWNraWQ9XFxcIiArIGlucHV0c1tpXS5pZCArIFxcXCJmZWVkYmFja1RleHRcXFwiICsgXFxcIiBpZCA9ICdcXFwiICsgaW5wdXRzW2ldLmlkICsgXFxcImZiYicgXFxcIiArIFxcXCI+PC9kaXY+XFxcIjtcXG5cXHRcXHRcXHRcXHRcXHQvL2lmIGV2ZW50IGxpc3RlbmVyIGRpcmVjdGx5IGNhbGxzIGZ1bmN0aW9uIHdpdGggYXJndW1lbnRzLCBpdCB3aWxsIGV4ZWN1dGUgb24gc3RhcnQsIHNvIGl0IGhhcyB0byBjYWxsIGFuIGFub255bW91cyBmdW5jdGlvbiB0aGF0IHBhc3NlcyB0aGUgYXJnc1xcblxcdFxcdFxcdFxcdFxcdGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGlucHV0c1tpXS5pZCArIFxcXCJmYmJcXFwiKS5hZGRFdmVudExpc3RlbmVyKFxcXCJjbGlja1xcXCIsIGZ1bmN0aW9uICgpIHtcXG5cXHRcXHRcXHRcXHRcXHRcXHRnaXZlRmVlZGJhY2soaW5wdXRJZCwgZmVlZGJhY2tUZXh0LCB0aGlzLmlkKTtcXG5cXHRcXHRcXHRcXHRcXHR9KTtcXG5cXHRcXHRcXHRcXHR9XFxuXFx0XFx0XFx0fVxcblxcdFxcdH0gZWxzZSBpZiAoKGlucHV0c1tpXS50eXBlLnRvTG93ZXJDYXNlKCkgPT0gXFxcInRleHRcXFwiKSAmJiAoaW5wdXRzW2ldLmdldEF0dHJpYnV0ZShcXFwiZGF0YS1taW52YWx1ZVxcXCIpKSkge1xcblxcdFxcdFxcdC8vdGhpcyBpcyBhIG51bWVyaWMgaW5wdXQgb2YgdHlwZSBmbG9hdCwgc28gd2UgY2FuIHVzZSB0aGUgbGlicmFyeSB0byByZXN0cmljdCB0byBudW0gaW5wdXQgYW5kIGRldGVybWluZSBpZiAsIGFuZCAuIGFyZSB2YWxpZCBkZWNpbWFsIHNlcGFyYXRvcnNcXG5cXHRcXHRcXHRxdWVzdGlvblR5cGUgPSBcXFwibnVtZXJpY1xcXCI7XFxuXFx0XFx0XFx0dmFyIHVzZXJBbnN3ZXIgPSBpbnB1dHNbaV0udmFsdWU7XFxuXFx0XFx0XFx0dmFyIG1pblZhbHVlID0gaW5wdXRzW2ldLmdldEF0dHJpYnV0ZShcXFwiZGF0YS1taW5WYWx1ZVxcXCIpO1xcblxcdFxcdFxcdHZhciBtYXhWYWx1ZSA9IGlucHV0c1tpXS5nZXRBdHRyaWJ1dGUoXFxcImRhdGEtbWF4VmFsdWVcXFwiKTtcXG5cXHRcXHRcXHR2YXIgY29ycmVjdEFuc3dlciA9IGZhbHNlO1xcblxcblxcdFxcdFxcdC8vY29udmVydCAnLCcgdG8gJy4nIHNvIGl0IGNhbiBlbnRlciBpbnRvIHBhcnNlZmxvYXRcXG5cXHRcXHRcXHR2YXIgdXNlck51bWJlciA9IHVzZXJBbnN3ZXIucmVwbGFjZShcXFwiLFxcXCIsIFxcXCIuXFxcIik7XFxuXFx0XFx0XFx0dXNlck51bWJlciA9IHBhcnNlRmxvYXQodXNlck51bWJlcik7XFxuXFxuXFx0XFx0XFx0aWYgKCFpc05hTih1c2VyTnVtYmVyKSkge1xcblxcdFxcdFxcdFxcdGlmIChwYXJzZUZsb2F0KHVzZXJOdW1iZXIpID49IHBhcnNlRmxvYXQobWluVmFsdWUpICYmIHBhcnNlRmxvYXQodXNlck51bWJlcikgPD0gcGFyc2VGbG9hdChtYXhWYWx1ZSkpIHtcXG5cXHRcXHRcXHRcXHRcXHRjb3JyZWN0QW5zd2VyID0gdHJ1ZTtcXG5cXHRcXHRcXHRcXHR9XFxuXFx0XFx0XFx0fVxcblxcblxcdFxcdFxcdGlmIChjb3JyZWN0QW5zd2VyKSB7XFxuXFx0XFx0XFx0XFx0Ly8gYWRkIGNvcnJlY3QgY2xhc3MgdG8gLmRvcy1ldmFsIGNsYXNzXFxuXFx0XFx0XFx0XFx0JChgIyR7aW5wdXRzW2ldLmlkfWApLmNsb3Nlc3QoJy5kb3MtZXZhbCcpWzBdLmNsYXNzTGlzdC5hZGQoJ2NvcnJlY3QnKTtcXG5cXG5cXHRcXHRcXHRcXHRpZiAoZ2V0UXVpelN1YmVsZW1lbnRCeUlkKG1vZGFsLCBpbnB1dHNbaV0uaWQgKyBcXFwiZmVlZGJhY2tUZXh0XFxcIikpIHtcXG5cXHRcXHRcXHRcXHRcXHRnZXRRdWl6U3ViZWxlbWVudEJ5SWQobW9kYWwsIGlucHV0c1tpXS5pZCArIFxcXCJmZWVkYmFja1RleHRcXFwiKS5jbGFzc0xpc3QuYWRkKCdxdWVzdGlvbi1lbGVtZW50LWhpZGUnKTtcXG5cXHRcXHRcXHRcXHR9XFxuXFx0XFx0XFx0XFx0YWRkUXVlc3Rpb25Db3JyZWN0QW5zd2VyQ291bnQocXVlc3Rpb25FbGVtZW50KTtcXG5cXG5cXHRcXHRcXHRcXHRpZiAoaXNDb21wbGV0ZWx5Q29ycmVjdCkge1xcblxcdFxcdFxcdFxcdFxcdGlmICh3aW5BdWRpbykge1xcblxcdFxcdFxcdFxcdFxcdFxcdHdpbkF1ZGlvLnBsYXkoKTtcXG5cXHRcXHRcXHRcXHRcXHR9XFxuXFx0XFx0XFx0XFx0fVxcblxcdFxcdFxcdH0gZWxzZSB7XFxuXFx0XFx0XFx0XFx0Ly8gYWRkIGluY29ycmVjdCBjbGFzcyB0byAuZG9zLWV2YWwgY2xhc3NcXG5cXHRcXHRcXHRcXHQkKGAjJHtpbnB1dHNbaV0uaWR9YCkuY2xvc2VzdCgnLmRvcy1ldmFsJylbMF0uY2xhc3NMaXN0LmFkZCgnaW5jb3JyZWN0Jyk7XFxuXFxuXFx0XFx0XFx0XFx0aWYgKGxvc2VBdWRpbykge1xcblxcdFxcdFxcdFxcdFxcdGxvc2VBdWRpby5wbGF5KCk7XFxuXFx0XFx0XFx0XFx0fVxcblxcdFxcdFxcdFxcdHRyeSB7XFxuXFx0XFx0XFx0XFx0XFx0ZmVlZGJhY2tUZXh0ID0gZ2V0UXVpelN1YmVsZW1lbnRCeUlkKG1vZGFsLCBpbnB1dHNbaV0uaWQgKyBcXFwiZmVlZGJhY2tUZXh0XFxcIikudGV4dENvbnRlbnQ7XFxuXFx0XFx0XFx0XFx0fSBjYXRjaCAoZXJyKSB7XFxuXFx0XFx0XFx0XFx0XFx0ZmVlZGJhY2tUZXh0ID0gXFxcIlxcXCI7XFxuXFx0XFx0XFx0XFx0fVxcblxcblxcdFxcdFxcdFxcdGlucHV0SWQgPSBpbnB1dHNbaV0uaWQ7XFxuXFxuXFx0XFx0XFx0XFx0Ly8xMyBpcyBtaW5pbW11bSB3aXRoIGh0bWwgY29tbWVudCBpdCBzZWVtc1xcblxcdFxcdFxcdFxcdGlmIChkZWNpZGVUb1Nob3dGZWVkYmFjayhmZWVkYmFja1RleHQpKSB7XFxuXFx0XFx0XFx0XFx0XFx0Z2V0UXVpelN1YmVsZW1lbnRCeUlkKG1vZGFsLCBpbnB1dHNbaV0uaWQgKyBcXFwiZlxcXCIpLmlubmVySFRNTCArPSBcXFwiPGRpdiBjbGFzcyA9ICdmZWVkYmFjay1pbWFnZScgZmVlZGJhY2tpZD1cXFwiICsgaW5wdXRzW2ldLmlkICsgXFxcImZlZWRiYWNrVGV4dFxcXCIgKyBcXFwiIGlkID0gJ1xcXCIgKyBpbnB1dHNbaV0uaWQgKyBcXFwiZmJiJyBcXFwiICsgXFxcIj48L2Rpdj5cXFwiO1xcblxcdFxcdFxcdFxcdFxcdC8vaWYgZXZlbnQgbGlzdGVuZXIgZGlyZWN0bHkgY2FsbHMgZnVuY3Rpb24gd2l0aCBhcmd1bWVudHMsIGl0IHdpbGwgZXhlY3V0ZSBvbiBzdGFydCwgc28gaXQgaGFzIHRvIGNhbGwgYW4gYW5vbnltb3VzIGZ1bmN0aW9uIHRoYXQgcGFzc2VzIHRoZSBhcmdzXFxuXFx0XFx0XFx0XFx0XFx0ZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaW5wdXRzW2ldLmlkICsgXFxcImZiYlxcXCIpLmFkZEV2ZW50TGlzdGVuZXIoXFxcImNsaWNrXFxcIiwgZnVuY3Rpb24gKCkge1xcblxcdFxcdFxcdFxcdFxcdFxcdGdpdmVGZWVkYmFjayhpbnB1dElkLCBmZWVkYmFja1RleHQsIHRoaXMuaWQpO1xcblxcdFxcdFxcdFxcdFxcdH0pO1xcblxcdFxcdFxcdFxcdH1cXG5cXHRcXHRcXHR9XFxuXFx0XFx0fVxcblxcblxcdH1cXG5cXG5cXHRjb25zdCBmYWxzZUFuc3dlcnMgPSBBcnJheS5mcm9tKGlucHV0cykuZmlsdGVyKGZ1bmN0aW9uIChlbCkge1xcblxcdFxcdGNvbnN0IGVudGVyZWRWYWx1ZSA9IGVsLnZhbHVlO1xcblxcdFxcdGNvbnN0IGRhdGFJc0NvcnJlY3QgPSBlbC5nZXRBdHRyaWJ1dGUoJ2RhdGEtaXMtY29ycmVjdCcpO1xcblxcdFxcdGNvbnN0IG1pblZhbHVlID0gZWwuZ2V0QXR0cmlidXRlKCdkYXRhLW1pblZhbHVlJyk7XFxuXFx0XFx0Y29uc3QgbWF4VmFsdWUgPSBlbC5nZXRBdHRyaWJ1dGUoJ2RhdGEtbWF4VmFsdWUnKTtcXG5cXHRcXHRjb25zdCBjb3JyZWN0RGF0YSA9IGVsLmdldEF0dHJpYnV0ZSgnZGF0YS1jb3JyZWN0LWRhdGEnKTtcXG5cXHRcXHRsZXQgY29ycmVjdERhdGFzID0gW107XFxuXFxuXFx0XFx0aWYgKGNvcnJlY3REYXRhICYmIGNvcnJlY3REYXRhLmluY2x1ZGVzKCc7JykpIHtcXG5cXHRcXHRcXHR2YXIgdGVtcCA9IGNvcnJlY3REYXRhLnNwbGl0KCc7Jyk7XFxuXFx0XFx0XFx0Zm9yIChsZXQgaSA9IDA7IGkgPCB0ZW1wLmxlbmd0aDsgaSsrKSB7XFxuXFx0XFx0XFx0XFx0Y29ycmVjdERhdGFzLnB1c2godGVtcFtpXS50cmltKCkpO1xcblxcdFxcdFxcdH1cXG5cXHRcXHR9XFxuXFxuXFx0XFx0dmFyIGlzRmFsc2UgPSBtaW5WYWx1ZSAmJiBtYXhWYWx1ZSA/IGVudGVyZWRWYWx1ZSA8IG1pblZhbHVlIHx8IGVudGVyZWRWYWx1ZSA+IG1heFZhbHVlIDogY29ycmVjdERhdGEgJiYgY29ycmVjdERhdGEuaW5jbHVkZXMoJzsnKSA/ICghY29ycmVjdERhdGFzLmluY2x1ZGVzKGVudGVyZWRWYWx1ZSkpIDogKGVudGVyZWRWYWx1ZSAhPSBjb3JyZWN0RGF0YSB8fCBjb3JyZWN0RGF0YSA9PT0gJ2ZhbHNlJyk7XFxuXFxuXFx0XFx0cmV0dXJuIGlzRmFsc2U7XFxuXFx0fSk7XFxuXFxuXFx0aWYgKHF1ZXN0aW9uVHlwZSA9PSBcXFwidGV4dFxcXCIpIHtcXG5cXHRcXHRpZiAoaXNDb21wbGV0ZWx5Q29ycmVjdCkge1xcblxcdFxcdFxcdGlmICh3aW5BdWRpbykge1xcblxcdFxcdFxcdFxcdHdpbkF1ZGlvLnBsYXkoKTtcXG5cXHRcXHRcXHR9XFxuXFx0XFx0fSBlbHNlIHtcXG5cXHRcXHRcXHRpZiAobG9zZUF1ZGlvKSB7XFxuXFx0XFx0XFx0XFx0bG9zZUF1ZGlvLnBsYXkoKTtcXG5cXHRcXHRcXHR9XFxuXFx0XFx0fVxcblxcdH1cXG5cXG5cXHRpZiAocXVlc3Rpb25UeXBlID09IFxcXCJjaGVja2JveFxcXCIpIHtcXG5cXHRcXHRpZiAoaXNDb21wbGV0ZWx5Q29ycmVjdCkge1xcblxcdFxcdFxcdGlmICh3aW5BdWRpbykge1xcblxcdFxcdFxcdFxcdHdpbkF1ZGlvLnBsYXkoKTtcXG5cXHRcXHRcXHR9XFxuXFxuXFx0XFx0XFx0Ly9HaXZlIHNjb3JlIGluIGZ1dHVyZVxcblxcdFxcdFxcdHRyeSB7XFxuXFx0XFx0XFx0XFx0ZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXFxcImNoZWNrYm94LWNvbW1lbnQtXFxcIiArIHJlYWxTcmNJZCkuaW5uZXJIVE1MID0gXFxcIlxcXCI7XFxuXFx0XFx0XFx0fSBjYXRjaCAoZXJyKSB7XFxuXFx0XFx0XFx0fVxcblxcdFxcdH0gZWxzZSB7XFxuXFx0XFx0XFx0aWYgKGxvc2VBdWRpbykge1xcblxcdFxcdFxcdFxcdGxvc2VBdWRpby5wbGF5KCk7XFxuXFx0XFx0XFx0fVxcblxcblxcdFxcdFxcdHRyeSB7XFxuXFx0XFx0XFx0XFx0ZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXFxcImNoZWNrYm94LWNvbW1lbnQtXFxcIiArIHJlYWxTcmNJZCkuaW5uZXJIVE1MID0gXFxcIlphZGF0YWsgbmlqZSB1IHBvdHB1bm9zdGkgdG/EjW5vIHJpamXFoWVuLiBQb2t1xaFhanRlIHBvbm92byFcXFwiO1xcblxcdFxcdFxcdH0gY2F0Y2ggKGVycikge1xcblxcdFxcdFxcdH1cXG5cXHRcXHR9XFxuXFx0fSBlbHNlIHtcXG5cXHRcXHQvL1doYXQgaGFwcGVucyB3aGVuIHF1ZXN0aW9uIHR5cGUgaXMgbm90IGNoZWNrYm94LCBjdXJyZW50bHkgbm90aGluZyBpcyBuZWVkZWRcXG5cXHR9XFxuXFxuXFx0dmFyIG9wdGlvbnMgPSBtb2RhbC5nZXRFbGVtZW50c0J5VGFnTmFtZShcXFwib3B0aW9uXFxcIik7XFxuXFx0dmFyIHByb2Nlc3NlZE9wdGlvbnNGb3JRdWVzdGlvbiA9IFtdO1xcblxcdHZhciBjb3JyZWN0U2VsZWN0aW9ucyA9IFtdO1xcblxcdHZhciB1bmR1cGxpY2F0ZWRPcHRpb25zID0gW107XFxuXFx0Zm9yIChsZXQgaSA9IDA7IGkgPCBvcHRpb25zLmxlbmd0aDsgaSsrKSB7XFxuXFx0XFx0aWYgKCF1bmR1cGxpY2F0ZWRPcHRpb25zLmluY2x1ZGVzKG9wdGlvbnNbaV0udGV4dCkpIHtcXG5cXHRcXHRcXHR1bmR1cGxpY2F0ZWRPcHRpb25zLnB1c2gob3B0aW9uc1tpXS50ZXh0KTtcXG5cXHRcXHR9XFxuXFx0fVxcblxcdGZvciAodmFyIGogPSAwOyBqIDwgb3B0aW9ucy5sZW5ndGg7IGorKykge1xcblxcdFxcdHF1ZXN0aW9uRWxlbWVudCA9IGdldFBhcmVudFF1ZXN0aW9uVG9wRWxlbWVudChvcHRpb25zW2pdKTtcXG5cXHRcXHRxdWVzdGlvbk91dGNvbWVJZCA9IGZpbGxPdXRjb21lSW5mb0RhdGEocXVlc3Rpb25FbGVtZW50KTtcXG5cXHRcXHRpZiAoIShwcm9jZXNzZWRPcHRpb25zRm9yUXVlc3Rpb24uaW5kZXhPZihvcHRpb25zW2pdLmlkLnNwbGl0KFxcXCJvXFxcIilbMF0pID4gLTEpKSB7XFxuXFx0XFx0XFx0cHJvY2Vzc2VkT3B0aW9uc0ZvclF1ZXN0aW9uLnB1c2gob3B0aW9uc1tqXS5pZC5zcGxpdChcXFwib1xcXCIpWzBdKTtcXG5cXHRcXHRcXHRmaWxsUXVlc3Rpb25EYXRhKHF1ZXN0aW9uRWxlbWVudCwgcXVlc3Rpb25PdXRjb21lSWQpO1xcblxcdFxcdH1cXG5cXG5cXHRcXHRpZiAob3B0aW9uc1tqXS5zZWxlY3RlZCA9PSB0cnVlKSB7XFxuXFx0XFx0XFx0aWYgKG9wdGlvbnNbal0udmFsdWUgPT0gb3B0aW9uc1tqXS5pZC5zcGxpdChcXFwiYVxcXCIpWzFdLnNwbGl0KFxcXCJvXFxcIilbMF0pIHtcXG5cXHRcXHRcXHRcXHQvLyBhZGQgY29ycmVjdCBjbGFzcyB0byAuZG9zLWV2YWwgY2xhc3NcXG5cXHRcXHRcXHRcXHQkKGAjJHtvcHRpb25zW2pdLmlkfWApLmNsb3Nlc3QoJy5kb3MtZXZhbCcpWzBdLmNsYXNzTGlzdC5hZGQoJ2NvcnJlY3QnKTtcXG5cXG5cXHRcXHRcXHRcXHRhZGRRdWVzdGlvbkNvcnJlY3RBbnN3ZXJDb3VudChxdWVzdGlvbkVsZW1lbnQpO1xcblxcdFxcdFxcdFxcdHRyeSB7XFxuXFx0XFx0XFx0XFx0XFx0ZmVlZGJhY2tUZXh0ID0gZ2V0UXVpelN1YmVsZW1lbnRCeUlkKG1vZGFsLCBvcHRpb25zW2pdLmlkICsgXFxcImZlZWRiYWNrVGV4dFxcXCIpLnRleHRDb250ZW50O1xcblxcdFxcdFxcdFxcdH0gY2F0Y2ggKGVycikge1xcblxcdFxcdFxcdFxcdFxcdGZlZWRiYWNrVGV4dCA9IFxcXCJcXFwiO1xcblxcdFxcdFxcdFxcdH1cXG5cXHRcXHRcXHRcXHRpbnB1dElkID0gb3B0aW9uc1tqXS5pZDtcXG5cXG5cXHRcXHRcXHRcXHRpZiAoIWNvcnJlY3RTZWxlY3Rpb25zLmluY2x1ZGVzKGlucHV0SWQpKSB7XFxuXFx0XFx0XFx0XFx0XFx0Y29ycmVjdFNlbGVjdGlvbnMucHVzaChpbnB1dElkKTtcXG5cXHRcXHRcXHRcXHR9XFxuXFxuXFx0XFx0XFx0XFx0Ly8xMyBpcyBtaW5pbW11bSB3aXRoIGh0bWwgY29tbWVudCBpdCBzZWVtc1xcblxcdFxcdFxcdFxcdGlmIChkZWNpZGVUb1Nob3dGZWVkYmFjayhmZWVkYmFja1RleHQpKSB7XFxuXFx0XFx0XFx0XFx0XFx0Z2V0UXVpelN1YmVsZW1lbnRCeUlkKG1vZGFsLCBvcHRpb25zW2pdLmlkICsgXFxcImZcXFwiKS5pbm5lckhUTUwgKz0gXFxcIjxkaXYgY2xhc3MgPSAnZmVlZGJhY2staW1hZ2UnIGZlZWRiYWNraWQ9XFxcIiArIG9wdGlvbnNbal0uaWQgKyBcXFwiZmVlZGJhY2tUZXh0XFxcIiArIFxcXCIgaWQgPSAnXFxcIiArIG9wdGlvbnNbal0uaWQgKyBcXFwiZmJiJyBcXFwiICsgXFxcIj48L2Rpdj5cXFwiO1xcblxcblxcdFxcdFxcdFxcdFxcdC8vaWYgZXZlbnQgbGlzdGVuZXIgZGlyZWN0bHkgY2FsbHMgZnVuY3Rpb24gd2l0aCBhcmd1bWVudHMsIGl0IHdpbGwgZXhlY3V0ZSBvbiBzdGFydCwgc28gaXQgaGFzIHRvIGNhbGwgYW4gYW5vbnltb3VzIGZ1bmN0aW9uIHRoYXQgcGFzc2VzIHRoZSBhcmdzXFxuXFx0XFx0XFx0XFx0XFx0ZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQob3B0aW9uc1tqXS5pZCArIFxcXCJmYmJcXFwiKS5hZGRFdmVudExpc3RlbmVyKFxcXCJjbGlja1xcXCIsIGZ1bmN0aW9uICgpIHtcXG5cXHRcXHRcXHRcXHRcXHRcXHRnaXZlRmVlZGJhY2soaW5wdXRJZCwgZmVlZGJhY2tUZXh0LCB0aGlzLmlkKTtcXG5cXHRcXHRcXHRcXHRcXHR9KTtcXG5cXHRcXHRcXHRcXHR9XFxuXFx0XFx0XFx0fSBlbHNlIHtcXG5cXHRcXHRcXHRcXHQvLyBhZGQgaW5jb3JyZWN0IGNsYXNzIHRvIC5kb3MtZXZhbCBjbGFzc1xcblxcdFxcdFxcdFxcdCQoYCMke29wdGlvbnNbal0uaWR9YCkuY2xvc2VzdCgnLmRvcy1ldmFsJylbMF0uY2xhc3NMaXN0LmFkZCgnaW5jb3JyZWN0Jyk7XFxuXFxuXFx0XFx0XFx0XFx0dHJ5IHtcXG5cXHRcXHRcXHRcXHRcXHRmZWVkYmFja1RleHQgPSBnZXRRdWl6U3ViZWxlbWVudEJ5SWQobW9kYWwsIG9wdGlvbnNbal0uaWQgKyBcXFwiZmVlZGJhY2tUZXh0XFxcIikudGV4dENvbnRlbnQ7XFxuXFx0XFx0XFx0XFx0fSBjYXRjaCAoZXJyKSB7XFxuXFx0XFx0XFx0XFx0XFx0ZmVlZGJhY2tUZXh0ID0gXFxcIlxcXCI7XFxuXFx0XFx0XFx0XFx0fVxcblxcdFxcdFxcdFxcdGlucHV0SWQgPSBvcHRpb25zW2pdLmlkO1xcblxcblxcdFxcdFxcdFxcdC8vMTMgaXMgbWluaW1tdW0gd2l0aCBodG1sIGNvbW1lbnQgaXQgc2VlbXNcXG5cXHRcXHRcXHRcXHRpZiAoZGVjaWRlVG9TaG93RmVlZGJhY2soZmVlZGJhY2tUZXh0KSkge1xcblxcdFxcdFxcdFxcdFxcdGdldFF1aXpTdWJlbGVtZW50QnlJZChtb2RhbCwgb3B0aW9uc1tqXS5pZCArIFxcXCJmXFxcIikuaW5uZXJIVE1MICs9IFxcXCI8ZGl2IGNsYXNzID0gJ2ZlZWRiYWNrLWltYWdlJyBmZWVkYmFja2lkPVxcXCIgKyBvcHRpb25zW2pdLmlkICsgXFxcImZlZWRiYWNrVGV4dFxcXCIgKyBcXFwiIGlkID0gJ1xcXCIgKyBvcHRpb25zW2pdLmlkICsgXFxcImZiYicgXFxcIiArIFxcXCI+PC9kaXY+XFxcIjtcXG5cXG5cXHRcXHRcXHRcXHRcXHQvL2lmIGV2ZW50IGxpc3RlbmVyIGRpcmVjdGx5IGNhbGxzIGZ1bmN0aW9uIHdpdGggYXJndW1lbnRzLCBpdCB3aWxsIGV4ZWN1dGUgb24gc3RhcnQsIHNvIGl0IGhhcyB0byBjYWxsIGFuIGFub255bW91cyBmdW5jdGlvbiB0aGF0IHBhc3NlcyB0aGUgYXJnc1xcblxcdFxcdFxcdFxcdFxcdGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKG9wdGlvbnNbal0uaWQgKyBcXFwiZmJiXFxcIikuYWRkRXZlbnRMaXN0ZW5lcihcXFwiY2xpY2tcXFwiLCBmdW5jdGlvbiAoKSB7XFxuXFx0XFx0XFx0XFx0XFx0XFx0Z2l2ZUZlZWRiYWNrKGlucHV0SWQsIGZlZWRiYWNrVGV4dCwgdGhpcy5pZCk7XFxuXFx0XFx0XFx0XFx0XFx0fSk7XFxuXFx0XFx0XFx0XFx0fVxcblxcdFxcdFxcdH1cXG5cXHRcXHR9XFxuXFx0fVxcblxcblxcdGlmICh1bmR1cGxpY2F0ZWRPcHRpb25zLmxlbmd0aCA+IDApIHtcXG5cXHRcXHRpZiAoKHVuZHVwbGljYXRlZE9wdGlvbnMubGVuZ3RoID09PSBjb3JyZWN0U2VsZWN0aW9ucy5sZW5ndGgpIHx8IChwcm9jZXNzZWRPcHRpb25zRm9yUXVlc3Rpb24ubGVuZ3RoID09IGNvcnJlY3RTZWxlY3Rpb25zLmxlbmd0aCkpIHtcXG5cXHRcXHRcXHRpZiAod2luQXVkaW8pIHtcXG5cXHRcXHRcXHRcXHR3aW5BdWRpby5wbGF5KCk7XFxuXFx0XFx0XFx0fVxcblxcdFxcdH0gZWxzZSB7XFxuXFx0XFx0XFx0aWYgKGxvc2VBdWRpbykge1xcblxcdFxcdFxcdFxcdGxvc2VBdWRpby5wbGF5KCk7XFxuXFx0XFx0XFx0fVxcblxcdFxcdH1cXG5cXHR9XFxuXFxuXFx0Y3VycmVudFF1aXogPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChyZWFsU3JjSWQpO1xcblxcblxcdGlmICgkKGN1cnJlbnRRdWl6KS5maW5kKFxcXCIuY29ubmVjdC1wYWlyc1xcXCIpLmxlbmd0aCB8fCAkKGN1cnJlbnRRdWl6KS5hdHRyKCdkYXRhLXF1ZXN0aW9uLXR5cGUnKSA9PT0gcXVlc3Rpb25UeXBlcy5kcmFnT3JkZXJFbGVtZW50cykge1xcblxcblxcdFxcdHF1ZXN0aW9uT3V0Y29tZUlkID0gZmlsbE91dGNvbWVJbmZvRGF0YShjdXJyZW50UXVpeik7XFxuXFxuXFx0XFx0dmFyIGdyb3VwVGFibGUgPSAkKGN1cnJlbnRRdWl6KS5maW5kKFxcXCJ0YWJsZS5kb3MtcGFydC1xdWVzdGlvbl9fY29udGVudFxcXCIpO1xcblxcblxcdFxcdGdyb3VwVGFibGUuZmluZChcXFwidHJcXFwiKS5lYWNoKGZ1bmN0aW9uICgpIHtcXG5cXHRcXHRcXHRmaWxsUXVlc3Rpb25EYXRhKGN1cnJlbnRRdWl6LCBxdWVzdGlvbk91dGNvbWVJZCk7XFxuXFx0XFx0XFx0Ly90YWJsZSBwYWlycyBtdXN0IGNvbWUgaW4gdHdvXFxuXFx0XFx0XFx0dGFibGVQYWlycyA9ICQodGhpcykuZmluZChcXFwidGRcXFwiKTtcXG5cXHRcXHRcXHRpZiAoJChjdXJyZW50UXVpeikuYXR0cignZGF0YS1xdWVzdGlvbi10eXBlJykgPT09IHF1ZXN0aW9uVHlwZXMuZHJhZ09yZGVyRWxlbWVudHMpIHsgLy8gdGFzayB0eXBlIGlzIGRyYWdPcmRlckVsZW1lbnRzXFxuXFx0XFx0XFx0XFx0aWYgKHRhYmxlUGFpcnNbMF0uZ2V0QXR0cmlidXRlKFxcXCJkYXRhLWNvcnJlY3QtcGFpclxcXCIpID09IHRhYmxlUGFpcnNbMV0uZ2V0QXR0cmlidXRlKFxcXCJkYXRhLWNvcnJlY3QtcGFpclxcXCIpKSB7XFxuXFx0XFx0XFx0XFx0XFx0JCgkKHRhYmxlUGFpcnMpWzFdKS5hZGRDbGFzcyhcXFwic3VjY2Vzc1xcXCIpO1xcblxcdFxcdFxcdFxcdFxcdGFkZFF1ZXN0aW9uQ29ycmVjdEFuc3dlckNvdW50KGN1cnJlbnRRdWl6KTtcXG5cXHRcXHRcXHRcXHR9IGVsc2Uge1xcblxcdFxcdFxcdFxcdFxcdCQoJCh0YWJsZVBhaXJzKVsxXSkuYWRkQ2xhc3MoXFxcImRhbmdlclxcXCIpO1xcblxcdFxcdFxcdFxcdH1cXG5cXHRcXHRcXHR9IGVsc2Uge1xcblxcdFxcdFxcdFxcdGlmICh0YWJsZVBhaXJzWzBdLmdldEF0dHJpYnV0ZShcXFwiZGF0YS1jb3JyZWN0LXBhaXJcXFwiKSA9PSB0YWJsZVBhaXJzWzFdLmdldEF0dHJpYnV0ZShcXFwiZGF0YS1jb3JyZWN0LXBhaXJcXFwiKSkge1xcblxcdFxcdFxcdFxcdFxcdCQodGFibGVQYWlycykuYWRkQ2xhc3MoXFxcInN1Y2Nlc3NcXFwiKTtcXG5cXHRcXHRcXHRcXHRcXHRhZGRRdWVzdGlvbkNvcnJlY3RBbnN3ZXJDb3VudChjdXJyZW50UXVpeik7XFxuXFx0XFx0XFx0XFx0fSBlbHNlIHtcXG5cXHRcXHRcXHRcXHRcXHQkKHRhYmxlUGFpcnMpLmFkZENsYXNzKFxcXCJkYW5nZXJcXFwiKTtcXG5cXHRcXHRcXHRcXHR9XFxuXFx0XFx0XFx0fVxcblxcdFxcdH0pO1xcblxcblxcdFxcdGNvbnN0IGZhbHNlQW5zd2VycyA9IGdyb3VwVGFibGUuZmluZCgndGQnKS50b0FycmF5KCkuZmlsdGVyKGZ1bmN0aW9uIChlbCkge1xcblxcdFxcdFxcdHJldHVybiBlbC5jbGFzc0xpc3QuY29udGFpbnMoJ2RhbmdlcicpO1xcblxcdFxcdH0pO1xcblxcblxcdFxcdGlmIChmYWxzZUFuc3dlcnMubGVuZ3RoID4gMCkge1xcblxcdFxcdFxcdGlmIChsb3NlQXVkaW8pIHtcXG5cXHRcXHRcXHRcXHRsb3NlQXVkaW8ucGxheSgpO1xcblxcdFxcdFxcdH1cXG5cXHRcXHR9IGVsc2Uge1xcblxcdFxcdFxcdGlmICh3aW5BdWRpbykge1xcblxcdFxcdFxcdFxcdHdpbkF1ZGlvLnBsYXkoKTtcXG5cXHRcXHRcXHR9XFxuXFx0XFx0fVxcblxcblxcdH1cXG5cXG5cXHRpZiAoY3VycmVudFF1aXouZ2V0QXR0cmlidXRlKCdkYXRhLXF1ZXN0aW9uLXR5cGUnKSA9PT0gcXVlc3Rpb25UeXBlcy5kcmFnU29ydEVsZW1lbnRzKSB7XFxuXFx0XFx0dmFyIGdyb3VwRWxlbWVudHMgPSBtb2RhbC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKFxcXCJkcmFnZ2FibGVcXFwiKTtcXG5cXHRcXHR2YXIgZ3JvdXBFbGVtZW50c1N1Y2Nlc3MgPSBbXTtcXG5cXHRcXHR2YXIgZ3JvdXBFbGVtZW50c0RhbmdlciA9IFtdO1xcblxcdFxcdGZvciAodmFyIGogPSAwOyBqIDwgZ3JvdXBFbGVtZW50cy5sZW5ndGg7IGorKykge1xcblxcdFxcdFxcdHF1ZXN0aW9uRWxlbWVudCA9IGdldFBhcmVudFF1ZXN0aW9uVG9wRWxlbWVudChncm91cEVsZW1lbnRzW2pdKTtcXG5cXHRcXHRcXHRxdWVzdGlvbk91dGNvbWVJZCA9IGZpbGxPdXRjb21lSW5mb0RhdGEocXVlc3Rpb25FbGVtZW50KTtcXG5cXHRcXHRcXHRmaWxsUXVlc3Rpb25EYXRhKHF1ZXN0aW9uRWxlbWVudCwgcXVlc3Rpb25PdXRjb21lSWQpO1xcblxcdFxcdFxcdHZhciBjb3JyZWN0QW5zd2VyRmllbGQgPSBncm91cEVsZW1lbnRzW2pdLmdldEVsZW1lbnRzQnlDbGFzc05hbWUoXFxcImZcXFwiKVswXTtcXG5cXHRcXHRcXHRpZiAoZ3JvdXBFbGVtZW50c1tqXS5nZXRBdHRyaWJ1dGUoXFxcImRhdGEtZHJhZ2dlZC1ncm91cC12YWx1ZVxcXCIpID09IGdyb3VwRWxlbWVudHNbal0uZ2V0QXR0cmlidXRlKFxcXCJkYXRhLWdyb3VwXFxcIikpIHtcXG5cXHRcXHRcXHRcXHRncm91cEVsZW1lbnRzU3VjY2Vzcy5wdXNoKGdyb3VwRWxlbWVudHNbal0pO1xcblxcdFxcdFxcdFxcdGdyb3VwRWxlbWVudHNbal0uY2xhc3NMaXN0LmFkZChcXFwic3VjY2Vzc1xcXCIpO1xcblxcdFxcdFxcdFxcdGFkZFF1ZXN0aW9uQ29ycmVjdEFuc3dlckNvdW50KHF1ZXN0aW9uRWxlbWVudCk7XFxuXFx0XFx0XFx0fSBlbHNlIHtcXG5cXHRcXHRcXHRcXHRncm91cEVsZW1lbnRzRGFuZ2VyLnB1c2goZ3JvdXBFbGVtZW50c1tqXSk7XFxuXFx0XFx0XFx0XFx0Z3JvdXBFbGVtZW50c1tqXS5jbGFzc0xpc3QuYWRkKFxcXCJkYW5nZXJcXFwiKTtcXG5cXHRcXHRcXHR9XFxuXFx0XFx0fVxcblxcdH1cXG5cXG5cXHR2YXIgc29ydGFibGVPcmRlcmVkRWxlbWVudHMgPSBtb2RhbC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKFxcXCJzb3J0YWJsZU9yZGVyZWRFbGVtZW50c1xcXCIpO1xcblxcdHZhciBpbmNvcnJlY3RTb3J0YWJsZXMgPSBbXTtcXG5cXHRmb3IgKHZhciBqID0gMDsgaiA8IHNvcnRhYmxlT3JkZXJlZEVsZW1lbnRzLmxlbmd0aDsgaisrKSB7XFxuXFxuXFx0XFx0cXVlc3Rpb25FbGVtZW50ID0gZ2V0UGFyZW50UXVlc3Rpb25Ub3BFbGVtZW50KHNvcnRhYmxlT3JkZXJlZEVsZW1lbnRzW2pdKTtcXG5cXHRcXHRxdWVzdGlvbk91dGNvbWVJZCA9IGZpbGxPdXRjb21lSW5mb0RhdGEocXVlc3Rpb25FbGVtZW50KTtcXG5cXG5cXHRcXHRpZiAoJCgnIycgKyBzb3J0YWJsZU9yZGVyZWRFbGVtZW50c1tqXS5pZC5yZXBsYWNlKCdzb3J0YWJsZU9yZGVyMicsICdzb3J0YWJsZU9yZGVyMScpKS5jaGlsZHJlbignbGknKS5sZW5ndGgpIHtcXG5cXHRcXHRcXHRmb3IgKHZhciBpID0gMDsgaSA8ICQoJyMnICsgc29ydGFibGVPcmRlcmVkRWxlbWVudHNbal0uaWQucmVwbGFjZSgnc29ydGFibGVPcmRlcjInLCAnc29ydGFibGVPcmRlcjEnKSkuY2hpbGRyZW4oJ2xpJykubGVuZ3RoOyBpKyspIHtcXG5cXHRcXHRcXHRcXHRmaWxsUXVlc3Rpb25EYXRhKHF1ZXN0aW9uRWxlbWVudCwgcXVlc3Rpb25PdXRjb21lSWQpO1xcblxcdFxcdFxcdH1cXG5cXHRcXHR9IGVsc2Uge1xcblxcdFxcdFxcdGZvciAodmFyIGkgPSAwOyBpIDwgJCgnIycgKyBzb3J0YWJsZU9yZGVyZWRFbGVtZW50c1tqXS5pZCkuY2hpbGRyZW4oJ2xpJykubGVuZ3RoOyBpKyspIHtcXG5cXHRcXHRcXHRcXHRmaWxsUXVlc3Rpb25EYXRhKHF1ZXN0aW9uRWxlbWVudCwgcXVlc3Rpb25PdXRjb21lSWQpO1xcblxcdFxcdFxcdH1cXG5cXHRcXHR9XFxuXFxuXFx0XFx0dmFyIG9yZGVyZWRFbGVtZW50cyA9IHNvcnRhYmxlT3JkZXJlZEVsZW1lbnRzW2pdLmdldEVsZW1lbnRzQnlUYWdOYW1lKFxcXCJsaVxcXCIpO1xcblxcdFxcdGZvciAodmFyIGsgPSAwOyBrIDwgb3JkZXJlZEVsZW1lbnRzLmxlbmd0aDsgaysrKSB7XFxuXFx0XFx0XFx0aWYgKGsgPT0gb3JkZXJlZEVsZW1lbnRzW2tdLmdldEF0dHJpYnV0ZShcXFwiaWRcXFwiKS5zcGxpdCgnYScpWzFdKSB7XFxuXFx0XFx0XFx0XFx0b3JkZXJlZEVsZW1lbnRzW2tdLmNsYXNzTGlzdC5hZGQoJ3N1Y2Nlc3MnKTtcXG5cXHRcXHRcXHRcXHRhZGRRdWVzdGlvbkNvcnJlY3RBbnN3ZXJDb3VudChxdWVzdGlvbkVsZW1lbnQpO1xcblxcdFxcdFxcdH0gZWxzZSB7XFxuXFx0XFx0XFx0XFx0b3JkZXJlZEVsZW1lbnRzW2tdLmNsYXNzTGlzdC5hZGQoJ2RhbmdlcicpO1xcblxcdFxcdFxcdFxcdGluY29ycmVjdFNvcnRhYmxlcy5wdXNoKG9yZGVyZWRFbGVtZW50c1trXSk7XFxuXFx0XFx0XFx0fVxcblxcdFxcdH1cXG5cXHR9XFxuXFxuXFx0aWYgKGluY29ycmVjdFNvcnRhYmxlcy5sZW5ndGggPiAwICYmIHNvcnRhYmxlT3JkZXJlZEVsZW1lbnRzLmxlbmd0aCA+IDAgJiYgbG9zZUF1ZGlvICYmIHdpbkF1ZGlvKSB7XFxuXFx0XFx0aWYgKGxvc2VBdWRpbykge1xcblxcdFxcdFxcdGxvc2VBdWRpby5wbGF5KCk7XFxuXFx0XFx0fVxcblxcdH0gZWxzZSB7XFxuXFx0XFx0aWYgKHNvcnRhYmxlT3JkZXJlZEVsZW1lbnRzLmxlbmd0aCA+IDApIHtcXG5cXHRcXHRcXHRpZiAod2luQXVkaW8pIHtcXG5cXHRcXHRcXHRcXHR3aW5BdWRpby5wbGF5KCk7XFxuXFx0XFx0XFx0fVxcblxcdFxcdH1cXG5cXHR9XFxuXFxuXFx0aWYgKGN1cnJlbnRRdWl6LmdldEF0dHJpYnV0ZSgnZGF0YS1xdWVzdGlvbi10eXBlJykgPT09IHF1ZXN0aW9uVHlwZXMuZHJhZ09uUGljdHVyZSkge1xcblxcdFxcdHZhciBkcmFnZ2FibGVFbGVtZW50c1N1Y2Nlc3MgPSBbXTtcXG5cXHRcXHR2YXIgZHJhZ2dhYmxlRWxlbWVudHNEYW5nZXIgPSBbXTtcXG5cXHRcXHR2YXIgZHJhZ2dhYmxlRWxlbWVudHMgPSBtb2RhbC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKFxcXCJkcmFnZ2FibGUtcmVzdHJpY3RlZFxcXCIpO1xcblxcdFxcdGlzQ29tcGxldGVseUNvcnJlY3QgPSB0cnVlO1xcblxcblxcdFxcdGZvciAodmFyIGogPSAwOyBqIDwgZHJhZ2dhYmxlRWxlbWVudHMubGVuZ3RoOyBqKyspIHtcXG5cXHRcXHRcXHRxdWVzdGlvbkVsZW1lbnQgPSBnZXRQYXJlbnRRdWVzdGlvblRvcEVsZW1lbnQoZHJhZ2dhYmxlRWxlbWVudHNbal0pO1xcblxcdFxcdFxcdHF1ZXN0aW9uT3V0Y29tZUlkID0gZmlsbE91dGNvbWVJbmZvRGF0YShxdWVzdGlvbkVsZW1lbnQpO1xcblxcdFxcdFxcdGZpbGxRdWVzdGlvbkRhdGEocXVlc3Rpb25FbGVtZW50LCBxdWVzdGlvbk91dGNvbWVJZCk7XFxuXFxuXFx0XFx0XFx0dmFyIHBpY3R1cmVEcm9wem9uZSA9ICQoZHJhZ2dhYmxlRWxlbWVudHNbal0pLmNsb3Nlc3QoXFxcIi5xdWVzdGlvbi1ib2R5XFxcIikuZmluZChcXFwiLnBpY3R1cmUtZHJvcHpvbmUtcXVpelxcXCIpO1xcblxcdFxcdFxcdC8vY2hlY2sgdGhhdCBkcmFnZ2FibGUgZWxlbWVudCBpcyBvbiByaWdodCBsb2NhdGlvblxcblxcdFxcdFxcdGlmIChpc0dvb2RMb2NhdGlvbihkcmFnZ2FibGVFbGVtZW50c1tqXS5nZXRBdHRyaWJ1dGUoXFxcImRhdGEtcGVyY2VudGFnZS14XFxcIiksIGRyYWdnYWJsZUVsZW1lbnRzW2pdLmdldEF0dHJpYnV0ZShcXFwiZGF0YS1wZXJjZW50YWdlLXlcXFwiKSxcXG5cXHRcXHRcXHRcXHRkcmFnZ2FibGVFbGVtZW50c1tqXS5nZXRBdHRyaWJ1dGUoXFxcImRhdGEtcXVpei1wZXJjZW50YWdlLXhcXFwiKSwgZHJhZ2dhYmxlRWxlbWVudHNbal0uZ2V0QXR0cmlidXRlKFxcXCJkYXRhLXF1aXotcGVyY2VudGFnZS15XFxcIiksIHBpY3R1cmVEcm9wem9uZS53aWR0aCgpLCBwaWN0dXJlRHJvcHpvbmUuaGVpZ2h0KCkpKSB7XFxuXFx0XFx0XFx0XFx0ZHJhZ2dhYmxlRWxlbWVudHNbal0uY2xhc3NMaXN0LmFkZCgnc3VjY2VzcycpO1xcblxcblxcdFxcdFxcdFxcdGFkZFF1ZXN0aW9uQ29ycmVjdEFuc3dlckNvdW50KHF1ZXN0aW9uRWxlbWVudCk7XFxuXFx0XFx0XFx0XFx0ZHJhZ2dhYmxlRWxlbWVudHNTdWNjZXNzLnB1c2goZHJhZ2dhYmxlRWxlbWVudHNbal0pO1xcblxcdFxcdFxcdH0gZWxzZSB7XFxuXFx0XFx0XFx0XFx0ZHJhZ2dhYmxlRWxlbWVudHNbal0uY2xhc3NMaXN0LmFkZCgnZGFuZ2VyJyk7XFxuXFx0XFx0XFx0XFx0aXNDb21wbGV0ZWx5Q29ycmVjdCA9IGZhbHNlO1xcblxcdFxcdFxcdFxcdGRyYWdnYWJsZUVsZW1lbnRzRGFuZ2VyLnB1c2goZHJhZ2dhYmxlRWxlbWVudHNbal0pO1xcblxcdFxcdFxcdH1cXG5cXG5cXHRcXHR9XFxuXFxuXFx0XFx0aWYgKGlzQ29tcGxldGVseUNvcnJlY3QpIHtcXG5cXHRcXHRcXHRpZiAod2luQXVkaW8pIHtcXG5cXHRcXHRcXHRcXHR3aW5BdWRpby5wbGF5KCk7XFxuXFx0XFx0XFx0fVxcblxcdFxcdH0gZWxzZSBpZiAoIWlzQ29tcGxldGVseUNvcnJlY3QpIHtcXG5cXHRcXHRcXHRpZiAobG9zZUF1ZGlvKSB7XFxuXFx0XFx0XFx0XFx0bG9zZUF1ZGlvLnBsYXkoKTtcXG5cXHRcXHRcXHR9XFxuXFx0XFx0fVxcblxcdH1cXG5cXG5cXG5cXHRpZiAoY3VycmVudFF1aXouZ2V0QXR0cmlidXRlKCdkYXRhLXF1ZXN0aW9uLXR5cGUnKSA9PT0gcXVlc3Rpb25UeXBlcy5kcmFnRWxlbWVudHMpIHtcXG5cXHRcXHR2YXIgZHJhZ2dhYmxlRWxlbWVudHNTdWNjZXNzID0gW107XFxuXFx0XFx0dmFyIGRyYWdnYWJsZUVsZW1lbnRzRGFuZ2VyID0gW107XFxuXFx0XFx0dmFyIGRyYWdnYWJsZUVsZW1lbnRzID0gbW9kYWwuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZShcXFwiZHJhZ2dhYmxlXFxcIik7XFxuXFx0XFx0aXNDb21wbGV0ZWx5Q29ycmVjdCA9IHRydWU7XFxuXFxuXFx0XFx0Zm9yICh2YXIgaiA9IDA7IGogPCBkcmFnZ2FibGVFbGVtZW50cy5sZW5ndGg7IGorKykge1xcblxcdFxcdFxcdHF1ZXN0aW9uRWxlbWVudCA9IGdldFBhcmVudFF1ZXN0aW9uVG9wRWxlbWVudChkcmFnZ2FibGVFbGVtZW50c1tqXSk7XFxuXFx0XFx0XFx0cXVlc3Rpb25PdXRjb21lSWQgPSBmaWxsT3V0Y29tZUluZm9EYXRhKHF1ZXN0aW9uRWxlbWVudCk7XFxuXFx0XFx0XFx0ZmlsbFF1ZXN0aW9uRGF0YShxdWVzdGlvbkVsZW1lbnQsIHF1ZXN0aW9uT3V0Y29tZUlkKTtcXG5cXG5cXHRcXHRcXHRpZiAoZHJhZ2dhYmxlRWxlbWVudHNbal0uZ2V0QXR0cmlidXRlKFxcXCJkYXRhLWRyYWdnZWQtZ3JvdXAtdmFsdWVcXFwiKSA9PT0gZHJhZ2dhYmxlRWxlbWVudHNbal0uZ2V0QXR0cmlidXRlKFxcXCJkYXRhLWdyb3VwXFxcIikpIHtcXG5cXHRcXHRcXHRcXHRkcmFnZ2FibGVFbGVtZW50c1N1Y2Nlc3MucHVzaChkcmFnZ2FibGVFbGVtZW50c1tqXSk7XFxuXFx0XFx0XFx0XFx0ZHJhZ2dhYmxlRWxlbWVudHNbal0uY2xhc3NMaXN0LmFkZChcXFwic3VjY2Vzc1xcXCIpO1xcblxcdFxcdFxcdFxcdGFkZFF1ZXN0aW9uQ29ycmVjdEFuc3dlckNvdW50KHF1ZXN0aW9uRWxlbWVudCk7XFxuXFx0XFx0XFx0fSBlbHNlIHtcXG5cXHRcXHRcXHRcXHRpc0NvbXBsZXRlbHlDb3JyZWN0ID0gZmFsc2U7XFxuXFx0XFx0XFx0XFx0ZHJhZ2dhYmxlRWxlbWVudHNEYW5nZXIucHVzaChkcmFnZ2FibGVFbGVtZW50c1tqXSk7XFxuXFx0XFx0XFx0XFx0ZHJhZ2dhYmxlRWxlbWVudHNbal0uY2xhc3NMaXN0LmFkZChcXFwiZGFuZ2VyXFxcIik7XFxuXFx0XFx0XFx0fVxcblxcblxcdFxcdH1cXG5cXG5cXHRcXHRpZiAoaXNDb21wbGV0ZWx5Q29ycmVjdCkge1xcblxcdFxcdFxcdGlmICh3aW5BdWRpbykge1xcblxcdFxcdFxcdFxcdHdpbkF1ZGlvLnBsYXkoKTtcXG5cXHRcXHRcXHR9XFxuXFx0XFx0fSBlbHNlIGlmICghaXNDb21wbGV0ZWx5Q29ycmVjdCkge1xcblxcdFxcdFxcdGlmIChsb3NlQXVkaW8pIHtcXG5cXHRcXHRcXHRcXHRsb3NlQXVkaW8ucGxheSgpO1xcblxcdFxcdFxcdH1cXG5cXHRcXHR9XFxuXFx0fVxcblxcblxcdC8vIFJFUEwgc3RhcnRcXG5cXHQvL2lmICghaW5wdXRzLmxlbmd0aCkgeyAvLyB0aGVyZSBhcmUgbm8gaW5wdXRzIGluIFJFUExcXG5cXHRpZiAoJChcXFwiI1xcXCIgKyByZWFsU3JjSWQpLmF0dHIoXFxcImRhdGEtcXVlc3Rpb24tdHlwZVxcXCIpID09PSBcXFwiUkVQTCB6YWRhdGFrXFxcIikge1xcblxcdFxcdENvZGUuY2hlY2socmVhbFNyY0lkKTtcXG5cXHR9XFxuXFx0Ly8gUkVQTCBlbmRcXG59XFxuXFxuZnVuY3Rpb24gZGVjaWRlVG9TaG93RmVlZGJhY2soZmVlZGJhY2tUZXh0KSB7XFxuXFx0ZmVlZGJhY2tUZXh0V2l0aG91dFdoaXRlc3BhY2UgPSBmZWVkYmFja1RleHQucmVwbGFjZSgvXFxcXHMvZywgXFxcIlxcXCIpO1xcblxcdGlmIChmZWVkYmFja1RleHRXaXRob3V0V2hpdGVzcGFjZS5sZW5ndGggPiAxKSB7XFxuXFx0XFx0cmV0dXJuIHRydWU7XFxuXFx0fSBlbHNlIHJldHVybiBmYWxzZTtcXG59XFxuXFxuLyoqXFxuICogRHJhZyBjb3VudGVyIGJhc2VkIHotaW5kZXggLSB0aGlzIGFsbG93cyBzdGFja2luZyBkcmFnZ2FibGVzIGluIHRoZSBvcmRlciBvZiB0aGVpciBsYXN0IG1vdmVtZW50IGluc3RlYWQgb2YgRE9NIG9yZGVyLlxcbiAqXFxuICogSWYgZHJhZ2dhYmxlIGVsZW1lbnRzIGhhdmUgYW4gYWRkaXRpb25hbCB6LWluZGV4IGFwcGxpZWQgZWcuIGR1cmluZyBkcmFnZ2luZywgdGhhdCB6LWluZGV4IHNob3VsZCBiZSBoaWdoIGVub3VnaCBzb1xcbiAqIGNvdW50ZXIgYmFzZWQgei1pbmRleCBkb2VzIG5vdCBiZWNvbWUgZ3JlYXRlciB0aGF0LCBvdGhlcndpc2UsIGFkZGl0aW9uYWwgei1pbmRleCB3aWxsIG5vdCBiZSBzdWZmaWNpZW50IHRvIHN0YWNrXFxuICogb3ZlciBvdGhlciBzaWJsaW5ncy5cXG4gKi9cXG52YXIgRHJhZ0NvdW50ZXIgPSB7XFxuXFx0Ly8gZWxlbWVudCBtb3Zlcy9kcmFncyBjb3VudGVyXFxuXFx0ZHJhZ0NvdW50ZXI6IDAsXFxuXFxuXFx0b25EcmFnU3RhcnQ6IGZ1bmN0aW9uICh0YXJnZXQpIHtcXG5cXHRcXHQvLyBpbmNyZWFzZSBkcmFnIGNvdW50ZXIgb24gbW92ZVxcblxcdFxcdCsrdGhpcy5kcmFnQ291bnRlcjtcXG5cXHRcXHQvLyBjbGVhciBkcmFnIGNvdW50ZXIgaW5saW5lIHotaW5kZXhcXG5cXHRcXHR0YXJnZXQuc3R5bGUuekluZGV4ID0gJyc7XFxuXFx0fSxcXG5cXHRvbkRyYWdFbmQ6IGZ1bmN0aW9uICh0YXJnZXQpIHtcXG5cXHRcXHQvLyBnZXQgdGFyZ2V0J3MgYmFzZSB6LWluZGV4XFxuXFx0XFx0dmFyIGN1cnJlbnRaSW5kZXggPSBwYXJzZUludCh3aW5kb3cuZ2V0Q29tcHV0ZWRTdHlsZSh0YXJnZXQpLnpJbmRleCB8fCAwKTtcXG5cXHRcXHQvLyBzZXQgbmV3IHotaW5kZXhcXG5cXHRcXHRpZiAoJCh0YXJnZXQpLmNsb3Nlc3QoXFxcImRpdltpZCo9J3Vlc3Rpb25JZCddXFxcIilbMF0uZ2V0QXR0cmlidXRlKCdkYXRhLXF1ZXN0aW9uLXR5cGUnKSAhPT0gcXVlc3Rpb25UeXBlcy5kcmFnU29ydEVsZW1lbnRzKSB7XFxuXFx0XFx0XFx0dGFyZ2V0LnN0eWxlLnpJbmRleCA9IGN1cnJlbnRaSW5kZXggKyB0aGlzLmRyYWdDb3VudGVyO1xcblxcdFxcdH0gZWxzZSB7XFxuXFx0XFx0XFx0dGFyZ2V0LnN0eWxlLnpJbmRleCA9IDE7XFxuXFx0XFx0fVxcblxcblxcdH1cXG59O1xcblxcblxcbnZhciBDb2RlID0gKGZ1bmN0aW9uICgpIHtcXG5cXG5cXHRjb25zdCBMSU5UX09QVElPTlMgPSB7XFxuXFx0XFx0XFxcImdsb2JhbHNcXFwiOiB7XFxuXFx0XFx0XFx0XFxcImFsZXJ0XFxcIjogdHJ1ZSxcXG5cXHRcXHRcXHRcXFwicHJpbnRcXFwiOiB0cnVlXFxuXFx0XFx0fSxcXG5cXHRcXHRcXFwidW5kZWZcXFwiOiB0cnVlLFxcblxcdFxcdFxcXCJ1bnVzZWRcXFwiOiB0cnVlXFxuXFx0fTtcXG5cXG5cXHRjb25zdCBBbnN3ZXJUeXBlcyA9IHtcXG5cXHRcXHRJR05PUkVEOiAnaWdub3JlZCcsXFxuXFx0XFx0U1RBVElDOiAnc3RhdGljJyxcXG5cXHRcXHRFVkFMVUFURUQ6ICdldmFsdWF0ZWQnXFxuXFx0fTtcXG5cXG5cXHR2YXIgUmVwbFR5cGUgPSB7XFxuXFx0XFx0SkFWQVNDUklQVDogJ2phdmFzY3JpcHQnLFxcblxcdFxcdFBZVEhPTjogJ3B5dGhvbicsXFxuXFx0XFx0QkxPQ0tMWTogJ2Jsb2NrbHknLFxcblxcdH07XFxuXFxuXFx0dmFyIElucHV0VHlwZSA9IHtcXG5cXHRcXHRTVFJJTkc6ICdzdHJpbmcnLFxcblxcdFxcdEZMT0FUOiAnZmxvYXQnLFxcblxcdFxcdElOVEVHRVI6ICdpbnRlZ2VyJyxcXG5cXHRcXHRCT09MRUFOOiAnYm9vbGVhbicsXFxuXFx0fTtcXG5cXG5cXHRjb25zdCBTdHlsZXMgPSB7XFxuXFx0XFx0Q09ERV9PVVRQVVQ6ICdvdmVyZmxvdzogYXV0bzsgaGVpZ2h0OiAzMDBweDsgYm9yZGVyOiAxcHggc29saWQ7IGJhY2tncm91bmQtY29sb3I6IHdoaXRlOyBmb250LWZhbWlseTogbW9ub3NwYWNlOyBwYWRkaW5nOiAwLjVlbTsgZm9udC1zaXplOiAwLjhlbTsnLFxcblxcdFxcdENPREVfT1VUUFVUX01BUktFUjogJycsXFxuXFx0XFx0Q09ERV9PVVRQVVRfVEVYVDogJycsXFxuXFx0XFx0Q09ERV9PVVRQVVRfSU5QVVQ6ICdkaXNwbGF5OmZsZXg7ICcsXFxuXFx0XFx0Q09ERV9PVVRQVVRfSU5QVVRfTEFCRUw6ICcnLFxcblxcdFxcdENPREVfT1VUUFVUX0lOUFVUX0NPTlRST0w6ICdmbGV4OiAxOyBvdXRsaW5lOiBub25lOyBib3JkZXI6IDAgbm9uZTsgdGV4dC1hbGlnbjogbGVmdDsnLFxcblxcdH07XFxuXFxuXFx0dmFyIHRhc2tzID0ge307XFxuXFxuXFx0Ly8gcHJpdmF0ZSBtZXRob2RzXFxuXFx0Ly8gLS0tLS0tLS0tLSB1dGlsc1xcblxcblxcdC8qKiBFbnN1cmUgdGhhdCBlbXB0eSBvciBpbnZhbGlkIHZhbHVlcyBhbHdheXMgZW5kcyB1cCBhcyBhbiBhcnJheS4gKi9cXG5cXHRmdW5jdGlvbiBlbnN1cmVBcnJDb250ZW50KGNvbnRlbnQpIHtcXG5cXHRcXHRpZiAoY29udGVudCA9PSBudWxsKSB7XFxuXFx0XFx0XFx0cmV0dXJuIFtdO1xcblxcdFxcdH1cXG5cXG5cXHRcXHQvLyBoYW5kbGUgYnVnIGluIGVtcHR5IGFyciByZXByZXNlbnRhdGlvblxcblxcdFxcdGlmIChjb250ZW50ID09PSAnbnVsbCcpIHtcXG5cXHRcXHRcXHRyZXR1cm4gW107XFxuXFx0XFx0fVxcblxcblxcdFxcdGlmICghQXJyYXkuaXNBcnJheShjb250ZW50KSkge1xcblxcdFxcdFxcdHJldHVybiBbY29udGVudF07XFxuXFx0XFx0fVxcblxcblxcdFxcdHJldHVybiBjb250ZW50O1xcblxcdH1cXG5cXG5cXHQvKiogQ2hlY2sgaWYgdmFsdWUgaXMgXFxcIndlYiBlbXB0eVxcXCIgaWUuIHVuZGVmaW5lZCwgdmFsdWUgb3IgYW4gZW1wdHkgc3RyaW5nLiAqL1xcblxcdGZ1bmN0aW9uIGlzRW1wdHlWYWx1ZSh2YWx1ZSkge1xcblxcdFxcdHJldHVybiB2YWx1ZSA9PSBudWxsIHx8IHZhbHVlID09PSAnJztcXG5cXHR9XFxuXFxuXFxuXFx0Ly8gLS0tLS0tLS0tLSB0YXNrc1xcblxcblxcdC8qKiBGaW5kIGFuZCByZXR1cm4gdGFzayBieSBpZC4gT3IgZmFpbC4gSWYgdGhhdCdzIHdoYXQgeW91IHdhbnQuICovXFxuXFx0ZnVuY3Rpb24gZ2V0VGFzayhpZCwgZmFpbCA9IHRydWUpIHtcXG5cXHRcXHRpZiAodGFza3NbaWRdID09IG51bGwgJiYgZmFpbCkge1xcblxcdFxcdFxcdHRocm93ICdVbmtub3duIHRhc2sgJyArIGlkO1xcblxcdFxcdH1cXG5cXG5cXHRcXHRyZXR1cm4gdGFza3NbaWRdO1xcblxcdH1cXG5cXG5cXG5cXHQvLyAtLS0tLS0tLS0tIGNvZGVcXG5cXG5cXHRmdW5jdGlvbiBnZXRUYXNrQ29kZSh0YXNrKSB7XFxuXFx0XFx0aWYgKHRhc2sucGFyYW1zLnJlcGxUeXBlID09PSBSZXBsVHlwZS5KQVZBU0NSSVBUKSB7XFxuXFx0XFx0XFx0cmV0dXJuIHRhc2suZWRpdG9yLmdldFZhbHVlKCk7XFxuXFx0XFx0fSBlbHNlIGlmICh0YXNrLnBhcmFtcy5yZXBsVHlwZSA9PT0gUmVwbFR5cGUuUFlUSE9OKSB7XFxuXFx0XFx0XFx0cmV0dXJuIHRhc2suZWRpdG9yLmdldFZhbHVlKCk7XFxuXFx0XFx0fSBlbHNlIGlmICh0YXNrLnBhcmFtcy5yZXBsVHlwZSA9PT0gUmVwbFR5cGUuQkxPQ0tMWSkge1xcblxcdFxcdFxcdHJldHVybiBCbG9ja2x5LkphdmFTY3JpcHQud29ya3NwYWNlVG9Db2RlKHRhc2suZWRpdG9yKTtcXG5cXHRcXHR9IGVsc2Uge1xcblxcdFxcdFxcdHRocm93ICdVbmtub3duIHJlcGwgdHlwZSAnICsgdGFzay5wYXJhbXMucmVwbFR5cGUgKyAnIG9uIHRhc2sgJyArIHRhc2sucGFyYW1zLmlkO1xcblxcdFxcdH1cXG5cXHR9XFxuXFxuXFx0ZnVuY3Rpb24gZ2V0VGFza1JlZmVyZW5jZUNvZGUodGFzaykge1xcblxcdFxcdGNvbnN0IHJlZmVyZW5jZUNvZGUgPSBjcmVhdGVUYXNrUmVmZXJlbmNlQ29kZSh0YXNrKTtcXG5cXG5cXHRcXHRyZXR1cm4gW1xcblxcdFxcdFxcdC4uLnJlZmVyZW5jZUNvZGUuaW5wdXRzLFxcblxcdFxcdFxcdC4uLnJlZmVyZW5jZUNvZGUuY29kZSxcXG5cXHRcXHRdLmpvaW4oJ1xcXFxuJyk7XFxuXFx0fVxcblxcblxcdGZ1bmN0aW9uIGNyZWF0ZUluaXRpYWxUYXNrQ29kZSh0YXNrKSB7XFxuXFx0XFx0aWYgKHRhc2sucGFyYW1zLnJlcGxUeXBlID09PSBSZXBsVHlwZS5KQVZBU0NSSVBUKSB7XFxuXFx0XFx0XFx0cmV0dXJuIHtcXG5cXHRcXHRcXHRcXHRjb2RlOiB0YXNrLnBhcmFtcy5jb2RlLFxcblxcdFxcdFxcdFxcdGlucHV0czogY3JlYXRlSnNJbnB1dHNDb2RlKHRhc2sucGFyYW1zLmlucHV0cylcXG5cXHRcXHRcXHR9O1xcblxcdFxcdH0gZWxzZSBpZiAodGFzay5wYXJhbXMucmVwbFR5cGUgPT09IFJlcGxUeXBlLlBZVEhPTikge1xcblxcdFxcdFxcdHJldHVybiB7XFxuXFx0XFx0XFx0XFx0Y29kZTogdGFzay5wYXJhbXMuY29kZSxcXG5cXHRcXHRcXHRcXHRpbnB1dHM6IGNyZWF0ZVB5dGhvbklucHV0c0NvZGUodGFzay5wYXJhbXMuaW5wdXRzKVxcblxcdFxcdFxcdH07XFxuXFx0XFx0fSBlbHNlIGlmICh0YXNrLnBhcmFtcy5yZXBsVHlwZSA9PT0gUmVwbFR5cGUuQkxPQ0tMWSkge1xcblxcdFxcdFxcdHJldHVybiB7XFxuXFx0XFx0XFx0XFx0Y29kZTogW10sXFxuXFx0XFx0XFx0XFx0aW5wdXRzOiBbXSxcXG5cXHRcXHRcXHR9O1xcblxcdFxcdH0gZWxzZSB7XFxuXFx0XFx0XFx0dGhyb3cgJ0Vycm9yIGNyZWF0aW5nIGVkaXRvci4gVW5rbm93biBSRVBMIHR5cGU6ICcgKyB0YXNrLnBhcmFtcy5yZXBsVHlwZTtcXG5cXHRcXHR9XFxuXFx0fVxcblxcblxcdGZ1bmN0aW9uIGNyZWF0ZVRhc2tSZWZlcmVuY2VDb2RlKHRhc2spIHtcXG5cXHRcXHRpZiAodGFzay5wYXJhbXMucmVwbFR5cGUgPT09IFJlcGxUeXBlLkpBVkFTQ1JJUFQpIHtcXG5cXHRcXHRcXHRyZXR1cm4ge1xcblxcdFxcdFxcdFxcdGNvZGU6IHRhc2sucGFyYW1zLmFuc3dlclRleHQsXFxuXFx0XFx0XFx0XFx0aW5wdXRzOiBjcmVhdGVKc0lucHV0c0NvZGUodGFzay5wYXJhbXMuaW5wdXRzKSxcXG5cXHRcXHRcXHR9O1xcblxcdFxcdH0gZWxzZSBpZiAodGFzay5wYXJhbXMucmVwbFR5cGUgPT09IFJlcGxUeXBlLlBZVEhPTikge1xcblxcdFxcdFxcdHJldHVybiB7XFxuXFx0XFx0XFx0XFx0Y29kZTogdGFzay5wYXJhbXMuYW5zd2VyVGV4dCxcXG5cXHRcXHRcXHRcXHRpbnB1dHM6IGNyZWF0ZVB5dGhvbklucHV0c0NvZGUodGFzay5wYXJhbXMuaW5wdXRzKSxcXG5cXHRcXHRcXHR9O1xcblxcdFxcdH0gZWxzZSBpZiAodGFzay5wYXJhbXMucmVwbFR5cGUgPT09IFJlcGxUeXBlLkJMT0NLTFkpIHtcXG5cXHRcXHRcXHRyZXR1cm4ge1xcblxcdFxcdFxcdFxcdGNvZGU6IFtdLFxcblxcdFxcdFxcdFxcdGlucHV0czogW10sXFxuXFx0XFx0XFx0fTtcXG5cXHRcXHR9IGVsc2Uge1xcblxcdFxcdFxcdHRocm93ICdFcnJvciBjcmVhdGluZyBlZGl0b3IuIFVua25vd24gUkVQTCB0eXBlOiAnICsgdGFzay5wYXJhbXMucmVwbFR5cGU7XFxuXFx0XFx0fVxcblxcdH1cXG5cXG5cXHRmdW5jdGlvbiBmaW5kT3V0cHV0RWxlbWVudChpZCkge1xcblxcdFxcdHZhciBvdXRwdXRTZWxlY3RvciA9IFxcXCIjb3V0cHV0LVxcXCIgKyBpZDtcXG5cXHRcXHRyZXR1cm4gJChvdXRwdXRTZWxlY3Rvcik7XFxuXFx0fVxcblxcblxcdGZ1bmN0aW9uIGZpbmRDaGVja0J1dHRvbkVsZW1lbnQoaWQpIHtcXG5cXHRcXHR2YXIgc2VsZWN0b3IgPSBcXFwiI2NoZWNrXFxcIiArIGlkO1xcblxcdFxcdHJldHVybiAkKHNlbGVjdG9yKTtcXG5cXHR9XFxuXFxuXFx0ZnVuY3Rpb24gY2xlYXJPdXRwdXQoaWQpIHtcXG5cXHRcXHRmaW5kT3V0cHV0RWxlbWVudChpZCkudGV4dChcXFwiXFxcIik7XFxuXFx0XFx0Y2xlYXJSZXN1bHRTdGF0dXMoaWQpO1xcblxcdH1cXG5cXG5cXHRmdW5jdGlvbiBhcHBlbmRUb091dHB1dChpZCwgY29udGVudCkge1xcblxcdFxcdGNvbnN0ICRvdXRwdXRFbCA9IGZpbmRPdXRwdXRFbGVtZW50KGlkKTtcXG5cXHRcXHQkb3V0cHV0RWwuYXBwZW5kKGNvbnRlbnQpO1xcblxcdFxcdCRvdXRwdXRFbC5zY3JvbGxUb3AoJG91dHB1dEVsLnByb3AoJ3Njcm9sbEhlaWdodCcpKTtcXG5cXHR9XFxuXFxuXFx0ZnVuY3Rpb24gc2V0UmVzdWx0U3RhdHVzKGlkLCByZXN1bHRDbGFzcykge1xcblxcdFxcdGNsZWFyUmVzdWx0U3RhdHVzKGlkKTtcXG5cXHRcXHRmaW5kT3V0cHV0RWxlbWVudChpZCkuYWRkQ2xhc3MocmVzdWx0Q2xhc3MpO1xcblxcdH1cXG5cXG5cXHRmdW5jdGlvbiBnZXRUYXNrUmVzdWx0KGlkKSB7XFxuXFx0XFx0dmFyICRvdXRwdXRFbCA9IGZpbmRPdXRwdXRFbGVtZW50KGlkKTtcXG5cXG5cXHRcXHRyZXR1cm4gJG91dHB1dEVsLmNoaWxkcmVuKCcuY29kZS1vdXRwdXQtdGV4dCcpLm1hcChmdW5jdGlvbiAoKSB7XFxuXFx0XFx0XFx0cmV0dXJuICQodGhpcykudGV4dCgpO1xcblxcdFxcdH0pXFxuXFx0XFx0XFx0LmdldCgpO1xcblxcdH1cXG5cXG5cXHRmdW5jdGlvbiBjbGVhclJlc3VsdFN0YXR1cyhpZCkge1xcblxcdFxcdGZpbmRPdXRwdXRFbGVtZW50KGlkKS5yZW1vdmVDbGFzcygnc3VjY2VzcyBkYW5nZXInKTtcXG5cXHR9XFxuXFxuXFx0ZnVuY3Rpb24gd3JpdGVSZXBsQ29uc29sZU91dHB1dE1hcmtlcihpZCwgdmFsdWUpIHtcXG5cXHRcXHRhcHBlbmRUb091dHB1dChpZCwgJChgPGRpdiBjbGFzcz1cXFwiY29kZS1vdXRwdXQtbWFya2VyXFxcIiBzdHlsZT1cXFwiJHtTdHlsZXMuQ09ERV9PVVRQVVRfTUFSS0VSfVxcXCI+JHt2YWx1ZX08L2Rpdj5gKSk7XFxuXFx0fVxcblxcblxcdGZ1bmN0aW9uIHdyaXRlUmVwbENvbnNvbGVUZXh0KGlkLCB2YWx1ZSkge1xcblxcdFxcdGFwcGVuZFRvT3V0cHV0KGlkLCAkKGA8ZGl2IGNsYXNzPVxcXCJjb2RlLW91dHB1dC10ZXh0XFxcIiBzdHlsZT1cXFwiJHtTdHlsZXMuQ09ERV9PVVRQVVRfVEVYVH1cXFwiPiR7dmFsdWV9PC9kaXY+YCkpO1xcblxcdH1cXG5cXG5cXHRmdW5jdGlvbiB3cml0ZVJlcGxDb25zb2xlSW5wdXQoaWQsIGxhYmVsLCB2YWx1ZUNhbGxiYWNrKSB7XFxuXFx0XFx0Y29uc3QgaW5wdXRDb250YWluZXJFbCA9ICQoYDxkaXYgY2xhc3M9XFxcImNvZGUtb3V0cHV0LWlucHV0XFxcIiBzdHlsZT1cXFwiJHtTdHlsZXMuQ09ERV9PVVRQVVRfSU5QVVR9XFxcIiAvPmApO1xcblxcdFxcdGNvbnN0IGxhYmVsRWwgPSAkKGA8c3BhbiBjbGFzcz1cXFwiY29kZS1vdXRwdXQtaW5wdXRMYWJlbFxcXCIgc3R5bGU9XFxcIiR7U3R5bGVzLkNPREVfT1VUUFVUX0lOUFVUX0xBQkVMfVxcXCIgLz5gKS50ZXh0KGxhYmVsKTtcXG5cXHRcXHRjb25zdCBpbnB1dEVsID0gJChgPGlucHV0PmAsIHtcXG5cXHRcXHRcXHR0eXBlOiBcXFwidGV4dFxcXCIsXFxuXFx0XFx0XFx0XFxcImNsYXNzXFxcIjogXFxcImNvZGUtb3V0cHV0LWlucHV0Q29udHJvbFxcXCIsXFxuXFx0XFx0XFx0c3R5bGU6IFN0eWxlcy5DT0RFX09VVFBVVF9JTlBVVF9DT05UUk9MLFxcblxcdFxcdFxcdG9uOiB7XFxuXFx0XFx0XFx0XFx0a2V5cHJlc3M6IGZ1bmN0aW9uIChldmVudCkge1xcblxcdFxcdFxcdFxcdFxcdC8vIG9uIGVudGVyIGRpc2FibGUgZnVydGhlciBpbnB1dCBhbmQgcmV0dXJuIHZhbHVlXFxuXFx0XFx0XFx0XFx0XFx0aWYgKGV2ZW50LmtleUNvZGUgPT0gMTMpIHtcXG5cXHRcXHRcXHRcXHRcXHRcXHQkKHRoaXMpXFxuXFx0XFx0XFx0XFx0XFx0XFx0XFx0LmF0dHIoXFxcImRpc2FibGVkXFxcIiwgXFxcImRpc2FibGVkXFxcIilcXG5cXHRcXHRcXHRcXHRcXHRcXHRcXHQuYmx1cigpO1xcblxcdFxcdFxcdFxcdFxcdFxcdHZhbHVlQ2FsbGJhY2sodGhpcy52YWx1ZSk7XFxuXFx0XFx0XFx0XFx0XFx0fVxcblxcdFxcdFxcdFxcdH1cXG5cXHRcXHRcXHR9XFxuXFx0XFx0fSk7XFxuXFxuXFx0XFx0aW5wdXRDb250YWluZXJFbC5hcHBlbmQobGFiZWxFbCk7XFxuXFx0XFx0aW5wdXRDb250YWluZXJFbC5hcHBlbmQoaW5wdXRFbCk7XFxuXFx0XFx0YXBwZW5kVG9PdXRwdXQoaWQsIGlucHV0Q29udGFpbmVyRWwpO1xcblxcblxcdFxcdGlucHV0RWwuZm9jdXMoKTtcXG5cXHR9XFxuXFxuXFxuXFx0LyoqIERvIHNvbWUgbmVjZXNzYXJ5IFVJIGFkanVzdG1lbnRzIGRlcGVuZGluZyBvbiB0YXNrJ3MgY29uZmlndXJhdGlvbi4gKi9cXG5cXHRmdW5jdGlvbiBjb25maWd1cmVVaSh0YXNrKSB7XFxuXFx0XFx0X190bXBfX3JlcGxhY2VPdXRwdXRFbCh0YXNrLnBhcmFtcy5pZCk7XFxuXFx0XFx0Y29uZmlndXJlQ2hlY2tCdXR0b24odGFzayk7XFxuXFx0fVxcblxcblxcdC8qKiBDb25maWd1cmUgY2hlY2sgYnV0dG9uIGFjY29yZGluZyB0byBhbnN3ZXIgdHlwZS4gKi9cXG5cXHRmdW5jdGlvbiBjb25maWd1cmVDaGVja0J1dHRvbih0YXNrKSB7XFxuXFx0XFx0Y29uc3QgaWQgPSB0YXNrLnBhcmFtcy5pZDtcXG5cXHRcXHRjb25zdCAkY2hlY2tCdXR0b25FbCA9IGZpbmRDaGVja0J1dHRvbkVsZW1lbnQoaWQpO1xcblxcblxcdFxcdC8vIElHTk9SRUQgLSBoaWRlIGNoZWNrIGJ1dHRvblxcblxcdFxcdGlmICh0YXNrLnBhcmFtcy5hbnN3ZXJUeXBlID09PSBBbnN3ZXJUeXBlcy5JR05PUkVEKSB7XFxuXFx0XFx0XFx0JGNoZWNrQnV0dG9uRWwuaGlkZSgpO1xcblxcdFxcdH1cXG5cXHR9XFxuXFxuXFx0LyoqIFRtcCBzb2x1dGlvbiB0aGF0IHJlcGxhY2VzIGN1cnJlbnQgSFRNTCBvdXRwdXQgVEVYVEFSRUEgZWwgd2l0aCBESVYuIElmIHRoaXMgbmV3IFxcXCJDb2RlXFxcIiBpbXBsZW1lbnRhdGlvbiBwcm92ZXMgT0ssIHRoaXMgc2hvdWxkIGJlIGRvbmUgaW4gSFRNTCBpdHNlbGYgaW5zdGVhZC4gKi9cXG5cXHRmdW5jdGlvbiBfX3RtcF9fcmVwbGFjZU91dHB1dEVsKGlkKSB7XFxuXFx0XFx0Y29uc3QgJG91dHB1dEVsID0gZmluZE91dHB1dEVsZW1lbnQoaWQpO1xcblxcdFxcdCRvdXRwdXRFbC5yZXBsYWNlV2l0aCgkKCc8ZGl2IC8+Jywge1xcblxcdFxcdFxcdGlkOiAkb3V0cHV0RWwuYXR0cignaWQnKSxcXG5cXHRcXHRcXHRjbGFzczogJG91dHB1dEVsLmF0dHIoJ2NsYXNzJyksXFxuXFx0XFx0XFx0c3R5bGU6IFN0eWxlcy5DT0RFX09VVFBVVCxcXG5cXHRcXHR9KSk7XFxuXFx0fVxcblxcblxcblxcdC8vIC0tLS0tLS0tLS0gSW50ZXJwcmV0ZXJzXFxuXFxuXFx0LyoqIE91dHB1dCB3cml0ZXIgdGhhdCBwYXNzZXMgb3V0cHV0IHRvIGdpdmVuIGNhbGxiYWNrIGZuLiAqL1xcblxcdGZ1bmN0aW9uIGNyZWF0ZUNhbGxiYWNrT3V0cHV0V3JpdGVyKGNhbGxiYWNrKSB7XFxuXFx0XFx0cmV0dXJuIHtcXG5cXHRcXHRcXHR3cml0ZTogKC4uLnBhcmFtcykgPT4ge1xcblxcdFxcdFxcdFxcdGNhbGxiYWNrKHBhcmFtcy5qb2luKCcnKSk7XFxuXFx0XFx0XFx0fVxcblxcdFxcdH07XFxuXFx0fTtcXG5cXG5cXHQvKiogT3V0cHV0IHdyaXRlciB0aGF0IGJ1ZmZlcnMgb3V0cHV0IGludG8gZ2l2ZW4gYnVmZmVyIChhcnJheSkuICovXFxuXFx0ZnVuY3Rpb24gY3JlYXRlQnVmZmVyZWRPdXRwdXRXcml0ZXIoYnVmZmVyKSB7XFxuXFx0XFx0cmV0dXJuIHtcXG5cXHRcXHRcXHR3cml0ZTogKC4uLmFyZ3MpID0+IHtcXG5cXHRcXHRcXHRcXHRidWZmZXIucHVzaChhcmdzLmpvaW4oJycpKTtcXG5cXHRcXHRcXHR9XFxuXFx0XFx0fTtcXG5cXHR9O1xcblxcblxcdC8qKiBJbnB1dCByZWFkZXIgdGhhdCByZWFkcyBmcm9tIGRlZmF1bHQgYnJvd3NlciBwcm9tcHQuICovXFxuXFx0ZnVuY3Rpb24gY3JlYXRlUHJvbXB0SW5wdXRSZWFkZXIoKSB7XFxuXFx0XFx0cmV0dXJuIHtcXG5cXHRcXHRcXHRyZWFkOiAobGFiZWwpID0+IHtcXG5cXHRcXHRcXHRcXHRyZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xcblxcdFxcdFxcdFxcdFxcdHRyeSB7XFxuXFx0XFx0XFx0XFx0XFx0XFx0Y29uc3QgdmFsdWUgPSBwcm9tcHQobGFiZWwpO1xcblxcdFxcdFxcdFxcdFxcdFxcdHJlc29sdmUodmFsdWUpO1xcblxcdFxcdFxcdFxcdFxcdH0gY2F0Y2ggKGVycikge1xcblxcdFxcdFxcdFxcdFxcdFxcdHJlamVjdChlcnIpO1xcblxcdFxcdFxcdFxcdFxcdH1cXG5cXHRcXHRcXHRcXHR9KTtcXG5cXHRcXHRcXHR9XFxuXFx0XFx0fTtcXG5cXHR9XFxuXFxuXFxuXFx0LyoqIElucHV0IHJlYWRlciB0aGF0IHJlYWRzIGZyb20gZGVmYXVsdCBicm93c2VyIHByb21wdC4gKi9cXG5cXHRmdW5jdGlvbiBjcmVhdGVJbmxpbmVJbnB1dFJlYWRlcih0YXNrSWQpIHtcXG5cXHRcXHRyZXR1cm4ge1xcblxcdFxcdFxcdHJlYWQ6IChsYWJlbCkgPT4ge1xcblxcdFxcdFxcdFxcdHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XFxuXFx0XFx0XFx0XFx0XFx0dHJ5IHtcXG5cXHRcXHRcXHRcXHRcXHRcXHR3cml0ZVJlcGxDb25zb2xlSW5wdXQodGFza0lkLCBsYWJlbCwgKHZhbHVlKSA9PiB7XFxuXFx0XFx0XFx0XFx0XFx0XFx0XFx0cmVzb2x2ZSh2YWx1ZSk7XFxuXFx0XFx0XFx0XFx0XFx0XFx0fSk7XFxuXFx0XFx0XFx0XFx0XFx0fSBjYXRjaCAoZXJyKSB7XFxuXFx0XFx0XFx0XFx0XFx0XFx0cmVqZWN0KGVycik7XFxuXFx0XFx0XFx0XFx0XFx0fVxcblxcdFxcdFxcdFxcdH0pO1xcblxcdFxcdFxcdH1cXG5cXHRcXHR9O1xcblxcdH1cXG5cXG5cXHQvKiogSW5wdXQgcmVhZGVyIHRoYXQgdGFrZXMgYW5vdGhlciBpbnB1dCByZWFkZXIgYW5kIHJlY29yZHMgaXQncyBldmVyeSBpbnB1dCBpbnRvIGEgcXVldWUuICovXFxuXFx0ZnVuY3Rpb24gY3JlYXRlUXVldWVMb29rdXBSZWNvcmRlcklucHV0UmVhZGVyKGlucHV0UmVhZGVyLCBpbnB1dFJlY29yZFF1ZXVlKSB7XFxuXFx0XFx0cmV0dXJuIHtcXG5cXHRcXHRcXHRyZWFkOiAodGV4dCkgPT4ge1xcblxcdFxcdFxcdFxcdHJldHVybiBpbnB1dFJlYWRlci5yZWFkKHRleHQpXFxuXFx0XFx0XFx0XFx0XFx0LnRoZW4oKHZhbHVlKSA9PiB7XFxuXFx0XFx0XFx0XFx0XFx0XFx0aW5wdXRSZWNvcmRRdWV1ZS5wdXNoKHZhbHVlKTtcXG5cXG5cXHRcXHRcXHRcXHRcXHRcXHRyZXR1cm4gdmFsdWU7XFxuXFx0XFx0XFx0XFx0XFx0fSk7XFxuXFx0XFx0XFx0fVxcblxcdFxcdH07XFxuXFx0fVxcblxcblxcdC8qKiBJbnB1dCByZWFkZXIgdGhhdCB0YWtlcyBhbm90aGVyIGlucHV0IHJlYWRlciBhbmQgcmVjb3JkcyBpdCdzIGV2ZXJ5IGlucHV0IGludG8gYSBsb29rdXAgbWFwLiAqL1xcblxcdGZ1bmN0aW9uIGNyZWF0ZU1hcExvb2t1cFJlY29yZGVySW5wdXRSZWFkZXIoaW5wdXRSZWFkZXIsIGlucHV0UmVjb3JkTWFwKSB7XFxuXFx0XFx0cmV0dXJuIHtcXG5cXHRcXHRcXHRyZWFkOiAodGV4dCkgPT4ge1xcblxcdFxcdFxcdFxcdHJldHVybiBpbnB1dFJlYWRlci5yZWFkKHRleHQpXFxuXFx0XFx0XFx0XFx0XFx0LnRoZW4oKHZhbHVlKSA9PiB7XFxuXFx0XFx0XFx0XFx0XFx0XFx0aW5wdXRSZWNvcmRNYXBbdGV4dF0gPSB2YWx1ZTtcXG5cXG5cXHRcXHRcXHRcXHRcXHRcXHRyZXR1cm4gdmFsdWU7XFxuXFx0XFx0XFx0XFx0XFx0fSk7XFxuXFx0XFx0XFx0fVxcblxcdFxcdH07XFxuXFx0fVxcblxcblxcdC8qKlxcblxcdCAqIElucHV0IHJlYWRlciB0aGF0IHVzZXMgcHJlcGFyZWQvcmVjb3JkZWQgbG9va3VwIHF1ZXVlIHRvIHJldHVybiBpbnB1dC5cXG5cXHQgKiBUaGlzIHJlYWRlciBhbGxvd3MgaW5wdXRzIHRvIGJlIGFjY2Vzc2VkL3JlYWQgaW4gdGhlIHNhbWUgb3JkZXIgdGhleSB3ZXJlIHJlY29yZGVkIGluLlxcblxcdCAqL1xcblxcdGZ1bmN0aW9uIGNyZWF0ZVF1ZXVlTG9va3VwSW5wdXRSZWFkZXIobG9va3VwUXVldWUpIHtcXG5cXHRcXHRyZXR1cm4ge1xcblxcdFxcdFxcdHJlYWQ6ICh0ZXh0KSA9PiB7XFxuXFx0XFx0XFx0XFx0cmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcXG5cXHRcXHRcXHRcXHRcXHR0cnkge1xcblxcdFxcdFxcdFxcdFxcdFxcdGNvbnN0IHZhbHVlID0gbG9va3VwUXVldWUuc2hpZnQoKTtcXG5cXHRcXHRcXHRcXHRcXHRcXHRyZXNvbHZlKHZhbHVlKTtcXG5cXHRcXHRcXHRcXHRcXHR9IGNhdGNoIChlcnIpIHtcXG5cXHRcXHRcXHRcXHRcXHRcXHRyZWplY3QoZXJyKTtcXG5cXHRcXHRcXHRcXHRcXHR9XFxuXFx0XFx0XFx0XFx0fSk7XFxuXFx0XFx0XFx0fVxcblxcdFxcdH07XFxuXFx0fVxcblxcblxcdC8qKlxcblxcdCAqIElucHV0IHJlYWRlciB0aGF0IHVzZXMgcHJlcGFyZWQvcmVjb3JkZWQgbG9va3VwIG1hcCB0byByZXR1cm4gaW5wdXQuXFxuXFx0ICogVGhpcyByZWFkZXIgYWxsb3dzIGlucHV0cyB0byBiZSBhY2Nlc3NlZC9yZWFkIGJ5IHRoZSBsYWJlbCB0aGV5IHdlcmUgcmVjb3JkZWQgd2l0aC4gVGhpcyBoYXMgYSBsaW1pdGF0aW9uIHRoYXQgeW91IG11c3QgaGF2ZSB1bmlxdWUgaW5wdXQgbGFiZWxzIGZvciBhbGwgaW5wdXRzLlxcblxcdCAqL1xcblxcdGZ1bmN0aW9uIGNyZWF0ZU1hcExvb2t1cElucHV0UmVhZGVyKGxvb2t1cE1hcCkge1xcblxcdFxcdHJldHVybiB7XFxuXFx0XFx0XFx0cmVhZDogKHRleHQpID0+IHtcXG5cXHRcXHRcXHRcXHRyZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xcblxcdFxcdFxcdFxcdFxcdHRyeSB7XFxuXFx0XFx0XFx0XFx0XFx0XFx0Y29uc3QgdmFsdWUgPSBsb29rdXBNYXBbdGV4dF07XFxuXFx0XFx0XFx0XFx0XFx0XFx0cmVzb2x2ZSh2YWx1ZSk7XFxuXFx0XFx0XFx0XFx0XFx0fSBjYXRjaCAoZXJyKSB7XFxuXFx0XFx0XFx0XFx0XFx0XFx0cmVqZWN0KGVycik7XFxuXFx0XFx0XFx0XFx0XFx0fVxcblxcdFxcdFxcdFxcdH0pO1xcblxcdFxcdFxcdH1cXG5cXHRcXHR9O1xcblxcdH1cXG5cXG5cXHQvKipcXG5cXHQgKiBQb3NzaWJsZSBvcHRpb25zOlxcblxcdCAqICAtIG91dHB1dFdyaXRlciAgLSBvdXRwdXQgd3JpdGVyIGltcGwgb2JqZWN0XFxuXFx0ICogIC0gaW5wdXRSZWFkZXIgLSBpbnB1dCBjb2xsZWN0b3IgaW1wbCBvYmplY3RcXG5cXHQgKi9cXG5cXHRmdW5jdGlvbiBydW5JbnRlcnByZXRlcihyZXBsVHlwZSwgY29kZSwgb3B0aW9ucykge1xcblxcdFxcdGlmIChyZXBsVHlwZSA9PT0gUmVwbFR5cGUuSkFWQVNDUklQVCkge1xcblxcdFxcdFxcdHJldHVybiBydW5Kc0ludGVycHJldGVyKGNvZGUsIG9wdGlvbnMpO1xcblxcdFxcdH0gZWxzZSBpZiAocmVwbFR5cGUgPT09IFJlcGxUeXBlLlBZVEhPTikge1xcblxcdFxcdFxcdHJldHVybiBydW5QeXRob25JbnRlcnByZXRlcihjb2RlLCBvcHRpb25zKTtcXG5cXHRcXHR9IGVsc2UgaWYgKHJlcGxUeXBlID09PSBSZXBsVHlwZS5CTE9DS0xZKSB7XFxuXFx0XFx0XFx0cmV0dXJuIHJ1bkpzSW50ZXJwcmV0ZXIoY29kZSk7XFxuXFx0XFx0fSBlbHNlIHtcXG5cXHRcXHRcXHR0aHJvdyAnVW5rbm93biBSRVBMIHR5cGU6ICcgKyByZXBsVHlwZTtcXG5cXHRcXHR9XFxuXFx0fVxcblxcblxcdC8vIC0tIFB5dGhvbiBpbnRlcnByZXRlclxcblxcblxcdGZ1bmN0aW9uIHJ1blB5dGhvbkludGVycHJldGVyKGNvZGUsIG9wdGlvbnMpIHtcXG5cXHRcXHRsZXQgZXhwZWN0VHJhaWxpbmdOZXdsaW5lID0gZmFsc2U7XFxuXFx0XFx0Ly8gb3V0cHV0IHdyaXRlciBmdW5jdGlvbiB3cmFwcGVyXFxuXFx0XFx0dmFyIG91dHB1dFdyaXRlckZuID0gZnVuY3Rpb24gKC4uLnBhcmFtcykge1xcblxcdFxcdFxcdGlmIChleHBlY3RUcmFpbGluZ05ld2xpbmUgJiYgcGFyYW1zLmxlbmd0aCA9PT0gMSAmJiBwYXJhbXMuc2xpY2UoMCwgMSkuc2hpZnQoKSA9PT0gJ1xcXFxuJykge1xcblxcdFxcdFxcdFxcdC8vIGlnbm9yZSBweXRob24ncyB0cmFpbGluZyBuZXdsaW5lXFxuXFx0XFx0XFx0fSBlbHNlIHtcXG5cXHRcXHRcXHRcXHRpZiAob3B0aW9ucyAmJiBvcHRpb25zLm91dHB1dFdyaXRlcikge1xcblxcdFxcdFxcdFxcdFxcdG9wdGlvbnMub3V0cHV0V3JpdGVyLndyaXRlKC4uLnBhcmFtcyk7XFxuXFx0XFx0XFx0XFx0fVxcblxcdFxcdFxcdH1cXG5cXHRcXHRcXHRleHBlY3RUcmFpbGluZ05ld2xpbmUgPSAhZXhwZWN0VHJhaWxpbmdOZXdsaW5lO1xcblxcdFxcdH07XFxuXFxuXFx0XFx0Ly8gaW5wdXQgcmVhZGVyIGZ1bmN0aW9uIHdyYXBwZXJcXG5cXHRcXHR2YXIgaW5wdXRSZWFkZXJGbiA9IGZ1bmN0aW9uICh0ZXh0KSB7XFxuXFx0XFx0XFx0aWYgKG9wdGlvbnMgJiYgb3B0aW9ucy5pbnB1dFJlYWRlcikge1xcblxcdFxcdFxcdFxcdHJldHVybiBvcHRpb25zLmlucHV0UmVhZGVyLnJlYWQodGV4dCk7XFxuXFx0XFx0XFx0fVxcblxcdFxcdFxcdGVsc2Uge1xcblxcdFxcdFxcdFxcdHJldHVybiBQcm9taXNlLnJlc29sdmUoKTtcXG5cXHRcXHRcXHR9XFxuXFx0XFx0fTtcXG5cXG5cXHRcXHRTay5jb25maWd1cmUoe1xcblxcdFxcdFxcdG91dHB1dDogb3V0cHV0V3JpdGVyRm4sXFxuXFx0XFx0XFx0aW5wdXRmdW46IGlucHV0UmVhZGVyRm4sXFxuXFx0XFx0XFx0aW5wdXRmdW5UYWtlc1Byb21wdDogdHJ1ZSxcXG5cXHRcXHRcXHRyZWFkOiAoeCkgPT4ge1xcblxcdFxcdFxcdFxcdGlmIChTay5idWlsdGluRmlsZXMgPT09IHVuZGVmaW5lZCB8fCBTay5idWlsdGluRmlsZXNbXFxcImZpbGVzXFxcIl1beF0gPT09IHVuZGVmaW5lZCkge1xcblxcdFxcdFxcdFxcdFxcdHRocm93IFxcXCJGaWxlIG5vdCBmb3VuZDogJ1xcXCIgKyB4ICsgXFxcIidcXFwiO1xcblxcdFxcdFxcdFxcdH1cXG5cXHRcXHRcXHRcXHRyZXR1cm4gU2suYnVpbHRpbkZpbGVzW1xcXCJmaWxlc1xcXCJdW3hdO1xcblxcdFxcdFxcdH1cXG5cXHRcXHR9KTtcXG5cXG5cXHRcXHRyZXR1cm4gU2subWlzY2V2YWwuYXN5bmNUb1Byb21pc2UoZnVuY3Rpb24gKCkge1xcblxcdFxcdFxcdHJldHVybiBTay5pbXBvcnRNYWluV2l0aEJvZHkoXFxcIjxzdGRpbj5cXFwiLCBmYWxzZSwgY29kZSwgdHJ1ZSk7XFxuXFx0XFx0fSk7XFxuXFx0fVxcblxcblxcblxcdC8vIC0tIEpTIGludGVycHJldGVyXFxuXFxuXFx0LyoqXFxuXFx0ICogSlMgaW50ZXJwcmV0ZXJcXG5cXHQgKiBEb3M6IGh0dHBzOi8vbmVpbC5mcmFzZXIubmFtZS9zb2Z0d2FyZS9KUy1JbnRlcnByZXRlci9kb2NzLmh0bWxcXG5cXHQgKi9cXG5cXHRmdW5jdGlvbiBydW5Kc0ludGVycHJldGVyKGNvZGUsIG9wdGlvbnMpIHtcXG5cXHRcXHRyZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xcblxcdFxcdFxcdGxldCBpbnRlcnZhbDtcXG5cXHRcXHRcXHR0cnkge1xcblxcdFxcdFxcdFxcdHZhciBpbnRlcnByZXRlciA9IG5ldyBJbnRlcnByZXRlcihjb2RlLCBqc0ludGVycHJldGVySW5pdEZuKG9wdGlvbnMpKTtcXG5cXHRcXHRcXHRcXHRpbnRlcnByZXRlci5ydW4oKTtcXG5cXG5cXHRcXHRcXHRcXHQvLyBsb29wIHVudGlsIHRoZXJlIGFyZSBubyBtb3JlIHN0ZXBzIHRvIHBlcmZvcm1lLCB0aGVuIGV4aXRcXG5cXHRcXHRcXHRcXHRpbnRlcnZhbCA9IHNldEludGVydmFsKCgpID0+IHtcXG5cXHRcXHRcXHRcXHRcXHRpZiAoIWludGVycHJldGVyLnN0ZXAoKSkge1xcblxcdFxcdFxcdFxcdFxcdFxcdGNsZWFySW50ZXJ2YWwoaW50ZXJ2YWwpO1xcblxcdFxcdFxcdFxcdFxcdFxcdGludGVydmFsID0gbnVsbDtcXG5cXHRcXHRcXHRcXHRcXHRcXHRyZXNvbHZlKCk7XFxuXFx0XFx0XFx0XFx0XFx0fVxcblxcdFxcdFxcdFxcdH0pO1xcblxcdFxcdFxcdH0gY2F0Y2ggKGVycikge1xcblxcdFxcdFxcdFxcdGlmIChpbnRlcnZhbCAhPSBudWxsKSB7XFxuXFx0XFx0XFx0XFx0XFx0Y2xlYXJJbnRlcnZhbChpbnRlcnZhbCk7XFxuXFx0XFx0XFx0XFx0XFx0aW50ZXJ2YWwgPSBudWxsO1xcblxcdFxcdFxcdFxcdH1cXG5cXHRcXHRcXHRcXHRyZWplY3QoZXJyKTtcXG5cXHRcXHRcXHR9XFxuXFx0XFx0fSk7XFxuXFx0fVxcblxcblxcdGZ1bmN0aW9uIGpzSW50ZXJwcmV0ZXJJbml0Rm4ob3B0aW9ucykge1xcblxcdFxcdHJldHVybiAoaW50ZXJwcmV0ZXIsIHNjb3BlKSA9PiB7XFxuXFx0XFx0XFx0Ly8gdHlwZSBjb3ZlcnNpb24gdXRpbHNcXG5cXHRcXHRcXHRmdW5jdGlvbiBwYXJzZUJvb2xGbihzdHJWYWx1ZSkge1xcblxcdFxcdFxcdFxcdGlmIChzdHJWYWx1ZSA9PSBudWxsIHx8IHN0clZhbHVlLnRyaW0oKS5sZW5ndGggPT09IDApIHtcXG5cXHRcXHRcXHRcXHRcXHRyZXR1cm4gZmFsc2U7XFxuXFx0XFx0XFx0XFx0fSBlbHNlIHtcXG5cXHRcXHRcXHRcXHRcXHRyZXR1cm4gL150cnVlJC9pLnRlc3Qoc3RyVmFsdWUudHJpbSgpKTtcXG5cXHRcXHRcXHRcXHR9XFxuXFx0XFx0XFx0fVxcblxcdFxcdFxcdGludGVycHJldGVyLnNldFByb3BlcnR5KHNjb3BlLCBcXFwicGFyc2VCb29sXFxcIiwgaW50ZXJwcmV0ZXIuY3JlYXRlTmF0aXZlRnVuY3Rpb24ocGFyc2VCb29sRm4pKTtcXG5cXG5cXHRcXHRcXHQvLyBvdXRwdXQgd3JpdGVyIGZ1bmN0aW9uIHdyYXBwZXJcXG5cXHRcXHRcXHR2YXIgb3V0cHV0V3JpdGVyRm4gPSBmdW5jdGlvbiAoLi4ucGFyYW1zKSB7XFxuXFx0XFx0XFx0XFx0aWYgKG9wdGlvbnMgJiYgb3B0aW9ucy5vdXRwdXRXcml0ZXIpIHtcXG5cXHRcXHRcXHRcXHRcXHRvcHRpb25zLm91dHB1dFdyaXRlci53cml0ZSguLi5wYXJhbXMpO1xcblxcdFxcdFxcdFxcdH1cXG5cXG5cXHRcXHRcXHRcXHRyZXR1cm4gaW50ZXJwcmV0ZXIuVU5ERUZJTkVEO1xcblxcdFxcdFxcdH07XFxuXFx0XFx0XFx0aW50ZXJwcmV0ZXIuc2V0UHJvcGVydHkoc2NvcGUsIFxcXCJwcmludFxcXCIsIGludGVycHJldGVyLmNyZWF0ZU5hdGl2ZUZ1bmN0aW9uKG91dHB1dFdyaXRlckZuKSk7XFxuXFx0XFx0XFx0aW50ZXJwcmV0ZXIuc2V0UHJvcGVydHkoc2NvcGUsIFxcXCJhbGVydFxcXCIsIGludGVycHJldGVyLmNyZWF0ZU5hdGl2ZUZ1bmN0aW9uKG91dHB1dFdyaXRlckZuKSk7XFxuXFxuXFx0XFx0XFx0Ly8gaW5wdXQgcmVhZGVyIGZ1bmN0aW9uIHdyYXBwZXJcXG5cXHRcXHRcXHR2YXIgaW5wdXRSZWFkZXJGbiA9IGZ1bmN0aW9uICh0ZXh0LCBjYWxsYmFjaykge1xcblxcdFxcdFxcdFxcdGlmIChvcHRpb25zICYmIG9wdGlvbnMuaW5wdXRSZWFkZXIpIHtcXG5cXHRcXHRcXHRcXHRcXHRvcHRpb25zLmlucHV0UmVhZGVyLnJlYWQodGV4dClcXG5cXHRcXHRcXHRcXHRcXHRcXHQudGhlbigodmFsdWUpID0+IHtcXG5cXHRcXHRcXHRcXHRcXHRcXHRcXHRjYWxsYmFjayh2YWx1ZSk7XFxuXFx0XFx0XFx0XFx0XFx0XFx0fSk7XFxuXFx0XFx0XFx0XFx0fVxcblxcdFxcdFxcdFxcdGVsc2Uge1xcblxcdFxcdFxcdFxcdFxcdGNhbGxiYWNrKCk7XFxuXFx0XFx0XFx0XFx0fVxcblxcdFxcdFxcdH07XFxuXFx0XFx0XFx0aW50ZXJwcmV0ZXIuc2V0UHJvcGVydHkoc2NvcGUsIFxcXCJpbnB1dFxcXCIsIGludGVycHJldGVyLmNyZWF0ZUFzeW5jRnVuY3Rpb24oaW5wdXRSZWFkZXJGbikpO1xcblxcdFxcdFxcdGludGVycHJldGVyLnNldFByb3BlcnR5KHNjb3BlLCBcXFwicHJvbXB0XFxcIiwgaW50ZXJwcmV0ZXIuY3JlYXRlQXN5bmNGdW5jdGlvbihpbnB1dFJlYWRlckZuKSk7XFxuXFx0XFx0fTtcXG5cXHR9XFxuXFxuXFx0ZnVuY3Rpb24gY3JlYXRlSnNJbnB1dHNDb2RlKGlucHV0cykge1xcblxcdFxcdC8vIHdyYXAgY21kIGluIHR5cGUgY29udmVydGVyLCBpZiB0aGVyZSBpcyB0eXBlIGFuZCBpdCdzIG5vdCBzdHJpbmcgKHN0aXJuIGlzIGRlZnVhbHQpXFxuXFx0XFx0ZnVuY3Rpb24gdHlwZVdyYXBwZXIoaW5wdXRUeXBlLCBjbWQpIHtcXG5cXHRcXHRcXHRpZiAoaW5wdXRUeXBlICE9IG51bGwgJiYgaW5wdXRUeXBlICE9PSBJbnB1dFR5cGUuU1RSSU5HKSB7XFxuXFx0XFx0XFx0XFx0aWYgKGlucHV0VHlwZSA9PT0gSW5wdXRUeXBlLkJPT0xFQU4pIHtcXG5cXHRcXHRcXHRcXHRcXHRyZXR1cm4gYHBhcnNlQm9vbCgke2NtZH0pYDtcXG5cXHRcXHRcXHRcXHR9IGVsc2UgaWYgKGlucHV0VHlwZSA9PT0gSW5wdXRUeXBlLkZMT0FUKSB7XFxuXFx0XFx0XFx0XFx0XFx0cmV0dXJuIGBwYXJzZUZsb2F0KCR7Y21kfSlgO1xcblxcdFxcdFxcdFxcdH0gZWxzZSBpZiAoaW5wdXRUeXBlID09PSBJbnB1dFR5cGUuSU5URUdFUikge1xcblxcdFxcdFxcdFxcdFxcdHJldHVybiBgcGFyc2VJbnQoJHtjbWR9KWA7XFxuXFx0XFx0XFx0XFx0fVxcblxcdFxcdFxcdFxcdC8vIG5vIHR5cGluZywgcmV0dXJuIG9yaWdpbmFsIHZhbHVlXFxuXFx0XFx0XFx0fSBlbHNlIHtcXG5cXHRcXHRcXHRcXHRyZXR1cm4gY21kO1xcblxcdFxcdFxcdH1cXG5cXHRcXHR9XFxuXFxuXFx0XFx0cmV0dXJuIChpbnB1dHMgfHwgW10pLm1hcCgoaW5wdXQpID0+IHtcXG5cXHRcXHRcXHRyZXR1cm4gYHZhciAke2lucHV0Lm5hbWV9ID0gJHt0eXBlV3JhcHBlcihpbnB1dC50eXBlLCAncHJvbXB0KFxcXCInICsgaW5wdXQubGFiZWwgKyAnXFxcIiknKX07YDtcXG5cXHRcXHR9KTtcXG5cXHR9XFxuXFxuXFx0ZnVuY3Rpb24gY3JlYXRlUHl0aG9uSW5wdXRzQ29kZShpbnB1dHMpIHtcXG5cXHRcXHQvLyB3cmFwIGNtZCBpbiB0eXBlIGNvbnZlcnRlciwgaWYgdGhlcmUgaXMgdHlwZSBhbmQgaXQncyBub3Qgc3RyaW5nIChzdGlybiBpcyBkZWZ1YWx0KVxcblxcdFxcdGZ1bmN0aW9uIHR5cGVXcmFwcGVyKGlucHV0VHlwZSwgY21kKSB7XFxuXFx0XFx0XFx0aWYgKGlucHV0VHlwZSAhPSBudWxsICYmIGlucHV0VHlwZSAhPT0gSW5wdXRUeXBlLlNUUklORykge1xcblxcdFxcdFxcdFxcdGlmIChpbnB1dFR5cGUgPT09IElucHV0VHlwZS5CT09MRUFOKSB7XFxuXFx0XFx0XFx0XFx0XFx0cmV0dXJuIGBib29sKCR7Y21kfSlgO1xcblxcdFxcdFxcdFxcdH0gZWxzZSBpZiAoaW5wdXRUeXBlID09PSBJbnB1dFR5cGUuRkxPQVQpIHtcXG5cXHRcXHRcXHRcXHRcXHRyZXR1cm4gYGZsb2F0KCR7Y21kfSlgO1xcblxcdFxcdFxcdFxcdH0gZWxzZSBpZiAoaW5wdXRUeXBlID09PSBJbnB1dFR5cGUuSU5URUdFUikge1xcblxcdFxcdFxcdFxcdFxcdHJldHVybiBgaW50KCR7Y21kfSlgO1xcblxcdFxcdFxcdFxcdH1cXG5cXHRcXHRcXHRcXHQvLyBubyB0eXBpbmcsIHJldHVybiBvcmlnaW5hbCB2YWx1ZVxcblxcdFxcdFxcdH0gZWxzZSB7XFxuXFx0XFx0XFx0XFx0cmV0dXJuIGNtZDtcXG5cXHRcXHRcXHR9XFxuXFx0XFx0fVxcblxcblxcdFxcdHJldHVybiAoaW5wdXRzIHx8IFtdKS5tYXAoKGlucHV0KSA9PiB7XFxuXFx0XFx0XFx0cmV0dXJuIGAke2lucHV0Lm5hbWV9ID0gJHt0eXBlV3JhcHBlcihpbnB1dC50eXBlLCAnaW5wdXQoXFxcIicgKyBpbnB1dC5sYWJlbCArICdcXFwiKScpfWA7XFxuXFx0XFx0fSk7XFxuXFx0fVxcblxcblxcdC8vIC0tLS0tLS0tLS0gRWRpdG9yXFxuXFxuXFx0ZnVuY3Rpb24gY3JlYXRlRWRpdG9yKHRhc2spIHtcXG5cXHRcXHRpZiAodGFzay5wYXJhbXMucmVwbFR5cGUgPT09IFJlcGxUeXBlLkpBVkFTQ1JJUFQpIHtcXG5cXHRcXHRcXHRjb25zdCB0YXNrQ29kZSA9IGNyZWF0ZUluaXRpYWxUYXNrQ29kZSh0YXNrKTtcXG5cXHRcXHRcXHRyZXR1cm4gY3JlYXRlQ29kZUVkaXRvcihcXG5cXHRcXHRcXHRcXHR0YXNrLnBhcmFtcy5pZCxcXG5cXHRcXHRcXHRcXHR0YXNrLnBhcmFtcy5yZXBsVHlwZSxcXG5cXHRcXHRcXHRcXHR0YXNrQ29kZS5jb2RlLFxcblxcdFxcdFxcdFxcdHRhc2tDb2RlLmlucHV0cyxcXG5cXHRcXHRcXHQpO1xcblxcdFxcdH0gZWxzZSBpZiAodGFzay5wYXJhbXMucmVwbFR5cGUgPT09IFJlcGxUeXBlLlBZVEhPTikge1xcblxcdFxcdFxcdGNvbnN0IHRhc2tDb2RlID0gY3JlYXRlSW5pdGlhbFRhc2tDb2RlKHRhc2spO1xcblxcdFxcdFxcdHJldHVybiBjcmVhdGVDb2RlRWRpdG9yKFxcblxcdFxcdFxcdFxcdHRhc2sucGFyYW1zLmlkLFxcblxcdFxcdFxcdFxcdHRhc2sucGFyYW1zLnJlcGxUeXBlLFxcblxcdFxcdFxcdFxcdHRhc2tDb2RlLmNvZGUsXFxuXFx0XFx0XFx0XFx0dGFza0NvZGUuaW5wdXRzLFxcblxcdFxcdFxcdCk7XFxuXFx0XFx0fSBlbHNlIGlmICh0YXNrLnBhcmFtcy5yZXBsVHlwZSA9PT0gUmVwbFR5cGUuQkxPQ0tMWSkge1xcblxcdFxcdFxcdHJldHVybiBjcmVhdGVCbG9ja2x5RWRpdG9yKFxcblxcdFxcdFxcdFxcdHRhc2sucGFyYW1zLmlkLFxcblxcdFxcdFxcdFxcdHRhc2sucGFyYW1zLnRvb2xib3gsXFxuXFx0XFx0XFx0XFx0dGFzay5wYXJhbXMud29ya3NwYWNlXFxuXFx0XFx0XFx0KTtcXG5cXHRcXHR9IGVsc2Uge1xcblxcdFxcdFxcdHRocm93ICdFcnJvciBjcmVhdGluZyBlZGl0b3IuIFVua25vd24gUkVQTCB0eXBlOiAnICsgdGFzay5wYXJhbXMucmVwbFR5cGU7XFxuXFx0XFx0fVxcblxcdH1cXG5cXG5cXHRmdW5jdGlvbiByZXNldEVkaXRvcihpZCkge1xcblxcdFxcdGNvbnN0IHRhc2sgPSBnZXRUYXNrKGlkKTtcXG5cXG5cXHRcXHRpZiAodGFzay5wYXJhbXMucmVwbFR5cGUgPT09IFJlcGxUeXBlLkpBVkFTQ1JJUFQpIHtcXG5cXHRcXHRcXHRjb25zdCB0YXNrQ29kZSA9IGNyZWF0ZUluaXRpYWxUYXNrQ29kZSh0YXNrKTtcXG5cXHRcXHRcXHRyZXR1cm4gcmVzZXRDb2RlRWRpdG9yKFxcblxcdFxcdFxcdFxcdHRhc2suZWRpdG9yLFxcblxcdFxcdFxcdFxcdHRhc2tDb2RlLmNvZGUsXFxuXFx0XFx0XFx0XFx0dGFza0NvZGUuaW5wdXRzLFxcblxcdFxcdFxcdCk7XFxuXFx0XFx0fSBlbHNlIGlmICh0YXNrLnBhcmFtcy5yZXBsVHlwZSA9PT0gUmVwbFR5cGUuUFlUSE9OKSB7XFxuXFx0XFx0XFx0Y29uc3QgdGFza0NvZGUgPSBjcmVhdGVJbml0aWFsVGFza0NvZGUodGFzayk7XFxuXFx0XFx0XFx0cmV0dXJuIHJlc2V0Q29kZUVkaXRvcihcXG5cXHRcXHRcXHRcXHR0YXNrLmVkaXRvcixcXG5cXHRcXHRcXHRcXHR0YXNrQ29kZS5jb2RlLFxcblxcdFxcdFxcdFxcdHRhc2tDb2RlLmlucHV0cyxcXG5cXHRcXHRcXHQpO1xcblxcdFxcdH0gZWxzZSBpZiAodGFzay5wYXJhbXMucmVwbFR5cGUgPT09IFJlcGxUeXBlLkJMT0NLTFkpIHtcXG5cXHRcXHRcXHRyZXR1cm4gcmVzZXRCbG9ja2x5RWRpdG9yKHRhc2suZWRpdG9yLCB0YXNrLnBhcmFtcy50b29sYm94LCB0YXNrLnBhcmFtcy53b3Jrc3BhY2UpO1xcblxcdFxcdH0gZWxzZSB7XFxuXFx0XFx0XFx0dGhyb3cgJ0Vycm9yIGNyZWF0aW5nIGVkaXRvci4gVW5rbm93biBSRVBMIHR5cGU6ICcgKyB0YXNrLnBhcmFtcy5yZXBsVHlwZTtcXG5cXHRcXHR9XFxuXFx0fVxcblxcblxcdC8vIC0tIENvZGUgZWRpdG9yXFxuXFxuXFx0ZnVuY3Rpb24gY3JlYXRlQ29kZUVkaXRvcihpZCwgdHlwZSwgY29kZSwgaW5wdXRzKSB7XFxuXFx0XFx0dmFyIG9wdGlvbnMgPSB7XFxuXFx0XFx0XFx0bGluZU51bWJlcnM6IHRydWUsXFxuXFx0XFx0XFx0bW9kZTogdHlwZSxcXG5cXHRcXHR9O1xcblxcdFxcdGlmIChvcHRpb25zLm1vZGUgPT09IFJlcGxUeXBlLkpBVkFTQ1JJUFQpIHtcXG5cXHRcXHRcXHRvcHRpb25zLmd1dHRlcnMgPSBbXFxcIkNvZGVNaXJyb3ItbGludC1tYXJrZXJzXFxcIl07XFxuXFx0XFx0XFx0Ly9vcHRpb25zLmxpbnQgPSB0cnVlO1xcblxcdFxcdFxcdG9wdGlvbnMubGludCA9IExJTlRfT1BUSU9OUztcXG5cXHRcXHR9XFxuXFxuXFx0XFx0Y29uc3QgZWRpdG9yID0gQ29kZU1pcnJvcihkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcXFwiZWRpdG9yLVxcXCIgKyBpZCksIG9wdGlvbnMpO1xcblxcblxcdFxcdHJlc2V0Q29kZUVkaXRvcihlZGl0b3IsIGNvZGUsIGlucHV0cyk7XFxuXFxuXFx0XFx0cmV0dXJuIGVkaXRvcjtcXG5cXHR9O1xcblxcblxcdGZ1bmN0aW9uIHJlc2V0Q29kZUVkaXRvcihlZGl0b3IsIGNvZGUsIGlucHV0cykge1xcblxcdFxcdC8vIHJlc3QgZWRpdG9yXFxuXFx0XFx0ZWRpdG9yLnNldFZhbHVlKCcnKTtcXG5cXHRcXHRlZGl0b3IuY2xlYXJIaXN0b3J5KCk7XFxuXFxuXFx0XFx0Ly8gc2V0IG5ldyB2YWx1ZVxcblxcdFxcdGVkaXRvci5zZXRWYWx1ZShbXFxuXFx0XFx0XFx0Ly8gYWRkIGdlbmVyYXRlZCBpbnB1dHMgYmVmb3JlIGluaXRpYWwgY29kZVxcblxcdFxcdFxcdC4uLmlucHV0cyxcXG5cXHRcXHRcXHQvLyBhZGQgaW5pdGlhbCBjb2RlXFxuXFx0XFx0XFx0Li4uY29kZVxcblxcdFxcdF0uam9pbignXFxcXG4nKVxcblxcdFxcdCk7XFxuXFxuXFx0XFx0Ly8gZGlzYWJsZSBlZGl0aW5nIG9mIGdlbmVyYXRlZCBpbnB1dHMgbGluZXNcXG5cXHRcXHRpZiAoaW5wdXRzICYmIGlucHV0cy5sZW5ndGggPiAwKSB7XFxuXFx0XFx0XFx0ZWRpdG9yLm1hcmtUZXh0KHsgbGluZTogMCwgY2g6IDAgfSwgeyBsaW5lOiBpbnB1dHMubGVuZ3RoLCBjaDogMCB9LCB7IHJlYWRPbmx5OiB0cnVlLCBjc3M6ICdvcGFjaXR5OiAwLjQ7JyB9KTtcXG5cXHRcXHR9XFxuXFx0fVxcblxcblxcblxcdC8vIC0tIEJsb2NrbHkgZWRpdG9yXFxuXFxuXFx0Ly8gVE9ETzogc29sdmUgaGFyZGNvZGVkIG1lZGlhIHBhdGggZm9yIEJsb2NrbHlcXG5cXHRmdW5jdGlvbiBjcmVhdGVCbG9ja2x5RWRpdG9yKGlkLCB0b29sYm94LCB3b3Jrc3BhY2UpIHtcXG5cXHRcXHRyZXR1cm4gQmxvY2tseS5pbmplY3QoXFxcImVkaXRvci1cXFwiICsgaWQsIHtcXG5cXHRcXHRcXHRtZWRpYTogXFxcIi4uL2V4cGxhaW4vc3RhdGljL3ByZXZpZXcvMS4xL2pzL3ZlbmRvci9ibG9ja2x5L21lZGlhL1xcXCIsXFxuXFx0XFx0XFx0c291bmRzOiBmYWxzZSxcXG5cXHRcXHRcXHR0b29sYm94OiB0b29sYm94LFxcblxcdFxcdFxcdHRyYXNoY2FuOiB0cnVlXFxuXFx0XFx0fSk7XFxuXFx0fTtcXG5cXG5cXHRmdW5jdGlvbiByZXNldEJsb2NrbHlFZGl0b3IoZWRpdG9yLCB0b29sYm94LCB3b3Jrc3BhY2UpIHtcXG5cXHRcXHRlZGl0b3Iuc2V0VmFsdWUoJycpO1xcblxcdFxcdC8vIFRPRE86IGNoZWNrIHJlc2V0dGluZyBibG9ja2x5IGVkaXRvclxcblxcdH1cXG5cXG5cXG5cXG5cXHQvLyAtLS0tLS0tLS0tIHB1YmxpYyBmdW5jdGlvbnNcXG5cXG5cXHR2YXIgaW5pdCA9IGZ1bmN0aW9uIChxdWVzdGlvbklkLCByZXBsVHlwZSwgaW5wdXRzLCBhbnN3ZXJUZXh0LCBhbnN3ZXJUeXBlLCByZXBsQ29kZSwgYmxvY2tseVRvb2xib3gsIGJsb2NrbHlXb3Jrc3BhY2UpIHtcXG5cXHRcXHR0cnkge1xcblxcdFxcdFxcdHZhciB0YXNrID0ge307XFxuXFx0XFx0XFx0dGFzay5wYXJhbXMgPSB7fTtcXG5cXHRcXHRcXHR0YXNrLnBhcmFtcy5pZCA9IHF1ZXN0aW9uSWQ7XFxuXFx0XFx0XFx0dGFzay5wYXJhbXMucmVwbFR5cGUgPSByZXBsVHlwZTtcXG5cXHRcXHRcXHR0YXNrLnBhcmFtcy5pbnB1dHMgPSBlbnN1cmVBcnJDb250ZW50KGlucHV0cyk7IC8vIHRoZXJlIGlzIGEgYnVnIHRoYXQgcmVuZGVycyBvbGQgcXVlc3Rpb25zIGFzIFxcXCJudWxsXFxcIiAoc3RyaW5nKVxcblxcdFxcdFxcdHRhc2sucGFyYW1zLmFuc3dlclRleHQgPSBlbnN1cmVBcnJDb250ZW50KGFuc3dlclRleHQpO1xcblxcdFxcdFxcdHRhc2sucGFyYW1zLmFuc3dlclR5cGUgPSBpc0VtcHR5VmFsdWUoYW5zd2VyVHlwZSkgPyBBbnN3ZXJUeXBlcy5TVEFUSUMgOiBhbnN3ZXJUeXBlOyAvLyBvbGQgcXVlc3Rpb25zIGRvbid0IGhhdmUgYW5zd2VyIHR5cGVcXG5cXHRcXHRcXHR0YXNrLnBhcmFtcy5jb2RlID0gZW5zdXJlQXJyQ29udGVudChyZXBsQ29kZSk7XFxuXFx0XFx0XFx0dGFzay5wYXJhbXMudG9vbGJveCA9IGJsb2NrbHlUb29sYm94O1xcblxcdFxcdFxcdHRhc2sucGFyYW1zLndvcmtzcGFjZSA9IGJsb2NrbHlXb3Jrc3BhY2U7XFxuXFxuXFx0XFx0XFx0dGFzay5lZGl0b3IgPSBjcmVhdGVFZGl0b3IodGFzayk7XFxuXFxuXFx0XFx0XFx0Y29uZmlndXJlVWkodGFzayk7XFxuXFxuXFx0XFx0XFx0dGFza3NbdGFzay5wYXJhbXMuaWRdID0gdGFzaztcXG5cXHRcXHR9IGNhdGNoIChlcnIpIHtcXG5cXHRcXHRcXHRjb25zb2xlLmVycm9yKCdFcnJvciBpbml0aWFsaXppbmcgdGFzayAnICsgcXVlc3Rpb25JZCwgZXJyKTtcXG5cXHRcXHR9XFxuXFx0fTtcXG5cXG5cXHR2YXIgcnVuID0gZnVuY3Rpb24gKGlkKSB7XFxuXFx0XFx0dHJ5IHtcXG5cXHRcXHRcXHRsZXQgdGFzayA9IGdldFRhc2soaWQpO1xcblxcblxcdFxcdFxcdGxldCBjb2RlID0gZ2V0VGFza0NvZGUodGFzayk7XFxuXFxuXFx0XFx0XFx0dGFzay5sYXN0UmVjb3JkZWRJbnB1dExvb2t1cCA9IFtdO1xcblxcdFxcdFxcdFByb21pc2UucmVzb2x2ZSh0cnVlKVxcblxcdFxcdFxcdFxcdC50aGVuKCgpID0+IHtcXG5cXHRcXHRcXHRcXHRcXHRjbGVhck91dHB1dCh0YXNrLnBhcmFtcy5pZCk7XFxuXFx0XFx0XFx0XFx0XFx0d3JpdGVSZXBsQ29uc29sZU91dHB1dE1hcmtlcih0YXNrLnBhcmFtcy5pZCwgXFxcIltwb2NldGFrIHByb2dyYW1hXVxcXCIpO1xcblxcdFxcdFxcdFxcdH0pXFxuXFx0XFx0XFx0XFx0LnRoZW4oKCkgPT4ge1xcblxcdFxcdFxcdFxcdFxcdHJldHVybiBydW5JbnRlcnByZXRlcih0YXNrLnBhcmFtcy5yZXBsVHlwZSwgY29kZSwge1xcblxcdFxcdFxcdFxcdFxcdFxcdG91dHB1dFdyaXRlcjogY3JlYXRlQ2FsbGJhY2tPdXRwdXRXcml0ZXIoKHRleHQpID0+IHdyaXRlUmVwbENvbnNvbGVUZXh0KHRhc2sucGFyYW1zLmlkLCB0ZXh0KSksXFxuXFx0XFx0XFx0XFx0XFx0XFx0aW5wdXRSZWFkZXI6IGNyZWF0ZVF1ZXVlTG9va3VwUmVjb3JkZXJJbnB1dFJlYWRlcihjcmVhdGVJbmxpbmVJbnB1dFJlYWRlcih0YXNrLnBhcmFtcy5pZCksIHRhc2subGFzdFJlY29yZGVkSW5wdXRMb29rdXApLFxcblxcdFxcdFxcdFxcdFxcdH0pO1xcblxcdFxcdFxcdFxcdH0pXFxuXFx0XFx0XFx0XFx0LmNhdGNoKChlcnIpID0+IHtcXG5cXHRcXHRcXHRcXHRcXHR3cml0ZVJlcGxDb25zb2xlVGV4dCh0YXNrLnBhcmFtcy5pZCwgZXJyLnRvU3RyaW5nKCkpO1xcblxcdFxcdFxcdFxcdFxcdGNvbnNvbGUuZXJyb3IoJ0Vycm9yIHJ1bm5pbmcgY29kZSBvbiB0YXNrICcgKyB0YXNrLnBhcmFtcy5pZCwgZXJyKTtcXG5cXHRcXHRcXHRcXHR9KVxcblxcdFxcdFxcdFxcdC5maW5hbGx5KCgpID0+IHtcXG5cXHRcXHRcXHRcXHRcXHR3cml0ZVJlcGxDb25zb2xlT3V0cHV0TWFya2VyKHRhc2sucGFyYW1zLmlkLCBcXFwiW2tyYWogcHJvZ3JhbWFdXFxcIik7XFxuXFx0XFx0XFx0XFx0fSk7XFxuXFx0XFx0fSBjYXRjaCAoZXJyKSB7XFxuXFx0XFx0XFx0Y29uc29sZS5lcnJvcignRXJyb3IgcnVubmluZyB0YXNrICcgKyBpZCwgZXJyKTtcXG5cXHRcXHR9XFxuXFx0fTtcXG5cXG5cXHR2YXIgY2hlY2sgPSBmdW5jdGlvbiAoaWQpIHtcXG5cXHRcXHR0cnkge1xcblxcdFxcdFxcdHZhciB0YXNrID0gZ2V0VGFzayhpZCk7XFxuXFxuXFx0XFx0XFx0Y2xlYXJSZXN1bHRTdGF0dXMoaWQpO1xcblxcblxcdFxcdFxcdHZhciByZXN1bHRPdXRwdXQgPSBnZXRUYXNrUmVzdWx0KHRhc2sucGFyYW1zLmlkKTtcXG5cXHRcXHRcXHRsZXQgcmVmZXJlbmNlQ29kZSA9IGdldFRhc2tSZWZlcmVuY2VDb2RlKHRhc2spO1xcblxcblxcdFxcdFxcdGNvbnN0IHJlZmVyZW5jZU91dHB1dEJ1ZmZlciA9IFtdO1xcblxcdFxcdFxcdC8vIGV2YWx1YXRlZCAtIG91dHB1dCBjb21hcHJhZWQgYWdhaW5zdCBldmFsdWF0ZWQgcmVmZXJlbmNlIGNvZGVcXG5cXHRcXHRcXHRpZiAodGFzay5wYXJhbXMuYW5zd2VyVHlwZSA9PT0gQW5zd2VyVHlwZXMuRVZBTFVBVEVEKSB7XFxuXFx0XFx0XFx0XFx0cnVuSW50ZXJwcmV0ZXIodGFzay5wYXJhbXMucmVwbFR5cGUsIHJlZmVyZW5jZUNvZGUsIHtcXG5cXHRcXHRcXHRcXHRcXHRvdXRwdXRXcml0ZXI6IGNyZWF0ZUJ1ZmZlcmVkT3V0cHV0V3JpdGVyKHJlZmVyZW5jZU91dHB1dEJ1ZmZlciksXFxuXFx0XFx0XFx0XFx0XFx0aW5wdXRSZWFkZXI6IGNyZWF0ZVF1ZXVlTG9va3VwSW5wdXRSZWFkZXIodGFzay5sYXN0UmVjb3JkZWRJbnB1dExvb2t1cCksXFxuXFx0XFx0XFx0XFx0fSlcXG5cXHRcXHRcXHRcXHRcXHQudGhlbigoKSA9PiB7XFxuXFx0XFx0XFx0XFx0XFx0XFx0Y29tcGFyZVJlc3VsdHMocmVzdWx0T3V0cHV0LCByZWZlcmVuY2VPdXRwdXRCdWZmZXIpO1xcblxcdFxcdFxcdFxcdFxcdH0pXFxuXFx0XFx0XFx0XFx0XFx0LmNhdGNoKChlcnIpID0+IHtcXG5cXHRcXHRcXHRcXHRcXHRcXHRjb25zb2xlLmVycm9yKCdFcnJvciBydW5uaW5nIHJlZmVyZW5jZSBjb2RlIG9uIHRhc2sgJyArIHRhc2sucGFyYW1zLmlkLCBlcnIpO1xcblxcdFxcdFxcdFxcdFxcdH0pO1xcblxcdFxcdFxcdFxcdC8vIHN0YXRpYyAtIG91dHB1dCBjb21wYXJlZCB3aXRoIHN0YXRpYyBhbnN3ZXJcXG5cXHRcXHRcXHR9IGVsc2UgaWYgKHRhc2sucGFyYW1zLmFuc3dlclR5cGUgPT09IEFuc3dlclR5cGVzLlNUQVRJQykge1xcblxcdFxcdFxcdFxcdGNvbXBhcmVSZXN1bHRzKHJlc3VsdE91dHB1dCwgdGFzay5wYXJhbXMuYW5zd2VyVGV4dCk7XFxuXFx0XFx0XFx0XFx0Ly8gaWdub3JlZCAtIG5vIGNoZWNrLCBhbnN3ZXIgaXMgaWdub3JlZFxcblxcdFxcdFxcdH0gZWxzZSBpZiAodGFzay5wYXJhbXMuYW5zd2VyVHlwZSA9PT0gQW5zd2VyVHlwZXMuSUdOT1JFRCkge1xcblxcdFxcdFxcdFxcdC8vIGlnbm9yZSBhbnN3ZXIgY2hlY2sgLSB0aGlzIHByb2JhYmx5IHNob3VsZG4ndCBoYXZlIGV2ZW4gYmVlbiBjYWxsZWRcXG5cXHRcXHRcXHRcXHRyZXR1cm47XFxuXFx0XFx0XFx0XFx0Ly8gdW5rbm93biBhbnN3ZXIgdHlwZVxcblxcdFxcdFxcdH0gZWxzZSB7XFxuXFx0XFx0XFx0XFx0Y29uc29sZS5lcnJvcihgVW5rbm93biBhbnN3ZXIgdHlwZSBcXFwiJHt0YXNrLnBhcmFtcy5hbnN3ZXJUeXBlfVxcXCIgaW4gdGFzayBcXFwiJHt0YXNrLnBhcmFtcy5pZH1cXFwiYCk7XFxuXFx0XFx0XFx0fVxcblxcblxcdFxcdFxcdGZ1bmN0aW9uIGNvbXBhcmVSZXN1bHRzKHJlc3VsdE91dHB1dCwgcmVmZXJlbmNlT3V0cHV0KSB7XFxuXFx0XFx0XFx0XFx0dmFyIGFuc3dlckNvcnJlY3Q7XFxuXFx0XFx0XFx0XFx0aWYgKHJlZmVyZW5jZU91dHB1dC5sZW5ndGggPT09IHJlc3VsdE91dHB1dC5sZW5ndGgpIHsgLy8gbnVtYmVyIG9mIGxpbmVzIG11c3QgbWF0Y2hcXG5cXHRcXHRcXHRcXHRcXHRhbnN3ZXJDb3JyZWN0ID0gdHJ1ZTtcXG5cXHRcXHRcXHRcXHRcXHRmb3IgKHZhciBpID0gMDsgYW5zd2VyQ29ycmVjdCAmJiBpIDwgcmVzdWx0T3V0cHV0Lmxlbmd0aDsgaSsrKSB7IC8vIGVhY2ggbGluZSBtdXN0IGJlIGV4YWN0IGFzIHRoZSBvbmVzIHByb3ZpZGVkIGJ5IGFuc3dlclxcblxcdFxcdFxcdFxcdFxcdFxcdGFuc3dlckNvcnJlY3QgPSByZXN1bHRPdXRwdXRbaV0gPT09IHJlZmVyZW5jZU91dHB1dFtpXTtcXG5cXHRcXHRcXHRcXHRcXHR9XFxuXFx0XFx0XFx0XFx0fSBlbHNlIHtcXG5cXHRcXHRcXHRcXHRcXHRhbnN3ZXJDb3JyZWN0ID0gZmFsc2U7XFxuXFx0XFx0XFx0XFx0fVxcblxcdFxcdFxcdFxcdGlmIChhbnN3ZXJDb3JyZWN0KSB7XFxuXFx0XFx0XFx0XFx0XFx0c2V0UmVzdWx0U3RhdHVzKHRhc2sucGFyYW1zLmlkLCBcXFwic3VjY2Vzc1xcXCIpO1xcblxcdFxcdFxcdFxcdFxcdGlmICh3aW5BdWRpbykge1xcblxcdFxcdFxcdFxcdFxcdFxcdHdpbkF1ZGlvLnBsYXkoKTtcXG5cXHRcXHRcXHRcXHRcXHR9XFxuXFx0XFx0XFx0XFx0fSBlbHNlIHtcXG5cXHRcXHRcXHRcXHRcXHRzZXRSZXN1bHRTdGF0dXModGFzay5wYXJhbXMuaWQsIFxcXCJkYW5nZXJcXFwiKTtcXG5cXHRcXHRcXHRcXHRcXHRpZiAobG9zZUF1ZGlvKSB7XFxuXFx0XFx0XFx0XFx0XFx0XFx0bG9zZUF1ZGlvLnBsYXkoKTtcXG5cXHRcXHRcXHRcXHRcXHR9XFxuXFx0XFx0XFx0XFx0fVxcblxcdFxcdFxcdH1cXG5cXHRcXHR9IGNhdGNoIChlcnIpIHtcXG5cXHRcXHRcXHRjb25zb2xlLmVycm9yKCdFcnJvciBjaGVja2luZyB0YXNrICcgKyBpZCwgZXJyKTtcXG5cXHRcXHR9XFxuXFx0fTtcXG5cXG5cXHR2YXIgcmVzZXQgPSBmdW5jdGlvbiAoaWQpIHtcXG5cXHRcXHR0cnkge1xcblxcdFxcdFxcdHZhciB0YXNrID0gZ2V0VGFzayhpZCwgZmFsc2UpO1xcblxcdFxcdFxcdGlmICh0YXNrID09IG51bGwpIHtcXG5cXHRcXHRcXHRcXHRyZXR1cm47XFxuXFx0XFx0XFx0fVxcblxcblxcdFxcdFxcdHJlc2V0RWRpdG9yKHRhc2sucGFyYW1zLmlkKTtcXG5cXHRcXHRcXHRjbGVhck91dHB1dCh0YXNrLnBhcmFtcy5pZCk7XFxuXFx0XFx0fSBjYXRjaCAoZXJyKSB7XFxuXFx0XFx0XFx0Y29uc29sZS5lcnJvcignRXJyb3IgcmVzZXR0aW5nIHRhc2sgJyArIGlkLCBlcnIpO1xcblxcdFxcdH1cXG5cXHR9O1xcblxcblxcdC8vIGV4cG9zaW5nIHB1YmxpYyBtZXRob2RzXFxuXFxuXFx0cmV0dXJuIHtcXG5cXHRcXHRpbml0OiBpbml0LFxcblxcdFxcdHJ1bjogcnVuLFxcblxcdFxcdGNoZWNrOiBjaGVjayxcXG5cXHRcXHRyZXNldDogcmVzZXQsXFxuXFx0XFx0dGFza3M6IHRhc2tzIC8vIHRlbXAgd2hpbGUgZGV2ZWxvcFxcblxcdH07XFxufSkoKTtcXG5cXG5jb25zdCByZXNldEFsbFF1ZXN0aW9uc09uUGFnZSA9ICgpID0+IHtcXG5cXHRjb25zdCBxdWVzdGlvbnMgPSAkKFxcXCJkaXZbaWQqPSdxdWVzdGlvbklkJ11bZGF0YS1xdWVzdGlvbi10eXBlXVxcXCIpLnRvQXJyYXkoKTtcXG5cXHRxdWVzdGlvbnMuZm9yRWFjaCgocXVlc3Rpb24pID0+IHtcXG5cXHRcXHRyZXNldFF1aXpRdWVzdGlvbihxdWVzdGlvbi5pZCwgdHJ1ZSk7XFxuXFx0fSk7XFxufTtcXG5cXG5cXG5cXG5jb25zdCBxdWl6SW5pdCA9ICgpID0+IHtcXG5cXHRjb25zdCBxdWVzdGlvbnMgPSAkKFxcXCJkaXZbaWQqPSdxdWVzdGlvbklkJ11bZGF0YS1xdWVzdGlvbi10eXBlXVxcXCIpLnRvQXJyYXkoKTtcXG5cXHRxdWVzdGlvbnMuZm9yRWFjaCgocXVlc3Rpb24pID0+IHtcXG5cXHRcXHRpbml0RHJhZ1BhaXJzRWxlbWVudHMocXVlc3Rpb24uaWQpO1xcblxcdH0pO1xcblxcblxcblxcdHJlc2V0QWxsUXVlc3Rpb25zT25QYWdlKCk7XFxufTtcXG5cXG5xdWl6SW5pdCgpO1xcblxcbiQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uICgpIHtcXG5cXHRpbml0S2V5Ym9hcmREcmFnRHJvcCgpO1xcblxcdGluaXRBZGRpdGlvbmFsS2V5Ym9hcmROYXYoKTtcXG5cXG5cXHQkKCdpbnB1dDpjaGVja2JveCcpLm9uKCdjbGljaycsIGZ1bmN0aW9uIChldmVudCkge1xcblxcdFxcdGlmICghZG9jdW1lbnQuYWN0aXZlRWxlbWVudC5jaGVja2VkIHx8IChldmVudC50YXJnZXQgIT09ICQoZG9jdW1lbnQuYWN0aXZlRWxlbWVudClbMF0pKSB7XFxuXFx0XFx0XFx0JChkb2N1bWVudC5hY3RpdmVFbGVtZW50KVswXS5ibHVyKCk7XFxuXFx0XFx0fVxcblxcdH0pO1xcblxcblxcdGlmICh3aW5kb3cuTWF0aEpheCkge1xcblxcdFxcdE1hdGhKYXguSHViLlF1ZXVlKGZ1bmN0aW9uICgpIHtcXG5cXHRcXHRcXHQkLmVhY2goJCgnaW5wdXQubGVuZ3RoLXRpbnknKS5ub3QoXFxcImlucHV0W2lkKj1fcV1cXFwiKSwgZnVuY3Rpb24gKGluZGV4LCB2YWx1ZSkge1xcblxcdFxcdFxcdFxcdHZhbHVlLnRhYkluZGV4ID0gJy0xJztcXG5cXHRcXHRcXHR9KTtcXG5cXHRcXHR9KTtcXG5cXHR9XFxuXFxuXFx0JCgnLmNoZWNrUXVpekJ1dHRvbicpLm9uKCdjbGljaycsIGZ1bmN0aW9uIChldmVudCkge1xcblxcdFxcdGxldCB0YXNrSWQgPSAkKGV2ZW50LnRhcmdldCkuY2xvc2VzdChcXFwiZGl2W2lkKj0ndWVzdGlvbklkJ11bZGF0YS1xdWVzdGlvbi10eXBlXVxcXCIpLmF0dHIoJ2lkJyk7XFxuXFx0XFx0aWYgKCQoYCMke3Rhc2tJZH1gKS5maW5kKCcuY2FuLWRyb3AnKVswXSAmJiAkKGAjJHt0YXNrSWR9YCkuZmluZCgnLmNhbi1kcm9wJylbMF0uY2xhc3NMaXN0LmNvbnRhaW5zKCdjYW4tZHJvcCcpKSB7XFxuXFx0XFx0XFx0JChgIyR7dGFza0lkfWApLmZpbmQoJy5jYW4tZHJvcCcpWzBdLmNsYXNzTGlzdC5yZW1vdmUoJ2Nhbi1kcm9wJyk7XFxuXFx0XFx0fVxcblxcblxcdFxcdGlmICgkKGAjJHt0YXNrSWR9YCkuZmluZCgnLmNhbi1kcm9wLXN0eWxlJylbMF0gJiYgJChgIyR7dGFza0lkfWApLmZpbmQoJy5jYW4tZHJvcC1zdHlsZScpWzBdLmNsYXNzTGlzdC5jb250YWlucygnY2FuLWRyb3Atc3R5bGUnKSkge1xcblxcdFxcdFxcdCQoYCMke3Rhc2tJZH1gKS5maW5kKCcuY2FuLWRyb3Atc3R5bGUnKVswXS5jbGFzc0xpc3QucmVtb3ZlKCdjYW4tZHJvcC1zdHlsZScpO1xcblxcdFxcdH1cXG5cXHR9KTtcXG5cXG5cXHQkKCcucmVzZXRRdWl6QnV0dG9uJykub24oJ2tleXByZXNzJywgZnVuY3Rpb24gKGV2ZW50KSB7XFxuXFx0XFx0aWYgKGV2ZW50LmtleUNvZGUgPT09IDMyIHx8IGV2ZW50LmtleUNvZGUgPT09IDEzKSB7XFxuXFx0XFx0XFx0cmVzZXRRdWl6UXVlc3Rpb24oJChldmVudC50YXJnZXQpLmNsb3Nlc3QoXFxcImRpdltpZCo9J3Vlc3Rpb25JZCddW2RhdGEtcXVlc3Rpb24tdHlwZV1cXFwiKS5hdHRyKCdpZCcpKTtcXG5cXG5cXHRcXHRcXHRpZiAoJChldmVudC50YXJnZXQpLmNsb3Nlc3QoXFxcImRpdltpZCo9J3Vlc3Rpb25JZCddW2RhdGEtcXVlc3Rpb24tdHlwZV1cXFwiKS5hdHRyKCdkYXRhLXF1ZXN0aW9uLXR5cGUnKSAhPT0gJ0RhL05lJykge1xcblxcdFxcdFxcdFxcdCQoYCMkeyQoZXZlbnQudGFyZ2V0KS5jbG9zZXN0KFxcXCJkaXZbaWQqPSd1ZXN0aW9uSWQnXVtkYXRhLXF1ZXN0aW9uLXR5cGVdXFxcIikuYXR0cignaWQnKX1gKS5maW5kKFxcXCI6dGFiYmFibGVcXFwiKVswXS5mb2N1cygpO1xcblxcdFxcdFxcdH1cXG5cXHRcXHR9XFxuXFx0fSk7XFxuXFxuXFx0JChmdW5jdGlvbiAoKSB7XFxuXFx0XFx0JCgnKltkcmFnZ2FibGUhPXRydWVdJywgJy5zbGljay10cmFjaycpLnVuYmluZCgnZHJhZ3N0YXJ0Jyk7XFxuXFx0XFx0JChcXFwiLmRyYWdnYWJsZS1lbGVtZW50XFxcIikuZHJhZ2dhYmxlKCk7XFxuXFx0fSk7XFxufSk7XFxuXCIiLCIvLyBleHRyYWN0ZWQgYnkgbWluaS1jc3MtZXh0cmFjdC1wbHVnaW4iLCJyZXF1aXJlKFwiISEvdmFyL2xpYi9qZW5raW5zL3dvcmtzcGFjZS9hbGdlYnJhLWZyb250ZW5kLWludGVyYWN0aW9ucy10ZXN0L25vZGVfbW9kdWxlcy9zY3JpcHQtbG9hZGVyL2FkZFNjcmlwdC5qc1wiKShyZXF1aXJlKFwiISEvdmFyL2xpYi9qZW5raW5zL3dvcmtzcGFjZS9hbGdlYnJhLWZyb250ZW5kLWludGVyYWN0aW9ucy10ZXN0L25vZGVfbW9kdWxlcy9zY3JpcHQtbG9hZGVyL25vZGVfbW9kdWxlcy9yYXctbG9hZGVyL2luZGV4LmpzIS92YXIvbGliL2plbmtpbnMvd29ya3NwYWNlL2FsZ2VicmEtZnJvbnRlbmQtaW50ZXJhY3Rpb25zLXRlc3Qvc3JjL2NvbW1vbi90aXBrb3ZuaWNlL2tleWJvYXJkLmpzXCIpKSIsIm1vZHVsZS5leHBvcnRzID0gXCIkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpIHtcXG4gIGNvbnN0IGtleWJvYXJkQ29udGFpbmVycyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5rZXlib2FyZF9jb250YWluZXInKTtcXG5cXG4gIGlmIChrZXlib2FyZENvbnRhaW5lcnMgJiYga2V5Ym9hcmRDb250YWluZXJzLmxlbmd0aCA+IDApIHtcXG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBrZXlib2FyZENvbnRhaW5lcnMubGVuZ3RoOyBpKyspIHtcXG4gICAgICBjb25zdCBrZXlzSWQgPSBrZXlib2FyZENvbnRhaW5lcnNbaV0uZ2V0QXR0cmlidXRlKCdkYXRhLWtleS12YXInKTtcXG4gICAgICBjb25zdCBwYXJlbnRJZCA9IGtleXNJZC5zcGxpdCgna2V5c18nKTtcXG4gICAgICBiaW5kS2V5Ym9hcmQoa2V5Ym9hcmRDb250YWluZXJzW2ldLCBrZXlzSWQsIHBhcmVudElkWzFdKTtcXG4gICAgfVxcbiAgfVxcbn0pXFxuXFxuZnVuY3Rpb24gYmluZEtleWJvYXJkKGtleWJvYXJkQ29udGFpbmVyLCBrZXlzSWQsIHBhcmVudElkKSB7XFxuICBjb25zdCBrZXlzID0gd2luZG93W2tleXNJZF0gfHwgZXZhbChrZXlzSWQpO1xcbiAgY29uc3QgcGFyZW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQocGFyZW50SWQpO1xcbiAgY29uc3QgdG9nZ2xlQnV0dG9uID0ga2V5Ym9hcmRDb250YWluZXIucXVlcnlTZWxlY3RvcignLnRvZ2dsZV9idXR0b24nKTtcXG4gIGNvbnN0IGlucHV0cyA9IHBhcmVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgnaW5wdXQnKTtcXG5cXG4gIGNvbnN0IGNvbnRyb2xzQ29udGFpbmVyID0gcGFyZW50LmdldEVsZW1lbnRzQnlDbGFzc05hbWUoJ2Rvcy1wYXJ0LXF1ZXN0aW9uX19jb250cm9scycpWzBdO1xcbiAgY29uc3QgY29udGVudENvbnRhaW5lciA9IHBhcmVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKCdkb3MtcGFydC1xdWVzdGlvbl9fY29udGVudCcpWzBdO1xcblxcbiAgbGV0IGtleWJvYXJkID0ga2V5Ym9hcmRDb250YWluZXIucXVlcnlTZWxlY3RvcignLmtleWJvYXJkJyk7XFxuXFxuICBpZiAoIWtleWJvYXJkKSB7XFxuICAgIGNvbnN0IGtleWIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcXG4gICAga2V5Yi5jbGFzc0xpc3QuYWRkKCdrZXlib2FyZCcpO1xcblxcbiAgICBrZXlib2FyZENvbnRhaW5lci5hcHBlbmRDaGlsZChrZXliKTtcXG5cXG4gICAga2V5Ym9hcmQgPSBrZXliO1xcbiAgfVxcblxcbiAgLy9jb250cm9sc0NvbnRhaW5lci5wYXJlbnRFbGVtZW50Lmluc2VydEJlZm9yZShrZXlib2FyZENvbnRhaW5lciwgY29udHJvbHNDb250YWluZXIpO1xcbiAgJChrZXlib2FyZENvbnRhaW5lcikuaW5zZXJ0QWZ0ZXIoY29udGVudENvbnRhaW5lcilcXG5cXG4gIGZvciAodmFyIGkgPSAwOyBpIDwgaW5wdXRzLmxlbmd0aDsgaSsrKSB7XFxuICAgIGFkZEV2ZW50KGlucHV0c1tpXSwgJ2ZvY3VzJywgZnVuY3Rpb24gKCkge1xcbiAgICAgIGN1cnJlbnRJbnB1dCA9IHRoaXM7XFxuICAgICAgaWYgKCFrZXlib2FyZENvbnRhaW5lci5jbGFzc0xpc3QuY29udGFpbnMoJ29wZW4nKSkge1xcbiAgICAgICAga2V5Ym9hcmRDb250YWluZXIuY2xhc3NMaXN0LmFkZCgnb3BlbicpO1xcbiAgICAgIH1cXG4gICAgfSk7XFxuICB9XFxuICBpbnNlcnRBbGxCdXR0b25zKGtleWJvYXJkKTtcXG5cXG4gIGZ1bmN0aW9uIGluc2VydEFsbEJ1dHRvbnMoa2V5Ym9hcmQpIHtcXG4gICAgY29uc3QgY2xvc2VCdXR0b24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdidXR0b24nKTtcXG4gICAgY29uc3QgY2xvc2VCdXR0b25UZXh0ID0gZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoJ1gnKTtcXG5cXG4gICAgY2xvc2VCdXR0b24uY2xhc3NMaXN0LmFkZCgnY2xvc2Vfa2V5Ym9hcmQnKTtcXG4gICAgY2xvc2VCdXR0b24uYXBwZW5kKGNsb3NlQnV0dG9uVGV4dCk7XFxuICAgIGtleWJvYXJkLmFwcGVuZChjbG9zZUJ1dHRvbik7XFxuICAgIGFkZEV2ZW50KGNsb3NlQnV0dG9uLCAnY2xpY2snLCBmdW5jdGlvbiAoKSB7XFxuICAgICAga2V5Ym9hcmRDb250YWluZXIuY2xhc3NMaXN0LnJlbW92ZSgnb3BlbicpO1xcbiAgICB9KTtcXG5cXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBrZXlzLmxlbmd0aDsgaSsrKSB7XFxuICAgICAgY29uc3QgYnV0dG9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYnV0dG9uJyk7XFxuICAgICAgY29uc3QgYnV0dG9uVGV4dCA9IGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKGtleXNbaV0uY29kZSk7XFxuICAgICAgY29uc3QgYXR0cmlidXRlID0gZG9jdW1lbnQuY3JlYXRlQXR0cmlidXRlKCduYW1lJyk7XFxuXFxuICAgICAgYXR0cmlidXRlLnZhbHVlID0ga2V5c1tpXS5uYW1lO1xcbiAgICAgIGJ1dHRvbi52YWx1ZSA9IGtleXNbaV0uY29kZTtcXG4gICAgICBidXR0b24uc2V0QXR0cmlidXRlTm9kZShhdHRyaWJ1dGUpO1xcbiAgICAgIGJ1dHRvbi5hcHBlbmRDaGlsZChidXR0b25UZXh0KTtcXG5cXG4gICAgICBhZGRFdmVudChidXR0b24sICdjbGljaycsIGlucHV0Q2hhcik7XFxuXFxuICAgICAga2V5Ym9hcmQuYXBwZW5kQ2hpbGQoYnV0dG9uKTtcXG4gICAgfVxcbiAgfVxcbn1cXG5cXG5mdW5jdGlvbiBpbnB1dENoYXIoKSB7XFxuICBpZiAoY3VycmVudElucHV0KSB7XFxuICAgIGN1cnJlbnRJbnB1dC5mb2N1cygpO1xcbiAgICBjdXJyZW50SW5wdXQudmFsdWUgKz0gdGhpcy52YWx1ZTtcXG4gIH1cXG59XFxuXFxuZnVuY3Rpb24gYWRkRXZlbnQoZWxlbWVudCwgZXZlbnRUeXBlLCBmdW5jKSB7XFxuICBjb25zdCBvbkV2ZW50VHlwZSA9IGV2ZW50VHlwZS5yZXBsYWNlKC9eXFxcXHcvLCBmdW5jdGlvbiAoY2hhcikge1xcbiAgICByZXR1cm4gY2hhci50b1VwcGVyQ2FzZSgpO1xcbiAgfSk7XFxuXFxuICBpZiAoZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKSB7XFxuICAgIGVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihldmVudFR5cGUsIGZ1bmMpO1xcbiAgfSBlbHNlIGlmIChlbGVtZW50LmF0dGFjaEV2ZW50KSB7XFxuICAgIGVsZW1lbnQuYXR0YWNoRXZlbnQoJ29uJyArIG9uRXZlbnRUeXBlLCBmdW5jKTtcXG4gIH0gZWxzZSB7XFxuICAgIGVsZW1lbnRbJ29uJyArIG9uRXZlbnRUeXBlXSA9IGZ1bmM7XFxuICB9XFxufVwiIiwiLy8gZXh0cmFjdGVkIGJ5IG1pbmktY3NzLWV4dHJhY3QtcGx1Z2luIiwicmVxdWlyZShcIiEhL3Zhci9saWIvamVua2lucy93b3Jrc3BhY2UvYWxnZWJyYS1mcm9udGVuZC1pbnRlcmFjdGlvbnMtdGVzdC9ub2RlX21vZHVsZXMvc2NyaXB0LWxvYWRlci9hZGRTY3JpcHQuanNcIikocmVxdWlyZShcIiEhL3Zhci9saWIvamVua2lucy93b3Jrc3BhY2UvYWxnZWJyYS1mcm9udGVuZC1pbnRlcmFjdGlvbnMtdGVzdC9ub2RlX21vZHVsZXMvc2NyaXB0LWxvYWRlci9ub2RlX21vZHVsZXMvcmF3LWxvYWRlci9pbmRleC5qcyEvdmFyL2xpYi9qZW5raW5zL3dvcmtzcGFjZS9hbGdlYnJhLWZyb250ZW5kLWludGVyYWN0aW9ucy10ZXN0L3NyYy9jb21tb24vbWVtb3J5L21lbW9yeS5qc1wiKSkiLCJtb2R1bGUuZXhwb3J0cyA9IFwiY29uc3QgZ2FtZXMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFxcXCIubWVtb3J5XFxcIik7XFxuXFxuZm9yICh2YXIgaSA9IDA7IGkgPCBnYW1lcy5sZW5ndGg7IGkrKykge1xcbiAgbWVtb3J5R2FtZShnYW1lc1tpXSk7XFxufVxcblxcbmZ1bmN0aW9uIG1lbW9yeUdhbWUoZ2FtZSkge1xcbiAgY29uc3QgY2FyZHMgPSBnYW1lLnF1ZXJ5U2VsZWN0b3JBbGwoXFxcIi5jYXJkLWhvbGRlclxcXCIpO1xcbiAgY29uc3QgcG9pbnRzVG9XaW4gPSBjYXJkcy5sZW5ndGggLyAyO1xcbiAgY29uc3QgdG9vbHRpcCA9IGdhbWUucXVlcnlTZWxlY3RvcihcXFwiLm1lbW9yeS10b29sdGlwXFxcIik7XFxuXFxuICBsZXQgbW92ZUNvdW50ZXIgPSAwO1xcbiAgbGV0IHBvaW50cyA9IDA7XFxuICBsZXQgaGFzRmxpcHBlZENhcmQgPSBmYWxzZTtcXG4gIGxldCBsb2NrQm9hcmQgPSBmYWxzZTtcXG4gIGxldCBmaXJzdENhcmQsIHNlY29uZENhcmQ7XFxuXFxuICB0b29sdGlwLmlubmVyVGV4dCA9IFxcXCJCcm9qIHBvdGV6YTogXFxcIiArIG1vdmVDb3VudGVyO1xcblxcbiAgZm9yICh2YXIgaSA9IDA7IGkgPCBjYXJkcy5sZW5ndGg7IGkrKykge1xcbiAgICBjb25zdCByYW5kb21Qb3MgPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiBjYXJkcy5sZW5ndGgpO1xcbiAgICBjYXJkc1tpXS5zdHlsZS5vcmRlciA9IHJhbmRvbVBvcztcXG4gICAgYWRkRXZlbnQoY2FyZHNbaV0pO1xcbiAgfVxcblxcbiAgZnVuY3Rpb24gYWRkRXZlbnQoZWxlbWVudCkge1xcbiAgICBpZiAoZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKSB7XFxuICAgICAgZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFxcXCJjbGlja1xcXCIsIGZsaXBDYXJkKTtcXG4gICAgfSBlbHNlIGlmIChlbGVtZW50LmF0dGFjaEV2ZW50KSB7XFxuICAgICAgZWxlbWVudC5hdHRhY2hFdmVudChcXFwib25DbGlja1xcXCIsIGZsaXBDYXJkKTtcXG4gICAgfSBlbHNlIHtcXG4gICAgICBlbGVtZW50W1xcXCJvbkNsaWNrXFxcIl0gPSBmbGlwQ2FyZDtcXG4gICAgfVxcbiAgfVxcblxcbiAgZnVuY3Rpb24gZmxpcENhcmQoKSB7XFxuICAgIGlmIChsb2NrQm9hcmQgfHwgdGhpcyA9PT0gZmlyc3RDYXJkKSB7XFxuICAgICAgcmV0dXJuO1xcbiAgICB9XFxuXFxuICAgIHRoaXMuY2xhc3NMaXN0LmFkZChcXFwiZmxpcFxcXCIpO1xcblxcbiAgICBsZXQgY292ZXIgPSB0aGlzLnF1ZXJ5U2VsZWN0b3IoXFxcIi5jb3ZlclxcXCIpO1xcbiAgICBsZXQgY2FyZCA9IHRoaXMucXVlcnlTZWxlY3RvcihcXFwiLmNhcmRcXFwiKTtcXG5cXG4gICAgc2V0VGltZW91dChmdW5jdGlvbigpIHtcXG4gICAgICBjb3Zlci5jbGFzc0xpc3QuYWRkKFxcXCJoaWRkZW5cXFwiKTtcXG4gICAgICBjYXJkLmNsYXNzTGlzdC5hZGQoXFxcInZpc2libGVcXFwiKTtcXG4gICAgfSwgMTUwKTtcXG5cXG4gICAgaWYgKCFoYXNGbGlwcGVkQ2FyZCkge1xcbiAgICAgIGhhc0ZsaXBwZWRDYXJkID0gdHJ1ZTtcXG4gICAgICBmaXJzdENhcmQgPSB0aGlzO1xcblxcbiAgICAgIHJldHVybjtcXG4gICAgfVxcblxcbiAgICBzZWNvbmRDYXJkID0gdGhpcztcXG4gICAgc2V0VGltZW91dChmdW5jdGlvbigpIHtcXG4gICAgICBjaGVja0Zvck1hdGNoKCk7XFxuICAgIH0sIDMwMCk7XFxuICB9XFxuXFxuICBmdW5jdGlvbiBjaGVja0Zvck1hdGNoKCkge1xcbiAgICBsZXQgaXNNYXRjaCA9IGZpcnN0Q2FyZC5kYXRhc2V0LmZyYW1ld29yayA9PT0gc2Vjb25kQ2FyZC5kYXRhc2V0LmZyYW1ld29yaztcXG5cXG4gICAgbW92ZUNvdW50ZXIrKztcXG4gICAgdG9vbHRpcC5pbm5lclRleHQgPSBcXFwiQnJvaiBwb3RlemE6IFxcXCIgKyBtb3ZlQ291bnRlcjtcXG5cXG4gICAgaWYgKGlzTWF0Y2gpIHtcXG4gICAgICBwb2ludHMrKztcXG4gICAgICBkaXNhYmxlQ2FyZHMoKTtcXG5cXG4gICAgICBpZiAocG9pbnRzID49IHBvaW50c1RvV2luKSB7XFxuICAgICAgICBlbmRHYW1lKCk7XFxuICAgICAgfVxcbiAgICB9IGVsc2Uge1xcbiAgICAgIHVuZmxpcENhcmRzKCk7XFxuICAgIH1cXG4gIH1cXG5cXG4gIGZ1bmN0aW9uIGRpc2FibGVDYXJkcygpIHtcXG4gICAgZmlyc3RDYXJkLnJlbW92ZUV2ZW50TGlzdGVuZXIoXFxcImNsaWNrXFxcIiwgZmxpcENhcmQpO1xcbiAgICBzZWNvbmRDYXJkLnJlbW92ZUV2ZW50TGlzdGVuZXIoXFxcImNsaWNrXFxcIiwgZmxpcENhcmQpO1xcblxcbiAgICBhZGRUb29sdGlwVG9DYXJkKGZpcnN0Q2FyZCk7XFxuICAgIGFkZFRvb2x0aXBUb0NhcmQoc2Vjb25kQ2FyZCk7XFxuXFxuICAgIHJlc2V0U2VsZWN0aW9uKCk7XFxuICB9XFxuXFxuICBmdW5jdGlvbiBhZGRUb29sdGlwVG9DYXJkKGNhcmQpIHtcXG4gICAgY29uc3QgdG9vbHRpcFRleHQgPSBkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZShgJHtwb2ludHN9YCk7XFxuICAgIGNvbnN0IHRvb2x0aXAgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzcGFuJyk7XFxuICAgIHRvb2x0aXAuYXBwZW5kQ2hpbGQodG9vbHRpcFRleHQpO1xcbiAgICB0b29sdGlwLmNsYXNzTGlzdC5hZGQoJ3BhaXItdG9vbHRpcCcpO1xcblxcbiAgICBjYXJkLnN0eWxlLnRyYW5zaXRpb25EdXJhdGlvbiA9ICcwcyc7IC8vIHJlbW92ZSB0cmFuc2l0aW9uIGR1cmF0aW9uIHRvIHJlbW92ZSB1bndhbnRlZCBhbmltYXRpb25zXFxuICAgIGNhcmQuY2xhc3NMaXN0LnJlbW92ZSgnZmxpcCcpO1xcblxcbiAgICBjYXJkLnF1ZXJ5U2VsZWN0b3IoJy5jYXJkJykuc3R5bGUudHJhbnNpdGlvbkR1cmF0aW9uID0gJzBzJzsgLy8gcmVtb3ZlIHRyYW5zaXRpb24gZHVyYXRpb24gdG8gcmVtb3ZlIHVud2FudGVkIGFuaW1hdGlvbnNcXG4gICAgY2FyZC5xdWVyeVNlbGVjdG9yKCcuY2FyZCcpLnN0eWxlLnZpc2liaWxpdHkgPSAndW5zZXQnO1xcbiAgICBjYXJkLnF1ZXJ5U2VsZWN0b3IoJy5jYXJkJykuc3R5bGUudHJhbnNmb3JtID0gJ3Vuc2V0JztcXG4gICAgY2FyZC5hcHBlbmRDaGlsZCh0b29sdGlwKTtcXG4gIH1cXG5cXG4gIGZ1bmN0aW9uIHVuZmxpcENhcmRzKCkge1xcbiAgICBsb2NrQm9hcmQgPSB0cnVlO1xcblxcbiAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkge1xcbiAgICAgIGZpcnN0Q2FyZC5jbGFzc0xpc3QucmVtb3ZlKFxcXCJmbGlwXFxcIik7XFxuICAgICAgc2Vjb25kQ2FyZC5jbGFzc0xpc3QucmVtb3ZlKFxcXCJmbGlwXFxcIik7XFxuXFxuICAgICAgcmV0dXJuIGhpZGVDYXJkcygpO1xcbiAgICB9LCAxNTAwKTtcXG5cXG4gICAgZnVuY3Rpb24gaGlkZUNhcmRzKCkge1xcbiAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7XFxuICAgICAgICBmaXJzdENhcmQucXVlcnlTZWxlY3RvcihcXFwiLmNhcmRcXFwiKS5jbGFzc0xpc3QucmVtb3ZlKFxcXCJ2aXNpYmxlXFxcIik7XFxuICAgICAgICBmaXJzdENhcmQucXVlcnlTZWxlY3RvcihcXFwiLmNvdmVyXFxcIikuY2xhc3NMaXN0LnJlbW92ZShcXFwiaGlkZGVuXFxcIik7XFxuXFxuICAgICAgICBzZWNvbmRDYXJkLnF1ZXJ5U2VsZWN0b3IoXFxcIi5jYXJkXFxcIikuY2xhc3NMaXN0LnJlbW92ZShcXFwidmlzaWJsZVxcXCIpO1xcbiAgICAgICAgc2Vjb25kQ2FyZC5xdWVyeVNlbGVjdG9yKFxcXCIuY292ZXJcXFwiKS5jbGFzc0xpc3QucmVtb3ZlKFxcXCJoaWRkZW5cXFwiKTtcXG5cXG4gICAgICAgIHJlc2V0U2VsZWN0aW9uKCk7XFxuICAgICAgfSwgMTUwKTtcXG4gICAgfVxcbiAgfVxcblxcbiAgZnVuY3Rpb24gcmVzZXRTZWxlY3Rpb24oKSB7XFxuICAgIGZpcnN0Q2FyZCA9IHNlY29uZENhcmQgPSBudWxsO1xcbiAgICBsb2NrQm9hcmQgPSBoYXNGbGlwcGVkQ2FyZCA9IGZhbHNlO1xcbiAgfVxcblxcbiAgZnVuY3Rpb24gZW5kR2FtZSgpIHtcXG4gICAgdG9vbHRpcC5pbm5lclRleHQgPSBcXFwiQnJhdm8hIFVrdXBhbiBicm9qIHBvdGV6YTogXFxcIiArIG1vdmVDb3VudGVyO1xcbiAgfVxcbn1cXG5cIiIsIi8vIGV4dHJhY3RlZCBieSBtaW5pLWNzcy1leHRyYWN0LXBsdWdpbiIsInJlcXVpcmUoXCIhIS92YXIvbGliL2plbmtpbnMvd29ya3NwYWNlL2FsZ2VicmEtZnJvbnRlbmQtaW50ZXJhY3Rpb25zLXRlc3Qvbm9kZV9tb2R1bGVzL3NjcmlwdC1sb2FkZXIvYWRkU2NyaXB0LmpzXCIpKHJlcXVpcmUoXCIhIS92YXIvbGliL2plbmtpbnMvd29ya3NwYWNlL2FsZ2VicmEtZnJvbnRlbmQtaW50ZXJhY3Rpb25zLXRlc3Qvbm9kZV9tb2R1bGVzL3NjcmlwdC1sb2FkZXIvbm9kZV9tb2R1bGVzL3Jhdy1sb2FkZXIvaW5kZXguanMhL3Zhci9saWIvamVua2lucy93b3Jrc3BhY2UvYWxnZWJyYS1mcm9udGVuZC1pbnRlcmFjdGlvbnMtdGVzdC9zcmMvY29tbW9uL21haW4vY29tbS9jb21tQ2xpZW50LmpzXCIpKSIsIm1vZHVsZS5leHBvcnRzID0gXCJcXG5jb25zdCBPUklHSU5fREVGQVVMVCA9ICcqJztcXG5cXG4vKipcXG4gKiBDb250ZW50IHdpbmRvdyBjb21tdW5pY2F0aW9uIGNsaWVudC4gQ29tbXVuaWNhdGVzIHdpdGggY29udGVudCBvYmplY3QgdXNpbmcgd2luZG93LnBvc3RNZXNzYWdlIGFuZCB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lciBBUEkuXFxuICogU2VlIGh0dHBzOi8vZGV2ZWxvcGVyLm1vemlsbGEub3JnL2VuLVVTL2RvY3MvV2ViL0FQSS9XaW5kb3cvcG9zdE1lc3NhZ2VcXG4gKi9cXG5jb25zdCBDb250ZW50V2luZG93Q29tbUNsaWVudCA9IGZ1bmN0aW9uIENvbnRlbnRDb21tQ2xpZW50KGVsZW1lbnQsIG9wdGlvbnMpIHtcXG4gIC8vIC0tLS0gb3B0aW9uc1xcbiAgbGV0IGRlYnVnO1xcbiAgbGV0IG9yaWdpbjtcXG5cXG4gIGluaXQoKTtcXG5cXG5cXG4gIC8vIC0tLS0tIHB1YmxpYyBBUElcXG5cXG4gIGZ1bmN0aW9uIGluaXQoKSB7XFxuICAgIGlmICghZWxlbWVudCkge1xcbiAgICAgIHRocm93IFxcXCJFbGVtZW50IGlzIGVtcHR5LlxcXCI7XFxuICAgIH1cXG4gIFxcbiAgICBpZiAoIWVsZW1lbnQucG9zdE1lc3NhZ2UpIHtcXG4gICAgICB0aHJvdyBcXFwiRWxlbWVudCBkb2VzIG5vdCBzdXBvcnQgc2VuZGluZyBtZXNzYWdlcy5cXFwiO1xcbiAgICB9XFxuICBcXG4gICAgaWYgKCFlbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIgfHwgIWVsZW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcikge1xcbiAgICAgIHRocm93IFxcXCJFbGVtZW50IGRvZXMgbm90IHN1cG9ydCBsaXN0ZW5pbmcgdG8gbWVzc2FnZXMuXFxcIjtcXG4gICAgfVxcblxcbiAgICBkZWJ1ZyA9IHJlYWRPcHRpb24ob3B0aW9ucyAhPSBudWxsID8gb3B0aW9ucy5kZWJ1ZyA6IHVuZGVmaW5lZCwgZmFsc2UpXFxuICAgIG9yaWdpbiA9IHJlYWRPcHRpb24ob3B0aW9ucyAhPSBudWxsID8gb3B0aW9ucy5vcmlnaW4gOiB1bmRlZmluZWQsIE9SSUdJTl9ERUZBVUxUKVxcbiAgfVxcblxcbiAgdGhpcy5zZW5kTWVzc2FnZSA9IChtZXNzYWdlKSA9PiB7XFxuICAgIHRoaXMubG9nTWVzc2FnZShgc2VuZGluZ2AsIG1lc3NhZ2UpXFxuICAgIGVsZW1lbnQucG9zdE1lc3NhZ2UobWVzc2FnZSwgb3JpZ2luKVxcbiAgfVxcblxcbiAgdGhpcy5hZGRNZXNzYWdlTGlzdGVuZXIgPSAoY2FsbGJhY2spID0+IHtcXG4gICAgY29uc3QgZXZlbnRIYW5kbGVyID0gKGV2ZW50KSA9PiB7XFxuICAgICAgY29uc3QgbWVzc2FnZSA9IGV2ZW50LmRhdGE7XFxuXFxuICAgICAgLy8gcmVhY3Qgb25seSBvbiBtZXNzYWdlcyB0aGF0IGhhdmUgXFxcInR5cGVcXFwiIHByb3BlcnR5IHRvIGlnbm9yZSBvdGhlciAzcmQgcGFydHkgY29tbXVuaWNhdGlvblxcbiAgICAgIGlmIChtZXNzYWdlLnR5cGUgIT0gbnVsbCkge1xcbiAgICAgICAgdGhpcy5sb2dNZXNzYWdlKCdyZWNlaXZlZCcsIG1lc3NhZ2UpO1xcbiAgICAgICAgY2FsbGJhY2sobWVzc2FnZSlcXG4gICAgICB9XFxuICAgIH1cXG5cXG4gICAgZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKCdtZXNzYWdlJywgZXZlbnRIYW5kbGVyKTtcXG5cXG4gICAgLy8gcmV0dXJuIGV2ZW50IHVuc3Vic2NyaWJlclxcbiAgICByZXR1cm4gKCkgPT4ge1xcbiAgICAgIGVsZW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcignbWVzc2FnZScsIGV2ZW50SGFuZGxlcik7XFxuICAgIH07IFxcbiAgfVxcblxcbiAgdGhpcy5sb2dNZXNzYWdlID0gKHRleHQsIGNvbnRlbnQpID0+IHtcXG4gICAgaWYgKGRlYnVnKSB7XFxuICAgICAgY29uc3Qgb3B0aW9uc1N0ciA9IGAgKCR7SlNPTi5zdHJpbmdpZnkoeyBvcmlnaW4gfSl9KWA7XFxuICAgICAgY29uc29sZS5pbmZvKGBbQ29udGVudENvbW1dICR7dGV4dH0ke29wdGlvbnNTdHJ9OiAke0pTT04uc3RyaW5naWZ5KGNvbnRlbnQpfWApXFxuICAgIH1cXG4gIH1cXG5cXG4gIGZ1bmN0aW9uIHJlYWRPcHRpb24odmFsdWUsIGRlZmF1bHRWYWx1ZSkge1xcbiAgICByZXR1cm4gdmFsdWUgIT0gbnVsbCA/IHZhbHVlIDogZGVmYXVsdFZhbHVlO1xcbiAgfVxcbn1cXG5cXG4vKiogQ29tbW9uIG1lc3NhZ2VzICovXFxuY29uc3QgQ29udGVudENvbW1NZXNzYWdlVHlwZXMgPSB7XFxuICAvLyAtLS0tLSB0ZXN0IG1lc3NhZ2VzXFxuICBDT01NT05fRE9TX1BJTkc6ICdDT01NT05fRE9TX1BJTkcnLFxcbiAgQ09NTU9OX0NPTlRFTlRfUE9ORzogJ0NPTU1PTl9DT05URU5UX1BPTkcnLFxcbn1cXG5cXG5cXG4vLyAtLS0tLSBleHBvcnRzXFxuXFxud2luZG93WydDb250ZW50V2luZG93Q29tbUNsaWVudCddID0gQ29udGVudFdpbmRvd0NvbW1DbGllbnQ7XFxuXCIiLCJyZXF1aXJlKFwiISEvdmFyL2xpYi9qZW5raW5zL3dvcmtzcGFjZS9hbGdlYnJhLWZyb250ZW5kLWludGVyYWN0aW9ucy10ZXN0L25vZGVfbW9kdWxlcy9zY3JpcHQtbG9hZGVyL2FkZFNjcmlwdC5qc1wiKShyZXF1aXJlKFwiISEvdmFyL2xpYi9qZW5raW5zL3dvcmtzcGFjZS9hbGdlYnJhLWZyb250ZW5kLWludGVyYWN0aW9ucy10ZXN0L25vZGVfbW9kdWxlcy9zY3JpcHQtbG9hZGVyL25vZGVfbW9kdWxlcy9yYXctbG9hZGVyL2luZGV4LmpzIS92YXIvbGliL2plbmtpbnMvd29ya3NwYWNlL2FsZ2VicmEtZnJvbnRlbmQtaW50ZXJhY3Rpb25zLXRlc3Qvc3JjL2NvbW1vbi9tYWluL2NvbW0vaXZyQ29tbS5qc1wiKSkiLCJtb2R1bGUuZXhwb3J0cyA9IFwiXFxuY29uc3QgSXZyQ29udGVudENvbW1NZXNzYWdlVHlwZXMgPSB7XFxuICBET1NfU0NST0xMX0NPTlRFTlRfT0JKRUNUX1ZJU0lCTEU6ICdET1NfU0NST0xMX0NPTlRFTlRfT0JKRUNUX1ZJU0lCTEUnLFxcbn1cXG5cXG4vKipcXG4gKiBHZW5lcmljIElWUiBjb250ZW50IGNvbW11bmljYXRpb24gY2xpZW50LiBDb21tdW5pY2F0ZXMgd2l0aCBnaXZlbiBJVlIgYW5kIGxpc3RlbnMgdG8gaXQncyBtZXNzYWdlcy5cXG4gKiBcXG4gKiBAcGFyYW0geyp9IGVsZW1lbnRJZCBJRCBvZiBJVlIgZnJhbWUgZWxlbWVudFxcbiAqIEBwYXJhbSB7Kn0gb3B0aW9ucyBjb21tdW5pY2F0aW9ucyBvcHRpb25zIChzZWUgXFxcIkNvbW11bmljYXRpb24gb3B0aW9uc1xcXCIpXFxuICogXFxuICogQ29tbXVuaWNhdGlvbiBvcHRpb25zXFxuICogIC0gZGVidWcge2Jvb2xlYW59IGVuYWJsZSBkZWJ1ZyBtb2RlIChlZy4gcHJpbnQgZGVidWcgbWVzc2FnZXMgb24gY29uc29sZSlcXG4gKiAgLSBvcmlnaW4ge3N0cmluZ30gdXNlZCBhcyBvcmlnaW4gcGFyYW1ldGVyIHdoZW4gcG9zdGluZyB3aW5kb3cgbWVzc2FnZXMgKHdpbmRvdy5wb3N0TWVzc2FnZSlcXG4gKi9cXG5jb25zdCBJdnJDb250ZW50Q29tbUNsaWVudCA9IGZ1bmN0aW9uIEl2ckNvbnRlbnRDbGllbnQoZWxlbWVudElkLCBvcHRpb25zKSB7XFxuICAvLyBoYXZlIGNvbW11bmljYXRvciBhbmQgY29udGVudCBlbGVtZW50IGJlZW4gaW5pdGlhbGl6ZWRcXG4gIGxldCBpbml0aWFsaXplZCA9IGZhbHNlO1xcbiAgbGV0IGluaXRpYWxpemVkUHJvbWlzZTtcXG4gIGxldCBjb21tQ2xpZW50O1xcblxcbiAgY29uc3QgaWZyYW1lRWxlbWVudCA9ICQoYCMke2VsZW1lbnRJZH1gKTtcXG4gIGlmIChpZnJhbWVFbGVtZW50Lmxlbmd0aCA9PT0gMCkge1xcbiAgICB0aHJvdyBgSVZSIGVsZW1lbnQgJHtlbGVtZW50SWR9IG5vdCBmb3VuZGA7XFxuICB9XFxuICBjb25zdCBpZnJhbWVFbCA9IGlmcmFtZUVsZW1lbnQuZ2V0KCkuc2hpZnQoKTtcXG4gIFxcblxcbiAgLy8gaW5pdCBjbGllbnRcXG4gIGluaXQoKTtcXG5cXG4gIC8vIC0tLS0tIHB1YmxpYyBBUElcXG5cXG4gIC8qKiBSZXR1cm5zIHRydWUgaWYgY29tbXVuaWNhdG9yIGFuZCBjb250ZW50IGVsZW1lbnQgaGF2ZSBiZWVuIGluaXRpYWxpemVkIGFuZCBmYWxzZSBvdGhlcndpc2UuICovXFxuICB0aGlzLmlzSW5pdGlhbGl6ZWQgPSAoKSA9PiB7XFxuICAgIHJldHVybiB0aGlzLmlzSW5pdGlhbGl6ZWQ7XFxuICB9XFxuXFxuICAvKiogUmV0dXJucyBwcm9taXNlIHdoaWNoIGlzIHJlc29sdmVkIHdoZW4gY29tbSBoYXMgYmVlbiBpbml0aWFsaXplZC4gKi9cXG4gIHRoaXMub25Jbml0aWFsaXplZCA9ICgpID0+IHtcXG4gICAgcmV0dXJuIGluaXRpYWxpemVkUHJvbWlzZTtcXG4gIH1cXG5cXG4gIC8qKiBTZW5kIG1lc3NhZ2UgdG8gSVZSLiAqL1xcbiAgdGhpcy5zZW5kTWVzc2FnZSA9IChtZXNzYWdlKSA9PiB7XFxuICAgIGNvbW1DbGllbnQuc2VuZE1lc3NhZ2UobWVzc2FnZSk7XFxuICB9XFxuXFxuICAvKiogTGlzdGVuIHRvIElWUiBtZXNzYWdlcy4gRnVuY3Rpb24gcmV0dXJucyB1bnN1YnNjcmliZSBmdW5jdGlvbi4gKi9cXG4gIHRoaXMuYWRkTWVzc2FnZUxpc3RlbmVyID0gKGxpc3RlbmVyKSA9PiB7XFxuICAgIHJldHVybiBjb21tQ2xpZW50LmFkZE1lc3NhZ2VMaXN0ZW5lcihsaXN0ZW5lcik7XFxuICB9XFxuXFxuXFxuICAvLyAtLS0tLSBwcml2YXRlXFxuXFxuICAvKiogSW5pdGlhbGl6ZSBldmVyeXRoaW5nICovXFxuICBmdW5jdGlvbiBpbml0KCkge1xcbiAgICBsZXQgcmVzb2x2ZVJlZiwgcmVqZWN0UmVmO1xcbiAgICBpbml0aWFsaXplZFByb21pc2UgPSBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XFxuICAgICAgLy8gYWxsb3cgZXh0ZXJuYWwgcHJvbWlzZSBoYW5kbGluZ1xcbiAgICAgIHJlc29sdmVSZWYgPSByZXNvbHZlXFxuICAgICAgcmVqZWN0UmVmID0gcmVqZWN0O1xcbiAgICB9KTtcXG5cXG4gICAgdmFyIGNvbnRlbnRXaW5kb3cgPSBpZnJhbWVFbC5jb250ZW50V2luZG93O1xcbiAgICBjb21tQ2xpZW50ID0gbmV3IENvbnRlbnRXaW5kb3dDb21tQ2xpZW50KGNvbnRlbnRXaW5kb3csIG9wdGlvbnMpO1xcbiAgICBjb250ZW50V2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ2xvYWQnLCAoKSA9PiB7XFxuICAgICAgaW5pdGlhbGl6ZWQgPSB0cnVlO1xcbiAgICAgIHJlc29sdmVSZWYoKTtcXG4gICAgfSkgIFxcbiAgfVxcbn1cXG5cXG4vKipcXG4gKiBTY3JvbGwgdmlzaWJsZSBJVlIgY29udGVudCBjb21tdW5pY2F0aW9uIGNsaWVudC4gSGFuZGxlcyBJVlIncyBcXFwiRE9TX1NDUk9MTF9DT05URU5UX09CSkVDVF9WSVNJQkxFXFxcIi5cXG4gKiBVc2VzIEl2ckNvbnRlbnRDb21tQ2xpZW50IHVuZGVyaG9vZCBzbyBzZWUgdGhlcmUgZm9yIG1vcmUgZGV0YWlscy5cXG4gKiBcXG4gKiBBZGRpdGlvbmFsIG9wdGlvbnM6XFxuICogIC0gdG9wT2Zmc2V0IHtudW1iZXJ9IG51bWJlciBvZiBwaXhlbHMgdG8gd2hpY2ggdG8gc2Nyb2xsIGJvZHlcXG4gKi9cXG5jb25zdCBTY3JvbGxWaXNpYmxlSXZyQ29udGVudENvbW1DbGllbnQgPSBmdW5jdGlvbiBJdnJDb250ZW50Q2xpZW50KGVsZW1lbnRJZCwgb3B0aW9ucykge1xcbiAgLy8gb3B0aW9uc1xcbiAgbGV0IHRvcE9mZnNldDtcXG5cXG4gIGxldCBpdnJDb21tQ2xpZW50O1xcblxcbiAgLy8gaW5pdCBjbGllbnRcXG4gIGluaXQoKTtcXG5cXG4gIC8vIC0tLS0tIHB1YmxpYyBBUElcXG5cXG4gIC8qKiBSZXR1cm5zIHRydWUgaWYgY29tbXVuaWNhdG9yIGFuZCBjb250ZW50IGVsZW1lbnQgaGF2ZSBiZWVuIGluaXRpYWxpemVkIGFuZCBmYWxzZSBvdGhlcndpc2UuICovXFxuICB0aGlzLmlzSW5pdGlhbGl6ZWQgPSAoKSA9PiB7XFxuICAgIHJldHVybiBpdnJDb21tQ2xpZW50ICYmIGl2ckNvbW1DbGllbnQuaXNJbml0aWFsaXplZCgpO1xcbiAgfVxcblxcbiAgLyoqICovXFxuICB0aGlzLm9uSW5pdGlhbGl6ZWQgPSAoKSA9PiB7XFxuICAgIHJldHVybiBpdnJDb21tQ2xpZW50Lm9uSW5pdGlhbGl6ZWQoKTtcXG4gIH1cXG5cXG5cXG4gIC8vIC0tLS0tIHByaXZhdGVcXG5cXG4gIC8qKiBJbml0aWFsaXplIGV2ZXJ5dGhpbmcgKi9cXG4gIGZ1bmN0aW9uIGluaXQoKSB7XFxuICAgIHRvcE9mZnNldCA9IHJlYWRPcHRpb24ob3B0aW9ucyAmJiBvcHRpb25zLnRvcE9mZnNldCwgMTAwKTtcXG5cXG4gICAgaXZyQ29tbUNsaWVudCA9IG5ldyBJdnJDb250ZW50Q29tbUNsaWVudChlbGVtZW50SWQsIG9wdGlvbnMpO1xcbiAgICBpdnJDb21tQ2xpZW50LmFkZE1lc3NhZ2VMaXN0ZW5lcihoYW5kbGVNZXNzYWdlKVxcbiAgfVxcblxcbiAgZnVuY3Rpb24gaGFuZGxlTWVzc2FnZShtZXNzYWdlKSB7XFxuICAgIGlmIChJdnJDb250ZW50Q29tbU1lc3NhZ2VUeXBlcy5ET1NfU0NST0xMX0NPTlRFTlRfT0JKRUNUX1ZJU0lCTEUgPT09IG1lc3NhZ2UudHlwZSkge1xcbiAgICAgIGhhbmRsZVNjcm9sbFZpc2libGUoKTtcXG4gICAgfVxcbiAgfVxcblxcbiAgZnVuY3Rpb24gaGFuZGxlU2Nyb2xsVmlzaWJsZSgpIHtcXG4gICAgJCgnaHRtbCwgYm9keScpLmFuaW1hdGUoe1xcbiAgICAgIHNjcm9sbFRvcDogJChgIyR7ZWxlbWVudElkfWApLm9mZnNldCgpLnRvcCAtIHRvcE9mZnNldCAvLyBTY3JvbGwgdG8gdGhpcyBsb2NhdGlvbi5cXG4gICAgfSk7XFxuICB9XFxuXFxuICBmdW5jdGlvbiByZWFkT3B0aW9uKHZhbHVlLCBkZWZhdWx0VmFsdWUpIHtcXG4gICAgcmV0dXJuIHZhbHVlICE9IG51bGwgPyB2YWx1ZSA6IGRlZmF1bHRWYWx1ZTtcXG4gIH1cXG59XFxuXFxuXFxuLy8gLS0tLS0gZXhwb3J0c1xcblxcbndpbmRvd1snSXZyQ29udGVudENvbW1DbGllbnQnXSA9IEl2ckNvbnRlbnRDb21tQ2xpZW50O1xcbndpbmRvd1snU2Nyb2xsVmlzaWJsZUl2ckNvbnRlbnRDb21tQ2xpZW50J10gPSBTY3JvbGxWaXNpYmxlSXZyQ29udGVudENvbW1DbGllbnQ7XFxuXCIiXSwic291cmNlUm9vdCI6IiJ9